(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();function _T(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Sf={exports:{}},Io={};var ib;function px(){if(ib)return Io;ib=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,a,o){var c=null;if(o!==void 0&&(c=""+o),a.key!==void 0&&(c=""+a.key),"key"in a){o={};for(var u in a)u!=="key"&&(o[u]=a[u])}else o=a;return a=o.ref,{$$typeof:n,type:i,key:c,ref:a!==void 0?a:null,props:o}}return Io.Fragment=e,Io.jsx=t,Io.jsxs=t,Io}var rb;function mx(){return rb||(rb=1,Sf.exports=px()),Sf.exports}var g=mx(),Tf={exports:{}},xe={};var ab;function gx(){if(ab)return xe;ab=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),y=Symbol.for("react.activity"),b=Symbol.iterator;function k(D){return D===null||typeof D!="object"?null:(D=b&&D[b]||D["@@iterator"],typeof D=="function"?D:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,O={};function R(D,J,oe){this.props=D,this.context=J,this.refs=O,this.updater=oe||C}R.prototype.isReactComponent={},R.prototype.setState=function(D,J){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,J,"setState")},R.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function P(){}P.prototype=R.prototype;function j(D,J,oe){this.props=D,this.context=J,this.refs=O,this.updater=oe||C}var E=j.prototype=new P;E.constructor=j,w(E,R.prototype),E.isPureReactComponent=!0;var _=Array.isArray;function A(){}var I={H:null,A:null,T:null,S:null},F=Object.prototype.hasOwnProperty;function B(D,J,oe){var de=oe.ref;return{$$typeof:n,type:D,key:J,ref:de!==void 0?de:null,props:oe}}function z(D,J){return B(D.type,J,D.props)}function H(D){return typeof D=="object"&&D!==null&&D.$$typeof===n}function ie(D){var J={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(oe){return J[oe]})}var he=/\/+/g;function Z(D,J){return typeof D=="object"&&D!==null&&D.key!=null?ie(""+D.key):J.toString(36)}function le(D){switch(D.status){case"fulfilled":return D.value;case"rejected":throw D.reason;default:switch(typeof D.status=="string"?D.then(A,A):(D.status="pending",D.then(function(J){D.status==="pending"&&(D.status="fulfilled",D.value=J)},function(J){D.status==="pending"&&(D.status="rejected",D.reason=J)})),D.status){case"fulfilled":return D.value;case"rejected":throw D.reason}}throw D}function N(D,J,oe,de,ge){var _e=typeof D;(_e==="undefined"||_e==="boolean")&&(D=null);var Se=!1;if(D===null)Se=!0;else switch(_e){case"bigint":case"string":case"number":Se=!0;break;case"object":switch(D.$$typeof){case n:case e:Se=!0;break;case p:return Se=D._init,N(Se(D._payload),J,oe,de,ge)}}if(Se)return ge=ge(D),Se=de===""?"."+Z(D,0):de,_(ge)?(oe="",Se!=null&&(oe=Se.replace(he,"$&/")+"/"),N(ge,J,oe,"",function(hn){return hn})):ge!=null&&(H(ge)&&(ge=z(ge,oe+(ge.key==null||D&&D.key===ge.key?"":(""+ge.key).replace(he,"$&/")+"/")+Se)),J.push(ge)),1;Se=0;var nt=de===""?".":de+":";if(_(D))for(var Fe=0;Fe<D.length;Fe++)de=D[Fe],_e=nt+Z(de,Fe),Se+=N(de,J,oe,_e,ge);else if(Fe=k(D),typeof Fe=="function")for(D=Fe.call(D),Fe=0;!(de=D.next()).done;)de=de.value,_e=nt+Z(de,Fe++),Se+=N(de,J,oe,_e,ge);else if(_e==="object"){if(typeof D.then=="function")return N(le(D),J,oe,de,ge);throw J=String(D),Error("Objects are not valid as a React child (found: "+(J==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":J)+"). If you meant to render a collection of children, use an array instead.")}return Se}function K(D,J,oe){if(D==null)return D;var de=[],ge=0;return N(D,de,"","",function(_e){return J.call(oe,_e,ge++)}),de}function ae(D){if(D._status===-1){var J=D._result;J=J(),J.then(function(oe){(D._status===0||D._status===-1)&&(D._status=1,D._result=oe)},function(oe){(D._status===0||D._status===-1)&&(D._status=2,D._result=oe)}),D._status===-1&&(D._status=0,D._result=J)}if(D._status===1)return D._result.default;throw D._result}var pe=typeof reportError=="function"?reportError:function(D){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var J=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof D=="object"&&D!==null&&typeof D.message=="string"?String(D.message):String(D),error:D});if(!window.dispatchEvent(J))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",D);return}console.error(D)},ye={map:K,forEach:function(D,J,oe){K(D,function(){J.apply(this,arguments)},oe)},count:function(D){var J=0;return K(D,function(){J++}),J},toArray:function(D){return K(D,function(J){return J})||[]},only:function(D){if(!H(D))throw Error("React.Children.only expected to receive a single React element child.");return D}};return xe.Activity=y,xe.Children=ye,xe.Component=R,xe.Fragment=t,xe.Profiler=a,xe.PureComponent=j,xe.StrictMode=i,xe.Suspense=h,xe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=I,xe.__COMPILER_RUNTIME={__proto__:null,c:function(D){return I.H.useMemoCache(D)}},xe.cache=function(D){return function(){return D.apply(null,arguments)}},xe.cacheSignal=function(){return null},xe.cloneElement=function(D,J,oe){if(D==null)throw Error("The argument must be a React element, but you passed "+D+".");var de=w({},D.props),ge=D.key;if(J!=null)for(_e in J.key!==void 0&&(ge=""+J.key),J)!F.call(J,_e)||_e==="key"||_e==="__self"||_e==="__source"||_e==="ref"&&J.ref===void 0||(de[_e]=J[_e]);var _e=arguments.length-2;if(_e===1)de.children=oe;else if(1<_e){for(var Se=Array(_e),nt=0;nt<_e;nt++)Se[nt]=arguments[nt+2];de.children=Se}return B(D.type,ge,de)},xe.createContext=function(D){return D={$$typeof:c,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null},D.Provider=D,D.Consumer={$$typeof:o,_context:D},D},xe.createElement=function(D,J,oe){var de,ge={},_e=null;if(J!=null)for(de in J.key!==void 0&&(_e=""+J.key),J)F.call(J,de)&&de!=="key"&&de!=="__self"&&de!=="__source"&&(ge[de]=J[de]);var Se=arguments.length-2;if(Se===1)ge.children=oe;else if(1<Se){for(var nt=Array(Se),Fe=0;Fe<Se;Fe++)nt[Fe]=arguments[Fe+2];ge.children=nt}if(D&&D.defaultProps)for(de in Se=D.defaultProps,Se)ge[de]===void 0&&(ge[de]=Se[de]);return B(D,_e,ge)},xe.createRef=function(){return{current:null}},xe.forwardRef=function(D){return{$$typeof:u,render:D}},xe.isValidElement=H,xe.lazy=function(D){return{$$typeof:p,_payload:{_status:-1,_result:D},_init:ae}},xe.memo=function(D,J){return{$$typeof:f,type:D,compare:J===void 0?null:J}},xe.startTransition=function(D){var J=I.T,oe={};I.T=oe;try{var de=D(),ge=I.S;ge!==null&&ge(oe,de),typeof de=="object"&&de!==null&&typeof de.then=="function"&&de.then(A,pe)}catch(_e){pe(_e)}finally{J!==null&&oe.types!==null&&(J.types=oe.types),I.T=J}},xe.unstable_useCacheRefresh=function(){return I.H.useCacheRefresh()},xe.use=function(D){return I.H.use(D)},xe.useActionState=function(D,J,oe){return I.H.useActionState(D,J,oe)},xe.useCallback=function(D,J){return I.H.useCallback(D,J)},xe.useContext=function(D){return I.H.useContext(D)},xe.useDebugValue=function(){},xe.useDeferredValue=function(D,J){return I.H.useDeferredValue(D,J)},xe.useEffect=function(D,J){return I.H.useEffect(D,J)},xe.useEffectEvent=function(D){return I.H.useEffectEvent(D)},xe.useId=function(){return I.H.useId()},xe.useImperativeHandle=function(D,J,oe){return I.H.useImperativeHandle(D,J,oe)},xe.useInsertionEffect=function(D,J){return I.H.useInsertionEffect(D,J)},xe.useLayoutEffect=function(D,J){return I.H.useLayoutEffect(D,J)},xe.useMemo=function(D,J){return I.H.useMemo(D,J)},xe.useOptimistic=function(D,J){return I.H.useOptimistic(D,J)},xe.useReducer=function(D,J,oe){return I.H.useReducer(D,J,oe)},xe.useRef=function(D){return I.H.useRef(D)},xe.useState=function(D){return I.H.useState(D)},xe.useSyncExternalStore=function(D,J,oe){return I.H.useSyncExternalStore(D,J,oe)},xe.useTransition=function(){return I.H.useTransition()},xe.version="19.2.3",xe}var sb;function rm(){return sb||(sb=1,Tf.exports=gx()),Tf.exports}var T=rm();const Go=_T(T);function Uu(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,i=Object.getOwnPropertySymbols(n);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(n,i[a])&&(t[i[a]]=n[i[a]]);return t}function vx(n,e,t,i){function a(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function u(p){try{f(i.next(p))}catch(y){c(y)}}function h(p){try{f(i.throw(p))}catch(y){c(y)}}function f(p){p.done?o(p.value):a(p.value).then(u,h)}f((i=i.apply(n,e||[])).next())})}const yx=n=>n?(...e)=>n(...e):(...e)=>fetch(...e);class am extends Error{constructor(e,t="FunctionsError",i){super(e),this.name=t,this.context=i}}class bx extends am{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ob extends am{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class lb extends am{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var lp;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(lp||(lp={}));class Sx{constructor(e,{headers:t={},customFetch:i,region:a=lp.Any}={}){this.url=e,this.headers=t,this.region=a,this.fetch=yx(i)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return vx(this,arguments,void 0,function*(t,i={}){var a;let o,c;try{const{headers:u,method:h,body:f,signal:p,timeout:y}=i;let b={},{region:k}=i;k||(k=this.region);const C=new URL(`${this.url}/${t}`);k&&k!=="any"&&(b["x-region"]=k,C.searchParams.set("forceFunctionRegion",k));let w;f&&(u&&!Object.prototype.hasOwnProperty.call(u,"Content-Type")||!u)?typeof Blob<"u"&&f instanceof Blob||f instanceof ArrayBuffer?(b["Content-Type"]="application/octet-stream",w=f):typeof f=="string"?(b["Content-Type"]="text/plain",w=f):typeof FormData<"u"&&f instanceof FormData?w=f:(b["Content-Type"]="application/json",w=JSON.stringify(f)):f&&typeof f!="string"&&!(typeof Blob<"u"&&f instanceof Blob)&&!(f instanceof ArrayBuffer)&&!(typeof FormData<"u"&&f instanceof FormData)?w=JSON.stringify(f):w=f;let O=p;y&&(c=new AbortController,o=setTimeout(()=>c.abort(),y),p?(O=c.signal,p.addEventListener("abort",()=>c.abort())):O=c.signal);const R=yield this.fetch(C.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},b),this.headers),u),body:w,signal:O}).catch(_=>{throw new bx(_)}),P=R.headers.get("x-relay-error");if(P&&P==="true")throw new ob(R);if(!R.ok)throw new lb(R);let j=((a=R.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),E;return j==="application/json"?E=yield R.json():j==="application/octet-stream"||j==="application/pdf"?E=yield R.blob():j==="text/event-stream"?E=R:j==="multipart/form-data"?E=yield R.formData():E=yield R.text(),{data:E,error:null,response:R}}catch(u){return{data:null,error:u,response:u instanceof lb||u instanceof ob?u.context:void 0}}finally{o&&clearTimeout(o)}})}}var Tx=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},kx=class{constructor(n){var e,t;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(e=n.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=n.signal,this.isMaybeSingle=(t=n.isMaybeSingle)!==null&&t!==void 0?t:!1,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,e){return this.headers=new Headers(this.headers),this.headers.set(n,e),this}then(n,e){var t=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const i=this.fetch;let a=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{let c=null,u=null,h=null,f=o.status,p=o.statusText;if(o.ok){var y,b;if(t.method!=="HEAD"){var k;const R=await o.text();R===""||(t.headers.get("Accept")==="text/csv"||t.headers.get("Accept")&&(!((k=t.headers.get("Accept"))===null||k===void 0)&&k.includes("application/vnd.pgrst.plan+text"))?u=R:u=JSON.parse(R))}const w=(y=t.headers.get("Prefer"))===null||y===void 0?void 0:y.match(/count=(exact|planned|estimated)/),O=(b=o.headers.get("content-range"))===null||b===void 0?void 0:b.split("/");w&&O&&O.length>1&&(h=parseInt(O[1])),t.isMaybeSingle&&t.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,f=406,p="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{var C;const w=await o.text();try{c=JSON.parse(w),Array.isArray(c)&&o.status===404&&(u=[],c=null,f=200,p="OK")}catch{o.status===404&&w===""?(f=204,p="No Content"):c={message:w}}if(c&&t.isMaybeSingle&&(!(c==null||(C=c.details)===null||C===void 0)&&C.includes("0 rows"))&&(c=null,f=200,p="OK"),c&&t.shouldThrowOnError)throw new Tx(c)}return{error:c,data:u,count:h,status:f,statusText:p}});return this.shouldThrowOnError||(a=a.catch(o=>{var c;let u="";const h=o?.cause;if(h){var f,p,y,b;const C=(f=h?.message)!==null&&f!==void 0?f:"",w=(p=h?.code)!==null&&p!==void 0?p:"";u=`${(y=o?.name)!==null&&y!==void 0?y:"FetchError"}: ${o?.message}`,u+=`

Caused by: ${(b=h?.name)!==null&&b!==void 0?b:"Error"}: ${C}`,w&&(u+=` (${w})`),h?.stack&&(u+=`
${h.stack}`)}else{var k;u=(k=o?.stack)!==null&&k!==void 0?k:""}return{error:{message:`${(c=o?.name)!==null&&c!==void 0?c:"FetchError"}: ${o?.message}`,details:u,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),a.then(n,e)}returns(){return this}overrideTypes(){return this}},wx=class extends kx{select(n){let e=!1;const t=(n??"*").split("").map(i=>/\s/.test(i)&&!e?"":(i==='"'&&(e=!e),i)).join("");return this.url.searchParams.set("select",t),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:e=!0,nullsFirst:t,foreignTable:i,referencedTable:a=i}={}){const o=a?`${a}.order`:"order",c=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${c?`${c},`:""}${n}.${e?"asc":"desc"}${t===void 0?"":t?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:e,referencedTable:t=e}={}){const i=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(i,`${n}`),this}range(n,e,{foreignTable:t,referencedTable:i=t}={}){const a=typeof i>"u"?"offset":`${i}.offset`,o=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${n}`),this.url.searchParams.set(o,`${e-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:e=!1,settings:t=!1,buffers:i=!1,wal:a=!1,format:o="text"}={}){var c;const u=[n?"analyze":null,e?"verbose":null,t?"settings":null,i?"buffers":null,a?"wal":null].filter(Boolean).join("|"),h=(c=this.headers.get("Accept"))!==null&&c!==void 0?c:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${o}; for="${h}"; options=${u};`),o==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const cb=new RegExp("[,()]");var vs=class extends wx{eq(n,e){return this.url.searchParams.append(n,`eq.${e}`),this}neq(n,e){return this.url.searchParams.append(n,`neq.${e}`),this}gt(n,e){return this.url.searchParams.append(n,`gt.${e}`),this}gte(n,e){return this.url.searchParams.append(n,`gte.${e}`),this}lt(n,e){return this.url.searchParams.append(n,`lt.${e}`),this}lte(n,e){return this.url.searchParams.append(n,`lte.${e}`),this}like(n,e){return this.url.searchParams.append(n,`like.${e}`),this}likeAllOf(n,e){return this.url.searchParams.append(n,`like(all).{${e.join(",")}}`),this}likeAnyOf(n,e){return this.url.searchParams.append(n,`like(any).{${e.join(",")}}`),this}ilike(n,e){return this.url.searchParams.append(n,`ilike.${e}`),this}ilikeAllOf(n,e){return this.url.searchParams.append(n,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(n,e){return this.url.searchParams.append(n,`ilike(any).{${e.join(",")}}`),this}regexMatch(n,e){return this.url.searchParams.append(n,`match.${e}`),this}regexIMatch(n,e){return this.url.searchParams.append(n,`imatch.${e}`),this}is(n,e){return this.url.searchParams.append(n,`is.${e}`),this}isDistinct(n,e){return this.url.searchParams.append(n,`isdistinct.${e}`),this}in(n,e){const t=Array.from(new Set(e)).map(i=>typeof i=="string"&&cb.test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(n,`in.(${t})`),this}notIn(n,e){const t=Array.from(new Set(e)).map(i=>typeof i=="string"&&cb.test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(n,`not.in.(${t})`),this}contains(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cs.{${e.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(e)}`),this}containedBy(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cd.{${e.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(e)}`),this}rangeGt(n,e){return this.url.searchParams.append(n,`sr.${e}`),this}rangeGte(n,e){return this.url.searchParams.append(n,`nxl.${e}`),this}rangeLt(n,e){return this.url.searchParams.append(n,`sl.${e}`),this}rangeLte(n,e){return this.url.searchParams.append(n,`nxr.${e}`),this}rangeAdjacent(n,e){return this.url.searchParams.append(n,`adj.${e}`),this}overlaps(n,e){return typeof e=="string"?this.url.searchParams.append(n,`ov.${e}`):this.url.searchParams.append(n,`ov.{${e.join(",")}}`),this}textSearch(n,e,{config:t,type:i}={}){let a="";i==="plain"?a="pl":i==="phrase"?a="ph":i==="websearch"&&(a="w");const o=t===void 0?"":`(${t})`;return this.url.searchParams.append(n,`${a}fts${o}.${e}`),this}match(n){return Object.entries(n).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(n,e,t){return this.url.searchParams.append(n,`not.${e}.${t}`),this}or(n,{foreignTable:e,referencedTable:t=e}={}){const i=t?`${t}.or`:"or";return this.url.searchParams.append(i,`(${n})`),this}filter(n,e,t){return this.url.searchParams.append(n,`${e}.${t}`),this}},Cx=class{constructor(n,{headers:e={},schema:t,fetch:i}){this.url=n,this.headers=new Headers(e),this.schema=t,this.fetch=i}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(n,e){const{head:t=!1,count:i}=e??{},a=t?"HEAD":"GET";let o=!1;const c=(n??"*").split("").map(f=>/\s/.test(f)&&!o?"":(f==='"'&&(o=!o),f)).join(""),{url:u,headers:h}=this.cloneRequestState();return u.searchParams.set("select",c),i&&h.append("Prefer",`count=${i}`),new vs({method:a,url:u,headers:h,schema:this.schema,fetch:this.fetch})}insert(n,{count:e,defaultToNull:t=!0}={}){var i;const a="POST",{url:o,headers:c}=this.cloneRequestState();if(e&&c.append("Prefer",`count=${e}`),t||c.append("Prefer","missing=default"),Array.isArray(n)){const u=n.reduce((h,f)=>h.concat(Object.keys(f)),[]);if(u.length>0){const h=[...new Set(u)].map(f=>`"${f}"`);o.searchParams.set("columns",h.join(","))}}return new vs({method:a,url:o,headers:c,schema:this.schema,body:n,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}upsert(n,{onConflict:e,ignoreDuplicates:t=!1,count:i,defaultToNull:a=!0}={}){var o;const c="POST",{url:u,headers:h}=this.cloneRequestState();if(h.append("Prefer",`resolution=${t?"ignore":"merge"}-duplicates`),e!==void 0&&u.searchParams.set("on_conflict",e),i&&h.append("Prefer",`count=${i}`),a||h.append("Prefer","missing=default"),Array.isArray(n)){const f=n.reduce((p,y)=>p.concat(Object.keys(y)),[]);if(f.length>0){const p=[...new Set(f)].map(y=>`"${y}"`);u.searchParams.set("columns",p.join(","))}}return new vs({method:c,url:u,headers:h,schema:this.schema,body:n,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}update(n,{count:e}={}){var t;const i="PATCH",{url:a,headers:o}=this.cloneRequestState();return e&&o.append("Prefer",`count=${e}`),new vs({method:i,url:a,headers:o,schema:this.schema,body:n,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}delete({count:n}={}){var e;const t="DELETE",{url:i,headers:a}=this.cloneRequestState();return n&&a.append("Prefer",`count=${n}`),new vs({method:t,url:i,headers:a,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},_x=class xT{constructor(e,{headers:t={},schema:i,fetch:a}={}){this.url=e,this.headers=new Headers(t),this.schemaName=i,this.fetch=a}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new Cx(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new xT(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:i=!1,get:a=!1,count:o}={}){var c;let u;const h=new URL(`${this.url}/rpc/${e}`);let f;const p=k=>k!==null&&typeof k=="object"&&(!Array.isArray(k)||k.some(p)),y=i&&Object.values(t).some(p);y?(u="POST",f=t):i||a?(u=i?"HEAD":"GET",Object.entries(t).filter(([k,C])=>C!==void 0).map(([k,C])=>[k,Array.isArray(C)?`{${C.join(",")}}`:`${C}`]).forEach(([k,C])=>{h.searchParams.append(k,C)})):(u="POST",f=t);const b=new Headers(this.headers);return y?b.set("Prefer",o?`count=${o},return=minimal`:"return=minimal"):o&&b.set("Prefer",`count=${o}`),new vs({method:u,url:h,headers:b,schema:this.schemaName,body:f,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}};class xx{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const t=globalThis.process;if(t){const i=t.versions;if(i&&i.node){const a=i.node,o=parseInt(a.replace(/^v/,"").split(".")[0]);return o>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${o} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${o} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const i=this.getWebSocketConstructor();return new i(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Ex="2.90.1",Rx=`realtime-js/${Ex}`,ET="1.0.0",Ox="2.0.0",ub=ET,cp=1e4,Ax=1e3,jx=100;var Or;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Or||(Or={}));var Rt;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Rt||(Rt={}));var Qn;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Qn||(Qn={}));var up;(function(n){n.websocket="websocket"})(up||(up={}));var fa;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(fa||(fa={}));class Px{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let i=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(i))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,i;const a=(i=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&i!==void 0?i:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,a)}_encodeJsonUserBroadcastPush(e){var t,i;const a=(i=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&i!==void 0?i:{},c=new TextEncoder().encode(JSON.stringify(a)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,c)}_encodeUserBroadcastPush(e,t,i){var a,o;const c=e.topic,u=(a=e.ref)!==null&&a!==void 0?a:"",h=(o=e.join_ref)!==null&&o!==void 0?o:"",f=e.payload.event,p=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},y=Object.keys(p).length===0?"":JSON.stringify(p);if(h.length>255)throw new Error(`joinRef length ${h.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`ref length ${u.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`topic length ${c.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`userEvent length ${f.length} exceeds maximum of 255`);if(y.length>255)throw new Error(`metadata length ${y.length} exceeds maximum of 255`);const b=this.USER_BROADCAST_PUSH_META_LENGTH+h.length+u.length+c.length+f.length+y.length,k=new ArrayBuffer(this.HEADER_LENGTH+b);let C=new DataView(k),w=0;C.setUint8(w++,this.KINDS.userBroadcastPush),C.setUint8(w++,h.length),C.setUint8(w++,u.length),C.setUint8(w++,c.length),C.setUint8(w++,f.length),C.setUint8(w++,y.length),C.setUint8(w++,t),Array.from(h,R=>C.setUint8(w++,R.charCodeAt(0))),Array.from(u,R=>C.setUint8(w++,R.charCodeAt(0))),Array.from(c,R=>C.setUint8(w++,R.charCodeAt(0))),Array.from(f,R=>C.setUint8(w++,R.charCodeAt(0))),Array.from(y,R=>C.setUint8(w++,R.charCodeAt(0)));var O=new Uint8Array(k.byteLength+i.byteLength);return O.set(new Uint8Array(k),0),O.set(new Uint8Array(i),k.byteLength),O.buffer}decode(e,t){if(this._isArrayBuffer(e)){let i=this._binaryDecode(e);return t(i)}if(typeof e=="string"){const i=JSON.parse(e),[a,o,c,u,h]=i;return t({join_ref:a,ref:o,topic:c,event:u,payload:h})}return t({})}_binaryDecode(e){const t=new DataView(e),i=t.getUint8(0),a=new TextDecoder;if(i===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,a)}_decodeUserBroadcast(e,t,i){const a=t.getUint8(1),o=t.getUint8(2),c=t.getUint8(3),u=t.getUint8(4);let h=this.HEADER_LENGTH+4;const f=i.decode(e.slice(h,h+a));h=h+a;const p=i.decode(e.slice(h,h+o));h=h+o;const y=i.decode(e.slice(h,h+c));h=h+c;const b=e.slice(h,e.byteLength),k=u===this.JSON_ENCODING?JSON.parse(i.decode(b)):b,C={type:this.BROADCAST_EVENT,event:p,payload:k};return c>0&&(C.meta=JSON.parse(y)),{join_ref:null,ref:null,topic:f,event:this.BROADCAST_EVENT,payload:C}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e?.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([i])=>t.includes(i)))}}class RT{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var it;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(it||(it={}));const db=(n,e,t={})=>{var i;const a=(i=t.skipTypes)!==null&&i!==void 0?i:[];return e?Object.keys(e).reduce((o,c)=>(o[c]=Dx(c,n,e,a),o),{}):{}},Dx=(n,e,t,i)=>{const a=e.find(u=>u.name===n),o=a?.type,c=t[n];return o&&!i.includes(o)?OT(o,c):dp(c)},OT=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return Lx(e,t)}switch(n){case it.bool:return Mx(e);case it.float4:case it.float8:case it.int2:case it.int4:case it.int8:case it.numeric:case it.oid:return Nx(e);case it.json:case it.jsonb:return Ix(e);case it.timestamp:return Ux(e);case it.abstime:case it.date:case it.daterange:case it.int4range:case it.int8range:case it.money:case it.reltime:case it.text:case it.time:case it.timestamptz:case it.timetz:case it.tsrange:case it.tstzrange:return dp(e);default:return dp(e)}},dp=n=>n,Mx=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},Nx=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},Ix=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},Lx=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,i=n[t];if(n[0]==="{"&&i==="}"){let o;const c=n.slice(1,t);try{o=JSON.parse("["+c+"]")}catch{o=c?c.split(","):[]}return o.map(u=>OT(e,u))}return n},Ux=n=>typeof n=="string"?n.replace(" ","T"):n,AT=n=>{const e=new URL(n);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class kf{constructor(e,t,i={},a=cp){this.channel=e,this.event=t,this.payload=i,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var i;return this._hasReceived(e)&&t((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(i=>i.status===e).forEach(i=>i.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var hb;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(hb||(hb={}));class Qo{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},a=>{const{onJoin:o,onLeave:c,onSync:u}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Qo.syncState(this.state,a,o,c),this.pendingDiffs.forEach(h=>{this.state=Qo.syncDiff(this.state,h,o,c)}),this.pendingDiffs=[],u()}),this.channel._on(i.diff,{},a=>{const{onJoin:o,onLeave:c,onSync:u}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=Qo.syncDiff(this.state,a,o,c),u())}),this.onJoin((a,o,c)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:o,newPresences:c})}),this.onLeave((a,o,c)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:o,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,i,a){const o=this.cloneDeep(e),c=this.transformState(t),u={},h={};return this.map(o,(f,p)=>{c[f]||(h[f]=p)}),this.map(c,(f,p)=>{const y=o[f];if(y){const b=p.map(O=>O.presence_ref),k=y.map(O=>O.presence_ref),C=p.filter(O=>k.indexOf(O.presence_ref)<0),w=y.filter(O=>b.indexOf(O.presence_ref)<0);C.length>0&&(u[f]=C),w.length>0&&(h[f]=w)}else u[f]=p}),this.syncDiff(o,{joins:u,leaves:h},i,a)}static syncDiff(e,t,i,a){const{joins:o,leaves:c}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return i||(i=()=>{}),a||(a=()=>{}),this.map(o,(u,h)=>{var f;const p=(f=e[u])!==null&&f!==void 0?f:[];if(e[u]=this.cloneDeep(h),p.length>0){const y=e[u].map(k=>k.presence_ref),b=p.filter(k=>y.indexOf(k.presence_ref)<0);e[u].unshift(...b)}i(u,p,h)}),this.map(c,(u,h)=>{let f=e[u];if(!f)return;const p=h.map(y=>y.presence_ref);f=f.filter(y=>p.indexOf(y.presence_ref)<0),e[u]=f,a(u,f,h),f.length===0&&delete e[u]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(i=>t(i,e[i]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,i)=>{const a=e[i];return"metas"in a?t[i]=a.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):t[i]=a,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var fb;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(fb||(fb={}));var Xo;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Xo||(Xo={}));var Bi;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Bi||(Bi={}));class Ss{constructor(e,t={config:{}},i){var a,o;if(this.topic=e,this.params=t,this.socket=i,this.bindings={},this.state=Rt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new kf(this,Qn.join,this.params,this.timeout),this.rejoinTimer=new RT(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Rt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(c=>c.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Rt.closed,this.socket._remove(this)}),this._onError(c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=Rt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Rt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=Rt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Qn.reply,{},(c,u)=>{this._trigger(this._replyEventName(u),c)}),this.presence=new Qo(this),this.broadcastEndpointURL=AT(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(a=this.params.config)===null||a===void 0?void 0:a.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var i,a,o;if(this.socket.isConnected()||this.socket.connect(),this.state==Rt.closed){const{config:{broadcast:c,presence:u,private:h}}=this.params,f=(a=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map(k=>k.filter))!==null&&a!==void 0?a:[],p=!!this.bindings[Xo.PRESENCE]&&this.bindings[Xo.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,y={},b={broadcast:c,presence:Object.assign(Object.assign({},u),{enabled:p}),postgres_changes:f,private:h};this.socket.accessTokenValue&&(y.access_token=this.socket.accessTokenValue),this._onError(k=>e?.(Bi.CHANNEL_ERROR,k)),this._onClose(()=>e?.(Bi.CLOSED)),this.updateJoinPayload(Object.assign({config:b},y)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:k})=>{var C;if(this.socket._isManualToken()||this.socket.setAuth(),k===void 0){e?.(Bi.SUBSCRIBED);return}else{const w=this.bindings.postgres_changes,O=(C=w?.length)!==null&&C!==void 0?C:0,R=[];for(let P=0;P<O;P++){const j=w[P],{filter:{event:E,schema:_,table:A,filter:I}}=j,F=k&&k[P];if(F&&F.event===E&&Ss.isFilterValueEqual(F.schema,_)&&Ss.isFilterValueEqual(F.table,A)&&Ss.isFilterValueEqual(F.filter,I))R.push(Object.assign(Object.assign({},j),{id:F.id}));else{this.unsubscribe(),this.state=Rt.errored,e?.(Bi.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=R,e&&e(Bi.SUBSCRIBED);return}}).receive("error",k=>{this.state=Rt.errored,e?.(Bi.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(k).join(", ")||"error")))}).receive("timeout",()=>{e?.(Bi.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,i){return this.state===Rt.joined&&e===Xo.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,i)}async httpSend(e,t,i={}){var a;if(t==null)return Promise.reject("Payload is required for httpSend()");const o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const c={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(a=i.timeout)!==null&&a!==void 0?a:this.timeout);if(u.status===202)return{success:!0};let h=u.statusText;try{const f=await u.json();h=f.error||f.message||h}catch{}return Promise.reject(new Error(h))}async send(e,t={}){var i,a;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:o,payload:c}=e,u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const h={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:c,private:this.private}]})};try{const f=await this._fetchWithTimeout(this.broadcastEndpointURL,h,(i=t.timeout)!==null&&i!==void 0?i:this.timeout);return await((a=f.body)===null||a===void 0?void 0:a.cancel()),f.ok?"ok":"error"}catch(f){return f.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var c,u,h;const f=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((h=(u=(c=this.params)===null||c===void 0?void 0:c.config)===null||u===void 0?void 0:u.broadcast)===null||h===void 0)&&h.ack)&&o("ok"),f.receive("ok",()=>o("ok")),f.receive("error",()=>o("error")),f.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Rt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Qn.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(a=>{i=new kf(this,Qn.leave,{},e),i.receive("ok",()=>{t(),a("ok")}).receive("timeout",()=>{t(),a("timed out")}).receive("error",()=>{a("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Rt.closed,this.bindings={}}async _fetchWithTimeout(e,t,i){const a=new AbortController,o=setTimeout(()=>a.abort(),i),c=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:a.signal}));return clearTimeout(o),c}_push(e,t,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new kf(this,e,t,i);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>jx){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,i){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,i){var a,o;const c=e.toLocaleLowerCase(),{close:u,error:h,leave:f,join:p}=Qn;if(i&&[u,h,f,p].indexOf(c)>=0&&i!==this._joinRef())return;let b=this._onMessage(c,t,i);if(t&&!b)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(c)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(k=>{var C,w,O;return((C=k.filter)===null||C===void 0?void 0:C.event)==="*"||((O=(w=k.filter)===null||w===void 0?void 0:w.event)===null||O===void 0?void 0:O.toLocaleLowerCase())===c}).map(k=>k.callback(b,i)):(o=this.bindings[c])===null||o===void 0||o.filter(k=>{var C,w,O,R,P,j,E,_;if(["broadcast","presence","postgres_changes"].includes(c))if("id"in k){const A=k.id,I=(C=k.filter)===null||C===void 0?void 0:C.event;return A&&((w=t.ids)===null||w===void 0?void 0:w.includes(A))&&(I==="*"||I?.toLocaleLowerCase()===((O=t.data)===null||O===void 0?void 0:O.type.toLocaleLowerCase()))&&(!(!((R=k.filter)===null||R===void 0)&&R.table)||k.filter.table===((P=t.data)===null||P===void 0?void 0:P.table))}else{const A=(E=(j=k?.filter)===null||j===void 0?void 0:j.event)===null||E===void 0?void 0:E.toLocaleLowerCase();return A==="*"||A===((_=t?.event)===null||_===void 0?void 0:_.toLocaleLowerCase())}else return k.type.toLocaleLowerCase()===c}).map(k=>{if(typeof b=="object"&&"ids"in b){const C=b.data,{schema:w,table:O,commit_timestamp:R,type:P,errors:j}=C;b=Object.assign(Object.assign({},{schema:w,table:O,commit_timestamp:R,eventType:P,new:{},old:{},errors:j}),this._getPayloadRecords(C))}k.callback(b,i)})}_isClosed(){return this.state===Rt.closed}_isJoined(){return this.state===Rt.joined}_isJoining(){return this.state===Rt.joining}_isLeaving(){return this.state===Rt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,i){const a=e.toLocaleLowerCase(),o={type:a,filter:t,callback:i};return this.bindings[a]?this.bindings[a].push(o):this.bindings[a]=[o],this}_off(e,t){const i=e.toLocaleLowerCase();return this.bindings[i]&&(this.bindings[i]=this.bindings[i].filter(a=>{var o;return!(((o=a.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===i&&Ss.isEqual(a.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(e[i]!==t[i])return!1;return!0}static isFilterValueEqual(e,t){return(e??void 0)===(t??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Qn.close,{},e)}_onError(e){this._on(Qn.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Rt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=db(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=db(e.columns,e.old_record)),t}}const wf=()=>{},Vc={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Bx=[1e3,2e3,5e3,1e4],zx=1e4,qx=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Fx{constructor(e,t){var i;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=cp,this.transport=null,this.heartbeatIntervalMs=Vc.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=wf,this.ref=0,this.reconnectTimer=null,this.vsn=ub,this.logger=wf,this.conn=null,this.sendBuffer=[],this.serializer=new Px,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=a=>a?(...o)=>a(...o):(...o)=>fetch(...o),!(!((i=t?.params)===null||i===void 0)&&i.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${up.websocket}`,this.httpEndpoint=AT(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=xx.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const i=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(i),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,i){this.logger(e,t,i)}connectionState(){switch(this.conn&&this.conn.readyState){case Or.connecting:return fa.Connecting;case Or.open:return fa.Open;case Or.closing:return fa.Closing;default:return fa.Closed}}isConnected(){return this.connectionState()===fa.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const i=`realtime:${e}`,a=this.getChannels().find(o=>o.topic===i);if(a)return a;{const o=new Ss(`realtime:${e}`,t,this);return this.channels.push(o),o}}push(e){const{topic:t,event:i,payload:a,ref:o}=e,c=()=>{this.encode(e,u=>{var h;(h=this.conn)===null||h===void 0||h.send(u)})};this.log("push",`${t} ${i} (${o})`,a),this.isConnected()?c():this.sendBuffer.push(c)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Ax,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Vc.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(i=>i.topic===e&&(i._isJoined()||i._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply"&&t.ref&&t.ref===this.pendingHeartbeatRef){const f=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error",f)}catch(p){this.log("error","error in heartbeat callback",p)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:i,event:a,payload:o,ref:c}=t,u=c?`(${c})`:"",h=o.status||"";this.log("receive",`${h} ${i} ${a} ${u}`.trim(),o),this.channels.filter(f=>f._isMember(i)).forEach(f=>f._trigger(a,o,c)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Or.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Or.open||this.conn.readyState===Or.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this._terminateWorker()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Qn.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const i=e.match(/\?/)?"&":"?",a=new URLSearchParams(t);return`${e}${i}${a}`}_workerObjectUrl(e){let t;if(e)t=e;else{const i=new Blob([qx],{type:"application/javascript"});t=URL.createObjectURL(i)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,i=!1;if(e)t=e,i=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(a){this.log("error","Error fetching access token from callback",a),t=this.accessTokenValue}else t=this.accessTokenValue;i?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(a=>{const o={access_token:t,version:Rx};t&&a.updateJoinPayload(o),a.joinedOnce&&a._isJoined()&&a._push(Qn.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(i=>{try{i(t)}catch(a){this.log("error",`error in ${e} callback`,a)}})}catch(i){this.log("error",`error triggering ${e} callbacks`,i)}}_setupReconnectionTimer(){this.reconnectTimer=new RT(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Vc.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,i,a,o,c,u,h,f,p,y,b,k;switch(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(i=e?.timeout)!==null&&i!==void 0?i:cp,this.heartbeatIntervalMs=(a=e?.heartbeatIntervalMs)!==null&&a!==void 0?a:Vc.HEARTBEAT_INTERVAL,this.worker=(o=e?.worker)!==null&&o!==void 0?o:!1,this.accessToken=(c=e?.accessToken)!==null&&c!==void 0?c:null,this.heartbeatCallback=(u=e?.heartbeatCallback)!==null&&u!==void 0?u:wf,this.vsn=(h=e?.vsn)!==null&&h!==void 0?h:ub,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(f=e?.reconnectAfterMs)!==null&&f!==void 0?f:(C=>Bx[C-1]||zx),this.vsn){case ET:this.encode=(p=e?.encode)!==null&&p!==void 0?p:((C,w)=>w(JSON.stringify(C))),this.decode=(y=e?.decode)!==null&&y!==void 0?y:((C,w)=>w(JSON.parse(C)));break;case Ox:this.encode=(b=e?.encode)!==null&&b!==void 0?b:this.serializer.encode.bind(this.serializer),this.decode=(k=e?.decode)!==null&&k!==void 0?k:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}var il=class extends Error{constructor(n,e){super(n),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Hx(n,e,t){const i=new URL(e,n);if(t)for(const[a,o]of Object.entries(t))o!==void 0&&i.searchParams.set(a,o);return i.toString()}async function Vx(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function $x(n){const e=n.fetchImpl??globalThis.fetch;return{async request({method:t,path:i,query:a,body:o,headers:c}){const u=Hx(n.baseUrl,i,a),h=await Vx(n.auth),f=await e(u,{method:t,headers:{...o?{"Content-Type":"application/json"}:{},...h,...c},body:o?JSON.stringify(o):void 0}),p=await f.text(),y=(f.headers.get("content-type")||"").includes("application/json"),b=y&&p?JSON.parse(p):p;if(!f.ok){const k=y?b:void 0,C=k?.error;throw new il(C?.message??`Request failed with status ${f.status}`,{status:f.status,icebergType:C?.type,icebergCode:C?.code,details:k})}return{status:f.status,headers:f.headers,data:b}}}}function $c(n){return n.join("")}var Wx=class{constructor(n,e=""){this.client=n,this.prefix=e}async listNamespaces(n){const e=n?{parent:$c(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(i=>({namespace:i}))}async createNamespace(n,e){const t={namespace:n.namespace,properties:e?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:t})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${$c(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${$c(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${$c(n.namespace)}`}),!0}catch(e){if(e instanceof il&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(n,e){try{return await this.createNamespace(n,e)}catch(t){if(t instanceof il&&t.status===409)return;throw t}}};function as(n){return n.join("")}var Gx=class{constructor(n,e="",t){this.client=n,this.prefix=e,this.accessDelegation=t}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${as(n.namespace)}/tables`})).data.identifiers}async createTable(n,e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${as(n.namespace)}/tables`,body:e,headers:t})).data.metadata}async updateTable(n,e){const t=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${as(n.namespace)}/tables/${n.name}`,body:e});return{"metadata-location":t.data["metadata-location"],metadata:t.data.metadata}}async dropTable(n,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${as(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String(e?.purge??!1)}})}async loadTable(n){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${as(n.namespace)}/tables/${n.name}`,headers:e})).data.metadata}async tableExists(n){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${as(n.namespace)}/tables/${n.name}`,headers:e}),!0}catch(t){if(t instanceof il&&t.status===404)return!1;throw t}}async createTableIfNotExists(n,e){try{return await this.createTable(n,e)}catch(t){if(t instanceof il&&t.status===409)return await this.loadTable({namespace:n.namespace,name:e.name});throw t}}},Kx=class{constructor(n){let e="v1";n.catalogName&&(e+=`/${n.catalogName}`);const t=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=$x({baseUrl:t,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=n.accessDelegation?.join(","),this.namespaceOps=new Wx(this.client,e),this.tableOps=new Gx(this.client,e,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,e){return this.namespaceOps.createNamespace(n,e)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,e){return this.tableOps.createTable(n,e)}async updateTable(n,e){return this.tableOps.updateTable(n,e)}async dropTable(n,e){await this.tableOps.dropTable(n,e)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,e){return this.namespaceOps.createNamespaceIfNotExists(n,e)}async createTableIfNotExists(n,e){return this.tableOps.createTableIfNotExists(n,e)}},Bu=class extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}};function ut(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var Jx=class extends Bu{constructor(n,e,t){super(n),this.name="StorageApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},hp=class extends Bu{constructor(n,e){super(n),this.name="StorageUnknownError",this.originalError=e}};const sm=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),Yx=()=>Response,fp=n=>{if(Array.isArray(n))return n.map(t=>fp(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,i])=>{const a=t.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[a]=fp(i)}),e},Qx=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Xx=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function rl(n){"@babel/helpers - typeof";return rl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rl(n)}function Zx(n,e){if(rl(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(rl(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function eE(n){var e=Zx(n,"string");return rl(e)=="symbol"?e:e+""}function tE(n,e,t){return(e=eE(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function pb(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,i)}return t}function Ce(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?pb(Object(t),!0).forEach(function(i){tE(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):pb(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}const Cf=n=>{var e;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(e=n.error)===null||e===void 0?void 0:e.message)||JSON.stringify(n)},nE=async(n,e,t)=>{n instanceof await Yx()&&!t?.noResolveJson?n.json().then(i=>{const a=n.status||500,o=i?.statusCode||a+"";e(new Jx(Cf(i),a,o))}).catch(i=>{e(new hp(Cf(i),i))}):e(new hp(Cf(n),n))},iE=(n,e,t,i)=>{const a={method:n,headers:e?.headers||{}};return n==="GET"||!i?a:(Qx(i)?(a.headers=Ce({"Content-Type":"application/json"},e?.headers),a.body=JSON.stringify(i)):a.body=i,e?.duplex&&(a.duplex=e.duplex),Ce(Ce({},a),t))};async function bl(n,e,t,i,a,o){return new Promise((c,u)=>{n(t,iE(e,i,a,o)).then(h=>{if(!h.ok)throw h;return i?.noResolveJson?h:h.json()}).then(h=>c(h)).catch(h=>nE(h,u,i))})}async function al(n,e,t,i){return bl(n,"GET",e,t,i)}async function Yn(n,e,t,i,a){return bl(n,"POST",e,i,a,t)}async function pp(n,e,t,i,a){return bl(n,"PUT",e,i,a,t)}async function rE(n,e,t,i){return bl(n,"HEAD",e,Ce(Ce({},t),{},{noResolveJson:!0}),i)}async function om(n,e,t,i,a){return bl(n,"DELETE",e,i,a,t)}var aE=class{constructor(n,e){this.downloadFn=n,this.shouldThrowOnError=e}then(n,e){return this.execute().then(n,e)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(ut(e))return{data:null,error:e};throw e}}};let jT;jT=Symbol.toStringTag;var sE=class{constructor(n,e){this.downloadFn=n,this.shouldThrowOnError=e,this[jT]="BlobDownloadBuilder",this.promise=null}asStream(){return new aE(this.downloadFn,this.shouldThrowOnError)}then(n,e){return this.getPromise().then(n,e)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(ut(e))return{data:null,error:e};throw e}}};const oE={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},mb={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var lE=class{constructor(n,e={},t,i){this.shouldThrowOnError=!1,this.url=n,this.headers=e,this.bucketId=t,this.fetch=sm(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(n,e,t,i){var a=this;try{let o;const c=Ce(Ce({},mb),i);let u=Ce(Ce({},a.headers),n==="POST"&&{"x-upsert":String(c.upsert)});const h=c.metadata;typeof Blob<"u"&&t instanceof Blob?(o=new FormData,o.append("cacheControl",c.cacheControl),h&&o.append("metadata",a.encodeMetadata(h)),o.append("",t)):typeof FormData<"u"&&t instanceof FormData?(o=t,o.has("cacheControl")||o.append("cacheControl",c.cacheControl),h&&!o.has("metadata")&&o.append("metadata",a.encodeMetadata(h))):(o=t,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType,h&&(u["x-metadata"]=a.toBase64(a.encodeMetadata(h))),(typeof ReadableStream<"u"&&o instanceof ReadableStream||o&&typeof o=="object"&&"pipe"in o&&typeof o.pipe=="function")&&!c.duplex&&(c.duplex="half")),i?.headers&&(u=Ce(Ce({},u),i.headers));const f=a._removeEmptyFolders(e),p=a._getFinalPath(f),y=await(n=="PUT"?pp:Yn)(a.fetch,`${a.url}/object/${p}`,o,Ce({headers:u},c?.duplex?{duplex:c.duplex}:{}));return{data:{path:f,id:y.Id,fullPath:y.Key},error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(ut(o))return{data:null,error:o};throw o}}async upload(n,e,t){return this.uploadOrUpdate("POST",n,e,t)}async uploadToSignedUrl(n,e,t,i){var a=this;const o=a._removeEmptyFolders(n),c=a._getFinalPath(o),u=new URL(a.url+`/object/upload/sign/${c}`);u.searchParams.set("token",e);try{let h;const f=Ce({upsert:mb.upsert},i),p=Ce(Ce({},a.headers),{"x-upsert":String(f.upsert)});return typeof Blob<"u"&&t instanceof Blob?(h=new FormData,h.append("cacheControl",f.cacheControl),h.append("",t)):typeof FormData<"u"&&t instanceof FormData?(h=t,h.append("cacheControl",f.cacheControl)):(h=t,p["cache-control"]=`max-age=${f.cacheControl}`,p["content-type"]=f.contentType),{data:{path:o,fullPath:(await pp(a.fetch,u.toString(),h,{headers:p})).Key},error:null}}catch(h){if(a.shouldThrowOnError)throw h;if(ut(h))return{data:null,error:h};throw h}}async createSignedUploadUrl(n,e){var t=this;try{let i=t._getFinalPath(n);const a=Ce({},t.headers);e?.upsert&&(a["x-upsert"]="true");const o=await Yn(t.fetch,`${t.url}/object/upload/sign/${i}`,{},{headers:a}),c=new URL(t.url+o.url),u=c.searchParams.get("token");if(!u)throw new Bu("No token returned by API");return{data:{signedUrl:c.toString(),path:n,token:u},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ut(i))return{data:null,error:i};throw i}}async update(n,e,t){return this.uploadOrUpdate("PUT",n,e,t)}async move(n,e,t){var i=this;try{return{data:await Yn(i.fetch,`${i.url}/object/move`,{bucketId:i.bucketId,sourceKey:n,destinationKey:e,destinationBucket:t?.destinationBucket},{headers:i.headers}),error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}}async copy(n,e,t){var i=this;try{return{data:{path:(await Yn(i.fetch,`${i.url}/object/copy`,{bucketId:i.bucketId,sourceKey:n,destinationKey:e,destinationBucket:t?.destinationBucket},{headers:i.headers})).Key},error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}}async createSignedUrl(n,e,t){var i=this;try{let a=i._getFinalPath(n),o=await Yn(i.fetch,`${i.url}/object/sign/${a}`,Ce({expiresIn:e},t?.transform?{transform:t.transform}:{}),{headers:i.headers});const c=t?.download?`&download=${t.download===!0?"":t.download}`:"";return o={signedUrl:encodeURI(`${i.url}${o.signedURL}${c}`)},{data:o,error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}}async createSignedUrls(n,e,t){var i=this;try{const a=await Yn(i.fetch,`${i.url}/object/sign/${i.bucketId}`,{expiresIn:e,paths:n},{headers:i.headers}),o=t?.download?`&download=${t.download===!0?"":t.download}`:"";return{data:a.map(c=>Ce(Ce({},c),{},{signedUrl:c.signedURL?encodeURI(`${i.url}${c.signedURL}${o}`):null})),error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}}download(n,e){const t=typeof e?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(e?.transform||{}),a=i?`?${i}`:"",o=this._getFinalPath(n),c=()=>al(this.fetch,`${this.url}/${t}/${o}${a}`,{headers:this.headers,noResolveJson:!0});return new sE(c,this.shouldThrowOnError)}async info(n){var e=this;const t=e._getFinalPath(n);try{return{data:fp(await al(e.fetch,`${e.url}/object/info/${t}`,{headers:e.headers})),error:null}}catch(i){if(e.shouldThrowOnError)throw i;if(ut(i))return{data:null,error:i};throw i}}async exists(n){var e=this;const t=e._getFinalPath(n);try{return await rE(e.fetch,`${e.url}/object/${t}`,{headers:e.headers}),{data:!0,error:null}}catch(i){if(e.shouldThrowOnError)throw i;if(ut(i)&&i instanceof hp){const a=i.originalError;if([400,404].includes(a?.status))return{data:!1,error:i}}throw i}}getPublicUrl(n,e){const t=this._getFinalPath(n),i=[],a=e?.download?`download=${e.download===!0?"":e.download}`:"";a!==""&&i.push(a);const o=typeof e?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(e?.transform||{});c!==""&&i.push(c);let u=i.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${t}${u}`)}}}async remove(n){var e=this;try{return{data:await om(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:n},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ut(t))return{data:null,error:t};throw t}}async list(n,e,t){var i=this;try{const a=Ce(Ce(Ce({},oE),e),{},{prefix:n||""});return{data:await Yn(i.fetch,`${i.url}/object/list/${i.bucketId}`,a,{headers:i.headers},t),error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}}async listV2(n,e){var t=this;try{const i=Ce({},n);return{data:await Yn(t.fetch,`${t.url}/object/list-v2/${t.bucketId}`,i,{headers:t.headers},e),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ut(i))return{data:null,error:i};throw i}}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const e=[];return n.width&&e.push(`width=${n.width}`),n.height&&e.push(`height=${n.height}`),n.resize&&e.push(`resize=${n.resize}`),n.format&&e.push(`format=${n.format}`),n.quality&&e.push(`quality=${n.quality}`),e.join("&")}};const PT="2.90.1",DT={"X-Client-Info":`storage-js/${PT}`};var cE=class{constructor(n,e={},t,i){this.shouldThrowOnError=!1;const a=new URL(n);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase.")),this.url=a.href.replace(/\/$/,""),this.headers=Ce(Ce({},DT),e),this.fetch=sm(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(n){var e=this;try{const t=e.listBucketOptionsToQueryString(n);return{data:await al(e.fetch,`${e.url}/bucket${t}`,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ut(t))return{data:null,error:t};throw t}}async getBucket(n){var e=this;try{return{data:await al(e.fetch,`${e.url}/bucket/${n}`,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ut(t))return{data:null,error:t};throw t}}async createBucket(n,e={public:!1}){var t=this;try{return{data:await Yn(t.fetch,`${t.url}/bucket`,{id:n,name:n,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ut(i))return{data:null,error:i};throw i}}async updateBucket(n,e){var t=this;try{return{data:await pp(t.fetch,`${t.url}/bucket/${n}`,{id:n,name:n,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ut(i))return{data:null,error:i};throw i}}async emptyBucket(n){var e=this;try{return{data:await Yn(e.fetch,`${e.url}/bucket/${n}/empty`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ut(t))return{data:null,error:t};throw t}}async deleteBucket(n){var e=this;try{return{data:await om(e.fetch,`${e.url}/bucket/${n}`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ut(t))return{data:null,error:t};throw t}}listBucketOptionsToQueryString(n){const e={};return n&&("limit"in n&&(e.limit=String(n.limit)),"offset"in n&&(e.offset=String(n.offset)),n.search&&(e.search=n.search),n.sortColumn&&(e.sortColumn=n.sortColumn),n.sortOrder&&(e.sortOrder=n.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},uE=class{constructor(n,e={},t){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Ce(Ce({},DT),e),this.fetch=sm(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var e=this;try{return{data:await Yn(e.fetch,`${e.url}/bucket`,{name:n},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ut(t))return{data:null,error:t};throw t}}async listBuckets(n){var e=this;try{const t=new URLSearchParams;n?.limit!==void 0&&t.set("limit",n.limit.toString()),n?.offset!==void 0&&t.set("offset",n.offset.toString()),n?.sortColumn&&t.set("sortColumn",n.sortColumn),n?.sortOrder&&t.set("sortOrder",n.sortOrder),n?.search&&t.set("search",n.search);const i=t.toString(),a=i?`${e.url}/bucket?${i}`:`${e.url}/bucket`;return{data:await al(e.fetch,a,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ut(t))return{data:null,error:t};throw t}}async deleteBucket(n){var e=this;try{return{data:await om(e.fetch,`${e.url}/bucket/${n}`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ut(t))return{data:null,error:t};throw t}}from(n){var e=this;if(!Xx(n))throw new Bu("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const t=new Kx({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),i=this.shouldThrowOnError;return new Proxy(t,{get(a,o){const c=a[o];return typeof c!="function"?c:async(...u)=>{try{return{data:await c.apply(a,u),error:null}}catch(h){if(i)throw h;return{data:null,error:h}}}}})}};const lm={"X-Client-Info":`storage-js/${PT}`,"Content-Type":"application/json"};var MT=class extends Error{constructor(n){super(n),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Cn(n){return typeof n=="object"&&n!==null&&"__isStorageVectorsError"in n}var _f=class extends MT{constructor(n,e,t){super(n),this.name="StorageVectorsApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},dE=class extends MT{constructor(n,e){super(n),this.name="StorageVectorsUnknownError",this.originalError=e}};const cm=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),hE=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},gb=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),fE=async(n,e,t)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!t?.noResolveJson){const i=n.status||500,a=n;if(typeof a.json=="function")a.json().then(o=>{const c=o?.statusCode||o?.code||i+"";e(new _f(gb(o),i,c))}).catch(()=>{const o=i+"";e(new _f(a.statusText||`HTTP ${i} error`,i,o))});else{const o=i+"";e(new _f(a.statusText||`HTTP ${i} error`,i,o))}}else e(new dE(gb(n),n))},pE=(n,e,t,i)=>{const a={method:n,headers:e?.headers||{}};return i?(hE(i)?(a.headers=Ce({"Content-Type":"application/json"},e?.headers),a.body=JSON.stringify(i)):a.body=i,Ce(Ce({},a),t)):a};async function mE(n,e,t,i,a,o){return new Promise((c,u)=>{n(t,pE(e,i,a,o)).then(h=>{if(!h.ok)throw h;if(i?.noResolveJson)return h;const f=h.headers.get("content-type");return!f||!f.includes("application/json")?{}:h.json()}).then(h=>c(h)).catch(h=>fE(h,u,i))})}async function _n(n,e,t,i,a){return mE(n,"POST",e,i,a,t)}var gE=class{constructor(n,e={},t){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Ce(Ce({},lm),e),this.fetch=cm(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(n){var e=this;try{return{data:await _n(e.fetch,`${e.url}/CreateIndex`,n,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Cn(t))return{data:null,error:t};throw t}}async getIndex(n,e){var t=this;try{return{data:await _n(t.fetch,`${t.url}/GetIndex`,{vectorBucketName:n,indexName:e},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Cn(i))return{data:null,error:i};throw i}}async listIndexes(n){var e=this;try{return{data:await _n(e.fetch,`${e.url}/ListIndexes`,n,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Cn(t))return{data:null,error:t};throw t}}async deleteIndex(n,e){var t=this;try{return{data:await _n(t.fetch,`${t.url}/DeleteIndex`,{vectorBucketName:n,indexName:e},{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Cn(i))return{data:null,error:i};throw i}}},vE=class{constructor(n,e={},t){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Ce(Ce({},lm),e),this.fetch=cm(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(n){var e=this;try{if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await _n(e.fetch,`${e.url}/PutVectors`,n,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Cn(t))return{data:null,error:t};throw t}}async getVectors(n){var e=this;try{return{data:await _n(e.fetch,`${e.url}/GetVectors`,n,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Cn(t))return{data:null,error:t};throw t}}async listVectors(n){var e=this;try{if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return{data:await _n(e.fetch,`${e.url}/ListVectors`,n,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Cn(t))return{data:null,error:t};throw t}}async queryVectors(n){var e=this;try{return{data:await _n(e.fetch,`${e.url}/QueryVectors`,n,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Cn(t))return{data:null,error:t};throw t}}async deleteVectors(n){var e=this;try{if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await _n(e.fetch,`${e.url}/DeleteVectors`,n,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Cn(t))return{data:null,error:t};throw t}}},yE=class{constructor(n,e={},t){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Ce(Ce({},lm),e),this.fetch=cm(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var e=this;try{return{data:await _n(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Cn(t))return{data:null,error:t};throw t}}async getBucket(n){var e=this;try{return{data:await _n(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:n},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Cn(t))return{data:null,error:t};throw t}}async listBuckets(n={}){var e=this;try{return{data:await _n(e.fetch,`${e.url}/ListVectorBuckets`,n,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Cn(t))return{data:null,error:t};throw t}}async deleteBucket(n){var e=this;try{return{data:await _n(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Cn(t))return{data:null,error:t};throw t}}},bE=class extends yE{constructor(n,e={}){super(n,e.headers||{},e.fetch)}from(n){return new SE(this.url,this.headers,n,this.fetch)}async createBucket(n){var e=()=>super.createBucket,t=this;return e().call(t,n)}async getBucket(n){var e=()=>super.getBucket,t=this;return e().call(t,n)}async listBuckets(n={}){var e=()=>super.listBuckets,t=this;return e().call(t,n)}async deleteBucket(n){var e=()=>super.deleteBucket,t=this;return e().call(t,n)}},SE=class extends gE{constructor(n,e,t,i){super(n,e,i),this.vectorBucketName=t}async createIndex(n){var e=()=>super.createIndex,t=this;return e().call(t,Ce(Ce({},n),{},{vectorBucketName:t.vectorBucketName}))}async listIndexes(n={}){var e=()=>super.listIndexes,t=this;return e().call(t,Ce(Ce({},n),{},{vectorBucketName:t.vectorBucketName}))}async getIndex(n){var e=()=>super.getIndex,t=this;return e().call(t,t.vectorBucketName,n)}async deleteIndex(n){var e=()=>super.deleteIndex,t=this;return e().call(t,t.vectorBucketName,n)}index(n){return new TE(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},TE=class extends vE{constructor(n,e,t,i,a){super(n,e,a),this.vectorBucketName=t,this.indexName=i}async putVectors(n){var e=()=>super.putVectors,t=this;return e().call(t,Ce(Ce({},n),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(n){var e=()=>super.getVectors,t=this;return e().call(t,Ce(Ce({},n),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(n={}){var e=()=>super.listVectors,t=this;return e().call(t,Ce(Ce({},n),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(n){var e=()=>super.queryVectors,t=this;return e().call(t,Ce(Ce({},n),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(n){var e=()=>super.deleteVectors,t=this;return e().call(t,Ce(Ce({},n),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},kE=class extends cE{constructor(n,e={},t,i){super(n,e,t,i)}from(n){return new lE(this.url,this.headers,n,this.fetch)}get vectors(){return new bE(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new uE(this.url+"/iceberg",this.headers,this.fetch)}};const NT="2.90.1",ys=30*1e3,mp=3,xf=mp*ys,wE="http://localhost:9999",CE="supabase.auth.token",_E={"X-Client-Info":`gotrue-js/${NT}`},gp="X-Supabase-Api-Version",IT={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},xE=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,EE=600*1e3;class sl extends Error{constructor(e,t,i){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=i}}function ve(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class RE extends sl{constructor(e,t,i){super(e,t,i),this.name="AuthApiError",this.status=t,this.code=i}}function OE(n){return ve(n)&&n.name==="AuthApiError"}class pa extends sl{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ji extends sl{constructor(e,t,i,a){super(e,i,a),this.name=t,this.status=i}}class wn extends Ji{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function AE(n){return ve(n)&&n.name==="AuthSessionMissingError"}class ss extends Ji{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Wc extends Ji{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Gc extends Ji{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function jE(n){return ve(n)&&n.name==="AuthImplicitGrantRedirectError"}class vb extends Ji{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class PE extends Ji{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class vp extends Ji{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ef(n){return ve(n)&&n.name==="AuthRetryableFetchError"}class yb extends Ji{constructor(e,t,i){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=i}}class yp extends Ji{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const bu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),bb=` 	
\r=`.split(""),DE=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<bb.length;e+=1)n[bb[e].charCodeAt(0)]=-2;for(let e=0;e<bu.length;e+=1)n[bu[e].charCodeAt(0)]=e;return n})();function Sb(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;t(bu[i]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;t(bu[i]),e.queuedBits-=6}}function LT(n,e,t){const i=DE[n];if(i>-1)for(e.queue=e.queue<<6|i,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(i===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Tb(n){const e=[],t=c=>{e.push(String.fromCodePoint(c))},i={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},o=c=>{IE(c,i,t)};for(let c=0;c<n.length;c+=1)LT(n.charCodeAt(c),a,o);return e.join("")}function ME(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function NE(n,e){for(let t=0;t<n.length;t+=1){let i=n.charCodeAt(t);if(i>55295&&i<=56319){const a=(i-55296)*1024&65535;i=(n.charCodeAt(t+1)-56320&65535|a)+65536,t+=1}ME(i,e)}}function IE(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let i=1;i<6;i+=1)if((n>>7-i&1)===0){e.utf8seq=i;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Cs(n){const e=[],t={queue:0,queuedBits:0},i=a=>{e.push(a)};for(let a=0;a<n.length;a+=1)LT(n.charCodeAt(a),t,i);return new Uint8Array(e)}function LE(n){const e=[];return NE(n,t=>e.push(t)),new Uint8Array(e)}function ma(n){const e=[],t={queue:0,queuedBits:0},i=a=>{e.push(a)};return n.forEach(a=>Sb(a,t,i)),Sb(null,t,i),e.join("")}function UE(n){return Math.round(Date.now()/1e3)+n}function BE(){return Symbol("auth-callback")}const qt=()=>typeof window<"u"&&typeof document<"u",oa={tested:!1,writable:!1},UT=()=>{if(!qt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(oa.tested)return oa.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),oa.tested=!0,oa.writable=!0}catch{oa.tested=!0,oa.writable=!1}return oa.writable};function zE(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((a,o)=>{e[o]=a})}catch{}return t.searchParams.forEach((i,a)=>{e[a]=i}),e}const BT=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),qE=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",bs=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},la=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},zt=async(n,e)=>{await n.removeItem(e)};class zu{constructor(){this.promise=new zu.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}zu.promiseConstructor=Promise;function Rf(n){const e=n.split(".");if(e.length!==3)throw new yp("Invalid JWT structure");for(let i=0;i<e.length;i++)if(!xE.test(e[i]))throw new yp("JWT not in base64url format");return{header:JSON.parse(Tb(e[0])),payload:JSON.parse(Tb(e[1])),signature:Cs(e[2]),raw:{header:e[0],payload:e[1]}}}async function FE(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function HE(n,e){return new Promise((i,a)=>{(async()=>{for(let o=0;o<1/0;o++)try{const c=await n(o);if(!e(o,null,c)){i(c);return}}catch(c){if(!e(o,c)){a(c);return}}})()})}function VE(n){return("0"+n.toString(16)).substr(-2)}function $E(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=t.length;let a="";for(let o=0;o<56;o++)a+=t.charAt(Math.floor(Math.random()*i));return a}return crypto.getRandomValues(e),Array.from(e,VE).join("")}async function WE(n){const t=new TextEncoder().encode(n),i=await crypto.subtle.digest("SHA-256",t),a=new Uint8Array(i);return Array.from(a).map(o=>String.fromCharCode(o)).join("")}async function GE(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await WE(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function os(n,e,t=!1){const i=$E();let a=i;t&&(a+="/PASSWORD_RECOVERY"),await bs(n,`${e}-code-verifier`,a);const o=await GE(i);return[o,i===o?"plain":"s256"]}const KE=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function JE(n){const e=n.headers.get(gp);if(!e||!e.match(KE))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function YE(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function QE(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const XE=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ls(n){if(!XE.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Of(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const i=t.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function ZE(n,e){return new Proxy(n,{get:(t,i,a)=>{if(i==="__isInsecureUserWarningProxy")return!0;if(typeof i=="symbol"){const o=i.toString();if(o==="Symbol(Symbol.toPrimitive)"||o==="Symbol(Symbol.toStringTag)"||o==="Symbol(util.inspect.custom)"||o==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,i,a)}return!e.value&&typeof i=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,i,a)}})}function kb(n){return JSON.parse(JSON.stringify(n))}const ua=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),e5=[502,503,504];async function wb(n){var e;if(!qE(n))throw new vp(ua(n),0);if(e5.includes(n.status))throw new vp(ua(n),n.status);let t;try{t=await n.json()}catch(o){throw new pa(ua(o),o)}let i;const a=JE(n);if(a&&a.getTime()>=IT["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?i=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(i=t.error_code),i){if(i==="weak_password")throw new yb(ua(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(i==="session_not_found")throw new wn}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((o,c)=>o&&typeof c=="string",!0))throw new yb(ua(t),n.status,t.weak_password.reasons);throw new RE(ua(t),n.status||500,i)}const t5=(n,e,t,i)=>{const a={method:n,headers:e?.headers||{}};return n==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),a.body=JSON.stringify(i),Object.assign(Object.assign({},a),t))};async function we(n,e,t,i){var a;const o=Object.assign({},i?.headers);o[gp]||(o[gp]=IT["2024-01-01"].name),i?.jwt&&(o.Authorization=`Bearer ${i.jwt}`);const c=(a=i?.query)!==null&&a!==void 0?a:{};i?.redirectTo&&(c.redirect_to=i.redirectTo);const u=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",h=await n5(n,e,t+u,{headers:o,noResolveJson:i?.noResolveJson},{},i?.body);return i?.xform?i?.xform(h):{data:Object.assign({},h),error:null}}async function n5(n,e,t,i,a,o){const c=t5(e,i,a,o);let u;try{u=await n(t,Object.assign({},c))}catch(h){throw console.error(h),new vp(ua(h),0)}if(u.ok||await wb(u),i?.noResolveJson)return u;try{return await u.json()}catch(h){await wb(h)}}function Jn(n){var e;let t=null;a5(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=UE(n.expires_in)));const i=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:i},error:null}}function Cb(n){const e=Jn(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,i)=>t&&typeof i=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Ar(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function i5(n){return{data:n,error:null}}function r5(n){const{action_link:e,email_otp:t,hashed_token:i,redirect_to:a,verification_type:o}=n,c=Uu(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),u={action_link:e,email_otp:t,hashed_token:i,redirect_to:a,verification_type:o},h=Object.assign({},c);return{data:{properties:u,user:h},error:null}}function _b(n){return n}function a5(n){return n.access_token&&n.refresh_token&&n.expires_in}const Af=["global","local","others"];class s5{constructor({url:e="",headers:t={},fetch:i}){this.url=e,this.headers=t,this.fetch=BT(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Af[0]){if(Af.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Af.join(", ")}`);try{return await we(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(i){if(ve(i))return{data:null,error:i};throw i}}async inviteUserByEmail(e,t={}){try{return await we(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ar})}catch(i){if(ve(i))return{data:{user:null},error:i};throw i}}async generateLink(e){try{const{options:t}=e,i=Uu(e,["options"]),a=Object.assign(Object.assign({},i),t);return"newEmail"in i&&(a.new_email=i?.newEmail,delete a.newEmail),await we(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:r5,redirectTo:t?.redirectTo})}catch(t){if(ve(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await we(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ar})}catch(t){if(ve(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,i,a,o,c,u,h;try{const f={nextPage:null,lastPage:0,total:0},p=await we(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&i!==void 0?i:"",per_page:(o=(a=e?.perPage)===null||a===void 0?void 0:a.toString())!==null&&o!==void 0?o:""},xform:_b});if(p.error)throw p.error;const y=await p.json(),b=(c=p.headers.get("x-total-count"))!==null&&c!==void 0?c:0,k=(h=(u=p.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&h!==void 0?h:[];return k.length>0&&(k.forEach(C=>{const w=parseInt(C.split(";")[0].split("=")[1].substring(0,1)),O=JSON.parse(C.split(";")[1].split("=")[1]);f[`${O}Page`]=w}),f.total=parseInt(b)),{data:Object.assign(Object.assign({},y),f),error:null}}catch(f){if(ve(f))return{data:{users:[]},error:f};throw f}}async getUserById(e){ls(e);try{return await we(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ar})}catch(t){if(ve(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){ls(e);try{return await we(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ar})}catch(i){if(ve(i))return{data:{user:null},error:i};throw i}}async deleteUser(e,t=!1){ls(e);try{return await we(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ar})}catch(i){if(ve(i))return{data:{user:null},error:i};throw i}}async _listFactors(e){ls(e.userId);try{const{data:t,error:i}=await we(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:t,error:i}}catch(t){if(ve(t))return{data:null,error:t};throw t}}async _deleteFactor(e){ls(e.userId),ls(e.id);try{return{data:await we(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(ve(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,i,a,o,c,u,h;try{const f={nextPage:null,lastPage:0,total:0},p=await we(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&i!==void 0?i:"",per_page:(o=(a=e?.perPage)===null||a===void 0?void 0:a.toString())!==null&&o!==void 0?o:""},xform:_b});if(p.error)throw p.error;const y=await p.json(),b=(c=p.headers.get("x-total-count"))!==null&&c!==void 0?c:0,k=(h=(u=p.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&h!==void 0?h:[];return k.length>0&&(k.forEach(C=>{const w=parseInt(C.split(";")[0].split("=")[1].substring(0,1)),O=JSON.parse(C.split(";")[1].split("=")[1]);f[`${O}Page`]=w}),f.total=parseInt(b)),{data:Object.assign(Object.assign({},y),f),error:null}}catch(f){if(ve(f))return{data:{clients:[]},error:f};throw f}}async _createOAuthClient(e){try{return await we(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ve(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await we(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ve(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await we(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(ve(i))return{data:null,error:i};throw i}}async _deleteOAuthClient(e){try{return await we(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(ve(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await we(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ve(t))return{data:null,error:t};throw t}}}function xb(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}const cs={debug:!!(globalThis&&UT()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class zT extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class o5 extends zT{}async function l5(n,e,t){cs.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const i=new globalThis.AbortController;return e>0&&setTimeout(()=>{i.abort(),cs.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async a=>{if(a){cs.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,a.name);try{return await t()}finally{cs.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,a.name)}}else{if(e===0)throw cs.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new o5(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(cs.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function c5(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function qT(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function u5(n){return parseInt(n,16)}function d5(n){const e=new TextEncoder().encode(n);return"0x"+Array.from(e,i=>i.toString(16).padStart(2,"0")).join("")}function h5(n){var e;const{chainId:t,domain:i,expirationTime:a,issuedAt:o=new Date,nonce:c,notBefore:u,requestId:h,resources:f,scheme:p,uri:y,version:b}=n;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!i)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(c&&c.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${c}`);if(!y)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(b!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${b}`);if(!((e=n.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const k=qT(n.address),C=p?`${p}://${i}`:i,w=n.statement?`${n.statement}
`:"",O=`${C} wants you to sign in with your Ethereum account:
${k}

${w}`;let R=`URI: ${y}
Version: ${b}
Chain ID: ${t}${c?`
Nonce: ${c}`:""}
Issued At: ${o.toISOString()}`;if(a&&(R+=`
Expiration Time: ${a.toISOString()}`),u&&(R+=`
Not Before: ${u.toISOString()}`),h&&(R+=`
Request ID: ${h}`),f){let P=`
Resources:`;for(const j of f){if(!j||typeof j!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${j}`);P+=`
- ${j}`}R+=P}return`${O}
${R}`}class _t extends Error{constructor({message:e,code:t,cause:i,name:a}){var o;super(e,{cause:i}),this.__isWebAuthnError=!0,this.name=(o=a??(i instanceof Error?i.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=t}}class Su extends _t{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function f5({error:n,options:e}){var t,i,a;const{publicKey:o}=e;if(!o)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new _t({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((t=o.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new _t({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(e.mediation==="conditional"&&((i=o.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new _t({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((a=o.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new _t({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new _t({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new _t({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return o.pubKeyCredParams.filter(u=>u.type==="public-key").length===0?new _t({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new _t({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const c=window.location.hostname;if(FT(c)){if(o.rp.id!==c)return new _t({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new _t({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new _t({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new _t({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new _t({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function p5({error:n,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new _t({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new _t({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const i=window.location.hostname;if(FT(i)){if(t.rpId!==i)return new _t({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new _t({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new _t({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new _t({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class m5{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const g5=new m5;function v5(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:e,user:t,excludeCredentials:i}=n,a=Uu(n,["challenge","user","excludeCredentials"]),o=Cs(e).buffer,c=Object.assign(Object.assign({},t),{id:Cs(t.id).buffer}),u=Object.assign(Object.assign({},a),{challenge:o,user:c});if(i&&i.length>0){u.excludeCredentials=new Array(i.length);for(let h=0;h<i.length;h++){const f=i[h];u.excludeCredentials[h]=Object.assign(Object.assign({},f),{id:Cs(f.id).buffer,type:f.type||"public-key",transports:f.transports})}}return u}function y5(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:e,allowCredentials:t}=n,i=Uu(n,["challenge","allowCredentials"]),a=Cs(e).buffer,o=Object.assign(Object.assign({},i),{challenge:a});if(t&&t.length>0){o.allowCredentials=new Array(t.length);for(let c=0;c<t.length;c++){const u=t[c];o.allowCredentials[c]=Object.assign(Object.assign({},u),{id:Cs(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return o}function b5(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const t=n;return{id:n.id,rawId:n.id,response:{attestationObject:ma(new Uint8Array(n.response.attestationObject)),clientDataJSON:ma(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function S5(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const t=n,i=n.getClientExtensionResults(),a=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:ma(new Uint8Array(a.authenticatorData)),clientDataJSON:ma(new Uint8Array(a.clientDataJSON)),signature:ma(new Uint8Array(a.signature)),userHandle:a.userHandle?ma(new Uint8Array(a.userHandle)):void 0},type:"public-key",clientExtensionResults:i,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function FT(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function Eb(){var n,e;return!!(qt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function T5(n){try{const e=await navigator.credentials.create(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Su("Browser returned unexpected credential type",e)}:{data:null,error:new Su("Empty credential response",e)}}catch(e){return{data:null,error:f5({error:e,options:n})}}}async function k5(n){try{const e=await navigator.credentials.get(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Su("Browser returned unexpected credential type",e)}:{data:null,error:new Su("Empty credential response",e)}}catch(e){return{data:null,error:p5({error:e,options:n})}}}const w5={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},C5={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Tu(...n){const e=a=>a!==null&&typeof a=="object"&&!Array.isArray(a),t=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),i={};for(const a of n)if(a)for(const o in a){const c=a[o];if(c!==void 0)if(Array.isArray(c))i[o]=c;else if(t(c))i[o]=c;else if(e(c)){const u=i[o];e(u)?i[o]=Tu(u,c):i[o]=Tu(c)}else i[o]=c}return i}function _5(n,e){return Tu(w5,n,e||{})}function x5(n,e){return Tu(C5,n,e||{})}class E5{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:i,signal:a},o){try{const{data:c,error:u}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!c)return{data:null,error:u};const h=a??g5.createNewAbortSignal();if(c.webauthn.type==="create"){const{user:f}=c.webauthn.credential_options.publicKey;f.name||(f.name=`${f.id}:${i}`),f.displayName||(f.displayName=f.name)}switch(c.webauthn.type){case"create":{const f=_5(c.webauthn.credential_options.publicKey,o?.create),{data:p,error:y}=await T5({publicKey:f,signal:h});return p?{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:p}},error:null}:{data:null,error:y}}case"request":{const f=x5(c.webauthn.credential_options.publicKey,o?.request),{data:p,error:y}=await k5(Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:f,signal:h}));return p?{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:p}},error:null}:{data:null,error:y}}}}catch(c){return ve(c)?{data:null,error:c}:{data:null,error:new pa("Unexpected error in challenge",c)}}}async _verify({challengeId:e,factorId:t,webauthn:i}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:i})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},o){if(!t)return{data:null,error:new sl("rpId is required for WebAuthn authentication")};try{if(!Eb())return{data:null,error:new pa("Browser does not support WebAuthn",null)};const{data:c,error:u}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:i},signal:a},{request:o});if(!c)return{data:null,error:u};const{webauthn:h}=c;return this._verify({factorId:e,challengeId:c.challengeId,webauthn:{type:h.type,rpId:t,rpOrigins:i,credential_response:h.credential_response}})}catch(c){return ve(c)?{data:null,error:c}:{data:null,error:new pa("Unexpected error in authenticate",c)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},o){if(!t)return{data:null,error:new sl("rpId is required for WebAuthn registration")};try{if(!Eb())return{data:null,error:new pa("Browser does not support WebAuthn",null)};const{data:c,error:u}=await this._enroll({friendlyName:e});if(!c)return await this.client.mfa.listFactors().then(p=>{var y;return(y=p.data)===null||y===void 0?void 0:y.all.find(b=>b.factor_type==="webauthn"&&b.friendly_name===e&&b.status!=="unverified")}).then(p=>p?this.client.mfa.unenroll({factorId:p?.id}):void 0),{data:null,error:u};const{data:h,error:f}=await this._challenge({factorId:c.id,friendlyName:c.friendly_name,webauthn:{rpId:t,rpOrigins:i},signal:a},{create:o});return h?this._verify({factorId:c.id,challengeId:h.challengeId,webauthn:{rpId:t,rpOrigins:i,type:h.webauthn.type,credential_response:h.webauthn.credential_response}}):{data:null,error:f}}catch(c){return ve(c)?{data:null,error:c}:{data:null,error:new pa("Unexpected error in register",c)}}}}c5();const R5={url:wE,storageKey:CE,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:_E,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function Rb(n,e,t){return await t()}const us={};class ol{get jwks(){var e,t;return(t=(e=us[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){us[this.storageKey]=Object.assign(Object.assign({},us[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=us[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){us[this.storageKey]=Object.assign(Object.assign({},us[this.storageKey]),{cachedAt:e})}constructor(e){var t,i,a;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const o=Object.assign(Object.assign({},R5),e);if(this.storageKey=o.storageKey,this.instanceID=(t=ol.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,ol.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.instanceID>0&&qt()){const c=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(c),this.logDebugMessages&&console.trace(c)}if(this.persistSession=o.persistSession,this.autoRefreshToken=o.autoRefreshToken,this.admin=new s5({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=BT(o.fetch),this.lock=o.lock||Rb,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,this.throwOnError=o.throwOnError,this.lockAcquireTimeout=o.lockAcquireTimeout,o.lock?this.lock=o.lock:this.persistSession&&qt()&&(!((i=globalThis?.navigator)===null||i===void 0)&&i.locks)?this.lock=l5:this.lock=Rb,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new E5(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:UT()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=xb(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=xb(this.memoryStorage)),qt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(c){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",c)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async c=>{this._debug("received broadcast notification from other tab or client",c),await this._notifyAllSubscribers(c.data.event,c.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${NT}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},i="none";if(qt()&&(t=zE(window.location.href),this._isImplicitGrantCallback(t)?i="implicit":await this._isPKCECallback(t)&&(i="pkce")),qt()&&this.detectSessionInUrl&&i!=="none"){const{data:a,error:o}=await this._getSessionFromURL(t,i);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),jE(o)){const h=(e=o.details)===null||e===void 0?void 0:e.code;if(h==="identity_already_exists"||h==="identity_not_found"||h==="single_identity_not_deletable")return{error:o}}return{error:o}}const{session:c,redirectType:u}=a;return this._debug("#_initialize()","detected session in URL",c,"redirect type",u),await this._saveSession(c),setTimeout(async()=>{u==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",c):await this._notifyAllSubscribers("SIGNED_IN",c)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return ve(t)?this._returnResult({error:t}):this._returnResult({error:new pa("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,i,a;try{const o=await we(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(i=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:(a=e?.options)===null||a===void 0?void 0:a.captchaToken}},xform:Jn}),{data:c,error:u}=o;if(u||!c)return this._returnResult({data:{user:null,session:null},error:u});const h=c.session,f=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:f,session:h},error:null})}catch(o){if(ve(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signUp(e){var t,i,a;try{let o;if("email"in e){const{email:p,password:y,options:b}=e;let k=null,C=null;this.flowType==="pkce"&&([k,C]=await os(this.storage,this.storageKey)),o=await we(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:b?.emailRedirectTo,body:{email:p,password:y,data:(t=b?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:b?.captchaToken},code_challenge:k,code_challenge_method:C},xform:Jn})}else if("phone"in e){const{phone:p,password:y,options:b}=e;o=await we(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:p,password:y,data:(i=b?.data)!==null&&i!==void 0?i:{},channel:(a=b?.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:b?.captchaToken}},xform:Jn})}else throw new Wc("You must provide either an email or phone number and a password");const{data:c,error:u}=o;if(u||!c)return await zt(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:u});const h=c.session,f=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:f,session:h},error:null})}catch(o){if(await zt(this.storage,`${this.storageKey}-code-verifier`),ve(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithPassword(e){try{let t;if("email"in e){const{email:o,password:c,options:u}=e;t=await we(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:c,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:Cb})}else if("phone"in e){const{phone:o,password:c,options:u}=e;t=await we(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:c,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:Cb})}else throw new Wc("You must provide either an email or phone number and a password");const{data:i,error:a}=t;if(a)return this._returnResult({data:{user:null,session:null},error:a});if(!i||!i.session||!i.user){const o=new ss;return this._returnResult({data:{user:null,session:null},error:o})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:a})}catch(t){if(ve(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,i,a,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(i=e.options)===null||i===void 0?void 0:i.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,i,a,o,c,u,h,f,p,y,b;let k,C;if("message"in e)k=e.message,C=e.signature;else{const{chain:w,wallet:O,statement:R,options:P}=e;let j;if(qt())if(typeof O=="object")j=O;else{const B=window;if("ethereum"in B&&typeof B.ethereum=="object"&&"request"in B.ethereum&&typeof B.ethereum.request=="function")j=B.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof O!="object"||!P?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");j=O}const E=new URL((t=P?.url)!==null&&t!==void 0?t:window.location.href),_=await j.request({method:"eth_requestAccounts"}).then(B=>B).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!_||_.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const A=qT(_[0]);let I=(i=P?.signInWithEthereum)===null||i===void 0?void 0:i.chainId;if(!I){const B=await j.request({method:"eth_chainId"});I=u5(B)}const F={domain:E.host,address:A,statement:R,uri:E.href,version:"1",chainId:I,nonce:(a=P?.signInWithEthereum)===null||a===void 0?void 0:a.nonce,issuedAt:(c=(o=P?.signInWithEthereum)===null||o===void 0?void 0:o.issuedAt)!==null&&c!==void 0?c:new Date,expirationTime:(u=P?.signInWithEthereum)===null||u===void 0?void 0:u.expirationTime,notBefore:(h=P?.signInWithEthereum)===null||h===void 0?void 0:h.notBefore,requestId:(f=P?.signInWithEthereum)===null||f===void 0?void 0:f.requestId,resources:(p=P?.signInWithEthereum)===null||p===void 0?void 0:p.resources};k=h5(F),C=await j.request({method:"personal_sign",params:[d5(k),A]})}try{const{data:w,error:O}=await we(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:k,signature:C},!((y=e.options)===null||y===void 0)&&y.captchaToken?{gotrue_meta_security:{captcha_token:(b=e.options)===null||b===void 0?void 0:b.captchaToken}}:null),xform:Jn});if(O)throw O;if(!w||!w.session||!w.user){const R=new ss;return this._returnResult({data:{user:null,session:null},error:R})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign({},w),error:O})}catch(w){if(ve(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async signInWithSolana(e){var t,i,a,o,c,u,h,f,p,y,b,k;let C,w;if("message"in e)C=e.message,w=e.signature;else{const{chain:O,wallet:R,statement:P,options:j}=e;let E;if(qt())if(typeof R=="object")E=R;else{const A=window;if("solana"in A&&typeof A.solana=="object"&&("signIn"in A.solana&&typeof A.solana.signIn=="function"||"signMessage"in A.solana&&typeof A.solana.signMessage=="function"))E=A.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof R!="object"||!j?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=R}const _=new URL((t=j?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in E&&E.signIn){const A=await E.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},j?.signInWithSolana),{version:"1",domain:_.host,uri:_.href}),P?{statement:P}:null));let I;if(Array.isArray(A)&&A[0]&&typeof A[0]=="object")I=A[0];else if(A&&typeof A=="object"&&"signedMessage"in A&&"signature"in A)I=A;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in I&&"signature"in I&&(typeof I.signedMessage=="string"||I.signedMessage instanceof Uint8Array)&&I.signature instanceof Uint8Array)C=typeof I.signedMessage=="string"?I.signedMessage:new TextDecoder().decode(I.signedMessage),w=I.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in E)||typeof E.signMessage!="function"||!("publicKey"in E)||typeof E!="object"||!E.publicKey||!("toBase58"in E.publicKey)||typeof E.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");C=[`${_.host} wants you to sign in with your Solana account:`,E.publicKey.toBase58(),...P?["",P,""]:[""],"Version: 1",`URI: ${_.href}`,`Issued At: ${(a=(i=j?.signInWithSolana)===null||i===void 0?void 0:i.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((o=j?.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${j.signInWithSolana.notBefore}`]:[],...!((c=j?.signInWithSolana)===null||c===void 0)&&c.expirationTime?[`Expiration Time: ${j.signInWithSolana.expirationTime}`]:[],...!((u=j?.signInWithSolana)===null||u===void 0)&&u.chainId?[`Chain ID: ${j.signInWithSolana.chainId}`]:[],...!((h=j?.signInWithSolana)===null||h===void 0)&&h.nonce?[`Nonce: ${j.signInWithSolana.nonce}`]:[],...!((f=j?.signInWithSolana)===null||f===void 0)&&f.requestId?[`Request ID: ${j.signInWithSolana.requestId}`]:[],...!((y=(p=j?.signInWithSolana)===null||p===void 0?void 0:p.resources)===null||y===void 0)&&y.length?["Resources",...j.signInWithSolana.resources.map(I=>`- ${I}`)]:[]].join(`
`);const A=await E.signMessage(new TextEncoder().encode(C),"utf8");if(!A||!(A instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");w=A}}try{const{data:O,error:R}=await we(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:C,signature:ma(w)},!((b=e.options)===null||b===void 0)&&b.captchaToken?{gotrue_meta_security:{captcha_token:(k=e.options)===null||k===void 0?void 0:k.captchaToken}}:null),xform:Jn});if(R)throw R;if(!O||!O.session||!O.user){const P=new ss;return this._returnResult({data:{user:null,session:null},error:P})}return O.session&&(await this._saveSession(O.session),await this._notifyAllSubscribers("SIGNED_IN",O.session)),this._returnResult({data:Object.assign({},O),error:R})}catch(O){if(ve(O))return this._returnResult({data:{user:null,session:null},error:O});throw O}}async _exchangeCodeForSession(e){const t=await la(this.storage,`${this.storageKey}-code-verifier`),[i,a]=(t??"").split("/");try{if(!i&&this.flowType==="pkce")throw new PE;const{data:o,error:c}=await we(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:i},xform:Jn});if(await zt(this.storage,`${this.storageKey}-code-verifier`),c)throw c;if(!o||!o.session||!o.user){const u=new ss;return this._returnResult({data:{user:null,session:null,redirectType:null},error:u})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:Object.assign(Object.assign({},o),{redirectType:a??null}),error:c})}catch(o){if(await zt(this.storage,`${this.storageKey}-code-verifier`),ve(o))return this._returnResult({data:{user:null,session:null,redirectType:null},error:o});throw o}}async signInWithIdToken(e){try{const{options:t,provider:i,token:a,access_token:o,nonce:c}=e,u=await we(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:a,access_token:o,nonce:c,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Jn}),{data:h,error:f}=u;if(f)return this._returnResult({data:{user:null,session:null},error:f});if(!h||!h.session||!h.user){const p=new ss;return this._returnResult({data:{user:null,session:null},error:p})}return h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),this._returnResult({data:h,error:f})}catch(t){if(ve(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,i,a,o,c;try{if("email"in e){const{email:u,options:h}=e;let f=null,p=null;this.flowType==="pkce"&&([f,p]=await os(this.storage,this.storageKey));const{error:y}=await we(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:u,data:(t=h?.data)!==null&&t!==void 0?t:{},create_user:(i=h?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:f,code_challenge_method:p},redirectTo:h?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:y})}if("phone"in e){const{phone:u,options:h}=e,{data:f,error:p}=await we(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:u,data:(a=h?.data)!==null&&a!==void 0?a:{},create_user:(o=h?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},channel:(c=h?.channel)!==null&&c!==void 0?c:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:f?.message_id},error:p})}throw new Wc("You must provide either an email or phone number.")}catch(u){if(await zt(this.storage,`${this.storageKey}-code-verifier`),ve(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async verifyOtp(e){var t,i;try{let a,o;"options"in e&&(a=(t=e.options)===null||t===void 0?void 0:t.redirectTo,o=(i=e.options)===null||i===void 0?void 0:i.captchaToken);const{data:c,error:u}=await we(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:a,xform:Jn});if(u)throw u;if(!c)throw new Error("An error occurred on token verification.");const h=c.session,f=c.user;return h?.access_token&&(await this._saveSession(h),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",h)),this._returnResult({data:{user:f,session:h},error:null})}catch(a){if(ve(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithSSO(e){var t,i,a,o,c;try{let u=null,h=null;this.flowType==="pkce"&&([u,h]=await os(this.storage,this.storageKey));const f=await we(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&i!==void 0?i:void 0}),!((a=e?.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:u,code_challenge_method:h}),headers:this.headers,xform:i5});return!((o=f.data)===null||o===void 0)&&o.url&&qt()&&!(!((c=e.options)===null||c===void 0)&&c.skipBrowserRedirect)&&window.location.assign(f.data.url),this._returnResult(f)}catch(u){if(await zt(this.storage,`${this.storageKey}-code-verifier`),ve(u))return this._returnResult({data:null,error:u});throw u}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:i}=e;if(i)throw i;if(!t)throw new wn;const{error:a}=await we(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:a})})}catch(e){if(ve(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:i,type:a,options:o}=e,{error:c}=await we(this.fetch,"POST",t,{headers:this.headers,body:{email:i,type:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},redirectTo:o?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:c})}else if("phone"in e){const{phone:i,type:a,options:o}=e,{data:c,error:u}=await we(this.fetch,"POST",t,{headers:this.headers,body:{phone:i,type:a,gotrue_meta_security:{captcha_token:o?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:c?.message_id},error:u})}throw new Wc("You must provide either an email or phone number and a type")}catch(t){if(ve(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const i=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await i,await t()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const i=t();for(this.pendingInLock.push((async()=>{try{await i}catch{}})()),await i;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await i}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await la(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const i=e.expires_at?e.expires_at*1e3-Date.now()<xf:!1;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",e.expires_at),!i){if(this.userStorage){const c=await la(this.userStorage,this.storageKey+"-user");c?.user?e.user=c.user:e.user=Of()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const c={value:this.suppressGetSessionWarning};e.user=ZE(e.user,c),c.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:a,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{session:null},error:o}):this._returnResult({data:{session:a},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await we(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ar}):await this._useSession(async t=>{var i,a,o;const{data:c,error:u}=t;if(u)throw u;return!(!((i=c.session)===null||i===void 0)&&i.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new wn}:await we(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(a=c.session)===null||a===void 0?void 0:a.access_token)!==null&&o!==void 0?o:void 0,xform:Ar})})}catch(t){if(ve(t))return AE(t)&&(await this._removeSession(),await zt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async i=>{const{data:a,error:o}=i;if(o)throw o;if(!a.session)throw new wn;const c=a.session;let u=null,h=null;this.flowType==="pkce"&&e.email!=null&&([u,h]=await os(this.storage,this.storageKey));const{data:f,error:p}=await we(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:u,code_challenge_method:h}),jwt:c.access_token,xform:Ar});if(p)throw p;return c.user=f.user,await this._saveSession(c),await this._notifyAllSubscribers("USER_UPDATED",c),this._returnResult({data:{user:c.user},error:null})})}catch(i){if(await zt(this.storage,`${this.storageKey}-code-verifier`),ve(i))return this._returnResult({data:{user:null},error:i});throw i}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new wn;const t=Date.now()/1e3;let i=t,a=!0,o=null;const{payload:c}=Rf(e.access_token);if(c.exp&&(i=c.exp,a=i<=t),a){const{data:u,error:h}=await this._callRefreshToken(e.refresh_token);if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!u)return{data:{user:null,session:null},error:null};o=u}else{const{data:u,error:h}=await this._getUser(e.access_token);if(h)throw h;o={access_token:e.access_token,refresh_token:e.refresh_token,user:u.user,token_type:"bearer",expires_in:i-t,expires_at:i},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return this._returnResult({data:{user:o.user,session:o},error:null})}catch(t){if(ve(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var i;if(!e){const{data:c,error:u}=t;if(u)throw u;e=(i=c.session)!==null&&i!==void 0?i:void 0}if(!e?.refresh_token)throw new wn;const{data:a,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{user:null,session:null},error:o}):a?this._returnResult({data:{user:a.user,session:a},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(ve(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!qt())throw new Gc("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Gc(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new vb("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Gc("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new vb("No code detected.");const{data:P,error:j}=await this._exchangeCodeForSession(e.code);if(j)throw j;const E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:P.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:a,access_token:o,refresh_token:c,expires_in:u,expires_at:h,token_type:f}=e;if(!o||!u||!c||!f)throw new Gc("No session defined in URL");const p=Math.round(Date.now()/1e3),y=parseInt(u);let b=p+y;h&&(b=parseInt(h));const k=b-p;k*1e3<=ys&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${k}s, should have been closer to ${y}s`);const C=b-y;p-C>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",C,b,p):p-C<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",C,b,p);const{data:w,error:O}=await this._getUser(o);if(O)throw O;const R={provider_token:i,provider_refresh_token:a,access_token:o,expires_in:y,expires_at:b,refresh_token:c,token_type:f,user:w.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:R,redirectType:e.type},error:null})}catch(i){if(ve(i))return this._returnResult({data:{session:null,redirectType:null},error:i});throw i}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await la(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var i;const{data:a,error:o}=t;if(o)return this._returnResult({error:o});const c=(i=a.session)===null||i===void 0?void 0:i.access_token;if(c){const{error:u}=await this.admin.signOut(c,e);if(u&&!(OE(u)&&(u.status===404||u.status===401||u.status===403)))return this._returnResult({error:u})}return e!=="others"&&(await this._removeSession(),await zt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=BE(),i={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,i),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:i}}}async _emitInitialSession(e){return await this._useSession(async t=>{var i,a;try{const{data:{session:o},error:c}=t;if(c)throw c;await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((a=this.stateChangeEmitters.get(e))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,t={}){let i=null,a=null;this.flowType==="pkce"&&([i,a]=await os(this.storage,this.storageKey,!0));try{return await we(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:i,code_challenge_method:a,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(await zt(this.storage,`${this.storageKey}-code-verifier`),ve(o))return this._returnResult({data:null,error:o});throw o}}async getUserIdentities(){var e;try{const{data:t,error:i}=await this.getUser();if(i)throw i;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(ve(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:i,error:a}=await this._useSession(async o=>{var c,u,h,f,p;const{data:y,error:b}=o;if(b)throw b;const k=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(c=e.options)===null||c===void 0?void 0:c.redirectTo,scopes:(u=e.options)===null||u===void 0?void 0:u.scopes,queryParams:(h=e.options)===null||h===void 0?void 0:h.queryParams,skipBrowserRedirect:!0});return await we(this.fetch,"GET",k,{headers:this.headers,jwt:(p=(f=y.session)===null||f===void 0?void 0:f.access_token)!==null&&p!==void 0?p:void 0})});if(a)throw a;return qt()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(i?.url),this._returnResult({data:{provider:e.provider,url:i?.url},error:null})}catch(i){if(ve(i))return this._returnResult({data:{provider:e.provider,url:null},error:i});throw i}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var i;try{const{error:a,data:{session:o}}=t;if(a)throw a;const{options:c,provider:u,token:h,access_token:f,nonce:p}=e,y=await we(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(i=o?.access_token)!==null&&i!==void 0?i:void 0,body:{provider:u,id_token:h,access_token:f,nonce:p,link_identity:!0,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:Jn}),{data:b,error:k}=y;return k?this._returnResult({data:{user:null,session:null},error:k}):!b||!b.session||!b.user?this._returnResult({data:{user:null,session:null},error:new ss}):(b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("USER_UPDATED",b.session)),this._returnResult({data:b,error:k}))}catch(a){if(await zt(this.storage,`${this.storageKey}-code-verifier`),ve(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var i,a;const{data:o,error:c}=t;if(c)throw c;return await we(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(a=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&a!==void 0?a:void 0})})}catch(t){if(ve(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const i=Date.now();return await HE(async a=>(a>0&&await FE(200*Math.pow(2,a-1)),this._debug(t,"refreshing attempt",a),await we(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Jn})),(a,o)=>{const c=200*Math.pow(2,a);return o&&Ef(o)&&Date.now()+c-i<ys})}catch(i){if(this._debug(t,"error",i),ve(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const i=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",i),qt()&&!t.skipBrowserRedirect&&window.location.assign(i),{data:{provider:e,url:i},error:null}}async _recoverAndRefresh(){var e,t;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const a=await la(this.storage,this.storageKey);if(a&&this.userStorage){let c=await la(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!c&&(c={user:a.user},await bs(this.userStorage,this.storageKey+"-user",c)),a.user=(e=c?.user)!==null&&e!==void 0?e:Of()}else if(a&&!a.user&&!a.user){const c=await la(this.storage,this.storageKey+"-user");c&&c?.user?(a.user=c.user,await zt(this.storage,this.storageKey+"-user"),await bs(this.storage,this.storageKey,a)):a.user=Of()}if(this._debug(i,"session from storage",a),!this._isValidSession(a)){this._debug(i,"session is not valid"),a!==null&&await this._removeSession();return}const o=((t=a.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<xf;if(this._debug(i,`session has${o?"":" not"} expired with margin of ${xf}s`),o){if(this.autoRefreshToken&&a.refresh_token){const{error:c}=await this._callRefreshToken(a.refresh_token);c&&(console.error(c),Ef(c)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",c),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:c,error:u}=await this._getUser(a.access_token);!u&&c?.user?(a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(i,"could not get user data, skipping SIGNED_IN notification")}catch(c){console.error("Error getting user data:",c),this._debug(i,"error getting user data, skipping SIGNED_IN notification",c)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(i,"error",a),console.error(a);return}finally{this._debug(i,"end")}}async _callRefreshToken(e){var t,i;if(!e)throw new wn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new zu;const{data:o,error:c}=await this._refreshAccessToken(e);if(c)throw c;if(!o.session)throw new wn;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const u={data:o.session,error:null};return this.refreshingDeferred.resolve(u),u}catch(o){if(this._debug(a,"error",o),ve(o)){const c={data:null,error:o};return Ef(o)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(c),c}throw(i=this.refreshingDeferred)===null||i===void 0||i.reject(o),o}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(e,t,i=!0){const a=`#_notifyAllSubscribers(${e})`;this._debug(a,"begin",t,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:e,session:t});const o=[],c=Array.from(this.stateChangeEmitters.values()).map(async u=>{try{await u.callback(e,t)}catch(h){o.push(h)}});if(await Promise.all(c),o.length>0){for(let u=0;u<o.length;u+=1)console.error(o[u]);throw o[0]}}finally{this._debug(a,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await zt(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),i=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!i&&t.user&&await bs(this.userStorage,this.storageKey+"-user",{user:t.user});const a=Object.assign({},t);delete a.user;const o=kb(a);await bs(this.storage,this.storageKey,o)}else{const a=kb(t);await bs(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await zt(this.storage,this.storageKey),await zt(this.storage,this.storageKey+"-code-verifier"),await zt(this.storage,this.storageKey+"-user"),this.userStorage&&await zt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&qt()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ys);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const t=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const t=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,t&&clearTimeout(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:i}}=t;if(!i||!i.refresh_token||!i.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((i.expires_at*1e3-e)/ys);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${ys}ms, refresh threshold is ${mp} ticks`),a<=mp&&await this._callRefreshToken(i.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof zT)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!qt()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,i){const a=[`provider=${encodeURIComponent(t)}`];if(i?.redirectTo&&a.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),i?.scopes&&a.push(`scopes=${encodeURIComponent(i.scopes)}`),this.flowType==="pkce"){const[o,c]=await os(this.storage,this.storageKey),u=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(c)}`});a.push(u.toString())}if(i?.queryParams){const o=new URLSearchParams(i.queryParams);a.push(o.toString())}return i?.skipBrowserRedirect&&a.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${e}?${a.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var i;const{data:a,error:o}=t;return o?this._returnResult({data:null,error:o}):await we(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(i=a?.session)===null||i===void 0?void 0:i.access_token})})}catch(t){if(ve(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var i,a;const{data:o,error:c}=t;if(c)return this._returnResult({data:null,error:c});const u=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:h,error:f}=await we(this.fetch,"POST",`${this.url}/factors`,{body:u,headers:this.headers,jwt:(i=o?.session)===null||i===void 0?void 0:i.access_token});return f?this._returnResult({data:null,error:f}):(e.factorType==="totp"&&h.type==="totp"&&(!((a=h?.totp)===null||a===void 0)&&a.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),this._returnResult({data:h,error:null}))})}catch(t){if(ve(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var i;const{data:a,error:o}=t;if(o)return this._returnResult({data:null,error:o});const c=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?b5(e.webauthn.credential_response):S5(e.webauthn.credential_response)})}:{code:e.code}),{data:u,error:h}=await we(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:c,headers:this.headers,jwt:(i=a?.session)===null||i===void 0?void 0:i.access_token});return h?this._returnResult({data:null,error:h}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),this._returnResult({data:u,error:h}))})}catch(t){if(ve(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var i;const{data:a,error:o}=t;if(o)return this._returnResult({data:null,error:o});const c=await we(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(i=a?.session)===null||i===void 0?void 0:i.access_token});if(c.error)return c;const{data:u}=c;if(u.type!=="webauthn")return{data:u,error:null};switch(u.webauthn.type){case"create":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:v5(u.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:y5(u.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(ve(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:i}=await this._challenge({factorId:e.factorId});return i?this._returnResult({data:null,error:i}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:i}=await this.getUser();if(i)return{data:null,error:i};const a={all:[],phone:[],totp:[],webauthn:[]};for(const o of(e=t?.factors)!==null&&e!==void 0?e:[])a.all.push(o),o.status==="verified"&&a[o.factor_type].push(o);return{data:a,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:i},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Rf(i.access_token);let c=null;o.aal&&(c=o.aal);let u=c;((t=(e=i.user.factors)===null||e===void 0?void 0:e.filter(p=>p.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(u="aal2");const f=o.amr||[];return{data:{currentLevel:c,nextLevel:u,currentAuthenticationMethods:f},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:i},error:a}=t;return a?this._returnResult({data:null,error:a}):i?await we(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:i.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new wn})})}catch(t){if(ve(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async i=>{const{data:{session:a},error:o}=i;if(o)return this._returnResult({data:null,error:o});if(!a)return this._returnResult({data:null,error:new wn});const c=await we(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"approve"},xform:u=>({data:u,error:null})});return c.data&&c.data.redirect_url&&qt()&&!t?.skipBrowserRedirect&&window.location.assign(c.data.redirect_url),c})}catch(i){if(ve(i))return this._returnResult({data:null,error:i});throw i}}async _denyAuthorization(e,t){try{return await this._useSession(async i=>{const{data:{session:a},error:o}=i;if(o)return this._returnResult({data:null,error:o});if(!a)return this._returnResult({data:null,error:new wn});const c=await we(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"deny"},xform:u=>({data:u,error:null})});return c.data&&c.data.redirect_url&&qt()&&!t?.skipBrowserRedirect&&window.location.assign(c.data.redirect_url),c})}catch(i){if(ve(i))return this._returnResult({data:null,error:i});throw i}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:i}=e;return i?this._returnResult({data:null,error:i}):t?await we(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new wn})})}catch(e){if(ve(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:i},error:a}=t;return a?this._returnResult({data:null,error:a}):i?(await we(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:i.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new wn})})}catch(t){if(ve(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let i=t.keys.find(u=>u.kid===e);if(i)return i;const a=Date.now();if(i=this.jwks.keys.find(u=>u.kid===e),i&&this.jwks_cached_at+EE>a)return i;const{data:o,error:c}=await we(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=a,i=o.keys.find(u=>u.kid===e),!i)?null:i}async getClaims(e,t={}){try{let i=e;if(!i){const{data:k,error:C}=await this.getSession();if(C||!k.session)return this._returnResult({data:null,error:C});i=k.session.access_token}const{header:a,payload:o,signature:c,raw:{header:u,payload:h}}=Rf(i);t?.allowExpired||YE(o.exp);const f=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!f){const{error:k}=await this.getUser(i);if(k)throw k;return{data:{claims:o,header:a,signature:c},error:null}}const p=QE(a.alg),y=await crypto.subtle.importKey("jwk",f,p,!0,["verify"]);if(!await crypto.subtle.verify(p,y,c,LE(`${u}.${h}`)))throw new yp("Invalid JWT signature");return{data:{claims:o,header:a,signature:c},error:null}}catch(i){if(ve(i))return this._returnResult({data:null,error:i});throw i}}}ol.nextInstanceID={};const O5=ol,A5="2.90.1";let Ko="";typeof Deno<"u"?Ko="deno":typeof document<"u"?Ko="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ko="react-native":Ko="node";const j5={"X-Client-Info":`supabase-js-${Ko}/${A5}`},P5={headers:j5},D5={schema:"public"},M5={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},N5={};function ll(n){"@babel/helpers - typeof";return ll=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ll(n)}function I5(n,e){if(ll(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(ll(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function L5(n){var e=I5(n,"string");return ll(e)=="symbol"?e:e+""}function U5(n,e,t){return(e=L5(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Ob(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,i)}return t}function ft(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ob(Object(t),!0).forEach(function(i){U5(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ob(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}const B5=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),z5=()=>Headers,q5=(n,e,t)=>{const i=B5(t),a=z5();return async(o,c)=>{var u;const h=(u=await e())!==null&&u!==void 0?u:n;let f=new a(c?.headers);return f.has("apikey")||f.set("apikey",n),f.has("Authorization")||f.set("Authorization",`Bearer ${h}`),i(o,ft(ft({},c),{},{headers:f}))}};function F5(n){return n.endsWith("/")?n:n+"/"}function H5(n,e){var t,i;const{db:a,auth:o,realtime:c,global:u}=n,{db:h,auth:f,realtime:p,global:y}=e,b={db:ft(ft({},h),a),auth:ft(ft({},f),o),realtime:ft(ft({},p),c),storage:{},global:ft(ft(ft({},y),u),{},{headers:ft(ft({},(t=y?.headers)!==null&&t!==void 0?t:{}),(i=u?.headers)!==null&&i!==void 0?i:{})}),accessToken:async()=>""};return n.accessToken?b.accessToken=n.accessToken:delete b.accessToken,b}function V5(n){const e=n?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(F5(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var $5=class extends O5{constructor(n){super(n)}},W5=class{constructor(n,e,t){var i,a;this.supabaseUrl=n,this.supabaseKey=e;const o=V5(n);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const c=`sb-${o.hostname.split(".")[0]}-auth-token`,u={db:D5,realtime:N5,auth:ft(ft({},M5),{},{storageKey:c}),global:P5},h=H5(t??{},u);if(this.storageKey=(i=h.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(a=h.global.headers)!==null&&a!==void 0?a:{},h.accessToken)this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(p,y)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(y)} is not possible`)}});else{var f;this.auth=this._initSupabaseAuthClient((f=h.auth)!==null&&f!==void 0?f:{},this.headers,h.global.fetch)}this.fetch=q5(e,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(ft({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.accessToken&&this.accessToken().then(p=>this.realtime.setAuth(p)).catch(p=>console.warn("Failed to set initial Realtime auth token:",p)),this.rest=new _x(new URL("rest/v1",o).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new kE(this.storageUrl.href,this.headers,this.fetch,t?.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new Sx(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,e={},t={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,e,t)}channel(n,e={config:{}}){return this.realtime.channel(n,e)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,e,t;if(n.accessToken)return await n.accessToken();const{data:i}=await n.auth.getSession();return(e=(t=i.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:e,detectSessionInUrl:t,storage:i,userStorage:a,storageKey:o,flowType:c,lock:u,debug:h,throwOnError:f},p,y){const b={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new $5({url:this.authUrl.href,headers:ft(ft({},b),p),storageKey:o,autoRefreshToken:n,persistSession:e,detectSessionInUrl:t,storage:i,userStorage:a,flowType:c,lock:u,debug:h,throwOnError:f,fetch:y,hasCustomAuthorizationHeader:Object.keys(this.headers).some(k=>k.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new Fx(this.realtimeUrl.href,ft(ft({},n),{},{params:ft(ft({},{apikey:this.supabaseKey}),n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,e)=>{this._handleTokenChanged(n,"CLIENT",e?.access_token)})}_handleTokenChanged(n,e,t){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==t?(this.changedAccessToken=t,this.realtime.setAuth(t)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const G5=(n,e,t)=>new W5(n,e,t);function K5(){if(typeof window<"u")return!1;const n=globalThis.process;if(!n)return!1;const e=n.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}K5()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const J5={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtjbWNzc3l5b3BtdnFnbHNkZHl3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4NjUwODUsImV4cCI6MjA4NDQ0MTA4NX0.OWjhyCAzhVkMfMrBL96FLjdUUlU51B8N3mKuBvqntt4",VITE_SUPABASE_URL:"https://kcmcssyyopmvqglsddyw.supabase.co"};function HT(n){const e=J5?.[n];if(!e||typeof e!="string")throw new Error(`Missing ${n}`);const t=e.trim();if(console.log(` ${n} =`,t),!/^https?:\/\//i.test(t)&&n.includes("URL"))throw new Error(`Invalid ${n}: ${t}`);return t}const Y5=HT("VITE_SUPABASE_URL"),Q5=HT("VITE_SUPABASE_ANON_KEY"),je=G5(Y5,Q5);async function Ab(n){const e={id:n.id,email:n.email??null},{error:t}=await je.from("profiles").upsert(e,{onConflict:"id"});t&&console.warn("ensureProfile upsert failed:",t.message)}const VT=T.createContext(null);function X5({children:n}){const[e,t]=T.useState(null),[i,a]=T.useState(!0);T.useEffect(()=>{let c=!0;(async()=>{const{data:h,error:f}=await je.auth.getSession();if(!c)return;f&&console.warn("getSession error",f);const p=h.session??null;t(p),a(!1),p?.user&&Ab(p.user).catch(y=>console.warn("ensureProfile error",y))})();const{data:u}=je.auth.onAuthStateChange((h,f)=>{t(f??null),a(!1),f?.user&&Ab(f.user).catch(p=>console.warn("ensureProfile error",p))});return()=>{c=!1,u.subscription.unsubscribe()}},[]);const o=T.useMemo(()=>({session:e,user:e?.user??null,loading:i,async signIn(c,u){const{error:h}=await je.auth.signInWithPassword({email:c,password:u});if(h)throw h},async signUp(c,u){const{error:h}=await je.auth.signUp({email:c,password:u});if(h)throw h},async signOut(){const{error:c}=await je.auth.signOut();if(c)throw c}}),[e,i]);return g.jsx(VT.Provider,{value:o,children:n})}function $T(){const n=T.useContext(VT);if(!n)throw new Error("useAuth must be used inside <AuthProvider>");return n}var jf={exports:{}},Lo={},Pf={exports:{}},Df={};var jb;function Z5(){return jb||(jb=1,(function(n){function e(N,K){var ae=N.length;N.push(K);e:for(;0<ae;){var pe=ae-1>>>1,ye=N[pe];if(0<a(ye,K))N[pe]=K,N[ae]=ye,ae=pe;else break e}}function t(N){return N.length===0?null:N[0]}function i(N){if(N.length===0)return null;var K=N[0],ae=N.pop();if(ae!==K){N[0]=ae;e:for(var pe=0,ye=N.length,D=ye>>>1;pe<D;){var J=2*(pe+1)-1,oe=N[J],de=J+1,ge=N[de];if(0>a(oe,ae))de<ye&&0>a(ge,oe)?(N[pe]=ge,N[de]=ae,pe=de):(N[pe]=oe,N[J]=ae,pe=J);else if(de<ye&&0>a(ge,ae))N[pe]=ge,N[de]=ae,pe=de;else break e}}return K}function a(N,K){var ae=N.sortIndex-K.sortIndex;return ae!==0?ae:N.id-K.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var c=Date,u=c.now();n.unstable_now=function(){return c.now()-u}}var h=[],f=[],p=1,y=null,b=3,k=!1,C=!1,w=!1,O=!1,R=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;function E(N){for(var K=t(f);K!==null;){if(K.callback===null)i(f);else if(K.startTime<=N)i(f),K.sortIndex=K.expirationTime,e(h,K);else break;K=t(f)}}function _(N){if(w=!1,E(N),!C)if(t(h)!==null)C=!0,A||(A=!0,ie());else{var K=t(f);K!==null&&le(_,K.startTime-N)}}var A=!1,I=-1,F=5,B=-1;function z(){return O?!0:!(n.unstable_now()-B<F)}function H(){if(O=!1,A){var N=n.unstable_now();B=N;var K=!0;try{e:{C=!1,w&&(w=!1,P(I),I=-1),k=!0;var ae=b;try{t:{for(E(N),y=t(h);y!==null&&!(y.expirationTime>N&&z());){var pe=y.callback;if(typeof pe=="function"){y.callback=null,b=y.priorityLevel;var ye=pe(y.expirationTime<=N);if(N=n.unstable_now(),typeof ye=="function"){y.callback=ye,E(N),K=!0;break t}y===t(h)&&i(h),E(N)}else i(h);y=t(h)}if(y!==null)K=!0;else{var D=t(f);D!==null&&le(_,D.startTime-N),K=!1}}break e}finally{y=null,b=ae,k=!1}K=void 0}}finally{K?ie():A=!1}}}var ie;if(typeof j=="function")ie=function(){j(H)};else if(typeof MessageChannel<"u"){var he=new MessageChannel,Z=he.port2;he.port1.onmessage=H,ie=function(){Z.postMessage(null)}}else ie=function(){R(H,0)};function le(N,K){I=R(function(){N(n.unstable_now())},K)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(N){N.callback=null},n.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<N?Math.floor(1e3/N):5},n.unstable_getCurrentPriorityLevel=function(){return b},n.unstable_next=function(N){switch(b){case 1:case 2:case 3:var K=3;break;default:K=b}var ae=b;b=K;try{return N()}finally{b=ae}},n.unstable_requestPaint=function(){O=!0},n.unstable_runWithPriority=function(N,K){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var ae=b;b=N;try{return K()}finally{b=ae}},n.unstable_scheduleCallback=function(N,K,ae){var pe=n.unstable_now();switch(typeof ae=="object"&&ae!==null?(ae=ae.delay,ae=typeof ae=="number"&&0<ae?pe+ae:pe):ae=pe,N){case 1:var ye=-1;break;case 2:ye=250;break;case 5:ye=1073741823;break;case 4:ye=1e4;break;default:ye=5e3}return ye=ae+ye,N={id:p++,callback:K,priorityLevel:N,startTime:ae,expirationTime:ye,sortIndex:-1},ae>pe?(N.sortIndex=ae,e(f,N),t(h)===null&&N===t(f)&&(w?(P(I),I=-1):w=!0,le(_,ae-pe))):(N.sortIndex=ye,e(h,N),C||k||(C=!0,A||(A=!0,ie()))),N},n.unstable_shouldYield=z,n.unstable_wrapCallback=function(N){var K=b;return function(){var ae=b;b=K;try{return N.apply(this,arguments)}finally{b=ae}}}})(Df)),Df}var Pb;function eR(){return Pb||(Pb=1,Pf.exports=Z5()),Pf.exports}var Mf={exports:{}},Vt={};var Db;function tR(){if(Db)return Vt;Db=1;var n=rm();function e(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)f+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function o(h,f,p){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:y==null?null:""+y,children:h,containerInfo:f,implementation:p}}var c=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Vt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Vt.createPortal=function(h,f){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return o(h,f,null,p)},Vt.flushSync=function(h){var f=c.T,p=i.p;try{if(c.T=null,i.p=2,h)return h()}finally{c.T=f,i.p=p,i.d.f()}},Vt.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,i.d.C(h,f))},Vt.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},Vt.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var p=f.as,y=u(p,f.crossOrigin),b=typeof f.integrity=="string"?f.integrity:void 0,k=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;p==="style"?i.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:y,integrity:b,fetchPriority:k}):p==="script"&&i.d.X(h,{crossOrigin:y,integrity:b,fetchPriority:k,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Vt.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var p=u(f.as,f.crossOrigin);i.d.M(h,{crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&i.d.M(h)},Vt.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var p=f.as,y=u(p,f.crossOrigin);i.d.L(h,p,{crossOrigin:y,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Vt.preloadModule=function(h,f){if(typeof h=="string")if(f){var p=u(f.as,f.crossOrigin);i.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else i.d.m(h)},Vt.requestFormReset=function(h){i.d.r(h)},Vt.unstable_batchedUpdates=function(h,f){return h(f)},Vt.useFormState=function(h,f,p){return c.H.useFormState(h,f,p)},Vt.useFormStatus=function(){return c.H.useHostTransitionStatus()},Vt.version="19.2.3",Vt}var Mb;function nR(){if(Mb)return Mf.exports;Mb=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Mf.exports=tR(),Mf.exports}var Nb;function iR(){if(Nb)return Lo;Nb=1;var n=eR(),e=rm(),t=nR();function i(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)s+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function o(r){var s=r,l=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,(s.flags&4098)!==0&&(l=s.return),r=s.return;while(r)}return s.tag===3?l:null}function c(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function u(r){if(r.tag===31){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function h(r){if(o(r)!==r)throw Error(i(188))}function f(r){var s=r.alternate;if(!s){if(s=o(r),s===null)throw Error(i(188));return s!==r?null:r}for(var l=r,d=s;;){var m=l.return;if(m===null)break;var v=m.alternate;if(v===null){if(d=m.return,d!==null){l=d;continue}break}if(m.child===v.child){for(v=m.child;v;){if(v===l)return h(m),r;if(v===d)return h(m),s;v=v.sibling}throw Error(i(188))}if(l.return!==d.return)l=m,d=v;else{for(var S=!1,x=m.child;x;){if(x===l){S=!0,l=m,d=v;break}if(x===d){S=!0,d=m,l=v;break}x=x.sibling}if(!S){for(x=v.child;x;){if(x===l){S=!0,l=v,d=m;break}if(x===d){S=!0,d=v,l=m;break}x=x.sibling}if(!S)throw Error(i(189))}}if(l.alternate!==d)throw Error(i(190))}if(l.tag!==3)throw Error(i(188));return l.stateNode.current===l?r:s}function p(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=p(r),s!==null)return s;r=r.sibling}return null}var y=Object.assign,b=Symbol.for("react.element"),k=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),O=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),P=Symbol.for("react.consumer"),j=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),B=Symbol.for("react.activity"),z=Symbol.for("react.memo_cache_sentinel"),H=Symbol.iterator;function ie(r){return r===null||typeof r!="object"?null:(r=H&&r[H]||r["@@iterator"],typeof r=="function"?r:null)}var he=Symbol.for("react.client.reference");function Z(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===he?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case w:return"Fragment";case R:return"Profiler";case O:return"StrictMode";case _:return"Suspense";case A:return"SuspenseList";case B:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case C:return"Portal";case j:return r.displayName||"Context";case P:return(r._context.displayName||"Context")+".Consumer";case E:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case I:return s=r.displayName||null,s!==null?s:Z(r.type)||"Memo";case F:s=r._payload,r=r._init;try{return Z(r(s))}catch{}}return null}var le=Array.isArray,N=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ae={pending:!1,data:null,method:null,action:null},pe=[],ye=-1;function D(r){return{current:r}}function J(r){0>ye||(r.current=pe[ye],pe[ye]=null,ye--)}function oe(r,s){ye++,pe[ye]=r.current,r.current=s}var de=D(null),ge=D(null),_e=D(null),Se=D(null);function nt(r,s){switch(oe(_e,s),oe(ge,r),oe(de,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?xy(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=xy(s),r=Ey(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}J(de),oe(de,r)}function Fe(){J(de),J(ge),J(_e)}function hn(r){r.memoizedState!==null&&oe(Se,r);var s=de.current,l=Ey(s,r.type);s!==l&&(oe(ge,r),oe(de,l))}function xl(r){ge.current===r&&(J(de),J(ge)),Se.current===r&&(J(Se),Po._currentValue=ae)}var td,ng;function Fr(r){if(td===void 0)try{throw Error()}catch(l){var s=l.stack.trim().match(/\n( *(at )?)/);td=s&&s[1]||"",ng=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+td+r+ng}var nd=!1;function id(r,s){if(!r||nd)return"";nd=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(s){var re=function(){throw Error()};if(Object.defineProperty(re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(re,[])}catch(Y){var G=Y}Reflect.construct(r,[],re)}else{try{re.call()}catch(Y){G=Y}r.call(re.prototype)}}else{try{throw Error()}catch(Y){G=Y}(re=r())&&typeof re.catch=="function"&&re.catch(function(){})}}catch(Y){if(Y&&G&&typeof Y.stack=="string")return[Y.stack,G.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=d.DetermineComponentFrameRoot(),S=v[0],x=v[1];if(S&&x){var L=S.split(`
`),$=x.split(`
`);for(m=d=0;d<L.length&&!L[d].includes("DetermineComponentFrameRoot");)d++;for(;m<$.length&&!$[m].includes("DetermineComponentFrameRoot");)m++;if(d===L.length||m===$.length)for(d=L.length-1,m=$.length-1;1<=d&&0<=m&&L[d]!==$[m];)m--;for(;1<=d&&0<=m;d--,m--)if(L[d]!==$[m]){if(d!==1||m!==1)do if(d--,m--,0>m||L[d]!==$[m]){var ee=`
`+L[d].replace(" at new "," at ");return r.displayName&&ee.includes("<anonymous>")&&(ee=ee.replace("<anonymous>",r.displayName)),ee}while(1<=d&&0<=m);break}}}finally{nd=!1,Error.prepareStackTrace=l}return(l=r?r.displayName||r.name:"")?Fr(l):""}function $1(r,s){switch(r.tag){case 26:case 27:case 5:return Fr(r.type);case 16:return Fr("Lazy");case 13:return r.child!==s&&s!==null?Fr("Suspense Fallback"):Fr("Suspense");case 19:return Fr("SuspenseList");case 0:case 15:return id(r.type,!1);case 11:return id(r.type.render,!1);case 1:return id(r.type,!0);case 31:return Fr("Activity");default:return""}}function ig(r){try{var s="",l=null;do s+=$1(r,l),l=r,r=r.return;while(r);return s}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var rd=Object.prototype.hasOwnProperty,ad=n.unstable_scheduleCallback,sd=n.unstable_cancelCallback,W1=n.unstable_shouldYield,G1=n.unstable_requestPaint,fn=n.unstable_now,K1=n.unstable_getCurrentPriorityLevel,rg=n.unstable_ImmediatePriority,ag=n.unstable_UserBlockingPriority,El=n.unstable_NormalPriority,J1=n.unstable_LowPriority,sg=n.unstable_IdlePriority,Y1=n.log,Q1=n.unstable_setDisableYieldValue,Hs=null,pn=null;function Zi(r){if(typeof Y1=="function"&&Q1(r),pn&&typeof pn.setStrictMode=="function")try{pn.setStrictMode(Hs,r)}catch{}}var mn=Math.clz32?Math.clz32:eC,X1=Math.log,Z1=Math.LN2;function eC(r){return r>>>=0,r===0?32:31-(X1(r)/Z1|0)|0}var Rl=256,Ol=262144,Al=4194304;function Hr(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function jl(r,s,l){var d=r.pendingLanes;if(d===0)return 0;var m=0,v=r.suspendedLanes,S=r.pingedLanes;r=r.warmLanes;var x=d&134217727;return x!==0?(d=x&~v,d!==0?m=Hr(d):(S&=x,S!==0?m=Hr(S):l||(l=x&~r,l!==0&&(m=Hr(l))))):(x=d&~v,x!==0?m=Hr(x):S!==0?m=Hr(S):l||(l=d&~r,l!==0&&(m=Hr(l)))),m===0?0:s!==0&&s!==m&&(s&v)===0&&(v=m&-m,l=s&-s,v>=l||v===32&&(l&4194048)!==0)?s:m}function Vs(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function tC(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function og(){var r=Al;return Al<<=1,(Al&62914560)===0&&(Al=4194304),r}function od(r){for(var s=[],l=0;31>l;l++)s.push(r);return s}function $s(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function nC(r,s,l,d,m,v){var S=r.pendingLanes;r.pendingLanes=l,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=l,r.entangledLanes&=l,r.errorRecoveryDisabledLanes&=l,r.shellSuspendCounter=0;var x=r.entanglements,L=r.expirationTimes,$=r.hiddenUpdates;for(l=S&~l;0<l;){var ee=31-mn(l),re=1<<ee;x[ee]=0,L[ee]=-1;var G=$[ee];if(G!==null)for($[ee]=null,ee=0;ee<G.length;ee++){var Y=G[ee];Y!==null&&(Y.lane&=-536870913)}l&=~re}d!==0&&lg(r,d,0),v!==0&&m===0&&r.tag!==0&&(r.suspendedLanes|=v&~(S&~s))}function lg(r,s,l){r.pendingLanes|=s,r.suspendedLanes&=~s;var d=31-mn(s);r.entangledLanes|=s,r.entanglements[d]=r.entanglements[d]|1073741824|l&261930}function cg(r,s){var l=r.entangledLanes|=s;for(r=r.entanglements;l;){var d=31-mn(l),m=1<<d;m&s|r[d]&s&&(r[d]|=s),l&=~m}}function ug(r,s){var l=s&-s;return l=(l&42)!==0?1:ld(l),(l&(r.suspendedLanes|s))!==0?0:l}function ld(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function cd(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function dg(){var r=K.p;return r!==0?r:(r=window.event,r===void 0?32:Yy(r.type))}function hg(r,s){var l=K.p;try{return K.p=r,s()}finally{K.p=l}}var er=Math.random().toString(36).slice(2),Nt="__reactFiber$"+er,Zt="__reactProps$"+er,Ta="__reactContainer$"+er,ud="__reactEvents$"+er,iC="__reactListeners$"+er,rC="__reactHandles$"+er,fg="__reactResources$"+er,Ws="__reactMarker$"+er;function dd(r){delete r[Nt],delete r[Zt],delete r[ud],delete r[iC],delete r[rC]}function ka(r){var s=r[Nt];if(s)return s;for(var l=r.parentNode;l;){if(s=l[Ta]||l[Nt]){if(l=s.alternate,s.child!==null||l!==null&&l.child!==null)for(r=My(r);r!==null;){if(l=r[Nt])return l;r=My(r)}return s}r=l,l=r.parentNode}return null}function wa(r){if(r=r[Nt]||r[Ta]){var s=r.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return r}return null}function Gs(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(i(33))}function Ca(r){var s=r[fg];return s||(s=r[fg]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function jt(r){r[Ws]=!0}var pg=new Set,mg={};function Vr(r,s){_a(r,s),_a(r+"Capture",s)}function _a(r,s){for(mg[r]=s,r=0;r<s.length;r++)pg.add(s[r])}var aC=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),gg={},vg={};function sC(r){return rd.call(vg,r)?!0:rd.call(gg,r)?!1:aC.test(r)?vg[r]=!0:(gg[r]=!0,!1)}function Pl(r,s,l){if(sC(s))if(l===null)r.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var d=s.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+l)}}function Dl(r,s,l){if(l===null)r.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+l)}}function bi(r,s,l,d){if(d===null)r.removeAttribute(l);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(l);return}r.setAttributeNS(s,l,""+d)}}function On(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function yg(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function oC(r,s,l){var d=Object.getOwnPropertyDescriptor(r.constructor.prototype,s);if(!r.hasOwnProperty(s)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var m=d.get,v=d.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return m.call(this)},set:function(S){l=""+S,v.call(this,S)}}),Object.defineProperty(r,s,{enumerable:d.enumerable}),{getValue:function(){return l},setValue:function(S){l=""+S},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function hd(r){if(!r._valueTracker){var s=yg(r)?"checked":"value";r._valueTracker=oC(r,s,""+r[s])}}function bg(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var l=s.getValue(),d="";return r&&(d=yg(r)?r.checked?"true":"false":r.value),r=d,r!==l?(s.setValue(r),!0):!1}function Ml(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var lC=/[\n"\\]/g;function An(r){return r.replace(lC,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function fd(r,s,l,d,m,v,S,x){r.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?r.type=S:r.removeAttribute("type"),s!=null?S==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+On(s)):r.value!==""+On(s)&&(r.value=""+On(s)):S!=="submit"&&S!=="reset"||r.removeAttribute("value"),s!=null?pd(r,S,On(s)):l!=null?pd(r,S,On(l)):d!=null&&r.removeAttribute("value"),m==null&&v!=null&&(r.defaultChecked=!!v),m!=null&&(r.checked=m&&typeof m!="function"&&typeof m!="symbol"),x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?r.name=""+On(x):r.removeAttribute("name")}function Sg(r,s,l,d,m,v,S,x){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(r.type=v),s!=null||l!=null){if(!(v!=="submit"&&v!=="reset"||s!=null)){hd(r);return}l=l!=null?""+On(l):"",s=s!=null?""+On(s):l,x||s===r.value||(r.value=s),r.defaultValue=s}d=d??m,d=typeof d!="function"&&typeof d!="symbol"&&!!d,r.checked=x?r.checked:!!d,r.defaultChecked=!!d,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(r.name=S),hd(r)}function pd(r,s,l){s==="number"&&Ml(r.ownerDocument)===r||r.defaultValue===""+l||(r.defaultValue=""+l)}function xa(r,s,l,d){if(r=r.options,s){s={};for(var m=0;m<l.length;m++)s["$"+l[m]]=!0;for(l=0;l<r.length;l++)m=s.hasOwnProperty("$"+r[l].value),r[l].selected!==m&&(r[l].selected=m),m&&d&&(r[l].defaultSelected=!0)}else{for(l=""+On(l),s=null,m=0;m<r.length;m++){if(r[m].value===l){r[m].selected=!0,d&&(r[m].defaultSelected=!0);return}s!==null||r[m].disabled||(s=r[m])}s!==null&&(s.selected=!0)}}function Tg(r,s,l){if(s!=null&&(s=""+On(s),s!==r.value&&(r.value=s),l==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=l!=null?""+On(l):""}function kg(r,s,l,d){if(s==null){if(d!=null){if(l!=null)throw Error(i(92));if(le(d)){if(1<d.length)throw Error(i(93));d=d[0]}l=d}l==null&&(l=""),s=l}l=On(s),r.defaultValue=l,d=r.textContent,d===l&&d!==""&&d!==null&&(r.value=d),hd(r)}function Ea(r,s){if(s){var l=r.firstChild;if(l&&l===r.lastChild&&l.nodeType===3){l.nodeValue=s;return}}r.textContent=s}var cC=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function wg(r,s,l){var d=s.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?d?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":d?r.setProperty(s,l):typeof l!="number"||l===0||cC.has(s)?s==="float"?r.cssFloat=l:r[s]=(""+l).trim():r[s]=l+"px"}function Cg(r,s,l){if(s!=null&&typeof s!="object")throw Error(i(62));if(r=r.style,l!=null){for(var d in l)!l.hasOwnProperty(d)||s!=null&&s.hasOwnProperty(d)||(d.indexOf("--")===0?r.setProperty(d,""):d==="float"?r.cssFloat="":r[d]="");for(var m in s)d=s[m],s.hasOwnProperty(m)&&l[m]!==d&&wg(r,m,d)}else for(var v in s)s.hasOwnProperty(v)&&wg(r,v,s[v])}function md(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var uC=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),dC=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Nl(r){return dC.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Si(){}var gd=null;function vd(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Ra=null,Oa=null;function _g(r){var s=wa(r);if(s&&(r=s.stateNode)){var l=r[Zt]||null;e:switch(r=s.stateNode,s.type){case"input":if(fd(r,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),s=l.name,l.type==="radio"&&s!=null){for(l=r;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+An(""+s)+'"][type="radio"]'),s=0;s<l.length;s++){var d=l[s];if(d!==r&&d.form===r.form){var m=d[Zt]||null;if(!m)throw Error(i(90));fd(d,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(s=0;s<l.length;s++)d=l[s],d.form===r.form&&bg(d)}break e;case"textarea":Tg(r,l.value,l.defaultValue);break e;case"select":s=l.value,s!=null&&xa(r,!!l.multiple,s,!1)}}}var yd=!1;function xg(r,s,l){if(yd)return r(s,l);yd=!0;try{var d=r(s);return d}finally{if(yd=!1,(Ra!==null||Oa!==null)&&(kc(),Ra&&(s=Ra,r=Oa,Oa=Ra=null,_g(s),r)))for(s=0;s<r.length;s++)_g(r[s])}}function Ks(r,s){var l=r.stateNode;if(l===null)return null;var d=l[Zt]||null;if(d===null)return null;l=d[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(r=r.type,d=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!d;break e;default:r=!1}if(r)return null;if(l&&typeof l!="function")throw Error(i(231,s,typeof l));return l}var Ti=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),bd=!1;if(Ti)try{var Js={};Object.defineProperty(Js,"passive",{get:function(){bd=!0}}),window.addEventListener("test",Js,Js),window.removeEventListener("test",Js,Js)}catch{bd=!1}var tr=null,Sd=null,Il=null;function Eg(){if(Il)return Il;var r,s=Sd,l=s.length,d,m="value"in tr?tr.value:tr.textContent,v=m.length;for(r=0;r<l&&s[r]===m[r];r++);var S=l-r;for(d=1;d<=S&&s[l-d]===m[v-d];d++);return Il=m.slice(r,1<d?1-d:void 0)}function Ll(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function Ul(){return!0}function Rg(){return!1}function en(r){function s(l,d,m,v,S){this._reactName=l,this._targetInst=m,this.type=d,this.nativeEvent=v,this.target=S,this.currentTarget=null;for(var x in r)r.hasOwnProperty(x)&&(l=r[x],this[x]=l?l(v):v[x]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?Ul:Rg,this.isPropagationStopped=Rg,this}return y(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Ul)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Ul)},persist:function(){},isPersistent:Ul}),s}var $r={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Bl=en($r),Ys=y({},$r,{view:0,detail:0}),hC=en(Ys),Td,kd,Qs,zl=y({},Ys,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cd,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Qs&&(Qs&&r.type==="mousemove"?(Td=r.screenX-Qs.screenX,kd=r.screenY-Qs.screenY):kd=Td=0,Qs=r),Td)},movementY:function(r){return"movementY"in r?r.movementY:kd}}),Og=en(zl),fC=y({},zl,{dataTransfer:0}),pC=en(fC),mC=y({},Ys,{relatedTarget:0}),wd=en(mC),gC=y({},$r,{animationName:0,elapsedTime:0,pseudoElement:0}),vC=en(gC),yC=y({},$r,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),bC=en(yC),SC=y({},$r,{data:0}),Ag=en(SC),TC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function CC(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=wC[r])?!!s[r]:!1}function Cd(){return CC}var _C=y({},Ys,{key:function(r){if(r.key){var s=TC[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=Ll(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?kC[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cd,charCode:function(r){return r.type==="keypress"?Ll(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Ll(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),xC=en(_C),EC=y({},zl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),jg=en(EC),RC=y({},Ys,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cd}),OC=en(RC),AC=y({},$r,{propertyName:0,elapsedTime:0,pseudoElement:0}),jC=en(AC),PC=y({},zl,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),DC=en(PC),MC=y({},$r,{newState:0,oldState:0}),NC=en(MC),IC=[9,13,27,32],_d=Ti&&"CompositionEvent"in window,Xs=null;Ti&&"documentMode"in document&&(Xs=document.documentMode);var LC=Ti&&"TextEvent"in window&&!Xs,Pg=Ti&&(!_d||Xs&&8<Xs&&11>=Xs),Dg=" ",Mg=!1;function Ng(r,s){switch(r){case"keyup":return IC.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ig(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Aa=!1;function UC(r,s){switch(r){case"compositionend":return Ig(s);case"keypress":return s.which!==32?null:(Mg=!0,Dg);case"textInput":return r=s.data,r===Dg&&Mg?null:r;default:return null}}function BC(r,s){if(Aa)return r==="compositionend"||!_d&&Ng(r,s)?(r=Eg(),Il=Sd=tr=null,Aa=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Pg&&s.locale!=="ko"?null:s.data;default:return null}}var zC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Lg(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!zC[r.type]:s==="textarea"}function Ug(r,s,l,d){Ra?Oa?Oa.push(d):Oa=[d]:Ra=d,s=Oc(s,"onChange"),0<s.length&&(l=new Bl("onChange","change",null,l,d),r.push({event:l,listeners:s}))}var Zs=null,eo=null;function qC(r){Sy(r,0)}function ql(r){var s=Gs(r);if(bg(s))return r}function Bg(r,s){if(r==="change")return s}var zg=!1;if(Ti){var xd;if(Ti){var Ed="oninput"in document;if(!Ed){var qg=document.createElement("div");qg.setAttribute("oninput","return;"),Ed=typeof qg.oninput=="function"}xd=Ed}else xd=!1;zg=xd&&(!document.documentMode||9<document.documentMode)}function Fg(){Zs&&(Zs.detachEvent("onpropertychange",Hg),eo=Zs=null)}function Hg(r){if(r.propertyName==="value"&&ql(eo)){var s=[];Ug(s,eo,r,vd(r)),xg(qC,s)}}function FC(r,s,l){r==="focusin"?(Fg(),Zs=s,eo=l,Zs.attachEvent("onpropertychange",Hg)):r==="focusout"&&Fg()}function HC(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return ql(eo)}function VC(r,s){if(r==="click")return ql(s)}function $C(r,s){if(r==="input"||r==="change")return ql(s)}function WC(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var gn=typeof Object.is=="function"?Object.is:WC;function to(r,s){if(gn(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var l=Object.keys(r),d=Object.keys(s);if(l.length!==d.length)return!1;for(d=0;d<l.length;d++){var m=l[d];if(!rd.call(s,m)||!gn(r[m],s[m]))return!1}return!0}function Vg(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function $g(r,s){var l=Vg(r);r=0;for(var d;l;){if(l.nodeType===3){if(d=r+l.textContent.length,r<=s&&d>=s)return{node:l,offset:s-r};r=d}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Vg(l)}}function Wg(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?Wg(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function Gg(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=Ml(r.document);s instanceof r.HTMLIFrameElement;){try{var l=typeof s.contentWindow.location.href=="string"}catch{l=!1}if(l)r=s.contentWindow;else break;s=Ml(r.document)}return s}function Rd(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var GC=Ti&&"documentMode"in document&&11>=document.documentMode,ja=null,Od=null,no=null,Ad=!1;function Kg(r,s,l){var d=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Ad||ja==null||ja!==Ml(d)||(d=ja,"selectionStart"in d&&Rd(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),no&&to(no,d)||(no=d,d=Oc(Od,"onSelect"),0<d.length&&(s=new Bl("onSelect","select",null,s,l),r.push({event:s,listeners:d}),s.target=ja)))}function Wr(r,s){var l={};return l[r.toLowerCase()]=s.toLowerCase(),l["Webkit"+r]="webkit"+s,l["Moz"+r]="moz"+s,l}var Pa={animationend:Wr("Animation","AnimationEnd"),animationiteration:Wr("Animation","AnimationIteration"),animationstart:Wr("Animation","AnimationStart"),transitionrun:Wr("Transition","TransitionRun"),transitionstart:Wr("Transition","TransitionStart"),transitioncancel:Wr("Transition","TransitionCancel"),transitionend:Wr("Transition","TransitionEnd")},jd={},Jg={};Ti&&(Jg=document.createElement("div").style,"AnimationEvent"in window||(delete Pa.animationend.animation,delete Pa.animationiteration.animation,delete Pa.animationstart.animation),"TransitionEvent"in window||delete Pa.transitionend.transition);function Gr(r){if(jd[r])return jd[r];if(!Pa[r])return r;var s=Pa[r],l;for(l in s)if(s.hasOwnProperty(l)&&l in Jg)return jd[r]=s[l];return r}var Yg=Gr("animationend"),Qg=Gr("animationiteration"),Xg=Gr("animationstart"),KC=Gr("transitionrun"),JC=Gr("transitionstart"),YC=Gr("transitioncancel"),Zg=Gr("transitionend"),ev=new Map,Pd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Pd.push("scrollEnd");function Vn(r,s){ev.set(r,s),Vr(s,[r])}var Fl=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},jn=[],Da=0,Dd=0;function Hl(){for(var r=Da,s=Dd=Da=0;s<r;){var l=jn[s];jn[s++]=null;var d=jn[s];jn[s++]=null;var m=jn[s];jn[s++]=null;var v=jn[s];if(jn[s++]=null,d!==null&&m!==null){var S=d.pending;S===null?m.next=m:(m.next=S.next,S.next=m),d.pending=m}v!==0&&tv(l,m,v)}}function Vl(r,s,l,d){jn[Da++]=r,jn[Da++]=s,jn[Da++]=l,jn[Da++]=d,Dd|=d,r.lanes|=d,r=r.alternate,r!==null&&(r.lanes|=d)}function Md(r,s,l,d){return Vl(r,s,l,d),$l(r)}function Kr(r,s){return Vl(r,null,null,s),$l(r)}function tv(r,s,l){r.lanes|=l;var d=r.alternate;d!==null&&(d.lanes|=l);for(var m=!1,v=r.return;v!==null;)v.childLanes|=l,d=v.alternate,d!==null&&(d.childLanes|=l),v.tag===22&&(r=v.stateNode,r===null||r._visibility&1||(m=!0)),r=v,v=v.return;return r.tag===3?(v=r.stateNode,m&&s!==null&&(m=31-mn(l),r=v.hiddenUpdates,d=r[m],d===null?r[m]=[s]:d.push(s),s.lane=l|536870912),v):null}function $l(r){if(50<_o)throw _o=0,Hh=null,Error(i(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var Ma={};function QC(r,s,l,d){this.tag=r,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vn(r,s,l,d){return new QC(r,s,l,d)}function Nd(r){return r=r.prototype,!(!r||!r.isReactComponent)}function ki(r,s){var l=r.alternate;return l===null?(l=vn(r.tag,s,r.key,r.mode),l.elementType=r.elementType,l.type=r.type,l.stateNode=r.stateNode,l.alternate=r,r.alternate=l):(l.pendingProps=s,l.type=r.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=r.flags&65011712,l.childLanes=r.childLanes,l.lanes=r.lanes,l.child=r.child,l.memoizedProps=r.memoizedProps,l.memoizedState=r.memoizedState,l.updateQueue=r.updateQueue,s=r.dependencies,l.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},l.sibling=r.sibling,l.index=r.index,l.ref=r.ref,l.refCleanup=r.refCleanup,l}function nv(r,s){r.flags&=65011714;var l=r.alternate;return l===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=l.childLanes,r.lanes=l.lanes,r.child=l.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=l.memoizedProps,r.memoizedState=l.memoizedState,r.updateQueue=l.updateQueue,r.type=l.type,s=l.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function Wl(r,s,l,d,m,v){var S=0;if(d=r,typeof r=="function")Nd(r)&&(S=1);else if(typeof r=="string")S=nx(r,l,de.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case B:return r=vn(31,l,s,m),r.elementType=B,r.lanes=v,r;case w:return Jr(l.children,m,v,s);case O:S=8,m|=24;break;case R:return r=vn(12,l,s,m|2),r.elementType=R,r.lanes=v,r;case _:return r=vn(13,l,s,m),r.elementType=_,r.lanes=v,r;case A:return r=vn(19,l,s,m),r.elementType=A,r.lanes=v,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case j:S=10;break e;case P:S=9;break e;case E:S=11;break e;case I:S=14;break e;case F:S=16,d=null;break e}S=29,l=Error(i(130,r===null?"null":typeof r,"")),d=null}return s=vn(S,l,s,m),s.elementType=r,s.type=d,s.lanes=v,s}function Jr(r,s,l,d){return r=vn(7,r,d,s),r.lanes=l,r}function Id(r,s,l){return r=vn(6,r,null,s),r.lanes=l,r}function iv(r){var s=vn(18,null,null,0);return s.stateNode=r,s}function Ld(r,s,l){return s=vn(4,r.children!==null?r.children:[],r.key,s),s.lanes=l,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var rv=new WeakMap;function Pn(r,s){if(typeof r=="object"&&r!==null){var l=rv.get(r);return l!==void 0?l:(s={value:r,source:s,stack:ig(s)},rv.set(r,s),s)}return{value:r,source:s,stack:ig(s)}}var Na=[],Ia=0,Gl=null,io=0,Dn=[],Mn=0,nr=null,oi=1,li="";function wi(r,s){Na[Ia++]=io,Na[Ia++]=Gl,Gl=r,io=s}function av(r,s,l){Dn[Mn++]=oi,Dn[Mn++]=li,Dn[Mn++]=nr,nr=r;var d=oi;r=li;var m=32-mn(d)-1;d&=~(1<<m),l+=1;var v=32-mn(s)+m;if(30<v){var S=m-m%5;v=(d&(1<<S)-1).toString(32),d>>=S,m-=S,oi=1<<32-mn(s)+m|l<<m|d,li=v+r}else oi=1<<v|l<<m|d,li=r}function Ud(r){r.return!==null&&(wi(r,1),av(r,1,0))}function Bd(r){for(;r===Gl;)Gl=Na[--Ia],Na[Ia]=null,io=Na[--Ia],Na[Ia]=null;for(;r===nr;)nr=Dn[--Mn],Dn[Mn]=null,li=Dn[--Mn],Dn[Mn]=null,oi=Dn[--Mn],Dn[Mn]=null}function sv(r,s){Dn[Mn++]=oi,Dn[Mn++]=li,Dn[Mn++]=nr,oi=s.id,li=s.overflow,nr=r}var It=null,at=null,Ue=!1,ir=null,Nn=!1,zd=Error(i(519));function rr(r){var s=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw ro(Pn(s,r)),zd}function ov(r){var s=r.stateNode,l=r.type,d=r.memoizedProps;switch(s[Nt]=r,s[Zt]=d,l){case"dialog":De("cancel",s),De("close",s);break;case"iframe":case"object":case"embed":De("load",s);break;case"video":case"audio":for(l=0;l<Eo.length;l++)De(Eo[l],s);break;case"source":De("error",s);break;case"img":case"image":case"link":De("error",s),De("load",s);break;case"details":De("toggle",s);break;case"input":De("invalid",s),Sg(s,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":De("invalid",s);break;case"textarea":De("invalid",s),kg(s,d.value,d.defaultValue,d.children)}l=d.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||s.textContent===""+l||d.suppressHydrationWarning===!0||Cy(s.textContent,l)?(d.popover!=null&&(De("beforetoggle",s),De("toggle",s)),d.onScroll!=null&&De("scroll",s),d.onScrollEnd!=null&&De("scrollend",s),d.onClick!=null&&(s.onclick=Si),s=!0):s=!1,s||rr(r,!0)}function lv(r){for(It=r.return;It;)switch(It.tag){case 5:case 31:case 13:Nn=!1;return;case 27:case 3:Nn=!0;return;default:It=It.return}}function La(r){if(r!==It)return!1;if(!Ue)return lv(r),Ue=!0,!1;var s=r.tag,l;if((l=s!==3&&s!==27)&&((l=s===5)&&(l=r.type,l=!(l!=="form"&&l!=="button")||af(r.type,r.memoizedProps)),l=!l),l&&at&&rr(r),lv(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));at=Dy(r)}else if(s===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));at=Dy(r)}else s===27?(s=at,yr(r.type)?(r=uf,uf=null,at=r):at=s):at=It?Ln(r.stateNode.nextSibling):null;return!0}function Yr(){at=It=null,Ue=!1}function qd(){var r=ir;return r!==null&&(an===null?an=r:an.push.apply(an,r),ir=null),r}function ro(r){ir===null?ir=[r]:ir.push(r)}var Fd=D(null),Qr=null,Ci=null;function ar(r,s,l){oe(Fd,s._currentValue),s._currentValue=l}function _i(r){r._currentValue=Fd.current,J(Fd)}function Hd(r,s,l){for(;r!==null;){var d=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,d!==null&&(d.childLanes|=s)):d!==null&&(d.childLanes&s)!==s&&(d.childLanes|=s),r===l)break;r=r.return}}function Vd(r,s,l,d){var m=r.child;for(m!==null&&(m.return=r);m!==null;){var v=m.dependencies;if(v!==null){var S=m.child;v=v.firstContext;e:for(;v!==null;){var x=v;v=m;for(var L=0;L<s.length;L++)if(x.context===s[L]){v.lanes|=l,x=v.alternate,x!==null&&(x.lanes|=l),Hd(v.return,l,r),d||(S=null);break e}v=x.next}}else if(m.tag===18){if(S=m.return,S===null)throw Error(i(341));S.lanes|=l,v=S.alternate,v!==null&&(v.lanes|=l),Hd(S,l,r),S=null}else S=m.child;if(S!==null)S.return=m;else for(S=m;S!==null;){if(S===r){S=null;break}if(m=S.sibling,m!==null){m.return=S.return,S=m;break}S=S.return}m=S}}function Ua(r,s,l,d){r=null;for(var m=s,v=!1;m!==null;){if(!v){if((m.flags&524288)!==0)v=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var S=m.alternate;if(S===null)throw Error(i(387));if(S=S.memoizedProps,S!==null){var x=m.type;gn(m.pendingProps.value,S.value)||(r!==null?r.push(x):r=[x])}}else if(m===Se.current){if(S=m.alternate,S===null)throw Error(i(387));S.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(r!==null?r.push(Po):r=[Po])}m=m.return}r!==null&&Vd(s,r,l,d),s.flags|=262144}function Kl(r){for(r=r.firstContext;r!==null;){if(!gn(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Xr(r){Qr=r,Ci=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Lt(r){return cv(Qr,r)}function Jl(r,s){return Qr===null&&Xr(r),cv(r,s)}function cv(r,s){var l=s._currentValue;if(s={context:s,memoizedValue:l,next:null},Ci===null){if(r===null)throw Error(i(308));Ci=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else Ci=Ci.next=s;return l}var XC=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(l,d){r.push(d)}};this.abort=function(){s.aborted=!0,r.forEach(function(l){return l()})}},ZC=n.unstable_scheduleCallback,e_=n.unstable_NormalPriority,Tt={$$typeof:j,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function $d(){return{controller:new XC,data:new Map,refCount:0}}function ao(r){r.refCount--,r.refCount===0&&ZC(e_,function(){r.controller.abort()})}var so=null,Wd=0,Ba=0,za=null;function t_(r,s){if(so===null){var l=so=[];Wd=0,Ba=Jh(),za={status:"pending",value:void 0,then:function(d){l.push(d)}}}return Wd++,s.then(uv,uv),s}function uv(){if(--Wd===0&&so!==null){za!==null&&(za.status="fulfilled");var r=so;so=null,Ba=0,za=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function n_(r,s){var l=[],d={status:"pending",value:null,reason:null,then:function(m){l.push(m)}};return r.then(function(){d.status="fulfilled",d.value=s;for(var m=0;m<l.length;m++)(0,l[m])(s)},function(m){for(d.status="rejected",d.reason=m,m=0;m<l.length;m++)(0,l[m])(void 0)}),d}var dv=N.S;N.S=function(r,s){K0=fn(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&t_(r,s),dv!==null&&dv(r,s)};var Zr=D(null);function Gd(){var r=Zr.current;return r!==null?r:Xe.pooledCache}function Yl(r,s){s===null?oe(Zr,Zr.current):oe(Zr,s.pool)}function hv(){var r=Gd();return r===null?null:{parent:Tt._currentValue,pool:r}}var qa=Error(i(460)),Kd=Error(i(474)),Ql=Error(i(542)),Xl={then:function(){}};function fv(r){return r=r.status,r==="fulfilled"||r==="rejected"}function pv(r,s,l){switch(l=r[l],l===void 0?r.push(s):l!==s&&(s.then(Si,Si),s=l),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,gv(r),r;default:if(typeof s.status=="string")s.then(Si,Si);else{if(r=Xe,r!==null&&100<r.shellSuspendCounter)throw Error(i(482));r=s,r.status="pending",r.then(function(d){if(s.status==="pending"){var m=s;m.status="fulfilled",m.value=d}},function(d){if(s.status==="pending"){var m=s;m.status="rejected",m.reason=d}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,gv(r),r}throw ta=s,qa}}function ea(r){try{var s=r._init;return s(r._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(ta=l,qa):l}}var ta=null;function mv(){if(ta===null)throw Error(i(459));var r=ta;return ta=null,r}function gv(r){if(r===qa||r===Ql)throw Error(i(483))}var Fa=null,oo=0;function Zl(r){var s=oo;return oo+=1,Fa===null&&(Fa=[]),pv(Fa,r,s)}function lo(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function ec(r,s){throw s.$$typeof===b?Error(i(525)):(r=Object.prototype.toString.call(s),Error(i(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function vv(r){function s(q,U){if(r){var V=q.deletions;V===null?(q.deletions=[U],q.flags|=16):V.push(U)}}function l(q,U){if(!r)return null;for(;U!==null;)s(q,U),U=U.sibling;return null}function d(q){for(var U=new Map;q!==null;)q.key!==null?U.set(q.key,q):U.set(q.index,q),q=q.sibling;return U}function m(q,U){return q=ki(q,U),q.index=0,q.sibling=null,q}function v(q,U,V){return q.index=V,r?(V=q.alternate,V!==null?(V=V.index,V<U?(q.flags|=67108866,U):V):(q.flags|=67108866,U)):(q.flags|=1048576,U)}function S(q){return r&&q.alternate===null&&(q.flags|=67108866),q}function x(q,U,V,ne){return U===null||U.tag!==6?(U=Id(V,q.mode,ne),U.return=q,U):(U=m(U,V),U.return=q,U)}function L(q,U,V,ne){var be=V.type;return be===w?ee(q,U,V.props.children,ne,V.key):U!==null&&(U.elementType===be||typeof be=="object"&&be!==null&&be.$$typeof===F&&ea(be)===U.type)?(U=m(U,V.props),lo(U,V),U.return=q,U):(U=Wl(V.type,V.key,V.props,null,q.mode,ne),lo(U,V),U.return=q,U)}function $(q,U,V,ne){return U===null||U.tag!==4||U.stateNode.containerInfo!==V.containerInfo||U.stateNode.implementation!==V.implementation?(U=Ld(V,q.mode,ne),U.return=q,U):(U=m(U,V.children||[]),U.return=q,U)}function ee(q,U,V,ne,be){return U===null||U.tag!==7?(U=Jr(V,q.mode,ne,be),U.return=q,U):(U=m(U,V),U.return=q,U)}function re(q,U,V){if(typeof U=="string"&&U!==""||typeof U=="number"||typeof U=="bigint")return U=Id(""+U,q.mode,V),U.return=q,U;if(typeof U=="object"&&U!==null){switch(U.$$typeof){case k:return V=Wl(U.type,U.key,U.props,null,q.mode,V),lo(V,U),V.return=q,V;case C:return U=Ld(U,q.mode,V),U.return=q,U;case F:return U=ea(U),re(q,U,V)}if(le(U)||ie(U))return U=Jr(U,q.mode,V,null),U.return=q,U;if(typeof U.then=="function")return re(q,Zl(U),V);if(U.$$typeof===j)return re(q,Jl(q,U),V);ec(q,U)}return null}function G(q,U,V,ne){var be=U!==null?U.key:null;if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return be!==null?null:x(q,U,""+V,ne);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case k:return V.key===be?L(q,U,V,ne):null;case C:return V.key===be?$(q,U,V,ne):null;case F:return V=ea(V),G(q,U,V,ne)}if(le(V)||ie(V))return be!==null?null:ee(q,U,V,ne,null);if(typeof V.then=="function")return G(q,U,Zl(V),ne);if(V.$$typeof===j)return G(q,U,Jl(q,V),ne);ec(q,V)}return null}function Y(q,U,V,ne,be){if(typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint")return q=q.get(V)||null,x(U,q,""+ne,be);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case k:return q=q.get(ne.key===null?V:ne.key)||null,L(U,q,ne,be);case C:return q=q.get(ne.key===null?V:ne.key)||null,$(U,q,ne,be);case F:return ne=ea(ne),Y(q,U,V,ne,be)}if(le(ne)||ie(ne))return q=q.get(V)||null,ee(U,q,ne,be,null);if(typeof ne.then=="function")return Y(q,U,V,Zl(ne),be);if(ne.$$typeof===j)return Y(q,U,V,Jl(U,ne),be);ec(U,ne)}return null}function fe(q,U,V,ne){for(var be=null,ze=null,me=U,Oe=U=0,Le=null;me!==null&&Oe<V.length;Oe++){me.index>Oe?(Le=me,me=null):Le=me.sibling;var qe=G(q,me,V[Oe],ne);if(qe===null){me===null&&(me=Le);break}r&&me&&qe.alternate===null&&s(q,me),U=v(qe,U,Oe),ze===null?be=qe:ze.sibling=qe,ze=qe,me=Le}if(Oe===V.length)return l(q,me),Ue&&wi(q,Oe),be;if(me===null){for(;Oe<V.length;Oe++)me=re(q,V[Oe],ne),me!==null&&(U=v(me,U,Oe),ze===null?be=me:ze.sibling=me,ze=me);return Ue&&wi(q,Oe),be}for(me=d(me);Oe<V.length;Oe++)Le=Y(me,q,Oe,V[Oe],ne),Le!==null&&(r&&Le.alternate!==null&&me.delete(Le.key===null?Oe:Le.key),U=v(Le,U,Oe),ze===null?be=Le:ze.sibling=Le,ze=Le);return r&&me.forEach(function(wr){return s(q,wr)}),Ue&&wi(q,Oe),be}function Te(q,U,V,ne){if(V==null)throw Error(i(151));for(var be=null,ze=null,me=U,Oe=U=0,Le=null,qe=V.next();me!==null&&!qe.done;Oe++,qe=V.next()){me.index>Oe?(Le=me,me=null):Le=me.sibling;var wr=G(q,me,qe.value,ne);if(wr===null){me===null&&(me=Le);break}r&&me&&wr.alternate===null&&s(q,me),U=v(wr,U,Oe),ze===null?be=wr:ze.sibling=wr,ze=wr,me=Le}if(qe.done)return l(q,me),Ue&&wi(q,Oe),be;if(me===null){for(;!qe.done;Oe++,qe=V.next())qe=re(q,qe.value,ne),qe!==null&&(U=v(qe,U,Oe),ze===null?be=qe:ze.sibling=qe,ze=qe);return Ue&&wi(q,Oe),be}for(me=d(me);!qe.done;Oe++,qe=V.next())qe=Y(me,q,Oe,qe.value,ne),qe!==null&&(r&&qe.alternate!==null&&me.delete(qe.key===null?Oe:qe.key),U=v(qe,U,Oe),ze===null?be=qe:ze.sibling=qe,ze=qe);return r&&me.forEach(function(fx){return s(q,fx)}),Ue&&wi(q,Oe),be}function Je(q,U,V,ne){if(typeof V=="object"&&V!==null&&V.type===w&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case k:e:{for(var be=V.key;U!==null;){if(U.key===be){if(be=V.type,be===w){if(U.tag===7){l(q,U.sibling),ne=m(U,V.props.children),ne.return=q,q=ne;break e}}else if(U.elementType===be||typeof be=="object"&&be!==null&&be.$$typeof===F&&ea(be)===U.type){l(q,U.sibling),ne=m(U,V.props),lo(ne,V),ne.return=q,q=ne;break e}l(q,U);break}else s(q,U);U=U.sibling}V.type===w?(ne=Jr(V.props.children,q.mode,ne,V.key),ne.return=q,q=ne):(ne=Wl(V.type,V.key,V.props,null,q.mode,ne),lo(ne,V),ne.return=q,q=ne)}return S(q);case C:e:{for(be=V.key;U!==null;){if(U.key===be)if(U.tag===4&&U.stateNode.containerInfo===V.containerInfo&&U.stateNode.implementation===V.implementation){l(q,U.sibling),ne=m(U,V.children||[]),ne.return=q,q=ne;break e}else{l(q,U);break}else s(q,U);U=U.sibling}ne=Ld(V,q.mode,ne),ne.return=q,q=ne}return S(q);case F:return V=ea(V),Je(q,U,V,ne)}if(le(V))return fe(q,U,V,ne);if(ie(V)){if(be=ie(V),typeof be!="function")throw Error(i(150));return V=be.call(V),Te(q,U,V,ne)}if(typeof V.then=="function")return Je(q,U,Zl(V),ne);if(V.$$typeof===j)return Je(q,U,Jl(q,V),ne);ec(q,V)}return typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint"?(V=""+V,U!==null&&U.tag===6?(l(q,U.sibling),ne=m(U,V),ne.return=q,q=ne):(l(q,U),ne=Id(V,q.mode,ne),ne.return=q,q=ne),S(q)):l(q,U)}return function(q,U,V,ne){try{oo=0;var be=Je(q,U,V,ne);return Fa=null,be}catch(me){if(me===qa||me===Ql)throw me;var ze=vn(29,me,null,q.mode);return ze.lanes=ne,ze.return=q,ze}}}var na=vv(!0),yv=vv(!1),sr=!1;function Jd(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Yd(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function or(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function lr(r,s,l){var d=r.updateQueue;if(d===null)return null;if(d=d.shared,(He&2)!==0){var m=d.pending;return m===null?s.next=s:(s.next=m.next,m.next=s),d.pending=s,s=$l(r),tv(r,null,l),s}return Vl(r,d,s,l),$l(r)}function co(r,s,l){if(s=s.updateQueue,s!==null&&(s=s.shared,(l&4194048)!==0)){var d=s.lanes;d&=r.pendingLanes,l|=d,s.lanes=l,cg(r,l)}}function Qd(r,s){var l=r.updateQueue,d=r.alternate;if(d!==null&&(d=d.updateQueue,l===d)){var m=null,v=null;if(l=l.firstBaseUpdate,l!==null){do{var S={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};v===null?m=v=S:v=v.next=S,l=l.next}while(l!==null);v===null?m=v=s:v=v.next=s}else m=v=s;l={baseState:d.baseState,firstBaseUpdate:m,lastBaseUpdate:v,shared:d.shared,callbacks:d.callbacks},r.updateQueue=l;return}r=l.lastBaseUpdate,r===null?l.firstBaseUpdate=s:r.next=s,l.lastBaseUpdate=s}var Xd=!1;function uo(){if(Xd){var r=za;if(r!==null)throw r}}function ho(r,s,l,d){Xd=!1;var m=r.updateQueue;sr=!1;var v=m.firstBaseUpdate,S=m.lastBaseUpdate,x=m.shared.pending;if(x!==null){m.shared.pending=null;var L=x,$=L.next;L.next=null,S===null?v=$:S.next=$,S=L;var ee=r.alternate;ee!==null&&(ee=ee.updateQueue,x=ee.lastBaseUpdate,x!==S&&(x===null?ee.firstBaseUpdate=$:x.next=$,ee.lastBaseUpdate=L))}if(v!==null){var re=m.baseState;S=0,ee=$=L=null,x=v;do{var G=x.lane&-536870913,Y=G!==x.lane;if(Y?(Ie&G)===G:(d&G)===G){G!==0&&G===Ba&&(Xd=!0),ee!==null&&(ee=ee.next={lane:0,tag:x.tag,payload:x.payload,callback:null,next:null});e:{var fe=r,Te=x;G=s;var Je=l;switch(Te.tag){case 1:if(fe=Te.payload,typeof fe=="function"){re=fe.call(Je,re,G);break e}re=fe;break e;case 3:fe.flags=fe.flags&-65537|128;case 0:if(fe=Te.payload,G=typeof fe=="function"?fe.call(Je,re,G):fe,G==null)break e;re=y({},re,G);break e;case 2:sr=!0}}G=x.callback,G!==null&&(r.flags|=64,Y&&(r.flags|=8192),Y=m.callbacks,Y===null?m.callbacks=[G]:Y.push(G))}else Y={lane:G,tag:x.tag,payload:x.payload,callback:x.callback,next:null},ee===null?($=ee=Y,L=re):ee=ee.next=Y,S|=G;if(x=x.next,x===null){if(x=m.shared.pending,x===null)break;Y=x,x=Y.next,Y.next=null,m.lastBaseUpdate=Y,m.shared.pending=null}}while(!0);ee===null&&(L=re),m.baseState=L,m.firstBaseUpdate=$,m.lastBaseUpdate=ee,v===null&&(m.shared.lanes=0),fr|=S,r.lanes=S,r.memoizedState=re}}function bv(r,s){if(typeof r!="function")throw Error(i(191,r));r.call(s)}function Sv(r,s){var l=r.callbacks;if(l!==null)for(r.callbacks=null,r=0;r<l.length;r++)bv(l[r],s)}var Ha=D(null),tc=D(0);function Tv(r,s){r=Mi,oe(tc,r),oe(Ha,s),Mi=r|s.baseLanes}function Zd(){oe(tc,Mi),oe(Ha,Ha.current)}function eh(){Mi=tc.current,J(Ha),J(tc)}var yn=D(null),In=null;function cr(r){var s=r.alternate;oe(vt,vt.current&1),oe(yn,r),In===null&&(s===null||Ha.current!==null||s.memoizedState!==null)&&(In=r)}function th(r){oe(vt,vt.current),oe(yn,r),In===null&&(In=r)}function kv(r){r.tag===22?(oe(vt,vt.current),oe(yn,r),In===null&&(In=r)):ur()}function ur(){oe(vt,vt.current),oe(yn,yn.current)}function bn(r){J(yn),In===r&&(In=null),J(vt)}var vt=D(0);function nc(r){for(var s=r;s!==null;){if(s.tag===13){var l=s.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||lf(l)||cf(l)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var xi=0,Re=null,Ge=null,kt=null,ic=!1,Va=!1,ia=!1,rc=0,fo=0,$a=null,i_=0;function dt(){throw Error(i(321))}function nh(r,s){if(s===null)return!1;for(var l=0;l<s.length&&l<r.length;l++)if(!gn(r[l],s[l]))return!1;return!0}function ih(r,s,l,d,m,v){return xi=v,Re=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,N.H=r===null||r.memoizedState===null?a0:yh,ia=!1,v=l(d,m),ia=!1,Va&&(v=Cv(s,l,d,m)),wv(r),v}function wv(r){N.H=go;var s=Ge!==null&&Ge.next!==null;if(xi=0,kt=Ge=Re=null,ic=!1,fo=0,$a=null,s)throw Error(i(300));r===null||wt||(r=r.dependencies,r!==null&&Kl(r)&&(wt=!0))}function Cv(r,s,l,d){Re=r;var m=0;do{if(Va&&($a=null),fo=0,Va=!1,25<=m)throw Error(i(301));if(m+=1,kt=Ge=null,r.updateQueue!=null){var v=r.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}N.H=s0,v=s(l,d)}while(Va);return v}function r_(){var r=N.H,s=r.useState()[0];return s=typeof s.then=="function"?po(s):s,r=r.useState()[0],(Ge!==null?Ge.memoizedState:null)!==r&&(Re.flags|=1024),s}function rh(){var r=rc!==0;return rc=0,r}function ah(r,s,l){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~l}function sh(r){if(ic){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}ic=!1}xi=0,kt=Ge=Re=null,Va=!1,fo=rc=0,$a=null}function Gt(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return kt===null?Re.memoizedState=kt=r:kt=kt.next=r,kt}function yt(){if(Ge===null){var r=Re.alternate;r=r!==null?r.memoizedState:null}else r=Ge.next;var s=kt===null?Re.memoizedState:kt.next;if(s!==null)kt=s,Ge=r;else{if(r===null)throw Re.alternate===null?Error(i(467)):Error(i(310));Ge=r,r={memoizedState:Ge.memoizedState,baseState:Ge.baseState,baseQueue:Ge.baseQueue,queue:Ge.queue,next:null},kt===null?Re.memoizedState=kt=r:kt=kt.next=r}return kt}function ac(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function po(r){var s=fo;return fo+=1,$a===null&&($a=[]),r=pv($a,r,s),s=Re,(kt===null?s.memoizedState:kt.next)===null&&(s=s.alternate,N.H=s===null||s.memoizedState===null?a0:yh),r}function sc(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return po(r);if(r.$$typeof===j)return Lt(r)}throw Error(i(438,String(r)))}function oh(r){var s=null,l=Re.updateQueue;if(l!==null&&(s=l.memoCache),s==null){var d=Re.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(s={data:d.data.map(function(m){return m.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),l===null&&(l=ac(),Re.updateQueue=l),l.memoCache=s,l=s.data[s.index],l===void 0)for(l=s.data[s.index]=Array(r),d=0;d<r;d++)l[d]=z;return s.index++,l}function Ei(r,s){return typeof s=="function"?s(r):s}function oc(r){var s=yt();return lh(s,Ge,r)}function lh(r,s,l){var d=r.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=l;var m=r.baseQueue,v=d.pending;if(v!==null){if(m!==null){var S=m.next;m.next=v.next,v.next=S}s.baseQueue=m=v,d.pending=null}if(v=r.baseState,m===null)r.memoizedState=v;else{s=m.next;var x=S=null,L=null,$=s,ee=!1;do{var re=$.lane&-536870913;if(re!==$.lane?(Ie&re)===re:(xi&re)===re){var G=$.revertLane;if(G===0)L!==null&&(L=L.next={lane:0,revertLane:0,gesture:null,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null}),re===Ba&&(ee=!0);else if((xi&G)===G){$=$.next,G===Ba&&(ee=!0);continue}else re={lane:0,revertLane:$.revertLane,gesture:null,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null},L===null?(x=L=re,S=v):L=L.next=re,Re.lanes|=G,fr|=G;re=$.action,ia&&l(v,re),v=$.hasEagerState?$.eagerState:l(v,re)}else G={lane:re,revertLane:$.revertLane,gesture:$.gesture,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null},L===null?(x=L=G,S=v):L=L.next=G,Re.lanes|=re,fr|=re;$=$.next}while($!==null&&$!==s);if(L===null?S=v:L.next=x,!gn(v,r.memoizedState)&&(wt=!0,ee&&(l=za,l!==null)))throw l;r.memoizedState=v,r.baseState=S,r.baseQueue=L,d.lastRenderedState=v}return m===null&&(d.lanes=0),[r.memoizedState,d.dispatch]}function ch(r){var s=yt(),l=s.queue;if(l===null)throw Error(i(311));l.lastRenderedReducer=r;var d=l.dispatch,m=l.pending,v=s.memoizedState;if(m!==null){l.pending=null;var S=m=m.next;do v=r(v,S.action),S=S.next;while(S!==m);gn(v,s.memoizedState)||(wt=!0),s.memoizedState=v,s.baseQueue===null&&(s.baseState=v),l.lastRenderedState=v}return[v,d]}function _v(r,s,l){var d=Re,m=yt(),v=Ue;if(v){if(l===void 0)throw Error(i(407));l=l()}else l=s();var S=!gn((Ge||m).memoizedState,l);if(S&&(m.memoizedState=l,wt=!0),m=m.queue,hh(Rv.bind(null,d,m,r),[r]),m.getSnapshot!==s||S||kt!==null&&kt.memoizedState.tag&1){if(d.flags|=2048,Wa(9,{destroy:void 0},Ev.bind(null,d,m,l,s),null),Xe===null)throw Error(i(349));v||(xi&127)!==0||xv(d,s,l)}return l}function xv(r,s,l){r.flags|=16384,r={getSnapshot:s,value:l},s=Re.updateQueue,s===null?(s=ac(),Re.updateQueue=s,s.stores=[r]):(l=s.stores,l===null?s.stores=[r]:l.push(r))}function Ev(r,s,l,d){s.value=l,s.getSnapshot=d,Ov(s)&&Av(r)}function Rv(r,s,l){return l(function(){Ov(s)&&Av(r)})}function Ov(r){var s=r.getSnapshot;r=r.value;try{var l=s();return!gn(r,l)}catch{return!0}}function Av(r){var s=Kr(r,2);s!==null&&sn(s,r,2)}function uh(r){var s=Gt();if(typeof r=="function"){var l=r;if(r=l(),ia){Zi(!0);try{l()}finally{Zi(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ei,lastRenderedState:r},s}function jv(r,s,l,d){return r.baseState=l,lh(r,Ge,typeof d=="function"?d:Ei)}function a_(r,s,l,d,m){if(uc(r))throw Error(i(485));if(r=s.action,r!==null){var v={payload:m,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){v.listeners.push(S)}};N.T!==null?l(!0):v.isTransition=!1,d(v),l=s.pending,l===null?(v.next=s.pending=v,Pv(s,v)):(v.next=l.next,s.pending=l.next=v)}}function Pv(r,s){var l=s.action,d=s.payload,m=r.state;if(s.isTransition){var v=N.T,S={};N.T=S;try{var x=l(m,d),L=N.S;L!==null&&L(S,x),Dv(r,s,x)}catch($){dh(r,s,$)}finally{v!==null&&S.types!==null&&(v.types=S.types),N.T=v}}else try{v=l(m,d),Dv(r,s,v)}catch($){dh(r,s,$)}}function Dv(r,s,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(d){Mv(r,s,d)},function(d){return dh(r,s,d)}):Mv(r,s,l)}function Mv(r,s,l){s.status="fulfilled",s.value=l,Nv(s),r.state=l,s=r.pending,s!==null&&(l=s.next,l===s?r.pending=null:(l=l.next,s.next=l,Pv(r,l)))}function dh(r,s,l){var d=r.pending;if(r.pending=null,d!==null){d=d.next;do s.status="rejected",s.reason=l,Nv(s),s=s.next;while(s!==d)}r.action=null}function Nv(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function Iv(r,s){return s}function Lv(r,s){if(Ue){var l=Xe.formState;if(l!==null){e:{var d=Re;if(Ue){if(at){t:{for(var m=at,v=Nn;m.nodeType!==8;){if(!v){m=null;break t}if(m=Ln(m.nextSibling),m===null){m=null;break t}}v=m.data,m=v==="F!"||v==="F"?m:null}if(m){at=Ln(m.nextSibling),d=m.data==="F!";break e}}rr(d)}d=!1}d&&(s=l[0])}}return l=Gt(),l.memoizedState=l.baseState=s,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Iv,lastRenderedState:s},l.queue=d,l=n0.bind(null,Re,d),d.dispatch=l,d=uh(!1),v=vh.bind(null,Re,!1,d.queue),d=Gt(),m={state:s,dispatch:null,action:r,pending:null},d.queue=m,l=a_.bind(null,Re,m,v,l),m.dispatch=l,d.memoizedState=r,[s,l,!1]}function Uv(r){var s=yt();return Bv(s,Ge,r)}function Bv(r,s,l){if(s=lh(r,s,Iv)[0],r=oc(Ei)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var d=po(s)}catch(S){throw S===qa?Ql:S}else d=s;s=yt();var m=s.queue,v=m.dispatch;return l!==s.memoizedState&&(Re.flags|=2048,Wa(9,{destroy:void 0},s_.bind(null,m,l),null)),[d,v,r]}function s_(r,s){r.action=s}function zv(r){var s=yt(),l=Ge;if(l!==null)return Bv(s,l,r);yt(),s=s.memoizedState,l=yt();var d=l.queue.dispatch;return l.memoizedState=r,[s,d,!1]}function Wa(r,s,l,d){return r={tag:r,create:l,deps:d,inst:s,next:null},s=Re.updateQueue,s===null&&(s=ac(),Re.updateQueue=s),l=s.lastEffect,l===null?s.lastEffect=r.next=r:(d=l.next,l.next=r,r.next=d,s.lastEffect=r),r}function qv(){return yt().memoizedState}function lc(r,s,l,d){var m=Gt();Re.flags|=r,m.memoizedState=Wa(1|s,{destroy:void 0},l,d===void 0?null:d)}function cc(r,s,l,d){var m=yt();d=d===void 0?null:d;var v=m.memoizedState.inst;Ge!==null&&d!==null&&nh(d,Ge.memoizedState.deps)?m.memoizedState=Wa(s,v,l,d):(Re.flags|=r,m.memoizedState=Wa(1|s,v,l,d))}function Fv(r,s){lc(8390656,8,r,s)}function hh(r,s){cc(2048,8,r,s)}function o_(r){Re.flags|=4;var s=Re.updateQueue;if(s===null)s=ac(),Re.updateQueue=s,s.events=[r];else{var l=s.events;l===null?s.events=[r]:l.push(r)}}function Hv(r){var s=yt().memoizedState;return o_({ref:s,nextImpl:r}),function(){if((He&2)!==0)throw Error(i(440));return s.impl.apply(void 0,arguments)}}function Vv(r,s){return cc(4,2,r,s)}function $v(r,s){return cc(4,4,r,s)}function Wv(r,s){if(typeof s=="function"){r=r();var l=s(r);return function(){typeof l=="function"?l():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function Gv(r,s,l){l=l!=null?l.concat([r]):null,cc(4,4,Wv.bind(null,s,r),l)}function fh(){}function Kv(r,s){var l=yt();s=s===void 0?null:s;var d=l.memoizedState;return s!==null&&nh(s,d[1])?d[0]:(l.memoizedState=[r,s],r)}function Jv(r,s){var l=yt();s=s===void 0?null:s;var d=l.memoizedState;if(s!==null&&nh(s,d[1]))return d[0];if(d=r(),ia){Zi(!0);try{r()}finally{Zi(!1)}}return l.memoizedState=[d,s],d}function ph(r,s,l){return l===void 0||(xi&1073741824)!==0&&(Ie&261930)===0?r.memoizedState=s:(r.memoizedState=l,r=Y0(),Re.lanes|=r,fr|=r,l)}function Yv(r,s,l,d){return gn(l,s)?l:Ha.current!==null?(r=ph(r,l,d),gn(r,s)||(wt=!0),r):(xi&42)===0||(xi&1073741824)!==0&&(Ie&261930)===0?(wt=!0,r.memoizedState=l):(r=Y0(),Re.lanes|=r,fr|=r,s)}function Qv(r,s,l,d,m){var v=K.p;K.p=v!==0&&8>v?v:8;var S=N.T,x={};N.T=x,vh(r,!1,s,l);try{var L=m(),$=N.S;if($!==null&&$(x,L),L!==null&&typeof L=="object"&&typeof L.then=="function"){var ee=n_(L,d);mo(r,s,ee,kn(r))}else mo(r,s,d,kn(r))}catch(re){mo(r,s,{then:function(){},status:"rejected",reason:re},kn())}finally{K.p=v,S!==null&&x.types!==null&&(S.types=x.types),N.T=S}}function l_(){}function mh(r,s,l,d){if(r.tag!==5)throw Error(i(476));var m=Xv(r).queue;Qv(r,m,s,ae,l===null?l_:function(){return Zv(r),l(d)})}function Xv(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:ae,baseState:ae,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ei,lastRenderedState:ae},next:null};var l={};return s.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ei,lastRenderedState:l},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function Zv(r){var s=Xv(r);s.next===null&&(s=r.alternate.memoizedState),mo(r,s.next.queue,{},kn())}function gh(){return Lt(Po)}function e0(){return yt().memoizedState}function t0(){return yt().memoizedState}function c_(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var l=kn();r=or(l);var d=lr(s,r,l);d!==null&&(sn(d,s,l),co(d,s,l)),s={cache:$d()},r.payload=s;return}s=s.return}}function u_(r,s,l){var d=kn();l={lane:d,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},uc(r)?i0(s,l):(l=Md(r,s,l,d),l!==null&&(sn(l,r,d),r0(l,s,d)))}function n0(r,s,l){var d=kn();mo(r,s,l,d)}function mo(r,s,l,d){var m={lane:d,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(uc(r))i0(s,m);else{var v=r.alternate;if(r.lanes===0&&(v===null||v.lanes===0)&&(v=s.lastRenderedReducer,v!==null))try{var S=s.lastRenderedState,x=v(S,l);if(m.hasEagerState=!0,m.eagerState=x,gn(x,S))return Vl(r,s,m,0),Xe===null&&Hl(),!1}catch{}if(l=Md(r,s,m,d),l!==null)return sn(l,r,d),r0(l,s,d),!0}return!1}function vh(r,s,l,d){if(d={lane:2,revertLane:Jh(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},uc(r)){if(s)throw Error(i(479))}else s=Md(r,l,d,2),s!==null&&sn(s,r,2)}function uc(r){var s=r.alternate;return r===Re||s!==null&&s===Re}function i0(r,s){Va=ic=!0;var l=r.pending;l===null?s.next=s:(s.next=l.next,l.next=s),r.pending=s}function r0(r,s,l){if((l&4194048)!==0){var d=s.lanes;d&=r.pendingLanes,l|=d,s.lanes=l,cg(r,l)}}var go={readContext:Lt,use:sc,useCallback:dt,useContext:dt,useEffect:dt,useImperativeHandle:dt,useLayoutEffect:dt,useInsertionEffect:dt,useMemo:dt,useReducer:dt,useRef:dt,useState:dt,useDebugValue:dt,useDeferredValue:dt,useTransition:dt,useSyncExternalStore:dt,useId:dt,useHostTransitionStatus:dt,useFormState:dt,useActionState:dt,useOptimistic:dt,useMemoCache:dt,useCacheRefresh:dt};go.useEffectEvent=dt;var a0={readContext:Lt,use:sc,useCallback:function(r,s){return Gt().memoizedState=[r,s===void 0?null:s],r},useContext:Lt,useEffect:Fv,useImperativeHandle:function(r,s,l){l=l!=null?l.concat([r]):null,lc(4194308,4,Wv.bind(null,s,r),l)},useLayoutEffect:function(r,s){return lc(4194308,4,r,s)},useInsertionEffect:function(r,s){lc(4,2,r,s)},useMemo:function(r,s){var l=Gt();s=s===void 0?null:s;var d=r();if(ia){Zi(!0);try{r()}finally{Zi(!1)}}return l.memoizedState=[d,s],d},useReducer:function(r,s,l){var d=Gt();if(l!==void 0){var m=l(s);if(ia){Zi(!0);try{l(s)}finally{Zi(!1)}}}else m=s;return d.memoizedState=d.baseState=m,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:m},d.queue=r,r=r.dispatch=u_.bind(null,Re,r),[d.memoizedState,r]},useRef:function(r){var s=Gt();return r={current:r},s.memoizedState=r},useState:function(r){r=uh(r);var s=r.queue,l=n0.bind(null,Re,s);return s.dispatch=l,[r.memoizedState,l]},useDebugValue:fh,useDeferredValue:function(r,s){var l=Gt();return ph(l,r,s)},useTransition:function(){var r=uh(!1);return r=Qv.bind(null,Re,r.queue,!0,!1),Gt().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,l){var d=Re,m=Gt();if(Ue){if(l===void 0)throw Error(i(407));l=l()}else{if(l=s(),Xe===null)throw Error(i(349));(Ie&127)!==0||xv(d,s,l)}m.memoizedState=l;var v={value:l,getSnapshot:s};return m.queue=v,Fv(Rv.bind(null,d,v,r),[r]),d.flags|=2048,Wa(9,{destroy:void 0},Ev.bind(null,d,v,l,s),null),l},useId:function(){var r=Gt(),s=Xe.identifierPrefix;if(Ue){var l=li,d=oi;l=(d&~(1<<32-mn(d)-1)).toString(32)+l,s="_"+s+"R_"+l,l=rc++,0<l&&(s+="H"+l.toString(32)),s+="_"}else l=i_++,s="_"+s+"r_"+l.toString(32)+"_";return r.memoizedState=s},useHostTransitionStatus:gh,useFormState:Lv,useActionState:Lv,useOptimistic:function(r){var s=Gt();s.memoizedState=s.baseState=r;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=l,s=vh.bind(null,Re,!0,l),l.dispatch=s,[r,s]},useMemoCache:oh,useCacheRefresh:function(){return Gt().memoizedState=c_.bind(null,Re)},useEffectEvent:function(r){var s=Gt(),l={impl:r};return s.memoizedState=l,function(){if((He&2)!==0)throw Error(i(440));return l.impl.apply(void 0,arguments)}}},yh={readContext:Lt,use:sc,useCallback:Kv,useContext:Lt,useEffect:hh,useImperativeHandle:Gv,useInsertionEffect:Vv,useLayoutEffect:$v,useMemo:Jv,useReducer:oc,useRef:qv,useState:function(){return oc(Ei)},useDebugValue:fh,useDeferredValue:function(r,s){var l=yt();return Yv(l,Ge.memoizedState,r,s)},useTransition:function(){var r=oc(Ei)[0],s=yt().memoizedState;return[typeof r=="boolean"?r:po(r),s]},useSyncExternalStore:_v,useId:e0,useHostTransitionStatus:gh,useFormState:Uv,useActionState:Uv,useOptimistic:function(r,s){var l=yt();return jv(l,Ge,r,s)},useMemoCache:oh,useCacheRefresh:t0};yh.useEffectEvent=Hv;var s0={readContext:Lt,use:sc,useCallback:Kv,useContext:Lt,useEffect:hh,useImperativeHandle:Gv,useInsertionEffect:Vv,useLayoutEffect:$v,useMemo:Jv,useReducer:ch,useRef:qv,useState:function(){return ch(Ei)},useDebugValue:fh,useDeferredValue:function(r,s){var l=yt();return Ge===null?ph(l,r,s):Yv(l,Ge.memoizedState,r,s)},useTransition:function(){var r=ch(Ei)[0],s=yt().memoizedState;return[typeof r=="boolean"?r:po(r),s]},useSyncExternalStore:_v,useId:e0,useHostTransitionStatus:gh,useFormState:zv,useActionState:zv,useOptimistic:function(r,s){var l=yt();return Ge!==null?jv(l,Ge,r,s):(l.baseState=r,[r,l.queue.dispatch])},useMemoCache:oh,useCacheRefresh:t0};s0.useEffectEvent=Hv;function bh(r,s,l,d){s=r.memoizedState,l=l(d,s),l=l==null?s:y({},s,l),r.memoizedState=l,r.lanes===0&&(r.updateQueue.baseState=l)}var Sh={enqueueSetState:function(r,s,l){r=r._reactInternals;var d=kn(),m=or(d);m.payload=s,l!=null&&(m.callback=l),s=lr(r,m,d),s!==null&&(sn(s,r,d),co(s,r,d))},enqueueReplaceState:function(r,s,l){r=r._reactInternals;var d=kn(),m=or(d);m.tag=1,m.payload=s,l!=null&&(m.callback=l),s=lr(r,m,d),s!==null&&(sn(s,r,d),co(s,r,d))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var l=kn(),d=or(l);d.tag=2,s!=null&&(d.callback=s),s=lr(r,d,l),s!==null&&(sn(s,r,l),co(s,r,l))}};function o0(r,s,l,d,m,v,S){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(d,v,S):s.prototype&&s.prototype.isPureReactComponent?!to(l,d)||!to(m,v):!0}function l0(r,s,l,d){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(l,d),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(l,d),s.state!==r&&Sh.enqueueReplaceState(s,s.state,null)}function ra(r,s){var l=s;if("ref"in s){l={};for(var d in s)d!=="ref"&&(l[d]=s[d])}if(r=r.defaultProps){l===s&&(l=y({},l));for(var m in r)l[m]===void 0&&(l[m]=r[m])}return l}function c0(r){Fl(r)}function u0(r){console.error(r)}function d0(r){Fl(r)}function dc(r,s){try{var l=r.onUncaughtError;l(s.value,{componentStack:s.stack})}catch(d){setTimeout(function(){throw d})}}function h0(r,s,l){try{var d=r.onCaughtError;d(l.value,{componentStack:l.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function Th(r,s,l){return l=or(l),l.tag=3,l.payload={element:null},l.callback=function(){dc(r,s)},l}function f0(r){return r=or(r),r.tag=3,r}function p0(r,s,l,d){var m=l.type.getDerivedStateFromError;if(typeof m=="function"){var v=d.value;r.payload=function(){return m(v)},r.callback=function(){h0(s,l,d)}}var S=l.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(r.callback=function(){h0(s,l,d),typeof m!="function"&&(pr===null?pr=new Set([this]):pr.add(this));var x=d.stack;this.componentDidCatch(d.value,{componentStack:x!==null?x:""})})}function d_(r,s,l,d,m){if(l.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(s=l.alternate,s!==null&&Ua(s,l,m,!0),l=yn.current,l!==null){switch(l.tag){case 31:case 13:return In===null?wc():l.alternate===null&&ht===0&&(ht=3),l.flags&=-257,l.flags|=65536,l.lanes=m,d===Xl?l.flags|=16384:(s=l.updateQueue,s===null?l.updateQueue=new Set([d]):s.add(d),Wh(r,d,m)),!1;case 22:return l.flags|=65536,d===Xl?l.flags|=16384:(s=l.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([d])},l.updateQueue=s):(l=s.retryQueue,l===null?s.retryQueue=new Set([d]):l.add(d)),Wh(r,d,m)),!1}throw Error(i(435,l.tag))}return Wh(r,d,m),wc(),!1}if(Ue)return s=yn.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=m,d!==zd&&(r=Error(i(422),{cause:d}),ro(Pn(r,l)))):(d!==zd&&(s=Error(i(423),{cause:d}),ro(Pn(s,l))),r=r.current.alternate,r.flags|=65536,m&=-m,r.lanes|=m,d=Pn(d,l),m=Th(r.stateNode,d,m),Qd(r,m),ht!==4&&(ht=2)),!1;var v=Error(i(520),{cause:d});if(v=Pn(v,l),Co===null?Co=[v]:Co.push(v),ht!==4&&(ht=2),s===null)return!0;d=Pn(d,l),l=s;do{switch(l.tag){case 3:return l.flags|=65536,r=m&-m,l.lanes|=r,r=Th(l.stateNode,d,r),Qd(l,r),!1;case 1:if(s=l.type,v=l.stateNode,(l.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(pr===null||!pr.has(v))))return l.flags|=65536,m&=-m,l.lanes|=m,m=f0(m),p0(m,r,l,d),Qd(l,m),!1}l=l.return}while(l!==null);return!1}var kh=Error(i(461)),wt=!1;function Ut(r,s,l,d){s.child=r===null?yv(s,null,l,d):na(s,r.child,l,d)}function m0(r,s,l,d,m){l=l.render;var v=s.ref;if("ref"in d){var S={};for(var x in d)x!=="ref"&&(S[x]=d[x])}else S=d;return Xr(s),d=ih(r,s,l,S,v,m),x=rh(),r!==null&&!wt?(ah(r,s,m),Ri(r,s,m)):(Ue&&x&&Ud(s),s.flags|=1,Ut(r,s,d,m),s.child)}function g0(r,s,l,d,m){if(r===null){var v=l.type;return typeof v=="function"&&!Nd(v)&&v.defaultProps===void 0&&l.compare===null?(s.tag=15,s.type=v,v0(r,s,v,d,m)):(r=Wl(l.type,null,d,s,s.mode,m),r.ref=s.ref,r.return=s,s.child=r)}if(v=r.child,!Ah(r,m)){var S=v.memoizedProps;if(l=l.compare,l=l!==null?l:to,l(S,d)&&r.ref===s.ref)return Ri(r,s,m)}return s.flags|=1,r=ki(v,d),r.ref=s.ref,r.return=s,s.child=r}function v0(r,s,l,d,m){if(r!==null){var v=r.memoizedProps;if(to(v,d)&&r.ref===s.ref)if(wt=!1,s.pendingProps=d=v,Ah(r,m))(r.flags&131072)!==0&&(wt=!0);else return s.lanes=r.lanes,Ri(r,s,m)}return wh(r,s,l,d,m)}function y0(r,s,l,d){var m=d.children,v=r!==null?r.memoizedState:null;if(r===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((s.flags&128)!==0){if(v=v!==null?v.baseLanes|l:l,r!==null){for(d=s.child=r.child,m=0;d!==null;)m=m|d.lanes|d.childLanes,d=d.sibling;d=m&~v}else d=0,s.child=null;return b0(r,s,v,l,d)}if((l&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&Yl(s,v!==null?v.cachePool:null),v!==null?Tv(s,v):Zd(),kv(s);else return d=s.lanes=536870912,b0(r,s,v!==null?v.baseLanes|l:l,l,d)}else v!==null?(Yl(s,v.cachePool),Tv(s,v),ur(),s.memoizedState=null):(r!==null&&Yl(s,null),Zd(),ur());return Ut(r,s,m,l),s.child}function vo(r,s){return r!==null&&r.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function b0(r,s,l,d,m){var v=Gd();return v=v===null?null:{parent:Tt._currentValue,pool:v},s.memoizedState={baseLanes:l,cachePool:v},r!==null&&Yl(s,null),Zd(),kv(s),r!==null&&Ua(r,s,d,!0),s.childLanes=m,null}function hc(r,s){return s=pc({mode:s.mode,children:s.children},r.mode),s.ref=r.ref,r.child=s,s.return=r,s}function S0(r,s,l){return na(s,r.child,null,l),r=hc(s,s.pendingProps),r.flags|=2,bn(s),s.memoizedState=null,r}function h_(r,s,l){var d=s.pendingProps,m=(s.flags&128)!==0;if(s.flags&=-129,r===null){if(Ue){if(d.mode==="hidden")return r=hc(s,d),s.lanes=536870912,vo(null,r);if(th(s),(r=at)?(r=Py(r,Nn),r=r!==null&&r.data==="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:nr!==null?{id:oi,overflow:li}:null,retryLane:536870912,hydrationErrors:null},l=iv(r),l.return=s,s.child=l,It=s,at=null)):r=null,r===null)throw rr(s);return s.lanes=536870912,null}return hc(s,d)}var v=r.memoizedState;if(v!==null){var S=v.dehydrated;if(th(s),m)if(s.flags&256)s.flags&=-257,s=S0(r,s,l);else if(s.memoizedState!==null)s.child=r.child,s.flags|=128,s=null;else throw Error(i(558));else if(wt||Ua(r,s,l,!1),m=(l&r.childLanes)!==0,wt||m){if(d=Xe,d!==null&&(S=ug(d,l),S!==0&&S!==v.retryLane))throw v.retryLane=S,Kr(r,S),sn(d,r,S),kh;wc(),s=S0(r,s,l)}else r=v.treeContext,at=Ln(S.nextSibling),It=s,Ue=!0,ir=null,Nn=!1,r!==null&&sv(s,r),s=hc(s,d),s.flags|=4096;return s}return r=ki(r.child,{mode:d.mode,children:d.children}),r.ref=s.ref,s.child=r,r.return=s,r}function fc(r,s){var l=s.ref;if(l===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(i(284));(r===null||r.ref!==l)&&(s.flags|=4194816)}}function wh(r,s,l,d,m){return Xr(s),l=ih(r,s,l,d,void 0,m),d=rh(),r!==null&&!wt?(ah(r,s,m),Ri(r,s,m)):(Ue&&d&&Ud(s),s.flags|=1,Ut(r,s,l,m),s.child)}function T0(r,s,l,d,m,v){return Xr(s),s.updateQueue=null,l=Cv(s,d,l,m),wv(r),d=rh(),r!==null&&!wt?(ah(r,s,v),Ri(r,s,v)):(Ue&&d&&Ud(s),s.flags|=1,Ut(r,s,l,v),s.child)}function k0(r,s,l,d,m){if(Xr(s),s.stateNode===null){var v=Ma,S=l.contextType;typeof S=="object"&&S!==null&&(v=Lt(S)),v=new l(d,v),s.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=Sh,s.stateNode=v,v._reactInternals=s,v=s.stateNode,v.props=d,v.state=s.memoizedState,v.refs={},Jd(s),S=l.contextType,v.context=typeof S=="object"&&S!==null?Lt(S):Ma,v.state=s.memoizedState,S=l.getDerivedStateFromProps,typeof S=="function"&&(bh(s,l,S,d),v.state=s.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(S=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),S!==v.state&&Sh.enqueueReplaceState(v,v.state,null),ho(s,d,v,m),uo(),v.state=s.memoizedState),typeof v.componentDidMount=="function"&&(s.flags|=4194308),d=!0}else if(r===null){v=s.stateNode;var x=s.memoizedProps,L=ra(l,x);v.props=L;var $=v.context,ee=l.contextType;S=Ma,typeof ee=="object"&&ee!==null&&(S=Lt(ee));var re=l.getDerivedStateFromProps;ee=typeof re=="function"||typeof v.getSnapshotBeforeUpdate=="function",x=s.pendingProps!==x,ee||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(x||$!==S)&&l0(s,v,d,S),sr=!1;var G=s.memoizedState;v.state=G,ho(s,d,v,m),uo(),$=s.memoizedState,x||G!==$||sr?(typeof re=="function"&&(bh(s,l,re,d),$=s.memoizedState),(L=sr||o0(s,l,L,d,G,$,S))?(ee||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(s.flags|=4194308)):(typeof v.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=d,s.memoizedState=$),v.props=d,v.state=$,v.context=S,d=L):(typeof v.componentDidMount=="function"&&(s.flags|=4194308),d=!1)}else{v=s.stateNode,Yd(r,s),S=s.memoizedProps,ee=ra(l,S),v.props=ee,re=s.pendingProps,G=v.context,$=l.contextType,L=Ma,typeof $=="object"&&$!==null&&(L=Lt($)),x=l.getDerivedStateFromProps,($=typeof x=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(S!==re||G!==L)&&l0(s,v,d,L),sr=!1,G=s.memoizedState,v.state=G,ho(s,d,v,m),uo();var Y=s.memoizedState;S!==re||G!==Y||sr||r!==null&&r.dependencies!==null&&Kl(r.dependencies)?(typeof x=="function"&&(bh(s,l,x,d),Y=s.memoizedState),(ee=sr||o0(s,l,ee,d,G,Y,L)||r!==null&&r.dependencies!==null&&Kl(r.dependencies))?($||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(d,Y,L),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(d,Y,L)),typeof v.componentDidUpdate=="function"&&(s.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof v.componentDidUpdate!="function"||S===r.memoizedProps&&G===r.memoizedState||(s.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||S===r.memoizedProps&&G===r.memoizedState||(s.flags|=1024),s.memoizedProps=d,s.memoizedState=Y),v.props=d,v.state=Y,v.context=L,d=ee):(typeof v.componentDidUpdate!="function"||S===r.memoizedProps&&G===r.memoizedState||(s.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||S===r.memoizedProps&&G===r.memoizedState||(s.flags|=1024),d=!1)}return v=d,fc(r,s),d=(s.flags&128)!==0,v||d?(v=s.stateNode,l=d&&typeof l.getDerivedStateFromError!="function"?null:v.render(),s.flags|=1,r!==null&&d?(s.child=na(s,r.child,null,m),s.child=na(s,null,l,m)):Ut(r,s,l,m),s.memoizedState=v.state,r=s.child):r=Ri(r,s,m),r}function w0(r,s,l,d){return Yr(),s.flags|=256,Ut(r,s,l,d),s.child}var Ch={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function _h(r){return{baseLanes:r,cachePool:hv()}}function xh(r,s,l){return r=r!==null?r.childLanes&~l:0,s&&(r|=Tn),r}function C0(r,s,l){var d=s.pendingProps,m=!1,v=(s.flags&128)!==0,S;if((S=v)||(S=r!==null&&r.memoizedState===null?!1:(vt.current&2)!==0),S&&(m=!0,s.flags&=-129),S=(s.flags&32)!==0,s.flags&=-33,r===null){if(Ue){if(m?cr(s):ur(),(r=at)?(r=Py(r,Nn),r=r!==null&&r.data!=="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:nr!==null?{id:oi,overflow:li}:null,retryLane:536870912,hydrationErrors:null},l=iv(r),l.return=s,s.child=l,It=s,at=null)):r=null,r===null)throw rr(s);return cf(r)?s.lanes=32:s.lanes=536870912,null}var x=d.children;return d=d.fallback,m?(ur(),m=s.mode,x=pc({mode:"hidden",children:x},m),d=Jr(d,m,l,null),x.return=s,d.return=s,x.sibling=d,s.child=x,d=s.child,d.memoizedState=_h(l),d.childLanes=xh(r,S,l),s.memoizedState=Ch,vo(null,d)):(cr(s),Eh(s,x))}var L=r.memoizedState;if(L!==null&&(x=L.dehydrated,x!==null)){if(v)s.flags&256?(cr(s),s.flags&=-257,s=Rh(r,s,l)):s.memoizedState!==null?(ur(),s.child=r.child,s.flags|=128,s=null):(ur(),x=d.fallback,m=s.mode,d=pc({mode:"visible",children:d.children},m),x=Jr(x,m,l,null),x.flags|=2,d.return=s,x.return=s,d.sibling=x,s.child=d,na(s,r.child,null,l),d=s.child,d.memoizedState=_h(l),d.childLanes=xh(r,S,l),s.memoizedState=Ch,s=vo(null,d));else if(cr(s),cf(x)){if(S=x.nextSibling&&x.nextSibling.dataset,S)var $=S.dgst;S=$,d=Error(i(419)),d.stack="",d.digest=S,ro({value:d,source:null,stack:null}),s=Rh(r,s,l)}else if(wt||Ua(r,s,l,!1),S=(l&r.childLanes)!==0,wt||S){if(S=Xe,S!==null&&(d=ug(S,l),d!==0&&d!==L.retryLane))throw L.retryLane=d,Kr(r,d),sn(S,r,d),kh;lf(x)||wc(),s=Rh(r,s,l)}else lf(x)?(s.flags|=192,s.child=r.child,s=null):(r=L.treeContext,at=Ln(x.nextSibling),It=s,Ue=!0,ir=null,Nn=!1,r!==null&&sv(s,r),s=Eh(s,d.children),s.flags|=4096);return s}return m?(ur(),x=d.fallback,m=s.mode,L=r.child,$=L.sibling,d=ki(L,{mode:"hidden",children:d.children}),d.subtreeFlags=L.subtreeFlags&65011712,$!==null?x=ki($,x):(x=Jr(x,m,l,null),x.flags|=2),x.return=s,d.return=s,d.sibling=x,s.child=d,vo(null,d),d=s.child,x=r.child.memoizedState,x===null?x=_h(l):(m=x.cachePool,m!==null?(L=Tt._currentValue,m=m.parent!==L?{parent:L,pool:L}:m):m=hv(),x={baseLanes:x.baseLanes|l,cachePool:m}),d.memoizedState=x,d.childLanes=xh(r,S,l),s.memoizedState=Ch,vo(r.child,d)):(cr(s),l=r.child,r=l.sibling,l=ki(l,{mode:"visible",children:d.children}),l.return=s,l.sibling=null,r!==null&&(S=s.deletions,S===null?(s.deletions=[r],s.flags|=16):S.push(r)),s.child=l,s.memoizedState=null,l)}function Eh(r,s){return s=pc({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function pc(r,s){return r=vn(22,r,null,s),r.lanes=0,r}function Rh(r,s,l){return na(s,r.child,null,l),r=Eh(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function _0(r,s,l){r.lanes|=s;var d=r.alternate;d!==null&&(d.lanes|=s),Hd(r.return,s,l)}function Oh(r,s,l,d,m,v){var S=r.memoizedState;S===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:d,tail:l,tailMode:m,treeForkCount:v}:(S.isBackwards=s,S.rendering=null,S.renderingStartTime=0,S.last=d,S.tail=l,S.tailMode=m,S.treeForkCount=v)}function x0(r,s,l){var d=s.pendingProps,m=d.revealOrder,v=d.tail;d=d.children;var S=vt.current,x=(S&2)!==0;if(x?(S=S&1|2,s.flags|=128):S&=1,oe(vt,S),Ut(r,s,d,l),d=Ue?io:0,!x&&r!==null&&(r.flags&128)!==0)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&_0(r,l,s);else if(r.tag===19)_0(r,l,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(m){case"forwards":for(l=s.child,m=null;l!==null;)r=l.alternate,r!==null&&nc(r)===null&&(m=l),l=l.sibling;l=m,l===null?(m=s.child,s.child=null):(m=l.sibling,l.sibling=null),Oh(s,!1,m,l,v,d);break;case"backwards":case"unstable_legacy-backwards":for(l=null,m=s.child,s.child=null;m!==null;){if(r=m.alternate,r!==null&&nc(r)===null){s.child=m;break}r=m.sibling,m.sibling=l,l=m,m=r}Oh(s,!0,l,null,v,d);break;case"together":Oh(s,!1,null,null,void 0,d);break;default:s.memoizedState=null}return s.child}function Ri(r,s,l){if(r!==null&&(s.dependencies=r.dependencies),fr|=s.lanes,(l&s.childLanes)===0)if(r!==null){if(Ua(r,s,l,!1),(l&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(i(153));if(s.child!==null){for(r=s.child,l=ki(r,r.pendingProps),s.child=l,l.return=s;r.sibling!==null;)r=r.sibling,l=l.sibling=ki(r,r.pendingProps),l.return=s;l.sibling=null}return s.child}function Ah(r,s){return(r.lanes&s)!==0?!0:(r=r.dependencies,!!(r!==null&&Kl(r)))}function f_(r,s,l){switch(s.tag){case 3:nt(s,s.stateNode.containerInfo),ar(s,Tt,r.memoizedState.cache),Yr();break;case 27:case 5:hn(s);break;case 4:nt(s,s.stateNode.containerInfo);break;case 10:ar(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,th(s),null;break;case 13:var d=s.memoizedState;if(d!==null)return d.dehydrated!==null?(cr(s),s.flags|=128,null):(l&s.child.childLanes)!==0?C0(r,s,l):(cr(s),r=Ri(r,s,l),r!==null?r.sibling:null);cr(s);break;case 19:var m=(r.flags&128)!==0;if(d=(l&s.childLanes)!==0,d||(Ua(r,s,l,!1),d=(l&s.childLanes)!==0),m){if(d)return x0(r,s,l);s.flags|=128}if(m=s.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),oe(vt,vt.current),d)break;return null;case 22:return s.lanes=0,y0(r,s,l,s.pendingProps);case 24:ar(s,Tt,r.memoizedState.cache)}return Ri(r,s,l)}function E0(r,s,l){if(r!==null)if(r.memoizedProps!==s.pendingProps)wt=!0;else{if(!Ah(r,l)&&(s.flags&128)===0)return wt=!1,f_(r,s,l);wt=(r.flags&131072)!==0}else wt=!1,Ue&&(s.flags&1048576)!==0&&av(s,io,s.index);switch(s.lanes=0,s.tag){case 16:e:{var d=s.pendingProps;if(r=ea(s.elementType),s.type=r,typeof r=="function")Nd(r)?(d=ra(r,d),s.tag=1,s=k0(null,s,r,d,l)):(s.tag=0,s=wh(null,s,r,d,l));else{if(r!=null){var m=r.$$typeof;if(m===E){s.tag=11,s=m0(null,s,r,d,l);break e}else if(m===I){s.tag=14,s=g0(null,s,r,d,l);break e}}throw s=Z(r)||r,Error(i(306,s,""))}}return s;case 0:return wh(r,s,s.type,s.pendingProps,l);case 1:return d=s.type,m=ra(d,s.pendingProps),k0(r,s,d,m,l);case 3:e:{if(nt(s,s.stateNode.containerInfo),r===null)throw Error(i(387));d=s.pendingProps;var v=s.memoizedState;m=v.element,Yd(r,s),ho(s,d,null,l);var S=s.memoizedState;if(d=S.cache,ar(s,Tt,d),d!==v.cache&&Vd(s,[Tt],l,!0),uo(),d=S.element,v.isDehydrated)if(v={element:d,isDehydrated:!1,cache:S.cache},s.updateQueue.baseState=v,s.memoizedState=v,s.flags&256){s=w0(r,s,d,l);break e}else if(d!==m){m=Pn(Error(i(424)),s),ro(m),s=w0(r,s,d,l);break e}else for(r=s.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,at=Ln(r.firstChild),It=s,Ue=!0,ir=null,Nn=!0,l=yv(s,null,d,l),s.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Yr(),d===m){s=Ri(r,s,l);break e}Ut(r,s,d,l)}s=s.child}return s;case 26:return fc(r,s),r===null?(l=Uy(s.type,null,s.pendingProps,null))?s.memoizedState=l:Ue||(l=s.type,r=s.pendingProps,d=Ac(_e.current).createElement(l),d[Nt]=s,d[Zt]=r,Bt(d,l,r),jt(d),s.stateNode=d):s.memoizedState=Uy(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return hn(s),r===null&&Ue&&(d=s.stateNode=Ny(s.type,s.pendingProps,_e.current),It=s,Nn=!0,m=at,yr(s.type)?(uf=m,at=Ln(d.firstChild)):at=m),Ut(r,s,s.pendingProps.children,l),fc(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&Ue&&((m=d=at)&&(d=H_(d,s.type,s.pendingProps,Nn),d!==null?(s.stateNode=d,It=s,at=Ln(d.firstChild),Nn=!1,m=!0):m=!1),m||rr(s)),hn(s),m=s.type,v=s.pendingProps,S=r!==null?r.memoizedProps:null,d=v.children,af(m,v)?d=null:S!==null&&af(m,S)&&(s.flags|=32),s.memoizedState!==null&&(m=ih(r,s,r_,null,null,l),Po._currentValue=m),fc(r,s),Ut(r,s,d,l),s.child;case 6:return r===null&&Ue&&((r=l=at)&&(l=V_(l,s.pendingProps,Nn),l!==null?(s.stateNode=l,It=s,at=null,r=!0):r=!1),r||rr(s)),null;case 13:return C0(r,s,l);case 4:return nt(s,s.stateNode.containerInfo),d=s.pendingProps,r===null?s.child=na(s,null,d,l):Ut(r,s,d,l),s.child;case 11:return m0(r,s,s.type,s.pendingProps,l);case 7:return Ut(r,s,s.pendingProps,l),s.child;case 8:return Ut(r,s,s.pendingProps.children,l),s.child;case 12:return Ut(r,s,s.pendingProps.children,l),s.child;case 10:return d=s.pendingProps,ar(s,s.type,d.value),Ut(r,s,d.children,l),s.child;case 9:return m=s.type._context,d=s.pendingProps.children,Xr(s),m=Lt(m),d=d(m),s.flags|=1,Ut(r,s,d,l),s.child;case 14:return g0(r,s,s.type,s.pendingProps,l);case 15:return v0(r,s,s.type,s.pendingProps,l);case 19:return x0(r,s,l);case 31:return h_(r,s,l);case 22:return y0(r,s,l,s.pendingProps);case 24:return Xr(s),d=Lt(Tt),r===null?(m=Gd(),m===null&&(m=Xe,v=$d(),m.pooledCache=v,v.refCount++,v!==null&&(m.pooledCacheLanes|=l),m=v),s.memoizedState={parent:d,cache:m},Jd(s),ar(s,Tt,m)):((r.lanes&l)!==0&&(Yd(r,s),ho(s,null,null,l),uo()),m=r.memoizedState,v=s.memoizedState,m.parent!==d?(m={parent:d,cache:d},s.memoizedState=m,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=m),ar(s,Tt,d)):(d=v.cache,ar(s,Tt,d),d!==m.cache&&Vd(s,[Tt],l,!0))),Ut(r,s,s.pendingProps.children,l),s.child;case 29:throw s.pendingProps}throw Error(i(156,s.tag))}function Oi(r){r.flags|=4}function jh(r,s,l,d,m){if((s=(r.mode&32)!==0)&&(s=!1),s){if(r.flags|=16777216,(m&335544128)===m)if(r.stateNode.complete)r.flags|=8192;else if(ey())r.flags|=8192;else throw ta=Xl,Kd}else r.flags&=-16777217}function R0(r,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!Hy(s))if(ey())r.flags|=8192;else throw ta=Xl,Kd}function mc(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?og():536870912,r.lanes|=s,Ya|=s)}function yo(r,s){if(!Ue)switch(r.tailMode){case"hidden":s=r.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?r.tail=null:l.sibling=null;break;case"collapsed":l=r.tail;for(var d=null;l!==null;)l.alternate!==null&&(d=l),l=l.sibling;d===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:d.sibling=null}}function st(r){var s=r.alternate!==null&&r.alternate.child===r.child,l=0,d=0;if(s)for(var m=r.child;m!==null;)l|=m.lanes|m.childLanes,d|=m.subtreeFlags&65011712,d|=m.flags&65011712,m.return=r,m=m.sibling;else for(m=r.child;m!==null;)l|=m.lanes|m.childLanes,d|=m.subtreeFlags,d|=m.flags,m.return=r,m=m.sibling;return r.subtreeFlags|=d,r.childLanes=l,s}function p_(r,s,l){var d=s.pendingProps;switch(Bd(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return st(s),null;case 1:return st(s),null;case 3:return l=s.stateNode,d=null,r!==null&&(d=r.memoizedState.cache),s.memoizedState.cache!==d&&(s.flags|=2048),_i(Tt),Fe(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(r===null||r.child===null)&&(La(s)?Oi(s):r===null||r.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,qd())),st(s),null;case 26:var m=s.type,v=s.memoizedState;return r===null?(Oi(s),v!==null?(st(s),R0(s,v)):(st(s),jh(s,m,null,d,l))):v?v!==r.memoizedState?(Oi(s),st(s),R0(s,v)):(st(s),s.flags&=-16777217):(r=r.memoizedProps,r!==d&&Oi(s),st(s),jh(s,m,r,d,l)),null;case 27:if(xl(s),l=_e.current,m=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==d&&Oi(s);else{if(!d){if(s.stateNode===null)throw Error(i(166));return st(s),null}r=de.current,La(s)?ov(s):(r=Ny(m,d,l),s.stateNode=r,Oi(s))}return st(s),null;case 5:if(xl(s),m=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==d&&Oi(s);else{if(!d){if(s.stateNode===null)throw Error(i(166));return st(s),null}if(v=de.current,La(s))ov(s);else{var S=Ac(_e.current);switch(v){case 1:v=S.createElementNS("http://www.w3.org/2000/svg",m);break;case 2:v=S.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;default:switch(m){case"svg":v=S.createElementNS("http://www.w3.org/2000/svg",m);break;case"math":v=S.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;case"script":v=S.createElement("div"),v.innerHTML="<script><\/script>",v=v.removeChild(v.firstChild);break;case"select":v=typeof d.is=="string"?S.createElement("select",{is:d.is}):S.createElement("select"),d.multiple?v.multiple=!0:d.size&&(v.size=d.size);break;default:v=typeof d.is=="string"?S.createElement(m,{is:d.is}):S.createElement(m)}}v[Nt]=s,v[Zt]=d;e:for(S=s.child;S!==null;){if(S.tag===5||S.tag===6)v.appendChild(S.stateNode);else if(S.tag!==4&&S.tag!==27&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===s)break e;for(;S.sibling===null;){if(S.return===null||S.return===s)break e;S=S.return}S.sibling.return=S.return,S=S.sibling}s.stateNode=v;e:switch(Bt(v,m,d),m){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&Oi(s)}}return st(s),jh(s,s.type,r===null?null:r.memoizedProps,s.pendingProps,l),null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==d&&Oi(s);else{if(typeof d!="string"&&s.stateNode===null)throw Error(i(166));if(r=_e.current,La(s)){if(r=s.stateNode,l=s.memoizedProps,d=null,m=It,m!==null)switch(m.tag){case 27:case 5:d=m.memoizedProps}r[Nt]=s,r=!!(r.nodeValue===l||d!==null&&d.suppressHydrationWarning===!0||Cy(r.nodeValue,l)),r||rr(s,!0)}else r=Ac(r).createTextNode(d),r[Nt]=s,s.stateNode=r}return st(s),null;case 31:if(l=s.memoizedState,r===null||r.memoizedState!==null){if(d=La(s),l!==null){if(r===null){if(!d)throw Error(i(318));if(r=s.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(557));r[Nt]=s}else Yr(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;st(s),r=!1}else l=qd(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=l),r=!0;if(!r)return s.flags&256?(bn(s),s):(bn(s),null);if((s.flags&128)!==0)throw Error(i(558))}return st(s),null;case 13:if(d=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(m=La(s),d!==null&&d.dehydrated!==null){if(r===null){if(!m)throw Error(i(318));if(m=s.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(i(317));m[Nt]=s}else Yr(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;st(s),m=!1}else m=qd(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=m),m=!0;if(!m)return s.flags&256?(bn(s),s):(bn(s),null)}return bn(s),(s.flags&128)!==0?(s.lanes=l,s):(l=d!==null,r=r!==null&&r.memoizedState!==null,l&&(d=s.child,m=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(m=d.alternate.memoizedState.cachePool.pool),v=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(v=d.memoizedState.cachePool.pool),v!==m&&(d.flags|=2048)),l!==r&&l&&(s.child.flags|=8192),mc(s,s.updateQueue),st(s),null);case 4:return Fe(),r===null&&Zh(s.stateNode.containerInfo),st(s),null;case 10:return _i(s.type),st(s),null;case 19:if(J(vt),d=s.memoizedState,d===null)return st(s),null;if(m=(s.flags&128)!==0,v=d.rendering,v===null)if(m)yo(d,!1);else{if(ht!==0||r!==null&&(r.flags&128)!==0)for(r=s.child;r!==null;){if(v=nc(r),v!==null){for(s.flags|=128,yo(d,!1),r=v.updateQueue,s.updateQueue=r,mc(s,r),s.subtreeFlags=0,r=l,l=s.child;l!==null;)nv(l,r),l=l.sibling;return oe(vt,vt.current&1|2),Ue&&wi(s,d.treeForkCount),s.child}r=r.sibling}d.tail!==null&&fn()>Sc&&(s.flags|=128,m=!0,yo(d,!1),s.lanes=4194304)}else{if(!m)if(r=nc(v),r!==null){if(s.flags|=128,m=!0,r=r.updateQueue,s.updateQueue=r,mc(s,r),yo(d,!0),d.tail===null&&d.tailMode==="hidden"&&!v.alternate&&!Ue)return st(s),null}else 2*fn()-d.renderingStartTime>Sc&&l!==536870912&&(s.flags|=128,m=!0,yo(d,!1),s.lanes=4194304);d.isBackwards?(v.sibling=s.child,s.child=v):(r=d.last,r!==null?r.sibling=v:s.child=v,d.last=v)}return d.tail!==null?(r=d.tail,d.rendering=r,d.tail=r.sibling,d.renderingStartTime=fn(),r.sibling=null,l=vt.current,oe(vt,m?l&1|2:l&1),Ue&&wi(s,d.treeForkCount),r):(st(s),null);case 22:case 23:return bn(s),eh(),d=s.memoizedState!==null,r!==null?r.memoizedState!==null!==d&&(s.flags|=8192):d&&(s.flags|=8192),d?(l&536870912)!==0&&(s.flags&128)===0&&(st(s),s.subtreeFlags&6&&(s.flags|=8192)):st(s),l=s.updateQueue,l!==null&&mc(s,l.retryQueue),l=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(l=r.memoizedState.cachePool.pool),d=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(d=s.memoizedState.cachePool.pool),d!==l&&(s.flags|=2048),r!==null&&J(Zr),null;case 24:return l=null,r!==null&&(l=r.memoizedState.cache),s.memoizedState.cache!==l&&(s.flags|=2048),_i(Tt),st(s),null;case 25:return null;case 30:return null}throw Error(i(156,s.tag))}function m_(r,s){switch(Bd(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return _i(Tt),Fe(),r=s.flags,(r&65536)!==0&&(r&128)===0?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return xl(s),null;case 31:if(s.memoizedState!==null){if(bn(s),s.alternate===null)throw Error(i(340));Yr()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 13:if(bn(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(i(340));Yr()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return J(vt),null;case 4:return Fe(),null;case 10:return _i(s.type),null;case 22:case 23:return bn(s),eh(),r!==null&&J(Zr),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return _i(Tt),null;case 25:return null;default:return null}}function O0(r,s){switch(Bd(s),s.tag){case 3:_i(Tt),Fe();break;case 26:case 27:case 5:xl(s);break;case 4:Fe();break;case 31:s.memoizedState!==null&&bn(s);break;case 13:bn(s);break;case 19:J(vt);break;case 10:_i(s.type);break;case 22:case 23:bn(s),eh(),r!==null&&J(Zr);break;case 24:_i(Tt)}}function bo(r,s){try{var l=s.updateQueue,d=l!==null?l.lastEffect:null;if(d!==null){var m=d.next;l=m;do{if((l.tag&r)===r){d=void 0;var v=l.create,S=l.inst;d=v(),S.destroy=d}l=l.next}while(l!==m)}}catch(x){We(s,s.return,x)}}function dr(r,s,l){try{var d=s.updateQueue,m=d!==null?d.lastEffect:null;if(m!==null){var v=m.next;d=v;do{if((d.tag&r)===r){var S=d.inst,x=S.destroy;if(x!==void 0){S.destroy=void 0,m=s;var L=l,$=x;try{$()}catch(ee){We(m,L,ee)}}}d=d.next}while(d!==v)}}catch(ee){We(s,s.return,ee)}}function A0(r){var s=r.updateQueue;if(s!==null){var l=r.stateNode;try{Sv(s,l)}catch(d){We(r,r.return,d)}}}function j0(r,s,l){l.props=ra(r.type,r.memoizedProps),l.state=r.memoizedState;try{l.componentWillUnmount()}catch(d){We(r,s,d)}}function So(r,s){try{var l=r.ref;if(l!==null){switch(r.tag){case 26:case 27:case 5:var d=r.stateNode;break;case 30:d=r.stateNode;break;default:d=r.stateNode}typeof l=="function"?r.refCleanup=l(d):l.current=d}}catch(m){We(r,s,m)}}function ci(r,s){var l=r.ref,d=r.refCleanup;if(l!==null)if(typeof d=="function")try{d()}catch(m){We(r,s,m)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(m){We(r,s,m)}else l.current=null}function P0(r){var s=r.type,l=r.memoizedProps,d=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":l.autoFocus&&d.focus();break e;case"img":l.src?d.src=l.src:l.srcSet&&(d.srcset=l.srcSet)}}catch(m){We(r,r.return,m)}}function Ph(r,s,l){try{var d=r.stateNode;L_(d,r.type,l,s),d[Zt]=s}catch(m){We(r,r.return,m)}}function D0(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&yr(r.type)||r.tag===4}function Dh(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||D0(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&yr(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Mh(r,s,l){var d=r.tag;if(d===5||d===6)r=r.stateNode,s?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(r,s):(s=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,s.appendChild(r),l=l._reactRootContainer,l!=null||s.onclick!==null||(s.onclick=Si));else if(d!==4&&(d===27&&yr(r.type)&&(l=r.stateNode,s=null),r=r.child,r!==null))for(Mh(r,s,l),r=r.sibling;r!==null;)Mh(r,s,l),r=r.sibling}function gc(r,s,l){var d=r.tag;if(d===5||d===6)r=r.stateNode,s?l.insertBefore(r,s):l.appendChild(r);else if(d!==4&&(d===27&&yr(r.type)&&(l=r.stateNode),r=r.child,r!==null))for(gc(r,s,l),r=r.sibling;r!==null;)gc(r,s,l),r=r.sibling}function M0(r){var s=r.stateNode,l=r.memoizedProps;try{for(var d=r.type,m=s.attributes;m.length;)s.removeAttributeNode(m[0]);Bt(s,d,l),s[Nt]=r,s[Zt]=l}catch(v){We(r,r.return,v)}}var Ai=!1,Ct=!1,Nh=!1,N0=typeof WeakSet=="function"?WeakSet:Set,Pt=null;function g_(r,s){if(r=r.containerInfo,nf=Lc,r=Gg(r),Rd(r)){if("selectionStart"in r)var l={start:r.selectionStart,end:r.selectionEnd};else e:{l=(l=r.ownerDocument)&&l.defaultView||window;var d=l.getSelection&&l.getSelection();if(d&&d.rangeCount!==0){l=d.anchorNode;var m=d.anchorOffset,v=d.focusNode;d=d.focusOffset;try{l.nodeType,v.nodeType}catch{l=null;break e}var S=0,x=-1,L=-1,$=0,ee=0,re=r,G=null;t:for(;;){for(var Y;re!==l||m!==0&&re.nodeType!==3||(x=S+m),re!==v||d!==0&&re.nodeType!==3||(L=S+d),re.nodeType===3&&(S+=re.nodeValue.length),(Y=re.firstChild)!==null;)G=re,re=Y;for(;;){if(re===r)break t;if(G===l&&++$===m&&(x=S),G===v&&++ee===d&&(L=S),(Y=re.nextSibling)!==null)break;re=G,G=re.parentNode}re=Y}l=x===-1||L===-1?null:{start:x,end:L}}else l=null}l=l||{start:0,end:0}}else l=null;for(rf={focusedElem:r,selectionRange:l},Lc=!1,Pt=s;Pt!==null;)if(s=Pt,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,Pt=r;else for(;Pt!==null;){switch(s=Pt,v=s.alternate,r=s.flags,s.tag){case 0:if((r&4)!==0&&(r=s.updateQueue,r=r!==null?r.events:null,r!==null))for(l=0;l<r.length;l++)m=r[l],m.ref.impl=m.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&v!==null){r=void 0,l=s,m=v.memoizedProps,v=v.memoizedState,d=l.stateNode;try{var fe=ra(l.type,m);r=d.getSnapshotBeforeUpdate(fe,v),d.__reactInternalSnapshotBeforeUpdate=r}catch(Te){We(l,l.return,Te)}}break;case 3:if((r&1024)!==0){if(r=s.stateNode.containerInfo,l=r.nodeType,l===9)of(r);else if(l===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":of(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(i(163))}if(r=s.sibling,r!==null){r.return=s.return,Pt=r;break}Pt=s.return}}function I0(r,s,l){var d=l.flags;switch(l.tag){case 0:case 11:case 15:Pi(r,l),d&4&&bo(5,l);break;case 1:if(Pi(r,l),d&4)if(r=l.stateNode,s===null)try{r.componentDidMount()}catch(S){We(l,l.return,S)}else{var m=ra(l.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(m,s,r.__reactInternalSnapshotBeforeUpdate)}catch(S){We(l,l.return,S)}}d&64&&A0(l),d&512&&So(l,l.return);break;case 3:if(Pi(r,l),d&64&&(r=l.updateQueue,r!==null)){if(s=null,l.child!==null)switch(l.child.tag){case 27:case 5:s=l.child.stateNode;break;case 1:s=l.child.stateNode}try{Sv(r,s)}catch(S){We(l,l.return,S)}}break;case 27:s===null&&d&4&&M0(l);case 26:case 5:Pi(r,l),s===null&&d&4&&P0(l),d&512&&So(l,l.return);break;case 12:Pi(r,l);break;case 31:Pi(r,l),d&4&&B0(r,l);break;case 13:Pi(r,l),d&4&&z0(r,l),d&64&&(r=l.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(l=__.bind(null,l),$_(r,l))));break;case 22:if(d=l.memoizedState!==null||Ai,!d){s=s!==null&&s.memoizedState!==null||Ct,m=Ai;var v=Ct;Ai=d,(Ct=s)&&!v?Di(r,l,(l.subtreeFlags&8772)!==0):Pi(r,l),Ai=m,Ct=v}break;case 30:break;default:Pi(r,l)}}function L0(r){var s=r.alternate;s!==null&&(r.alternate=null,L0(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&dd(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var ot=null,tn=!1;function ji(r,s,l){for(l=l.child;l!==null;)U0(r,s,l),l=l.sibling}function U0(r,s,l){if(pn&&typeof pn.onCommitFiberUnmount=="function")try{pn.onCommitFiberUnmount(Hs,l)}catch{}switch(l.tag){case 26:Ct||ci(l,s),ji(r,s,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:Ct||ci(l,s);var d=ot,m=tn;yr(l.type)&&(ot=l.stateNode,tn=!1),ji(r,s,l),Oo(l.stateNode),ot=d,tn=m;break;case 5:Ct||ci(l,s);case 6:if(d=ot,m=tn,ot=null,ji(r,s,l),ot=d,tn=m,ot!==null)if(tn)try{(ot.nodeType===9?ot.body:ot.nodeName==="HTML"?ot.ownerDocument.body:ot).removeChild(l.stateNode)}catch(v){We(l,s,v)}else try{ot.removeChild(l.stateNode)}catch(v){We(l,s,v)}break;case 18:ot!==null&&(tn?(r=ot,Ay(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,l.stateNode),rs(r)):Ay(ot,l.stateNode));break;case 4:d=ot,m=tn,ot=l.stateNode.containerInfo,tn=!0,ji(r,s,l),ot=d,tn=m;break;case 0:case 11:case 14:case 15:dr(2,l,s),Ct||dr(4,l,s),ji(r,s,l);break;case 1:Ct||(ci(l,s),d=l.stateNode,typeof d.componentWillUnmount=="function"&&j0(l,s,d)),ji(r,s,l);break;case 21:ji(r,s,l);break;case 22:Ct=(d=Ct)||l.memoizedState!==null,ji(r,s,l),Ct=d;break;default:ji(r,s,l)}}function B0(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{rs(r)}catch(l){We(s,s.return,l)}}}function z0(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{rs(r)}catch(l){We(s,s.return,l)}}function v_(r){switch(r.tag){case 31:case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new N0),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new N0),s;default:throw Error(i(435,r.tag))}}function vc(r,s){var l=v_(r);s.forEach(function(d){if(!l.has(d)){l.add(d);var m=x_.bind(null,r,d);d.then(m,m)}})}function nn(r,s){var l=s.deletions;if(l!==null)for(var d=0;d<l.length;d++){var m=l[d],v=r,S=s,x=S;e:for(;x!==null;){switch(x.tag){case 27:if(yr(x.type)){ot=x.stateNode,tn=!1;break e}break;case 5:ot=x.stateNode,tn=!1;break e;case 3:case 4:ot=x.stateNode.containerInfo,tn=!0;break e}x=x.return}if(ot===null)throw Error(i(160));U0(v,S,m),ot=null,tn=!1,v=m.alternate,v!==null&&(v.return=null),m.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)q0(s,r),s=s.sibling}var $n=null;function q0(r,s){var l=r.alternate,d=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:nn(s,r),rn(r),d&4&&(dr(3,r,r.return),bo(3,r),dr(5,r,r.return));break;case 1:nn(s,r),rn(r),d&512&&(Ct||l===null||ci(l,l.return)),d&64&&Ai&&(r=r.updateQueue,r!==null&&(d=r.callbacks,d!==null&&(l=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=l===null?d:l.concat(d))));break;case 26:var m=$n;if(nn(s,r),rn(r),d&512&&(Ct||l===null||ci(l,l.return)),d&4){var v=l!==null?l.memoizedState:null;if(d=r.memoizedState,l===null)if(d===null)if(r.stateNode===null){e:{d=r.type,l=r.memoizedProps,m=m.ownerDocument||m;t:switch(d){case"title":v=m.getElementsByTagName("title")[0],(!v||v[Ws]||v[Nt]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=m.createElement(d),m.head.insertBefore(v,m.querySelector("head > title"))),Bt(v,d,l),v[Nt]=r,jt(v),d=v;break e;case"link":var S=qy("link","href",m).get(d+(l.href||""));if(S){for(var x=0;x<S.length;x++)if(v=S[x],v.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&v.getAttribute("rel")===(l.rel==null?null:l.rel)&&v.getAttribute("title")===(l.title==null?null:l.title)&&v.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){S.splice(x,1);break t}}v=m.createElement(d),Bt(v,d,l),m.head.appendChild(v);break;case"meta":if(S=qy("meta","content",m).get(d+(l.content||""))){for(x=0;x<S.length;x++)if(v=S[x],v.getAttribute("content")===(l.content==null?null:""+l.content)&&v.getAttribute("name")===(l.name==null?null:l.name)&&v.getAttribute("property")===(l.property==null?null:l.property)&&v.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&v.getAttribute("charset")===(l.charSet==null?null:l.charSet)){S.splice(x,1);break t}}v=m.createElement(d),Bt(v,d,l),m.head.appendChild(v);break;default:throw Error(i(468,d))}v[Nt]=r,jt(v),d=v}r.stateNode=d}else Fy(m,r.type,r.stateNode);else r.stateNode=zy(m,d,r.memoizedProps);else v!==d?(v===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):v.count--,d===null?Fy(m,r.type,r.stateNode):zy(m,d,r.memoizedProps)):d===null&&r.stateNode!==null&&Ph(r,r.memoizedProps,l.memoizedProps)}break;case 27:nn(s,r),rn(r),d&512&&(Ct||l===null||ci(l,l.return)),l!==null&&d&4&&Ph(r,r.memoizedProps,l.memoizedProps);break;case 5:if(nn(s,r),rn(r),d&512&&(Ct||l===null||ci(l,l.return)),r.flags&32){m=r.stateNode;try{Ea(m,"")}catch(fe){We(r,r.return,fe)}}d&4&&r.stateNode!=null&&(m=r.memoizedProps,Ph(r,m,l!==null?l.memoizedProps:m)),d&1024&&(Nh=!0);break;case 6:if(nn(s,r),rn(r),d&4){if(r.stateNode===null)throw Error(i(162));d=r.memoizedProps,l=r.stateNode;try{l.nodeValue=d}catch(fe){We(r,r.return,fe)}}break;case 3:if(Dc=null,m=$n,$n=jc(s.containerInfo),nn(s,r),$n=m,rn(r),d&4&&l!==null&&l.memoizedState.isDehydrated)try{rs(s.containerInfo)}catch(fe){We(r,r.return,fe)}Nh&&(Nh=!1,F0(r));break;case 4:d=$n,$n=jc(r.stateNode.containerInfo),nn(s,r),rn(r),$n=d;break;case 12:nn(s,r),rn(r);break;case 31:nn(s,r),rn(r),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,vc(r,d)));break;case 13:nn(s,r),rn(r),r.child.flags&8192&&r.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(bc=fn()),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,vc(r,d)));break;case 22:m=r.memoizedState!==null;var L=l!==null&&l.memoizedState!==null,$=Ai,ee=Ct;if(Ai=$||m,Ct=ee||L,nn(s,r),Ct=ee,Ai=$,rn(r),d&8192)e:for(s=r.stateNode,s._visibility=m?s._visibility&-2:s._visibility|1,m&&(l===null||L||Ai||Ct||aa(r)),l=null,s=r;;){if(s.tag===5||s.tag===26){if(l===null){L=l=s;try{if(v=L.stateNode,m)S=v.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{x=L.stateNode;var re=L.memoizedProps.style,G=re!=null&&re.hasOwnProperty("display")?re.display:null;x.style.display=G==null||typeof G=="boolean"?"":(""+G).trim()}}catch(fe){We(L,L.return,fe)}}}else if(s.tag===6){if(l===null){L=s;try{L.stateNode.nodeValue=m?"":L.memoizedProps}catch(fe){We(L,L.return,fe)}}}else if(s.tag===18){if(l===null){L=s;try{var Y=L.stateNode;m?jy(Y,!0):jy(L.stateNode,!1)}catch(fe){We(L,L.return,fe)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;l===s&&(l=null),s=s.return}l===s&&(l=null),s.sibling.return=s.return,s=s.sibling}d&4&&(d=r.updateQueue,d!==null&&(l=d.retryQueue,l!==null&&(d.retryQueue=null,vc(r,l))));break;case 19:nn(s,r),rn(r),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,vc(r,d)));break;case 30:break;case 21:break;default:nn(s,r),rn(r)}}function rn(r){var s=r.flags;if(s&2){try{for(var l,d=r.return;d!==null;){if(D0(d)){l=d;break}d=d.return}if(l==null)throw Error(i(160));switch(l.tag){case 27:var m=l.stateNode,v=Dh(r);gc(r,v,m);break;case 5:var S=l.stateNode;l.flags&32&&(Ea(S,""),l.flags&=-33);var x=Dh(r);gc(r,x,S);break;case 3:case 4:var L=l.stateNode.containerInfo,$=Dh(r);Mh(r,$,L);break;default:throw Error(i(161))}}catch(ee){We(r,r.return,ee)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function F0(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;F0(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function Pi(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)I0(r,s.alternate,s),s=s.sibling}function aa(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:dr(4,s,s.return),aa(s);break;case 1:ci(s,s.return);var l=s.stateNode;typeof l.componentWillUnmount=="function"&&j0(s,s.return,l),aa(s);break;case 27:Oo(s.stateNode);case 26:case 5:ci(s,s.return),aa(s);break;case 22:s.memoizedState===null&&aa(s);break;case 30:aa(s);break;default:aa(s)}r=r.sibling}}function Di(r,s,l){for(l=l&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var d=s.alternate,m=r,v=s,S=v.flags;switch(v.tag){case 0:case 11:case 15:Di(m,v,l),bo(4,v);break;case 1:if(Di(m,v,l),d=v,m=d.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch($){We(d,d.return,$)}if(d=v,m=d.updateQueue,m!==null){var x=d.stateNode;try{var L=m.shared.hiddenCallbacks;if(L!==null)for(m.shared.hiddenCallbacks=null,m=0;m<L.length;m++)bv(L[m],x)}catch($){We(d,d.return,$)}}l&&S&64&&A0(v),So(v,v.return);break;case 27:M0(v);case 26:case 5:Di(m,v,l),l&&d===null&&S&4&&P0(v),So(v,v.return);break;case 12:Di(m,v,l);break;case 31:Di(m,v,l),l&&S&4&&B0(m,v);break;case 13:Di(m,v,l),l&&S&4&&z0(m,v);break;case 22:v.memoizedState===null&&Di(m,v,l),So(v,v.return);break;case 30:break;default:Di(m,v,l)}s=s.sibling}}function Ih(r,s){var l=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(l=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==l&&(r!=null&&r.refCount++,l!=null&&ao(l))}function Lh(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&ao(r))}function Wn(r,s,l,d){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)H0(r,s,l,d),s=s.sibling}function H0(r,s,l,d){var m=s.flags;switch(s.tag){case 0:case 11:case 15:Wn(r,s,l,d),m&2048&&bo(9,s);break;case 1:Wn(r,s,l,d);break;case 3:Wn(r,s,l,d),m&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&ao(r)));break;case 12:if(m&2048){Wn(r,s,l,d),r=s.stateNode;try{var v=s.memoizedProps,S=v.id,x=v.onPostCommit;typeof x=="function"&&x(S,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(L){We(s,s.return,L)}}else Wn(r,s,l,d);break;case 31:Wn(r,s,l,d);break;case 13:Wn(r,s,l,d);break;case 23:break;case 22:v=s.stateNode,S=s.alternate,s.memoizedState!==null?v._visibility&2?Wn(r,s,l,d):To(r,s):v._visibility&2?Wn(r,s,l,d):(v._visibility|=2,Ga(r,s,l,d,(s.subtreeFlags&10256)!==0||!1)),m&2048&&Ih(S,s);break;case 24:Wn(r,s,l,d),m&2048&&Lh(s.alternate,s);break;default:Wn(r,s,l,d)}}function Ga(r,s,l,d,m){for(m=m&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var v=r,S=s,x=l,L=d,$=S.flags;switch(S.tag){case 0:case 11:case 15:Ga(v,S,x,L,m),bo(8,S);break;case 23:break;case 22:var ee=S.stateNode;S.memoizedState!==null?ee._visibility&2?Ga(v,S,x,L,m):To(v,S):(ee._visibility|=2,Ga(v,S,x,L,m)),m&&$&2048&&Ih(S.alternate,S);break;case 24:Ga(v,S,x,L,m),m&&$&2048&&Lh(S.alternate,S);break;default:Ga(v,S,x,L,m)}s=s.sibling}}function To(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var l=r,d=s,m=d.flags;switch(d.tag){case 22:To(l,d),m&2048&&Ih(d.alternate,d);break;case 24:To(l,d),m&2048&&Lh(d.alternate,d);break;default:To(l,d)}s=s.sibling}}var ko=8192;function Ka(r,s,l){if(r.subtreeFlags&ko)for(r=r.child;r!==null;)V0(r,s,l),r=r.sibling}function V0(r,s,l){switch(r.tag){case 26:Ka(r,s,l),r.flags&ko&&r.memoizedState!==null&&ix(l,$n,r.memoizedState,r.memoizedProps);break;case 5:Ka(r,s,l);break;case 3:case 4:var d=$n;$n=jc(r.stateNode.containerInfo),Ka(r,s,l),$n=d;break;case 22:r.memoizedState===null&&(d=r.alternate,d!==null&&d.memoizedState!==null?(d=ko,ko=16777216,Ka(r,s,l),ko=d):Ka(r,s,l));break;default:Ka(r,s,l)}}function $0(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function wo(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var d=s[l];Pt=d,G0(d,r)}$0(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)W0(r),r=r.sibling}function W0(r){switch(r.tag){case 0:case 11:case 15:wo(r),r.flags&2048&&dr(9,r,r.return);break;case 3:wo(r);break;case 12:wo(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,yc(r)):wo(r);break;default:wo(r)}}function yc(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var d=s[l];Pt=d,G0(d,r)}$0(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:dr(8,s,s.return),yc(s);break;case 22:l=s.stateNode,l._visibility&2&&(l._visibility&=-3,yc(s));break;default:yc(s)}r=r.sibling}}function G0(r,s){for(;Pt!==null;){var l=Pt;switch(l.tag){case 0:case 11:case 15:dr(8,l,s);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var d=l.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:ao(l.memoizedState.cache)}if(d=l.child,d!==null)d.return=l,Pt=d;else e:for(l=r;Pt!==null;){d=Pt;var m=d.sibling,v=d.return;if(L0(d),d===l){Pt=null;break e}if(m!==null){m.return=v,Pt=m;break e}Pt=v}}}var y_={getCacheForType:function(r){var s=Lt(Tt),l=s.data.get(r);return l===void 0&&(l=r(),s.data.set(r,l)),l},cacheSignal:function(){return Lt(Tt).controller.signal}},b_=typeof WeakMap=="function"?WeakMap:Map,He=0,Xe=null,Pe=null,Ie=0,$e=0,Sn=null,hr=!1,Ja=!1,Uh=!1,Mi=0,ht=0,fr=0,sa=0,Bh=0,Tn=0,Ya=0,Co=null,an=null,zh=!1,bc=0,K0=0,Sc=1/0,Tc=null,pr=null,Et=0,mr=null,Qa=null,Ni=0,qh=0,Fh=null,J0=null,_o=0,Hh=null;function kn(){return(He&2)!==0&&Ie!==0?Ie&-Ie:N.T!==null?Jh():dg()}function Y0(){if(Tn===0)if((Ie&536870912)===0||Ue){var r=Ol;Ol<<=1,(Ol&3932160)===0&&(Ol=262144),Tn=r}else Tn=536870912;return r=yn.current,r!==null&&(r.flags|=32),Tn}function sn(r,s,l){(r===Xe&&($e===2||$e===9)||r.cancelPendingCommit!==null)&&(Xa(r,0),gr(r,Ie,Tn,!1)),$s(r,l),((He&2)===0||r!==Xe)&&(r===Xe&&((He&2)===0&&(sa|=l),ht===4&&gr(r,Ie,Tn,!1)),ui(r))}function Q0(r,s,l){if((He&6)!==0)throw Error(i(327));var d=!l&&(s&127)===0&&(s&r.expiredLanes)===0||Vs(r,s),m=d?k_(r,s):$h(r,s,!0),v=d;do{if(m===0){Ja&&!d&&gr(r,s,0,!1);break}else{if(l=r.current.alternate,v&&!S_(l)){m=$h(r,s,!1),v=!1;continue}if(m===2){if(v=s,r.errorRecoveryDisabledLanes&v)var S=0;else S=r.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){s=S;e:{var x=r;m=Co;var L=x.current.memoizedState.isDehydrated;if(L&&(Xa(x,S).flags|=256),S=$h(x,S,!1),S!==2){if(Uh&&!L){x.errorRecoveryDisabledLanes|=v,sa|=v,m=4;break e}v=an,an=m,v!==null&&(an===null?an=v:an.push.apply(an,v))}m=S}if(v=!1,m!==2)continue}}if(m===1){Xa(r,0),gr(r,s,0,!0);break}e:{switch(d=r,v=m,v){case 0:case 1:throw Error(i(345));case 4:if((s&4194048)!==s)break;case 6:gr(d,s,Tn,!hr);break e;case 2:an=null;break;case 3:case 5:break;default:throw Error(i(329))}if((s&62914560)===s&&(m=bc+300-fn(),10<m)){if(gr(d,s,Tn,!hr),jl(d,0,!0)!==0)break e;Ni=s,d.timeoutHandle=Ry(X0.bind(null,d,l,an,Tc,zh,s,Tn,sa,Ya,hr,v,"Throttled",-0,0),m);break e}X0(d,l,an,Tc,zh,s,Tn,sa,Ya,hr,v,null,-0,0)}}break}while(!0);ui(r)}function X0(r,s,l,d,m,v,S,x,L,$,ee,re,G,Y){if(r.timeoutHandle=-1,re=s.subtreeFlags,re&8192||(re&16785408)===16785408){re={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Si},V0(s,v,re);var fe=(v&62914560)===v?bc-fn():(v&4194048)===v?K0-fn():0;if(fe=rx(re,fe),fe!==null){Ni=v,r.cancelPendingCommit=fe(sy.bind(null,r,s,v,l,d,m,S,x,L,ee,re,null,G,Y)),gr(r,v,S,!$);return}}sy(r,s,v,l,d,m,S,x,L)}function S_(r){for(var s=r;;){var l=s.tag;if((l===0||l===11||l===15)&&s.flags&16384&&(l=s.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var d=0;d<l.length;d++){var m=l[d],v=m.getSnapshot;m=m.value;try{if(!gn(v(),m))return!1}catch{return!1}}if(l=s.child,s.subtreeFlags&16384&&l!==null)l.return=s,s=l;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function gr(r,s,l,d){s&=~Bh,s&=~sa,r.suspendedLanes|=s,r.pingedLanes&=~s,d&&(r.warmLanes|=s),d=r.expirationTimes;for(var m=s;0<m;){var v=31-mn(m),S=1<<v;d[v]=-1,m&=~S}l!==0&&lg(r,l,s)}function kc(){return(He&6)===0?(xo(0),!1):!0}function Vh(){if(Pe!==null){if($e===0)var r=Pe.return;else r=Pe,Ci=Qr=null,sh(r),Fa=null,oo=0,r=Pe;for(;r!==null;)O0(r.alternate,r),r=r.return;Pe=null}}function Xa(r,s){var l=r.timeoutHandle;l!==-1&&(r.timeoutHandle=-1,z_(l)),l=r.cancelPendingCommit,l!==null&&(r.cancelPendingCommit=null,l()),Ni=0,Vh(),Xe=r,Pe=l=ki(r.current,null),Ie=s,$e=0,Sn=null,hr=!1,Ja=Vs(r,s),Uh=!1,Ya=Tn=Bh=sa=fr=ht=0,an=Co=null,zh=!1,(s&8)!==0&&(s|=s&32);var d=r.entangledLanes;if(d!==0)for(r=r.entanglements,d&=s;0<d;){var m=31-mn(d),v=1<<m;s|=r[m],d&=~v}return Mi=s,Hl(),l}function Z0(r,s){Re=null,N.H=go,s===qa||s===Ql?(s=mv(),$e=3):s===Kd?(s=mv(),$e=4):$e=s===kh?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Sn=s,Pe===null&&(ht=1,dc(r,Pn(s,r.current)))}function ey(){var r=yn.current;return r===null?!0:(Ie&4194048)===Ie?In===null:(Ie&62914560)===Ie||(Ie&536870912)!==0?r===In:!1}function ty(){var r=N.H;return N.H=go,r===null?go:r}function ny(){var r=N.A;return N.A=y_,r}function wc(){ht=4,hr||(Ie&4194048)!==Ie&&yn.current!==null||(Ja=!0),(fr&134217727)===0&&(sa&134217727)===0||Xe===null||gr(Xe,Ie,Tn,!1)}function $h(r,s,l){var d=He;He|=2;var m=ty(),v=ny();(Xe!==r||Ie!==s)&&(Tc=null,Xa(r,s)),s=!1;var S=ht;e:do try{if($e!==0&&Pe!==null){var x=Pe,L=Sn;switch($e){case 8:Vh(),S=6;break e;case 3:case 2:case 9:case 6:yn.current===null&&(s=!0);var $=$e;if($e=0,Sn=null,Za(r,x,L,$),l&&Ja){S=0;break e}break;default:$=$e,$e=0,Sn=null,Za(r,x,L,$)}}T_(),S=ht;break}catch(ee){Z0(r,ee)}while(!0);return s&&r.shellSuspendCounter++,Ci=Qr=null,He=d,N.H=m,N.A=v,Pe===null&&(Xe=null,Ie=0,Hl()),S}function T_(){for(;Pe!==null;)iy(Pe)}function k_(r,s){var l=He;He|=2;var d=ty(),m=ny();Xe!==r||Ie!==s?(Tc=null,Sc=fn()+500,Xa(r,s)):Ja=Vs(r,s);e:do try{if($e!==0&&Pe!==null){s=Pe;var v=Sn;t:switch($e){case 1:$e=0,Sn=null,Za(r,s,v,1);break;case 2:case 9:if(fv(v)){$e=0,Sn=null,ry(s);break}s=function(){$e!==2&&$e!==9||Xe!==r||($e=7),ui(r)},v.then(s,s);break e;case 3:$e=7;break e;case 4:$e=5;break e;case 7:fv(v)?($e=0,Sn=null,ry(s)):($e=0,Sn=null,Za(r,s,v,7));break;case 5:var S=null;switch(Pe.tag){case 26:S=Pe.memoizedState;case 5:case 27:var x=Pe;if(S?Hy(S):x.stateNode.complete){$e=0,Sn=null;var L=x.sibling;if(L!==null)Pe=L;else{var $=x.return;$!==null?(Pe=$,Cc($)):Pe=null}break t}}$e=0,Sn=null,Za(r,s,v,5);break;case 6:$e=0,Sn=null,Za(r,s,v,6);break;case 8:Vh(),ht=6;break e;default:throw Error(i(462))}}w_();break}catch(ee){Z0(r,ee)}while(!0);return Ci=Qr=null,N.H=d,N.A=m,He=l,Pe!==null?0:(Xe=null,Ie=0,Hl(),ht)}function w_(){for(;Pe!==null&&!W1();)iy(Pe)}function iy(r){var s=E0(r.alternate,r,Mi);r.memoizedProps=r.pendingProps,s===null?Cc(r):Pe=s}function ry(r){var s=r,l=s.alternate;switch(s.tag){case 15:case 0:s=T0(l,s,s.pendingProps,s.type,void 0,Ie);break;case 11:s=T0(l,s,s.pendingProps,s.type.render,s.ref,Ie);break;case 5:sh(s);default:O0(l,s),s=Pe=nv(s,Mi),s=E0(l,s,Mi)}r.memoizedProps=r.pendingProps,s===null?Cc(r):Pe=s}function Za(r,s,l,d){Ci=Qr=null,sh(s),Fa=null,oo=0;var m=s.return;try{if(d_(r,m,s,l,Ie)){ht=1,dc(r,Pn(l,r.current)),Pe=null;return}}catch(v){if(m!==null)throw Pe=m,v;ht=1,dc(r,Pn(l,r.current)),Pe=null;return}s.flags&32768?(Ue||d===1?r=!0:Ja||(Ie&536870912)!==0?r=!1:(hr=r=!0,(d===2||d===9||d===3||d===6)&&(d=yn.current,d!==null&&d.tag===13&&(d.flags|=16384))),ay(s,r)):Cc(s)}function Cc(r){var s=r;do{if((s.flags&32768)!==0){ay(s,hr);return}r=s.return;var l=p_(s.alternate,s,Mi);if(l!==null){Pe=l;return}if(s=s.sibling,s!==null){Pe=s;return}Pe=s=r}while(s!==null);ht===0&&(ht=5)}function ay(r,s){do{var l=m_(r.alternate,r);if(l!==null){l.flags&=32767,Pe=l;return}if(l=r.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!s&&(r=r.sibling,r!==null)){Pe=r;return}Pe=r=l}while(r!==null);ht=6,Pe=null}function sy(r,s,l,d,m,v,S,x,L){r.cancelPendingCommit=null;do _c();while(Et!==0);if((He&6)!==0)throw Error(i(327));if(s!==null){if(s===r.current)throw Error(i(177));if(v=s.lanes|s.childLanes,v|=Dd,nC(r,l,v,S,x,L),r===Xe&&(Pe=Xe=null,Ie=0),Qa=s,mr=r,Ni=l,qh=v,Fh=m,J0=d,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,E_(El,function(){return dy(),null})):(r.callbackNode=null,r.callbackPriority=0),d=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||d){d=N.T,N.T=null,m=K.p,K.p=2,S=He,He|=4;try{g_(r,s,l)}finally{He=S,K.p=m,N.T=d}}Et=1,oy(),ly(),cy()}}function oy(){if(Et===1){Et=0;var r=mr,s=Qa,l=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||l){l=N.T,N.T=null;var d=K.p;K.p=2;var m=He;He|=4;try{q0(s,r);var v=rf,S=Gg(r.containerInfo),x=v.focusedElem,L=v.selectionRange;if(S!==x&&x&&x.ownerDocument&&Wg(x.ownerDocument.documentElement,x)){if(L!==null&&Rd(x)){var $=L.start,ee=L.end;if(ee===void 0&&(ee=$),"selectionStart"in x)x.selectionStart=$,x.selectionEnd=Math.min(ee,x.value.length);else{var re=x.ownerDocument||document,G=re&&re.defaultView||window;if(G.getSelection){var Y=G.getSelection(),fe=x.textContent.length,Te=Math.min(L.start,fe),Je=L.end===void 0?Te:Math.min(L.end,fe);!Y.extend&&Te>Je&&(S=Je,Je=Te,Te=S);var q=$g(x,Te),U=$g(x,Je);if(q&&U&&(Y.rangeCount!==1||Y.anchorNode!==q.node||Y.anchorOffset!==q.offset||Y.focusNode!==U.node||Y.focusOffset!==U.offset)){var V=re.createRange();V.setStart(q.node,q.offset),Y.removeAllRanges(),Te>Je?(Y.addRange(V),Y.extend(U.node,U.offset)):(V.setEnd(U.node,U.offset),Y.addRange(V))}}}}for(re=[],Y=x;Y=Y.parentNode;)Y.nodeType===1&&re.push({element:Y,left:Y.scrollLeft,top:Y.scrollTop});for(typeof x.focus=="function"&&x.focus(),x=0;x<re.length;x++){var ne=re[x];ne.element.scrollLeft=ne.left,ne.element.scrollTop=ne.top}}Lc=!!nf,rf=nf=null}finally{He=m,K.p=d,N.T=l}}r.current=s,Et=2}}function ly(){if(Et===2){Et=0;var r=mr,s=Qa,l=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||l){l=N.T,N.T=null;var d=K.p;K.p=2;var m=He;He|=4;try{I0(r,s.alternate,s)}finally{He=m,K.p=d,N.T=l}}Et=3}}function cy(){if(Et===4||Et===3){Et=0,G1();var r=mr,s=Qa,l=Ni,d=J0;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Et=5:(Et=0,Qa=mr=null,uy(r,r.pendingLanes));var m=r.pendingLanes;if(m===0&&(pr=null),cd(l),s=s.stateNode,pn&&typeof pn.onCommitFiberRoot=="function")try{pn.onCommitFiberRoot(Hs,s,void 0,(s.current.flags&128)===128)}catch{}if(d!==null){s=N.T,m=K.p,K.p=2,N.T=null;try{for(var v=r.onRecoverableError,S=0;S<d.length;S++){var x=d[S];v(x.value,{componentStack:x.stack})}}finally{N.T=s,K.p=m}}(Ni&3)!==0&&_c(),ui(r),m=r.pendingLanes,(l&261930)!==0&&(m&42)!==0?r===Hh?_o++:(_o=0,Hh=r):_o=0,xo(0)}}function uy(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,ao(s)))}function _c(){return oy(),ly(),cy(),dy()}function dy(){if(Et!==5)return!1;var r=mr,s=qh;qh=0;var l=cd(Ni),d=N.T,m=K.p;try{K.p=32>l?32:l,N.T=null,l=Fh,Fh=null;var v=mr,S=Ni;if(Et=0,Qa=mr=null,Ni=0,(He&6)!==0)throw Error(i(331));var x=He;if(He|=4,W0(v.current),H0(v,v.current,S,l),He=x,xo(0,!1),pn&&typeof pn.onPostCommitFiberRoot=="function")try{pn.onPostCommitFiberRoot(Hs,v)}catch{}return!0}finally{K.p=m,N.T=d,uy(r,s)}}function hy(r,s,l){s=Pn(l,s),s=Th(r.stateNode,s,2),r=lr(r,s,2),r!==null&&($s(r,2),ui(r))}function We(r,s,l){if(r.tag===3)hy(r,r,l);else for(;s!==null;){if(s.tag===3){hy(s,r,l);break}else if(s.tag===1){var d=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(pr===null||!pr.has(d))){r=Pn(l,r),l=f0(2),d=lr(s,l,2),d!==null&&(p0(l,d,s,r),$s(d,2),ui(d));break}}s=s.return}}function Wh(r,s,l){var d=r.pingCache;if(d===null){d=r.pingCache=new b_;var m=new Set;d.set(s,m)}else m=d.get(s),m===void 0&&(m=new Set,d.set(s,m));m.has(l)||(Uh=!0,m.add(l),r=C_.bind(null,r,s,l),s.then(r,r))}function C_(r,s,l){var d=r.pingCache;d!==null&&d.delete(s),r.pingedLanes|=r.suspendedLanes&l,r.warmLanes&=~l,Xe===r&&(Ie&l)===l&&(ht===4||ht===3&&(Ie&62914560)===Ie&&300>fn()-bc?(He&2)===0&&Xa(r,0):Bh|=l,Ya===Ie&&(Ya=0)),ui(r)}function fy(r,s){s===0&&(s=og()),r=Kr(r,s),r!==null&&($s(r,s),ui(r))}function __(r){var s=r.memoizedState,l=0;s!==null&&(l=s.retryLane),fy(r,l)}function x_(r,s){var l=0;switch(r.tag){case 31:case 13:var d=r.stateNode,m=r.memoizedState;m!==null&&(l=m.retryLane);break;case 19:d=r.stateNode;break;case 22:d=r.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(s),fy(r,l)}function E_(r,s){return ad(r,s)}var xc=null,es=null,Gh=!1,Ec=!1,Kh=!1,vr=0;function ui(r){r!==es&&r.next===null&&(es===null?xc=es=r:es=es.next=r),Ec=!0,Gh||(Gh=!0,O_())}function xo(r,s){if(!Kh&&Ec){Kh=!0;do for(var l=!1,d=xc;d!==null;){if(r!==0){var m=d.pendingLanes;if(m===0)var v=0;else{var S=d.suspendedLanes,x=d.pingedLanes;v=(1<<31-mn(42|r)+1)-1,v&=m&~(S&~x),v=v&201326741?v&201326741|1:v?v|2:0}v!==0&&(l=!0,vy(d,v))}else v=Ie,v=jl(d,d===Xe?v:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(v&3)===0||Vs(d,v)||(l=!0,vy(d,v));d=d.next}while(l);Kh=!1}}function R_(){py()}function py(){Ec=Gh=!1;var r=0;vr!==0&&B_()&&(r=vr);for(var s=fn(),l=null,d=xc;d!==null;){var m=d.next,v=my(d,s);v===0?(d.next=null,l===null?xc=m:l.next=m,m===null&&(es=l)):(l=d,(r!==0||(v&3)!==0)&&(Ec=!0)),d=m}Et!==0&&Et!==5||xo(r),vr!==0&&(vr=0)}function my(r,s){for(var l=r.suspendedLanes,d=r.pingedLanes,m=r.expirationTimes,v=r.pendingLanes&-62914561;0<v;){var S=31-mn(v),x=1<<S,L=m[S];L===-1?((x&l)===0||(x&d)!==0)&&(m[S]=tC(x,s)):L<=s&&(r.expiredLanes|=x),v&=~x}if(s=Xe,l=Ie,l=jl(r,r===s?l:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),d=r.callbackNode,l===0||r===s&&($e===2||$e===9)||r.cancelPendingCommit!==null)return d!==null&&d!==null&&sd(d),r.callbackNode=null,r.callbackPriority=0;if((l&3)===0||Vs(r,l)){if(s=l&-l,s===r.callbackPriority)return s;switch(d!==null&&sd(d),cd(l)){case 2:case 8:l=ag;break;case 32:l=El;break;case 268435456:l=sg;break;default:l=El}return d=gy.bind(null,r),l=ad(l,d),r.callbackPriority=s,r.callbackNode=l,s}return d!==null&&d!==null&&sd(d),r.callbackPriority=2,r.callbackNode=null,2}function gy(r,s){if(Et!==0&&Et!==5)return r.callbackNode=null,r.callbackPriority=0,null;var l=r.callbackNode;if(_c()&&r.callbackNode!==l)return null;var d=Ie;return d=jl(r,r===Xe?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),d===0?null:(Q0(r,d,s),my(r,fn()),r.callbackNode!=null&&r.callbackNode===l?gy.bind(null,r):null)}function vy(r,s){if(_c())return null;Q0(r,s,!0)}function O_(){q_(function(){(He&6)!==0?ad(rg,R_):py()})}function Jh(){if(vr===0){var r=Ba;r===0&&(r=Rl,Rl<<=1,(Rl&261888)===0&&(Rl=256)),vr=r}return vr}function yy(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Nl(""+r)}function by(r,s){var l=s.ownerDocument.createElement("input");return l.name=s.name,l.value=s.value,r.id&&l.setAttribute("form",r.id),s.parentNode.insertBefore(l,s),r=new FormData(r),l.parentNode.removeChild(l),r}function A_(r,s,l,d,m){if(s==="submit"&&l&&l.stateNode===m){var v=yy((m[Zt]||null).action),S=d.submitter;S&&(s=(s=S[Zt]||null)?yy(s.formAction):S.getAttribute("formAction"),s!==null&&(v=s,S=null));var x=new Bl("action","action",null,d,m);r.push({event:x,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(vr!==0){var L=S?by(m,S):new FormData(m);mh(l,{pending:!0,data:L,method:m.method,action:v},null,L)}}else typeof v=="function"&&(x.preventDefault(),L=S?by(m,S):new FormData(m),mh(l,{pending:!0,data:L,method:m.method,action:v},v,L))},currentTarget:m}]})}}for(var Yh=0;Yh<Pd.length;Yh++){var Qh=Pd[Yh],j_=Qh.toLowerCase(),P_=Qh[0].toUpperCase()+Qh.slice(1);Vn(j_,"on"+P_)}Vn(Yg,"onAnimationEnd"),Vn(Qg,"onAnimationIteration"),Vn(Xg,"onAnimationStart"),Vn("dblclick","onDoubleClick"),Vn("focusin","onFocus"),Vn("focusout","onBlur"),Vn(KC,"onTransitionRun"),Vn(JC,"onTransitionStart"),Vn(YC,"onTransitionCancel"),Vn(Zg,"onTransitionEnd"),_a("onMouseEnter",["mouseout","mouseover"]),_a("onMouseLeave",["mouseout","mouseover"]),_a("onPointerEnter",["pointerout","pointerover"]),_a("onPointerLeave",["pointerout","pointerover"]),Vr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Vr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Vr("onBeforeInput",["compositionend","keypress","textInput","paste"]),Vr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Vr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Vr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Eo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),D_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Eo));function Sy(r,s){s=(s&4)!==0;for(var l=0;l<r.length;l++){var d=r[l],m=d.event;d=d.listeners;e:{var v=void 0;if(s)for(var S=d.length-1;0<=S;S--){var x=d[S],L=x.instance,$=x.currentTarget;if(x=x.listener,L!==v&&m.isPropagationStopped())break e;v=x,m.currentTarget=$;try{v(m)}catch(ee){Fl(ee)}m.currentTarget=null,v=L}else for(S=0;S<d.length;S++){if(x=d[S],L=x.instance,$=x.currentTarget,x=x.listener,L!==v&&m.isPropagationStopped())break e;v=x,m.currentTarget=$;try{v(m)}catch(ee){Fl(ee)}m.currentTarget=null,v=L}}}}function De(r,s){var l=s[ud];l===void 0&&(l=s[ud]=new Set);var d=r+"__bubble";l.has(d)||(Ty(s,r,2,!1),l.add(d))}function Xh(r,s,l){var d=0;s&&(d|=4),Ty(l,r,d,s)}var Rc="_reactListening"+Math.random().toString(36).slice(2);function Zh(r){if(!r[Rc]){r[Rc]=!0,pg.forEach(function(l){l!=="selectionchange"&&(D_.has(l)||Xh(l,!1,r),Xh(l,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[Rc]||(s[Rc]=!0,Xh("selectionchange",!1,s))}}function Ty(r,s,l,d){switch(Yy(s)){case 2:var m=ox;break;case 8:m=lx;break;default:m=mf}l=m.bind(null,s,l,r),m=void 0,!bd||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(m=!0),d?m!==void 0?r.addEventListener(s,l,{capture:!0,passive:m}):r.addEventListener(s,l,!0):m!==void 0?r.addEventListener(s,l,{passive:m}):r.addEventListener(s,l,!1)}function ef(r,s,l,d,m){var v=d;if((s&1)===0&&(s&2)===0&&d!==null)e:for(;;){if(d===null)return;var S=d.tag;if(S===3||S===4){var x=d.stateNode.containerInfo;if(x===m)break;if(S===4)for(S=d.return;S!==null;){var L=S.tag;if((L===3||L===4)&&S.stateNode.containerInfo===m)return;S=S.return}for(;x!==null;){if(S=ka(x),S===null)return;if(L=S.tag,L===5||L===6||L===26||L===27){d=v=S;continue e}x=x.parentNode}}d=d.return}xg(function(){var $=v,ee=vd(l),re=[];e:{var G=ev.get(r);if(G!==void 0){var Y=Bl,fe=r;switch(r){case"keypress":if(Ll(l)===0)break e;case"keydown":case"keyup":Y=xC;break;case"focusin":fe="focus",Y=wd;break;case"focusout":fe="blur",Y=wd;break;case"beforeblur":case"afterblur":Y=wd;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Y=Og;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Y=pC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Y=OC;break;case Yg:case Qg:case Xg:Y=vC;break;case Zg:Y=jC;break;case"scroll":case"scrollend":Y=hC;break;case"wheel":Y=DC;break;case"copy":case"cut":case"paste":Y=bC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Y=jg;break;case"toggle":case"beforetoggle":Y=NC}var Te=(s&4)!==0,Je=!Te&&(r==="scroll"||r==="scrollend"),q=Te?G!==null?G+"Capture":null:G;Te=[];for(var U=$,V;U!==null;){var ne=U;if(V=ne.stateNode,ne=ne.tag,ne!==5&&ne!==26&&ne!==27||V===null||q===null||(ne=Ks(U,q),ne!=null&&Te.push(Ro(U,ne,V))),Je)break;U=U.return}0<Te.length&&(G=new Y(G,fe,null,l,ee),re.push({event:G,listeners:Te}))}}if((s&7)===0){e:{if(G=r==="mouseover"||r==="pointerover",Y=r==="mouseout"||r==="pointerout",G&&l!==gd&&(fe=l.relatedTarget||l.fromElement)&&(ka(fe)||fe[Ta]))break e;if((Y||G)&&(G=ee.window===ee?ee:(G=ee.ownerDocument)?G.defaultView||G.parentWindow:window,Y?(fe=l.relatedTarget||l.toElement,Y=$,fe=fe?ka(fe):null,fe!==null&&(Je=o(fe),Te=fe.tag,fe!==Je||Te!==5&&Te!==27&&Te!==6)&&(fe=null)):(Y=null,fe=$),Y!==fe)){if(Te=Og,ne="onMouseLeave",q="onMouseEnter",U="mouse",(r==="pointerout"||r==="pointerover")&&(Te=jg,ne="onPointerLeave",q="onPointerEnter",U="pointer"),Je=Y==null?G:Gs(Y),V=fe==null?G:Gs(fe),G=new Te(ne,U+"leave",Y,l,ee),G.target=Je,G.relatedTarget=V,ne=null,ka(ee)===$&&(Te=new Te(q,U+"enter",fe,l,ee),Te.target=V,Te.relatedTarget=Je,ne=Te),Je=ne,Y&&fe)t:{for(Te=M_,q=Y,U=fe,V=0,ne=q;ne;ne=Te(ne))V++;ne=0;for(var be=U;be;be=Te(be))ne++;for(;0<V-ne;)q=Te(q),V--;for(;0<ne-V;)U=Te(U),ne--;for(;V--;){if(q===U||U!==null&&q===U.alternate){Te=q;break t}q=Te(q),U=Te(U)}Te=null}else Te=null;Y!==null&&ky(re,G,Y,Te,!1),fe!==null&&Je!==null&&ky(re,Je,fe,Te,!0)}}e:{if(G=$?Gs($):window,Y=G.nodeName&&G.nodeName.toLowerCase(),Y==="select"||Y==="input"&&G.type==="file")var ze=Bg;else if(Lg(G))if(zg)ze=$C;else{ze=HC;var me=FC}else Y=G.nodeName,!Y||Y.toLowerCase()!=="input"||G.type!=="checkbox"&&G.type!=="radio"?$&&md($.elementType)&&(ze=Bg):ze=VC;if(ze&&(ze=ze(r,$))){Ug(re,ze,l,ee);break e}me&&me(r,G,$),r==="focusout"&&$&&G.type==="number"&&$.memoizedProps.value!=null&&pd(G,"number",G.value)}switch(me=$?Gs($):window,r){case"focusin":(Lg(me)||me.contentEditable==="true")&&(ja=me,Od=$,no=null);break;case"focusout":no=Od=ja=null;break;case"mousedown":Ad=!0;break;case"contextmenu":case"mouseup":case"dragend":Ad=!1,Kg(re,l,ee);break;case"selectionchange":if(GC)break;case"keydown":case"keyup":Kg(re,l,ee)}var Oe;if(_d)e:{switch(r){case"compositionstart":var Le="onCompositionStart";break e;case"compositionend":Le="onCompositionEnd";break e;case"compositionupdate":Le="onCompositionUpdate";break e}Le=void 0}else Aa?Ng(r,l)&&(Le="onCompositionEnd"):r==="keydown"&&l.keyCode===229&&(Le="onCompositionStart");Le&&(Pg&&l.locale!=="ko"&&(Aa||Le!=="onCompositionStart"?Le==="onCompositionEnd"&&Aa&&(Oe=Eg()):(tr=ee,Sd="value"in tr?tr.value:tr.textContent,Aa=!0)),me=Oc($,Le),0<me.length&&(Le=new Ag(Le,r,null,l,ee),re.push({event:Le,listeners:me}),Oe?Le.data=Oe:(Oe=Ig(l),Oe!==null&&(Le.data=Oe)))),(Oe=LC?UC(r,l):BC(r,l))&&(Le=Oc($,"onBeforeInput"),0<Le.length&&(me=new Ag("onBeforeInput","beforeinput",null,l,ee),re.push({event:me,listeners:Le}),me.data=Oe)),A_(re,r,$,l,ee)}Sy(re,s)})}function Ro(r,s,l){return{instance:r,listener:s,currentTarget:l}}function Oc(r,s){for(var l=s+"Capture",d=[];r!==null;){var m=r,v=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||v===null||(m=Ks(r,l),m!=null&&d.unshift(Ro(r,m,v)),m=Ks(r,s),m!=null&&d.push(Ro(r,m,v))),r.tag===3)return d;r=r.return}return[]}function M_(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function ky(r,s,l,d,m){for(var v=s._reactName,S=[];l!==null&&l!==d;){var x=l,L=x.alternate,$=x.stateNode;if(x=x.tag,L!==null&&L===d)break;x!==5&&x!==26&&x!==27||$===null||(L=$,m?($=Ks(l,v),$!=null&&S.unshift(Ro(l,$,L))):m||($=Ks(l,v),$!=null&&S.push(Ro(l,$,L)))),l=l.return}S.length!==0&&r.push({event:s,listeners:S})}var N_=/\r\n?/g,I_=/\u0000|\uFFFD/g;function wy(r){return(typeof r=="string"?r:""+r).replace(N_,`
`).replace(I_,"")}function Cy(r,s){return s=wy(s),wy(r)===s}function Ke(r,s,l,d,m,v){switch(l){case"children":typeof d=="string"?s==="body"||s==="textarea"&&d===""||Ea(r,d):(typeof d=="number"||typeof d=="bigint")&&s!=="body"&&Ea(r,""+d);break;case"className":Dl(r,"class",d);break;case"tabIndex":Dl(r,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":Dl(r,l,d);break;case"style":Cg(r,d,v);break;case"data":if(s!=="object"){Dl(r,"data",d);break}case"src":case"href":if(d===""&&(s!=="a"||l!=="href")){r.removeAttribute(l);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){r.removeAttribute(l);break}d=Nl(""+d),r.setAttribute(l,d);break;case"action":case"formAction":if(typeof d=="function"){r.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(l==="formAction"?(s!=="input"&&Ke(r,s,"name",m.name,m,null),Ke(r,s,"formEncType",m.formEncType,m,null),Ke(r,s,"formMethod",m.formMethod,m,null),Ke(r,s,"formTarget",m.formTarget,m,null)):(Ke(r,s,"encType",m.encType,m,null),Ke(r,s,"method",m.method,m,null),Ke(r,s,"target",m.target,m,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){r.removeAttribute(l);break}d=Nl(""+d),r.setAttribute(l,d);break;case"onClick":d!=null&&(r.onclick=Si);break;case"onScroll":d!=null&&De("scroll",r);break;case"onScrollEnd":d!=null&&De("scrollend",r);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(l=d.__html,l!=null){if(m.children!=null)throw Error(i(60));r.innerHTML=l}}break;case"multiple":r.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":r.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){r.removeAttribute("xlink:href");break}l=Nl(""+d),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(l,""+d):r.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(l,""):r.removeAttribute(l);break;case"capture":case"download":d===!0?r.setAttribute(l,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(l,d):r.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?r.setAttribute(l,d):r.removeAttribute(l);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?r.removeAttribute(l):r.setAttribute(l,d);break;case"popover":De("beforetoggle",r),De("toggle",r),Pl(r,"popover",d);break;case"xlinkActuate":bi(r,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":bi(r,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":bi(r,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":bi(r,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":bi(r,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":bi(r,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":bi(r,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":bi(r,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":bi(r,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":Pl(r,"is",d);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=uC.get(l)||l,Pl(r,l,d))}}function tf(r,s,l,d,m,v){switch(l){case"style":Cg(r,d,v);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(l=d.__html,l!=null){if(m.children!=null)throw Error(i(60));r.innerHTML=l}}break;case"children":typeof d=="string"?Ea(r,d):(typeof d=="number"||typeof d=="bigint")&&Ea(r,""+d);break;case"onScroll":d!=null&&De("scroll",r);break;case"onScrollEnd":d!=null&&De("scrollend",r);break;case"onClick":d!=null&&(r.onclick=Si);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!mg.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(m=l.endsWith("Capture"),s=l.slice(2,m?l.length-7:void 0),v=r[Zt]||null,v=v!=null?v[l]:null,typeof v=="function"&&r.removeEventListener(s,v,m),typeof d=="function")){typeof v!="function"&&v!==null&&(l in r?r[l]=null:r.hasAttribute(l)&&r.removeAttribute(l)),r.addEventListener(s,d,m);break e}l in r?r[l]=d:d===!0?r.setAttribute(l,""):Pl(r,l,d)}}}function Bt(r,s,l){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":De("error",r),De("load",r);var d=!1,m=!1,v;for(v in l)if(l.hasOwnProperty(v)){var S=l[v];if(S!=null)switch(v){case"src":d=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:Ke(r,s,v,S,l,null)}}m&&Ke(r,s,"srcSet",l.srcSet,l,null),d&&Ke(r,s,"src",l.src,l,null);return;case"input":De("invalid",r);var x=v=S=m=null,L=null,$=null;for(d in l)if(l.hasOwnProperty(d)){var ee=l[d];if(ee!=null)switch(d){case"name":m=ee;break;case"type":S=ee;break;case"checked":L=ee;break;case"defaultChecked":$=ee;break;case"value":v=ee;break;case"defaultValue":x=ee;break;case"children":case"dangerouslySetInnerHTML":if(ee!=null)throw Error(i(137,s));break;default:Ke(r,s,d,ee,l,null)}}Sg(r,v,x,L,$,S,m,!1);return;case"select":De("invalid",r),d=S=v=null;for(m in l)if(l.hasOwnProperty(m)&&(x=l[m],x!=null))switch(m){case"value":v=x;break;case"defaultValue":S=x;break;case"multiple":d=x;default:Ke(r,s,m,x,l,null)}s=v,l=S,r.multiple=!!d,s!=null?xa(r,!!d,s,!1):l!=null&&xa(r,!!d,l,!0);return;case"textarea":De("invalid",r),v=m=d=null;for(S in l)if(l.hasOwnProperty(S)&&(x=l[S],x!=null))switch(S){case"value":d=x;break;case"defaultValue":m=x;break;case"children":v=x;break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(i(91));break;default:Ke(r,s,S,x,l,null)}kg(r,d,m,v);return;case"option":for(L in l)l.hasOwnProperty(L)&&(d=l[L],d!=null)&&(L==="selected"?r.selected=d&&typeof d!="function"&&typeof d!="symbol":Ke(r,s,L,d,l,null));return;case"dialog":De("beforetoggle",r),De("toggle",r),De("cancel",r),De("close",r);break;case"iframe":case"object":De("load",r);break;case"video":case"audio":for(d=0;d<Eo.length;d++)De(Eo[d],r);break;case"image":De("error",r),De("load",r);break;case"details":De("toggle",r);break;case"embed":case"source":case"link":De("error",r),De("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for($ in l)if(l.hasOwnProperty($)&&(d=l[$],d!=null))switch($){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:Ke(r,s,$,d,l,null)}return;default:if(md(s)){for(ee in l)l.hasOwnProperty(ee)&&(d=l[ee],d!==void 0&&tf(r,s,ee,d,l,void 0));return}}for(x in l)l.hasOwnProperty(x)&&(d=l[x],d!=null&&Ke(r,s,x,d,l,null))}function L_(r,s,l,d){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,v=null,S=null,x=null,L=null,$=null,ee=null;for(Y in l){var re=l[Y];if(l.hasOwnProperty(Y)&&re!=null)switch(Y){case"checked":break;case"value":break;case"defaultValue":L=re;default:d.hasOwnProperty(Y)||Ke(r,s,Y,null,d,re)}}for(var G in d){var Y=d[G];if(re=l[G],d.hasOwnProperty(G)&&(Y!=null||re!=null))switch(G){case"type":v=Y;break;case"name":m=Y;break;case"checked":$=Y;break;case"defaultChecked":ee=Y;break;case"value":S=Y;break;case"defaultValue":x=Y;break;case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(i(137,s));break;default:Y!==re&&Ke(r,s,G,Y,d,re)}}fd(r,S,x,L,$,ee,v,m);return;case"select":Y=S=x=G=null;for(v in l)if(L=l[v],l.hasOwnProperty(v)&&L!=null)switch(v){case"value":break;case"multiple":Y=L;default:d.hasOwnProperty(v)||Ke(r,s,v,null,d,L)}for(m in d)if(v=d[m],L=l[m],d.hasOwnProperty(m)&&(v!=null||L!=null))switch(m){case"value":G=v;break;case"defaultValue":x=v;break;case"multiple":S=v;default:v!==L&&Ke(r,s,m,v,d,L)}s=x,l=S,d=Y,G!=null?xa(r,!!l,G,!1):!!d!=!!l&&(s!=null?xa(r,!!l,s,!0):xa(r,!!l,l?[]:"",!1));return;case"textarea":Y=G=null;for(x in l)if(m=l[x],l.hasOwnProperty(x)&&m!=null&&!d.hasOwnProperty(x))switch(x){case"value":break;case"children":break;default:Ke(r,s,x,null,d,m)}for(S in d)if(m=d[S],v=l[S],d.hasOwnProperty(S)&&(m!=null||v!=null))switch(S){case"value":G=m;break;case"defaultValue":Y=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(i(91));break;default:m!==v&&Ke(r,s,S,m,d,v)}Tg(r,G,Y);return;case"option":for(var fe in l)G=l[fe],l.hasOwnProperty(fe)&&G!=null&&!d.hasOwnProperty(fe)&&(fe==="selected"?r.selected=!1:Ke(r,s,fe,null,d,G));for(L in d)G=d[L],Y=l[L],d.hasOwnProperty(L)&&G!==Y&&(G!=null||Y!=null)&&(L==="selected"?r.selected=G&&typeof G!="function"&&typeof G!="symbol":Ke(r,s,L,G,d,Y));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Te in l)G=l[Te],l.hasOwnProperty(Te)&&G!=null&&!d.hasOwnProperty(Te)&&Ke(r,s,Te,null,d,G);for($ in d)if(G=d[$],Y=l[$],d.hasOwnProperty($)&&G!==Y&&(G!=null||Y!=null))switch($){case"children":case"dangerouslySetInnerHTML":if(G!=null)throw Error(i(137,s));break;default:Ke(r,s,$,G,d,Y)}return;default:if(md(s)){for(var Je in l)G=l[Je],l.hasOwnProperty(Je)&&G!==void 0&&!d.hasOwnProperty(Je)&&tf(r,s,Je,void 0,d,G);for(ee in d)G=d[ee],Y=l[ee],!d.hasOwnProperty(ee)||G===Y||G===void 0&&Y===void 0||tf(r,s,ee,G,d,Y);return}}for(var q in l)G=l[q],l.hasOwnProperty(q)&&G!=null&&!d.hasOwnProperty(q)&&Ke(r,s,q,null,d,G);for(re in d)G=d[re],Y=l[re],!d.hasOwnProperty(re)||G===Y||G==null&&Y==null||Ke(r,s,re,G,d,Y)}function _y(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function U_(){if(typeof performance.getEntriesByType=="function"){for(var r=0,s=0,l=performance.getEntriesByType("resource"),d=0;d<l.length;d++){var m=l[d],v=m.transferSize,S=m.initiatorType,x=m.duration;if(v&&x&&_y(S)){for(S=0,x=m.responseEnd,d+=1;d<l.length;d++){var L=l[d],$=L.startTime;if($>x)break;var ee=L.transferSize,re=L.initiatorType;ee&&_y(re)&&(L=L.responseEnd,S+=ee*(L<x?1:(x-$)/(L-$)))}if(--d,s+=8*(v+S)/(m.duration/1e3),r++,10<r)break}}if(0<r)return s/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var nf=null,rf=null;function Ac(r){return r.nodeType===9?r:r.ownerDocument}function xy(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ey(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function af(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var sf=null;function B_(){var r=window.event;return r&&r.type==="popstate"?r===sf?!1:(sf=r,!0):(sf=null,!1)}var Ry=typeof setTimeout=="function"?setTimeout:void 0,z_=typeof clearTimeout=="function"?clearTimeout:void 0,Oy=typeof Promise=="function"?Promise:void 0,q_=typeof queueMicrotask=="function"?queueMicrotask:typeof Oy<"u"?function(r){return Oy.resolve(null).then(r).catch(F_)}:Ry;function F_(r){setTimeout(function(){throw r})}function yr(r){return r==="head"}function Ay(r,s){var l=s,d=0;do{var m=l.nextSibling;if(r.removeChild(l),m&&m.nodeType===8)if(l=m.data,l==="/$"||l==="/&"){if(d===0){r.removeChild(m),rs(s);return}d--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")d++;else if(l==="html")Oo(r.ownerDocument.documentElement);else if(l==="head"){l=r.ownerDocument.head,Oo(l);for(var v=l.firstChild;v;){var S=v.nextSibling,x=v.nodeName;v[Ws]||x==="SCRIPT"||x==="STYLE"||x==="LINK"&&v.rel.toLowerCase()==="stylesheet"||l.removeChild(v),v=S}}else l==="body"&&Oo(r.ownerDocument.body);l=m}while(l);rs(s)}function jy(r,s){var l=r;r=0;do{var d=l.nextSibling;if(l.nodeType===1?s?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(s?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),d&&d.nodeType===8)if(l=d.data,l==="/$"){if(r===0)break;r--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||r++;l=d}while(l)}function of(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var l=s;switch(s=s.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":of(l),dd(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}r.removeChild(l)}}function H_(r,s,l,d){for(;r.nodeType===1;){var m=l;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!d&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(d){if(!r[Ws])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(v=r.getAttribute("rel"),v==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(v!==m.rel||r.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||r.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||r.getAttribute("title")!==(m.title==null?null:m.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(v=r.getAttribute("src"),(v!==(m.src==null?null:m.src)||r.getAttribute("type")!==(m.type==null?null:m.type)||r.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&v&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var v=m.name==null?null:""+m.name;if(m.type==="hidden"&&r.getAttribute("name")===v)return r}else return r;if(r=Ln(r.nextSibling),r===null)break}return null}function V_(r,s,l){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!l||(r=Ln(r.nextSibling),r===null))return null;return r}function Py(r,s){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!s||(r=Ln(r.nextSibling),r===null))return null;return r}function lf(r){return r.data==="$?"||r.data==="$~"}function cf(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function $_(r,s){var l=r.ownerDocument;if(r.data==="$~")r._reactRetry=s;else if(r.data!=="$?"||l.readyState!=="loading")s();else{var d=function(){s(),l.removeEventListener("DOMContentLoaded",d)};l.addEventListener("DOMContentLoaded",d),r._reactRetry=d}}function Ln(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return r}var uf=null;function Dy(r){r=r.nextSibling;for(var s=0;r;){if(r.nodeType===8){var l=r.data;if(l==="/$"||l==="/&"){if(s===0)return Ln(r.nextSibling);s--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||s++}r=r.nextSibling}return null}function My(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var l=r.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(s===0)return r;s--}else l!=="/$"&&l!=="/&"||s++}r=r.previousSibling}return null}function Ny(r,s,l){switch(s=Ac(l),r){case"html":if(r=s.documentElement,!r)throw Error(i(452));return r;case"head":if(r=s.head,!r)throw Error(i(453));return r;case"body":if(r=s.body,!r)throw Error(i(454));return r;default:throw Error(i(451))}}function Oo(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);dd(r)}var Un=new Map,Iy=new Set;function jc(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Ii=K.d;K.d={f:W_,r:G_,D:K_,C:J_,L:Y_,m:Q_,X:Z_,S:X_,M:ex};function W_(){var r=Ii.f(),s=kc();return r||s}function G_(r){var s=wa(r);s!==null&&s.tag===5&&s.type==="form"?Zv(s):Ii.r(r)}var ts=typeof document>"u"?null:document;function Ly(r,s,l){var d=ts;if(d&&typeof s=="string"&&s){var m=An(s);m='link[rel="'+r+'"][href="'+m+'"]',typeof l=="string"&&(m+='[crossorigin="'+l+'"]'),Iy.has(m)||(Iy.add(m),r={rel:r,crossOrigin:l,href:s},d.querySelector(m)===null&&(s=d.createElement("link"),Bt(s,"link",r),jt(s),d.head.appendChild(s)))}}function K_(r){Ii.D(r),Ly("dns-prefetch",r,null)}function J_(r,s){Ii.C(r,s),Ly("preconnect",r,s)}function Y_(r,s,l){Ii.L(r,s,l);var d=ts;if(d&&r&&s){var m='link[rel="preload"][as="'+An(s)+'"]';s==="image"&&l&&l.imageSrcSet?(m+='[imagesrcset="'+An(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(m+='[imagesizes="'+An(l.imageSizes)+'"]')):m+='[href="'+An(r)+'"]';var v=m;switch(s){case"style":v=ns(r);break;case"script":v=is(r)}Un.has(v)||(r=y({rel:"preload",href:s==="image"&&l&&l.imageSrcSet?void 0:r,as:s},l),Un.set(v,r),d.querySelector(m)!==null||s==="style"&&d.querySelector(Ao(v))||s==="script"&&d.querySelector(jo(v))||(s=d.createElement("link"),Bt(s,"link",r),jt(s),d.head.appendChild(s)))}}function Q_(r,s){Ii.m(r,s);var l=ts;if(l&&r){var d=s&&typeof s.as=="string"?s.as:"script",m='link[rel="modulepreload"][as="'+An(d)+'"][href="'+An(r)+'"]',v=m;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=is(r)}if(!Un.has(v)&&(r=y({rel:"modulepreload",href:r},s),Un.set(v,r),l.querySelector(m)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(jo(v)))return}d=l.createElement("link"),Bt(d,"link",r),jt(d),l.head.appendChild(d)}}}function X_(r,s,l){Ii.S(r,s,l);var d=ts;if(d&&r){var m=Ca(d).hoistableStyles,v=ns(r);s=s||"default";var S=m.get(v);if(!S){var x={loading:0,preload:null};if(S=d.querySelector(Ao(v)))x.loading=5;else{r=y({rel:"stylesheet",href:r,"data-precedence":s},l),(l=Un.get(v))&&df(r,l);var L=S=d.createElement("link");jt(L),Bt(L,"link",r),L._p=new Promise(function($,ee){L.onload=$,L.onerror=ee}),L.addEventListener("load",function(){x.loading|=1}),L.addEventListener("error",function(){x.loading|=2}),x.loading|=4,Pc(S,s,d)}S={type:"stylesheet",instance:S,count:1,state:x},m.set(v,S)}}}function Z_(r,s){Ii.X(r,s);var l=ts;if(l&&r){var d=Ca(l).hoistableScripts,m=is(r),v=d.get(m);v||(v=l.querySelector(jo(m)),v||(r=y({src:r,async:!0},s),(s=Un.get(m))&&hf(r,s),v=l.createElement("script"),jt(v),Bt(v,"link",r),l.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},d.set(m,v))}}function ex(r,s){Ii.M(r,s);var l=ts;if(l&&r){var d=Ca(l).hoistableScripts,m=is(r),v=d.get(m);v||(v=l.querySelector(jo(m)),v||(r=y({src:r,async:!0,type:"module"},s),(s=Un.get(m))&&hf(r,s),v=l.createElement("script"),jt(v),Bt(v,"link",r),l.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},d.set(m,v))}}function Uy(r,s,l,d){var m=(m=_e.current)?jc(m):null;if(!m)throw Error(i(446));switch(r){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(s=ns(l.href),l=Ca(m).hoistableStyles,d=l.get(s),d||(d={type:"style",instance:null,count:0,state:null},l.set(s,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){r=ns(l.href);var v=Ca(m).hoistableStyles,S=v.get(r);if(S||(m=m.ownerDocument||m,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(r,S),(v=m.querySelector(Ao(r)))&&!v._p&&(S.instance=v,S.state.loading=5),Un.has(r)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Un.set(r,l),v||tx(m,r,l,S.state))),s&&d===null)throw Error(i(528,""));return S}if(s&&d!==null)throw Error(i(529,""));return null;case"script":return s=l.async,l=l.src,typeof l=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=is(l),l=Ca(m).hoistableScripts,d=l.get(s),d||(d={type:"script",instance:null,count:0,state:null},l.set(s,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,r))}}function ns(r){return'href="'+An(r)+'"'}function Ao(r){return'link[rel="stylesheet"]['+r+"]"}function By(r){return y({},r,{"data-precedence":r.precedence,precedence:null})}function tx(r,s,l,d){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?d.loading=1:(s=r.createElement("link"),d.preload=s,s.addEventListener("load",function(){return d.loading|=1}),s.addEventListener("error",function(){return d.loading|=2}),Bt(s,"link",l),jt(s),r.head.appendChild(s))}function is(r){return'[src="'+An(r)+'"]'}function jo(r){return"script[async]"+r}function zy(r,s,l){if(s.count++,s.instance===null)switch(s.type){case"style":var d=r.querySelector('style[data-href~="'+An(l.href)+'"]');if(d)return s.instance=d,jt(d),d;var m=y({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return d=(r.ownerDocument||r).createElement("style"),jt(d),Bt(d,"style",m),Pc(d,l.precedence,r),s.instance=d;case"stylesheet":m=ns(l.href);var v=r.querySelector(Ao(m));if(v)return s.state.loading|=4,s.instance=v,jt(v),v;d=By(l),(m=Un.get(m))&&df(d,m),v=(r.ownerDocument||r).createElement("link"),jt(v);var S=v;return S._p=new Promise(function(x,L){S.onload=x,S.onerror=L}),Bt(v,"link",d),s.state.loading|=4,Pc(v,l.precedence,r),s.instance=v;case"script":return v=is(l.src),(m=r.querySelector(jo(v)))?(s.instance=m,jt(m),m):(d=l,(m=Un.get(v))&&(d=y({},l),hf(d,m)),r=r.ownerDocument||r,m=r.createElement("script"),jt(m),Bt(m,"link",d),r.head.appendChild(m),s.instance=m);case"void":return null;default:throw Error(i(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(d=s.instance,s.state.loading|=4,Pc(d,l.precedence,r));return s.instance}function Pc(r,s,l){for(var d=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=d.length?d[d.length-1]:null,v=m,S=0;S<d.length;S++){var x=d[S];if(x.dataset.precedence===s)v=x;else if(v!==m)break}v?v.parentNode.insertBefore(r,v.nextSibling):(s=l.nodeType===9?l.head:l,s.insertBefore(r,s.firstChild))}function df(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function hf(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var Dc=null;function qy(r,s,l){if(Dc===null){var d=new Map,m=Dc=new Map;m.set(l,d)}else m=Dc,d=m.get(l),d||(d=new Map,m.set(l,d));if(d.has(r))return d;for(d.set(r,null),l=l.getElementsByTagName(r),m=0;m<l.length;m++){var v=l[m];if(!(v[Ws]||v[Nt]||r==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var S=v.getAttribute(s)||"";S=r+S;var x=d.get(S);x?x.push(v):d.set(S,[v])}}return d}function Fy(r,s,l){r=r.ownerDocument||r,r.head.insertBefore(l,s==="title"?r.querySelector("head > title"):null)}function nx(r,s,l){if(l===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(r=s.disabled,typeof s.precedence=="string"&&r==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Hy(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function ix(r,s,l,d){if(l.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var m=ns(d.href),v=s.querySelector(Ao(m));if(v){s=v._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(r.count++,r=Mc.bind(r),s.then(r,r)),l.state.loading|=4,l.instance=v,jt(v);return}v=s.ownerDocument||s,d=By(d),(m=Un.get(m))&&df(d,m),v=v.createElement("link"),jt(v);var S=v;S._p=new Promise(function(x,L){S.onload=x,S.onerror=L}),Bt(v,"link",d),l.instance=v}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(l,s),(s=l.state.preload)&&(l.state.loading&3)===0&&(r.count++,l=Mc.bind(r),s.addEventListener("load",l),s.addEventListener("error",l))}}var ff=0;function rx(r,s){return r.stylesheets&&r.count===0&&Ic(r,r.stylesheets),0<r.count||0<r.imgCount?function(l){var d=setTimeout(function(){if(r.stylesheets&&Ic(r,r.stylesheets),r.unsuspend){var v=r.unsuspend;r.unsuspend=null,v()}},6e4+s);0<r.imgBytes&&ff===0&&(ff=62500*U_());var m=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&Ic(r,r.stylesheets),r.unsuspend)){var v=r.unsuspend;r.unsuspend=null,v()}},(r.imgBytes>ff?50:800)+s);return r.unsuspend=l,function(){r.unsuspend=null,clearTimeout(d),clearTimeout(m)}}:null}function Mc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ic(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Nc=null;function Ic(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Nc=new Map,s.forEach(ax,r),Nc=null,Mc.call(r))}function ax(r,s){if(!(s.state.loading&4)){var l=Nc.get(r);if(l)var d=l.get(null);else{l=new Map,Nc.set(r,l);for(var m=r.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<m.length;v++){var S=m[v];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(l.set(S.dataset.precedence,S),d=S)}d&&l.set(null,d)}m=s.instance,S=m.getAttribute("data-precedence"),v=l.get(S)||d,v===d&&l.set(null,m),l.set(S,m),this.count++,d=Mc.bind(this),m.addEventListener("load",d),m.addEventListener("error",d),v?v.parentNode.insertBefore(m,v.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(m,r.firstChild)),s.state.loading|=4}}var Po={$$typeof:j,Provider:null,Consumer:null,_currentValue:ae,_currentValue2:ae,_threadCount:0};function sx(r,s,l,d,m,v,S,x,L){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=od(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=od(0),this.hiddenUpdates=od(null),this.identifierPrefix=d,this.onUncaughtError=m,this.onCaughtError=v,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=L,this.incompleteTransitions=new Map}function Vy(r,s,l,d,m,v,S,x,L,$,ee,re){return r=new sx(r,s,l,S,L,$,ee,re,x),s=1,v===!0&&(s|=24),v=vn(3,null,null,s),r.current=v,v.stateNode=r,s=$d(),s.refCount++,r.pooledCache=s,s.refCount++,v.memoizedState={element:d,isDehydrated:l,cache:s},Jd(v),r}function $y(r){return r?(r=Ma,r):Ma}function Wy(r,s,l,d,m,v){m=$y(m),d.context===null?d.context=m:d.pendingContext=m,d=or(s),d.payload={element:l},v=v===void 0?null:v,v!==null&&(d.callback=v),l=lr(r,d,s),l!==null&&(sn(l,r,s),co(l,r,s))}function Gy(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var l=r.retryLane;r.retryLane=l!==0&&l<s?l:s}}function pf(r,s){Gy(r,s),(r=r.alternate)&&Gy(r,s)}function Ky(r){if(r.tag===13||r.tag===31){var s=Kr(r,67108864);s!==null&&sn(s,r,67108864),pf(r,67108864)}}function Jy(r){if(r.tag===13||r.tag===31){var s=kn();s=ld(s);var l=Kr(r,s);l!==null&&sn(l,r,s),pf(r,s)}}var Lc=!0;function ox(r,s,l,d){var m=N.T;N.T=null;var v=K.p;try{K.p=2,mf(r,s,l,d)}finally{K.p=v,N.T=m}}function lx(r,s,l,d){var m=N.T;N.T=null;var v=K.p;try{K.p=8,mf(r,s,l,d)}finally{K.p=v,N.T=m}}function mf(r,s,l,d){if(Lc){var m=gf(d);if(m===null)ef(r,s,d,Uc,l),Qy(r,d);else if(ux(m,r,s,l,d))d.stopPropagation();else if(Qy(r,d),s&4&&-1<cx.indexOf(r)){for(;m!==null;){var v=wa(m);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var S=Hr(v.pendingLanes);if(S!==0){var x=v;for(x.pendingLanes|=2,x.entangledLanes|=2;S;){var L=1<<31-mn(S);x.entanglements[1]|=L,S&=~L}ui(v),(He&6)===0&&(Sc=fn()+500,xo(0))}}break;case 31:case 13:x=Kr(v,2),x!==null&&sn(x,v,2),kc(),pf(v,2)}if(v=gf(d),v===null&&ef(r,s,d,Uc,l),v===m)break;m=v}m!==null&&d.stopPropagation()}else ef(r,s,d,null,l)}}function gf(r){return r=vd(r),vf(r)}var Uc=null;function vf(r){if(Uc=null,r=ka(r),r!==null){var s=o(r);if(s===null)r=null;else{var l=s.tag;if(l===13){if(r=c(s),r!==null)return r;r=null}else if(l===31){if(r=u(s),r!==null)return r;r=null}else if(l===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return Uc=r,null}function Yy(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(K1()){case rg:return 2;case ag:return 8;case El:case J1:return 32;case sg:return 268435456;default:return 32}default:return 32}}var yf=!1,br=null,Sr=null,Tr=null,Do=new Map,Mo=new Map,kr=[],cx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Qy(r,s){switch(r){case"focusin":case"focusout":br=null;break;case"dragenter":case"dragleave":Sr=null;break;case"mouseover":case"mouseout":Tr=null;break;case"pointerover":case"pointerout":Do.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mo.delete(s.pointerId)}}function No(r,s,l,d,m,v){return r===null||r.nativeEvent!==v?(r={blockedOn:s,domEventName:l,eventSystemFlags:d,nativeEvent:v,targetContainers:[m]},s!==null&&(s=wa(s),s!==null&&Ky(s)),r):(r.eventSystemFlags|=d,s=r.targetContainers,m!==null&&s.indexOf(m)===-1&&s.push(m),r)}function ux(r,s,l,d,m){switch(s){case"focusin":return br=No(br,r,s,l,d,m),!0;case"dragenter":return Sr=No(Sr,r,s,l,d,m),!0;case"mouseover":return Tr=No(Tr,r,s,l,d,m),!0;case"pointerover":var v=m.pointerId;return Do.set(v,No(Do.get(v)||null,r,s,l,d,m)),!0;case"gotpointercapture":return v=m.pointerId,Mo.set(v,No(Mo.get(v)||null,r,s,l,d,m)),!0}return!1}function Xy(r){var s=ka(r.target);if(s!==null){var l=o(s);if(l!==null){if(s=l.tag,s===13){if(s=c(l),s!==null){r.blockedOn=s,hg(r.priority,function(){Jy(l)});return}}else if(s===31){if(s=u(l),s!==null){r.blockedOn=s,hg(r.priority,function(){Jy(l)});return}}else if(s===3&&l.stateNode.current.memoizedState.isDehydrated){r.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Bc(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var l=gf(r.nativeEvent);if(l===null){l=r.nativeEvent;var d=new l.constructor(l.type,l);gd=d,l.target.dispatchEvent(d),gd=null}else return s=wa(l),s!==null&&Ky(s),r.blockedOn=l,!1;s.shift()}return!0}function Zy(r,s,l){Bc(r)&&l.delete(s)}function dx(){yf=!1,br!==null&&Bc(br)&&(br=null),Sr!==null&&Bc(Sr)&&(Sr=null),Tr!==null&&Bc(Tr)&&(Tr=null),Do.forEach(Zy),Mo.forEach(Zy)}function zc(r,s){r.blockedOn===s&&(r.blockedOn=null,yf||(yf=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,dx)))}var qc=null;function eb(r){qc!==r&&(qc=r,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){qc===r&&(qc=null);for(var s=0;s<r.length;s+=3){var l=r[s],d=r[s+1],m=r[s+2];if(typeof d!="function"){if(vf(d||l)===null)continue;break}var v=wa(l);v!==null&&(r.splice(s,3),s-=3,mh(v,{pending:!0,data:m,method:l.method,action:d},d,m))}}))}function rs(r){function s(L){return zc(L,r)}br!==null&&zc(br,r),Sr!==null&&zc(Sr,r),Tr!==null&&zc(Tr,r),Do.forEach(s),Mo.forEach(s);for(var l=0;l<kr.length;l++){var d=kr[l];d.blockedOn===r&&(d.blockedOn=null)}for(;0<kr.length&&(l=kr[0],l.blockedOn===null);)Xy(l),l.blockedOn===null&&kr.shift();if(l=(r.ownerDocument||r).$$reactFormReplay,l!=null)for(d=0;d<l.length;d+=3){var m=l[d],v=l[d+1],S=m[Zt]||null;if(typeof v=="function")S||eb(l);else if(S){var x=null;if(v&&v.hasAttribute("formAction")){if(m=v,S=v[Zt]||null)x=S.formAction;else if(vf(m)!==null)continue}else x=S.action;typeof x=="function"?l[d+1]=x:(l.splice(d,3),d-=3),eb(l)}}}function tb(){function r(v){v.canIntercept&&v.info==="react-transition"&&v.intercept({handler:function(){return new Promise(function(S){return m=S})},focusReset:"manual",scroll:"manual"})}function s(){m!==null&&(m(),m=null),d||setTimeout(l,20)}function l(){if(!d&&!navigation.transition){var v=navigation.currentEntry;v&&v.url!=null&&navigation.navigate(v.url,{state:v.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,m=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(l,100),function(){d=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),m!==null&&(m(),m=null)}}}function bf(r){this._internalRoot=r}Fc.prototype.render=bf.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(i(409));var l=s.current,d=kn();Wy(l,d,r,s,null,null)},Fc.prototype.unmount=bf.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;Wy(r.current,2,null,r,null,null),kc(),s[Ta]=null}};function Fc(r){this._internalRoot=r}Fc.prototype.unstable_scheduleHydration=function(r){if(r){var s=dg();r={blockedOn:null,target:r,priority:s};for(var l=0;l<kr.length&&s!==0&&s<kr[l].priority;l++);kr.splice(l,0,r),l===0&&Xy(r)}};var nb=e.version;if(nb!=="19.2.3")throw Error(i(527,nb,"19.2.3"));K.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(i(188)):(r=Object.keys(r).join(","),Error(i(268,r)));return r=f(s),r=r!==null?p(r):null,r=r===null?null:r.stateNode,r};var hx={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:N,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hc.isDisabled&&Hc.supportsFiber)try{Hs=Hc.inject(hx),pn=Hc}catch{}}return Lo.createRoot=function(r,s){if(!a(r))throw Error(i(299));var l=!1,d="",m=c0,v=u0,S=d0;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onUncaughtError!==void 0&&(m=s.onUncaughtError),s.onCaughtError!==void 0&&(v=s.onCaughtError),s.onRecoverableError!==void 0&&(S=s.onRecoverableError)),s=Vy(r,1,!1,null,null,l,d,null,m,v,S,tb),r[Ta]=s.current,Zh(r),new bf(s)},Lo.hydrateRoot=function(r,s,l){if(!a(r))throw Error(i(299));var d=!1,m="",v=c0,S=u0,x=d0,L=null;return l!=null&&(l.unstable_strictMode===!0&&(d=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onUncaughtError!==void 0&&(v=l.onUncaughtError),l.onCaughtError!==void 0&&(S=l.onCaughtError),l.onRecoverableError!==void 0&&(x=l.onRecoverableError),l.formState!==void 0&&(L=l.formState)),s=Vy(r,1,!0,s,l??null,d,m,L,v,S,x,tb),s.context=$y(null),l=s.current,d=kn(),d=ld(d),m=or(d),m.callback=null,lr(l,m,d),l=d,s.current.lanes=l,$s(s,l),ui(s),r[Ta]=s.current,Zh(r),new Fc(s)},Lo.version="19.2.3",Lo}var Ib;function rR(){if(Ib)return jf.exports;Ib=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),jf.exports=iR(),jf.exports}var aR=rR();const sR=_T(aR);var Lb="popstate";function oR(n={}){function e(i,a){let{pathname:o,search:c,hash:u}=i.location;return bp("",{pathname:o,search:c,hash:u},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function t(i,a){return typeof a=="string"?a:cl(a)}return cR(e,t,null,n)}function ct(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function En(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function lR(){return Math.random().toString(36).substring(2,10)}function Ub(n,e){return{usr:n.state,key:n.key,idx:e}}function bp(n,e,t=null,i){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?Bs(e):e,state:t,key:e&&e.key||i||lR()}}function cl({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function Bs(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substring(i),n=n.substring(0,i)),n&&(e.pathname=n)}return e}function cR(n,e,t,i={}){let{window:a=document.defaultView,v5Compat:o=!1}=i,c=a.history,u="POP",h=null,f=p();f==null&&(f=0,c.replaceState({...c.state,idx:f},""));function p(){return(c.state||{idx:null}).idx}function y(){u="POP";let O=p(),R=O==null?null:O-f;f=O,h&&h({action:u,location:w.location,delta:R})}function b(O,R){u="PUSH";let P=bp(w.location,O,R);f=p()+1;let j=Ub(P,f),E=w.createHref(P);try{c.pushState(j,"",E)}catch(_){if(_ instanceof DOMException&&_.name==="DataCloneError")throw _;a.location.assign(E)}o&&h&&h({action:u,location:w.location,delta:1})}function k(O,R){u="REPLACE";let P=bp(w.location,O,R);f=p();let j=Ub(P,f),E=w.createHref(P);c.replaceState(j,"",E),o&&h&&h({action:u,location:w.location,delta:0})}function C(O){return uR(O)}let w={get action(){return u},get location(){return n(a,c)},listen(O){if(h)throw new Error("A history only accepts one active listener");return a.addEventListener(Lb,y),h=O,()=>{a.removeEventListener(Lb,y),h=null}},createHref(O){return e(a,O)},createURL:C,encodeLocation(O){let R=C(O);return{pathname:R.pathname,search:R.search,hash:R.hash}},push:b,replace:k,go(O){return c.go(O)}};return w}function uR(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),ct(t,"No window.location.(origin|href) available to create URL");let i=typeof n=="string"?n:cl(n);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=t+i),new URL(i,t)}function WT(n,e,t="/"){return dR(n,e,t,!1)}function dR(n,e,t,i){let a=typeof e=="string"?Bs(e):e,o=Wi(a.pathname||"/",t);if(o==null)return null;let c=GT(n);hR(c);let u=null;for(let h=0;u==null&&h<c.length;++h){let f=wR(o);u=TR(c[h],f,i)}return u}function GT(n,e=[],t=[],i="",a=!1){let o=(c,u,h=a,f)=>{let p={relativePath:f===void 0?c.path||"":f,caseSensitive:c.caseSensitive===!0,childrenIndex:u,route:c};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(i)&&h)return;ct(p.relativePath.startsWith(i),`Absolute route path "${p.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(i.length)}let y=$i([i,p.relativePath]),b=t.concat(p);c.children&&c.children.length>0&&(ct(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${y}".`),GT(c.children,e,b,y,h)),!(c.path==null&&!c.index)&&e.push({path:y,score:bR(y,c.index),routesMeta:b})};return n.forEach((c,u)=>{if(c.path===""||!c.path?.includes("?"))o(c,u);else for(let h of KT(c.path))o(c,u,!0,h)}),e}function KT(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,a=t.endsWith("?"),o=t.replace(/\?$/,"");if(i.length===0)return a?[o,""]:[o];let c=KT(i.join("/")),u=[];return u.push(...c.map(h=>h===""?o:[o,h].join("/"))),a&&u.push(...c),u.map(h=>n.startsWith("/")&&h===""?"/":h)}function hR(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:SR(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var fR=/^:[\w-]+$/,pR=3,mR=2,gR=1,vR=10,yR=-2,Bb=n=>n==="*";function bR(n,e){let t=n.split("/"),i=t.length;return t.some(Bb)&&(i+=yR),e&&(i+=mR),t.filter(a=>!Bb(a)).reduce((a,o)=>a+(fR.test(o)?pR:o===""?gR:vR),i)}function SR(n,e){return n.length===e.length&&n.slice(0,-1).every((i,a)=>i===e[a])?n[n.length-1]-e[e.length-1]:0}function TR(n,e,t=!1){let{routesMeta:i}=n,a={},o="/",c=[];for(let u=0;u<i.length;++u){let h=i[u],f=u===i.length-1,p=o==="/"?e:e.slice(o.length)||"/",y=ku({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},p),b=h.route;if(!y&&f&&t&&!i[i.length-1].route.index&&(y=ku({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!y)return null;Object.assign(a,y.params),c.push({params:a,pathname:$i([o,y.pathname]),pathnameBase:ER($i([o,y.pathnameBase])),route:b}),y.pathnameBase!=="/"&&(o=$i([o,y.pathnameBase]))}return c}function ku(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=kR(n.path,n.caseSensitive,n.end),a=e.match(t);if(!a)return null;let o=a[0],c=o.replace(/(.)\/+$/,"$1"),u=a.slice(1);return{params:i.reduce((f,{paramName:p,isOptional:y},b)=>{if(p==="*"){let C=u[b]||"";c=o.slice(0,o.length-C.length).replace(/(.)\/+$/,"$1")}const k=u[b];return y&&!k?f[p]=void 0:f[p]=(k||"").replace(/%2F/g,"/"),f},{}),pathname:o,pathnameBase:c,pattern:n}}function kR(n,e=!1,t=!0){En(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let i=[],a="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,u,h)=>(i.push({paramName:u,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(i.push({paramName:"*"}),a+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?a+="\\/*$":n!==""&&n!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),i]}function wR(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return En(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Wi(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}var JT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,CR=n=>JT.test(n);function _R(n,e="/"){let{pathname:t,search:i="",hash:a=""}=typeof n=="string"?Bs(n):n,o;if(t)if(CR(t))o=t;else{if(t.includes("//")){let c=t;t=t.replace(/\/\/+/g,"/"),En(!1,`Pathnames cannot have embedded double slashes - normalizing ${c} -> ${t}`)}t.startsWith("/")?o=zb(t.substring(1),"/"):o=zb(t,e)}else o=e;return{pathname:o,search:RR(i),hash:OR(a)}}function zb(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(a=>{a===".."?t.length>1&&t.pop():a!=="."&&t.push(a)}),t.length>1?t.join("/"):"/"}function Nf(n,e,t,i){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function xR(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function um(n){let e=xR(n);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function dm(n,e,t,i=!1){let a;typeof n=="string"?a=Bs(n):(a={...n},ct(!a.pathname||!a.pathname.includes("?"),Nf("?","pathname","search",a)),ct(!a.pathname||!a.pathname.includes("#"),Nf("#","pathname","hash",a)),ct(!a.search||!a.search.includes("#"),Nf("#","search","hash",a)));let o=n===""||a.pathname==="",c=o?"/":a.pathname,u;if(c==null)u=t;else{let y=e.length-1;if(!i&&c.startsWith("..")){let b=c.split("/");for(;b[0]==="..";)b.shift(),y-=1;a.pathname=b.join("/")}u=y>=0?e[y]:"/"}let h=_R(a,u),f=c&&c!=="/"&&c.endsWith("/"),p=(o||c===".")&&t.endsWith("/");return!h.pathname.endsWith("/")&&(f||p)&&(h.pathname+="/"),h}var $i=n=>n.join("/").replace(/\/\/+/g,"/"),ER=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),RR=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,OR=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,AR=class{constructor(n,e,t,i=!1){this.status=n,this.statusText=e||"",this.internal=i,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function jR(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}function PR(n){return n.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var YT=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function QT(n,e){let t=n;if(typeof t!="string"||!JT.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let i=t,a=!1;if(YT)try{let o=new URL(window.location.href),c=t.startsWith("//")?new URL(o.protocol+t):new URL(t),u=Wi(c.pathname,e);c.origin===o.origin&&u!=null?t=u+c.search+c.hash:a=!0}catch{En(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:i,isExternal:a,to:t}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var XT=["POST","PUT","PATCH","DELETE"];new Set(XT);var DR=["GET",...XT];new Set(DR);var zs=T.createContext(null);zs.displayName="DataRouter";var qu=T.createContext(null);qu.displayName="DataRouterState";var MR=T.createContext(!1),ZT=T.createContext({isTransitioning:!1});ZT.displayName="ViewTransition";var NR=T.createContext(new Map);NR.displayName="Fetchers";var IR=T.createContext(null);IR.displayName="Await";var Rn=T.createContext(null);Rn.displayName="Navigation";var Sl=T.createContext(null);Sl.displayName="Location";var Fn=T.createContext({outlet:null,matches:[],isDataRoute:!1});Fn.displayName="Route";var hm=T.createContext(null);hm.displayName="RouteError";var ek="REACT_ROUTER_ERROR",LR="REDIRECT",UR="ROUTE_ERROR_RESPONSE";function BR(n){if(n.startsWith(`${ek}:${LR}:{`))try{let e=JSON.parse(n.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function zR(n){if(n.startsWith(`${ek}:${UR}:{`))try{let e=JSON.parse(n.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new AR(e.status,e.statusText,e.data)}catch{}}function qR(n,{relative:e}={}){ct(qs(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=T.useContext(Rn),{hash:a,pathname:o,search:c}=Tl(n,{relative:e}),u=o;return t!=="/"&&(u=o==="/"?t:$i([t,o])),i.createHref({pathname:u,search:c,hash:a})}function qs(){return T.useContext(Sl)!=null}function Hn(){return ct(qs(),"useLocation() may be used only in the context of a <Router> component."),T.useContext(Sl).location}var tk="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function nk(n){T.useContext(Rn).static||T.useLayoutEffect(n)}function Qt(){let{isDataRoute:n}=T.useContext(Fn);return n?n2():FR()}function FR(){ct(qs(),"useNavigate() may be used only in the context of a <Router> component.");let n=T.useContext(zs),{basename:e,navigator:t}=T.useContext(Rn),{matches:i}=T.useContext(Fn),{pathname:a}=Hn(),o=JSON.stringify(um(i)),c=T.useRef(!1);return nk(()=>{c.current=!0}),T.useCallback((h,f={})=>{if(En(c.current,tk),!c.current)return;if(typeof h=="number"){t.go(h);return}let p=dm(h,JSON.parse(o),a,f.relative==="path");n==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:$i([e,p.pathname])),(f.replace?t.replace:t.push)(p,f.state,f)},[e,t,o,a,n])}var HR=T.createContext(null);function VR(n){let e=T.useContext(Fn).outlet;return T.useMemo(()=>e&&T.createElement(HR.Provider,{value:n},e),[e,n])}function Yi(){let{matches:n}=T.useContext(Fn),e=n[n.length-1];return e?e.params:{}}function Tl(n,{relative:e}={}){let{matches:t}=T.useContext(Fn),{pathname:i}=Hn(),a=JSON.stringify(um(t));return T.useMemo(()=>dm(n,JSON.parse(a),i,e==="path"),[n,a,i,e])}function $R(n,e){return ik(n,e)}function ik(n,e,t,i,a){ct(qs(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=T.useContext(Rn),{matches:c}=T.useContext(Fn),u=c[c.length-1],h=u?u.params:{},f=u?u.pathname:"/",p=u?u.pathnameBase:"/",y=u&&u.route;{let P=y&&y.path||"";ak(f,!y||P.endsWith("*")||P.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${P}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${P}"> to <Route path="${P==="/"?"*":`${P}/*`}">.`)}let b=Hn(),k;if(e){let P=typeof e=="string"?Bs(e):e;ct(p==="/"||P.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${P.pathname}" was given in the \`location\` prop.`),k=P}else k=b;let C=k.pathname||"/",w=C;if(p!=="/"){let P=p.replace(/^\//,"").split("/");w="/"+C.replace(/^\//,"").split("/").slice(P.length).join("/")}let O=WT(n,{pathname:w});En(y||O!=null,`No routes matched location "${k.pathname}${k.search}${k.hash}" `),En(O==null||O[O.length-1].route.element!==void 0||O[O.length-1].route.Component!==void 0||O[O.length-1].route.lazy!==void 0,`Matched leaf route at location "${k.pathname}${k.search}${k.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let R=YR(O&&O.map(P=>Object.assign({},P,{params:Object.assign({},h,P.params),pathname:$i([p,o.encodeLocation?o.encodeLocation(P.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:P.pathname]),pathnameBase:P.pathnameBase==="/"?p:$i([p,o.encodeLocation?o.encodeLocation(P.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:P.pathnameBase])})),c,t,i,a);return e&&R?T.createElement(Sl.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...k},navigationType:"POP"}},R):R}function WR(){let n=t2(),e=jR(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:i},o={padding:"2px 4px",backgroundColor:i},c=null;return console.error("Error handled by React Router default ErrorBoundary:",n),c=T.createElement(T.Fragment,null,T.createElement("p",null," Hey developer "),T.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",T.createElement("code",{style:o},"ErrorBoundary")," or"," ",T.createElement("code",{style:o},"errorElement")," prop on your route.")),T.createElement(T.Fragment,null,T.createElement("h2",null,"Unexpected Application Error!"),T.createElement("h3",{style:{fontStyle:"italic"}},e),t?T.createElement("pre",{style:a},t):null,c)}var GR=T.createElement(WR,null),rk=class extends T.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.onError?this.props.onError(n,e):console.error("React Router caught the following error during render",n)}render(){let n=this.state.error;if(this.context&&typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){const t=zR(n.digest);t&&(n=t)}let e=n!==void 0?T.createElement(Fn.Provider,{value:this.props.routeContext},T.createElement(hm.Provider,{value:n,children:this.props.component})):this.props.children;return this.context?T.createElement(KR,{error:n},e):e}};rk.contextType=MR;var If=new WeakMap;function KR({children:n,error:e}){let{basename:t}=T.useContext(Rn);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let i=BR(e.digest);if(i){let a=If.get(e);if(a)throw a;let o=QT(i.location,t);if(YT&&!If.get(e))if(o.isExternal||i.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const c=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:i.replace}));throw If.set(e,c),c}return T.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return n}function JR({routeContext:n,match:e,children:t}){let i=T.useContext(zs);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),T.createElement(Fn.Provider,{value:n},t)}function YR(n,e=[],t=null,i=null,a=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,c=t?.errors;if(c!=null){let p=o.findIndex(y=>y.route.id&&c?.[y.route.id]!==void 0);ct(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),o=o.slice(0,Math.min(o.length,p+1))}let u=!1,h=-1;if(t)for(let p=0;p<o.length;p++){let y=o[p];if((y.route.HydrateFallback||y.route.hydrateFallbackElement)&&(h=p),y.route.id){let{loaderData:b,errors:k}=t,C=y.route.loader&&!b.hasOwnProperty(y.route.id)&&(!k||k[y.route.id]===void 0);if(y.route.lazy||C){u=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let f=t&&i?(p,y)=>{i(p,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:PR(t.matches),errorInfo:y})}:void 0;return o.reduceRight((p,y,b)=>{let k,C=!1,w=null,O=null;t&&(k=c&&y.route.id?c[y.route.id]:void 0,w=y.route.errorElement||GR,u&&(h<0&&b===0?(ak("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),C=!0,O=null):h===b&&(C=!0,O=y.route.hydrateFallbackElement||null)));let R=e.concat(o.slice(0,b+1)),P=()=>{let j;return k?j=w:C?j=O:y.route.Component?j=T.createElement(y.route.Component,null):y.route.element?j=y.route.element:j=p,T.createElement(JR,{match:y,routeContext:{outlet:p,matches:R,isDataRoute:t!=null},children:j})};return t&&(y.route.ErrorBoundary||y.route.errorElement||b===0)?T.createElement(rk,{location:t.location,revalidation:t.revalidation,component:w,error:k,children:P(),routeContext:{outlet:null,matches:R,isDataRoute:!0},onError:f}):P()},null)}function fm(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function QR(n){let e=T.useContext(zs);return ct(e,fm(n)),e}function XR(n){let e=T.useContext(qu);return ct(e,fm(n)),e}function ZR(n){let e=T.useContext(Fn);return ct(e,fm(n)),e}function pm(n){let e=ZR(n),t=e.matches[e.matches.length-1];return ct(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function e2(){return pm("useRouteId")}function t2(){let n=T.useContext(hm),e=XR("useRouteError"),t=pm("useRouteError");return n!==void 0?n:e.errors?.[t]}function n2(){let{router:n}=QR("useNavigate"),e=pm("useNavigate"),t=T.useRef(!1);return nk(()=>{t.current=!0}),T.useCallback(async(a,o={})=>{En(t.current,tk),t.current&&(typeof a=="number"?await n.navigate(a):await n.navigate(a,{fromRouteId:e,...o}))},[n,e])}var qb={};function ak(n,e,t){!e&&!qb[n]&&(qb[n]=!0,En(!1,t))}T.memo(i2);function i2({routes:n,future:e,state:t,onError:i}){return ik(n,void 0,t,i,e)}function Sp({to:n,replace:e,state:t,relative:i}){ct(qs(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=T.useContext(Rn);En(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=T.useContext(Fn),{pathname:c}=Hn(),u=Qt(),h=dm(n,um(o),c,i==="path"),f=JSON.stringify(h);return T.useEffect(()=>{u(JSON.parse(f),{replace:e,state:t,relative:i})},[u,f,i,e,t]),null}function r2(n){return VR(n.context)}function Ze(n){ct(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function a2({basename:n="/",children:e=null,location:t,navigationType:i="POP",navigator:a,static:o=!1,unstable_useTransitions:c}){ct(!qs(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let u=n.replace(/^\/*/,"/"),h=T.useMemo(()=>({basename:u,navigator:a,static:o,unstable_useTransitions:c,future:{}}),[u,a,o,c]);typeof t=="string"&&(t=Bs(t));let{pathname:f="/",search:p="",hash:y="",state:b=null,key:k="default"}=t,C=T.useMemo(()=>{let w=Wi(f,u);return w==null?null:{location:{pathname:w,search:p,hash:y,state:b,key:k},navigationType:i}},[u,f,p,y,b,k,i]);return En(C!=null,`<Router basename="${u}"> is not able to match the URL "${f}${p}${y}" because it does not start with the basename, so the <Router> won't render anything.`),C==null?null:T.createElement(Rn.Provider,{value:h},T.createElement(Sl.Provider,{children:e,value:C}))}function s2({children:n,location:e}){return $R(Tp(n),e)}function Tp(n,e=[]){let t=[];return T.Children.forEach(n,(i,a)=>{if(!T.isValidElement(i))return;let o=[...e,a];if(i.type===T.Fragment){t.push.apply(t,Tp(i.props.children,o));return}ct(i.type===Ze,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ct(!i.props.index||!i.props.children,"An index route cannot have child routes.");let c={id:i.props.id||o.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(c.children=Tp(i.props.children,o)),t.push(c)}),t}var nu="get",iu="application/x-www-form-urlencoded";function Fu(n){return typeof HTMLElement<"u"&&n instanceof HTMLElement}function o2(n){return Fu(n)&&n.tagName.toLowerCase()==="button"}function l2(n){return Fu(n)&&n.tagName.toLowerCase()==="form"}function c2(n){return Fu(n)&&n.tagName.toLowerCase()==="input"}function u2(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function d2(n,e){return n.button===0&&(!e||e==="_self")&&!u2(n)}function kp(n=""){return new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((e,t)=>{let i=n[t];return e.concat(Array.isArray(i)?i.map(a=>[t,a]):[[t,i]])},[]))}function h2(n,e){let t=kp(n);return e&&e.forEach((i,a)=>{t.has(a)||e.getAll(a).forEach(o=>{t.append(a,o)})}),t}var Kc=null;function f2(){if(Kc===null)try{new FormData(document.createElement("form"),0),Kc=!1}catch{Kc=!0}return Kc}var p2=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Lf(n){return n!=null&&!p2.has(n)?(En(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${iu}"`),null):n}function m2(n,e){let t,i,a,o,c;if(l2(n)){let u=n.getAttribute("action");i=u?Wi(u,e):null,t=n.getAttribute("method")||nu,a=Lf(n.getAttribute("enctype"))||iu,o=new FormData(n)}else if(o2(n)||c2(n)&&(n.type==="submit"||n.type==="image")){let u=n.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=n.getAttribute("formaction")||u.getAttribute("action");if(i=h?Wi(h,e):null,t=n.getAttribute("formmethod")||u.getAttribute("method")||nu,a=Lf(n.getAttribute("formenctype"))||Lf(u.getAttribute("enctype"))||iu,o=new FormData(u,n),!f2()){let{name:f,type:p,value:y}=n;if(p==="image"){let b=f?`${f}.`:"";o.append(`${b}x`,"0"),o.append(`${b}y`,"0")}else f&&o.append(f,y)}}else{if(Fu(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=nu,i=null,a=iu,c=n}return o&&a==="text/plain"&&(c=o,o=void 0),{action:i,method:t.toLowerCase(),encType:a,formData:o,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function mm(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function g2(n,e,t,i){let a=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return t?a.pathname.endsWith("/")?a.pathname=`${a.pathname}_.${i}`:a.pathname=`${a.pathname}.${i}`:a.pathname==="/"?a.pathname=`_root.${i}`:e&&Wi(a.pathname,e)==="/"?a.pathname=`${e.replace(/\/$/,"")}/_root.${i}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${i}`,a}async function v2(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function y2(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function b2(n,e,t){let i=await Promise.all(n.map(async a=>{let o=e.routes[a.route.id];if(o){let c=await v2(o,t);return c.links?c.links():[]}return[]}));return w2(i.flat(1).filter(y2).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function Fb(n,e,t,i,a,o){let c=(h,f)=>t[f]?h.route.id!==t[f].route.id:!0,u=(h,f)=>t[f].pathname!==h.pathname||t[f].route.path?.endsWith("*")&&t[f].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,f)=>c(h,f)||u(h,f)):o==="data"?e.filter((h,f)=>{let p=i.routes[h.route.id];if(!p||!p.hasLoader)return!1;if(c(h,f)||u(h,f))return!0;if(h.route.shouldRevalidate){let y=h.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof y=="boolean")return y}return!0}):[]}function S2(n,e,{includeHydrateFallback:t}={}){return T2(n.map(i=>{let a=e.routes[i.route.id];if(!a)return[];let o=[a.module];return a.clientActionModule&&(o=o.concat(a.clientActionModule)),a.clientLoaderModule&&(o=o.concat(a.clientLoaderModule)),t&&a.hydrateFallbackModule&&(o=o.concat(a.hydrateFallbackModule)),a.imports&&(o=o.concat(a.imports)),o}).flat(1))}function T2(n){return[...new Set(n)]}function k2(n){let e={},t=Object.keys(n).sort();for(let i of t)e[i]=n[i];return e}function w2(n,e){let t=new Set;return new Set(e),n.reduce((i,a)=>{let o=JSON.stringify(k2(a));return t.has(o)||(t.add(o),i.push({key:o,link:a})),i},[])}function sk(){let n=T.useContext(zs);return mm(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function C2(){let n=T.useContext(qu);return mm(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var gm=T.createContext(void 0);gm.displayName="FrameworkContext";function ok(){let n=T.useContext(gm);return mm(n,"You must render this element inside a <HydratedRouter> element"),n}function _2(n,e){let t=T.useContext(gm),[i,a]=T.useState(!1),[o,c]=T.useState(!1),{onFocus:u,onBlur:h,onMouseEnter:f,onMouseLeave:p,onTouchStart:y}=e,b=T.useRef(null);T.useEffect(()=>{if(n==="render"&&c(!0),n==="viewport"){let w=R=>{R.forEach(P=>{c(P.isIntersecting)})},O=new IntersectionObserver(w,{threshold:.5});return b.current&&O.observe(b.current),()=>{O.disconnect()}}},[n]),T.useEffect(()=>{if(i){let w=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(w)}}},[i]);let k=()=>{a(!0)},C=()=>{a(!1),c(!1)};return t?n!=="intent"?[o,b,{}]:[o,b,{onFocus:Uo(u,k),onBlur:Uo(h,C),onMouseEnter:Uo(f,k),onMouseLeave:Uo(p,C),onTouchStart:Uo(y,k)}]:[!1,b,{}]}function Uo(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function x2({page:n,...e}){let{router:t}=sk(),i=T.useMemo(()=>WT(t.routes,n,t.basename),[t.routes,n,t.basename]);return i?T.createElement(R2,{page:n,matches:i,...e}):null}function E2(n){let{manifest:e,routeModules:t}=ok(),[i,a]=T.useState([]);return T.useEffect(()=>{let o=!1;return b2(n,e,t).then(c=>{o||a(c)}),()=>{o=!0}},[n,e,t]),i}function R2({page:n,matches:e,...t}){let i=Hn(),{future:a,manifest:o,routeModules:c}=ok(),{basename:u}=sk(),{loaderData:h,matches:f}=C2(),p=T.useMemo(()=>Fb(n,e,f,o,i,"data"),[n,e,f,o,i]),y=T.useMemo(()=>Fb(n,e,f,o,i,"assets"),[n,e,f,o,i]),b=T.useMemo(()=>{if(n===i.pathname+i.search+i.hash)return[];let w=new Set,O=!1;if(e.forEach(P=>{let j=o.routes[P.route.id];!j||!j.hasLoader||(!p.some(E=>E.route.id===P.route.id)&&P.route.id in h&&c[P.route.id]?.shouldRevalidate||j.hasClientLoader?O=!0:w.add(P.route.id))}),w.size===0)return[];let R=g2(n,u,a.unstable_trailingSlashAwareDataRequests,"data");return O&&w.size>0&&R.searchParams.set("_routes",e.filter(P=>w.has(P.route.id)).map(P=>P.route.id).join(",")),[R.pathname+R.search]},[u,a.unstable_trailingSlashAwareDataRequests,h,i,o,p,e,n,c]),k=T.useMemo(()=>S2(y,o),[y,o]),C=E2(y);return T.createElement(T.Fragment,null,b.map(w=>T.createElement("link",{key:w,rel:"prefetch",as:"fetch",href:w,...t})),k.map(w=>T.createElement("link",{key:w,rel:"modulepreload",href:w,...t})),C.map(({key:w,link:O})=>T.createElement("link",{key:w,nonce:t.nonce,...O})))}function O2(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var A2=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{A2&&(window.__reactRouterVersion="7.12.0")}catch{}function j2({basename:n,children:e,unstable_useTransitions:t,window:i}){let a=T.useRef();a.current==null&&(a.current=oR({window:i,v5Compat:!0}));let o=a.current,[c,u]=T.useState({action:o.action,location:o.location}),h=T.useCallback(f=>{t===!1?u(f):T.startTransition(()=>u(f))},[t]);return T.useLayoutEffect(()=>o.listen(h),[o,h]),T.createElement(a2,{basename:n,children:e,location:c.location,navigationType:c.action,navigator:o,unstable_useTransitions:t})}var lk=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ri=T.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:a,reloadDocument:o,replace:c,state:u,target:h,to:f,preventScrollReset:p,viewTransition:y,unstable_defaultShouldRevalidate:b,...k},C){let{basename:w,unstable_useTransitions:O}=T.useContext(Rn),R=typeof f=="string"&&lk.test(f),P=QT(f,w);f=P.to;let j=qR(f,{relative:a}),[E,_,A]=_2(i,k),I=N2(f,{replace:c,state:u,target:h,preventScrollReset:p,relative:a,viewTransition:y,unstable_defaultShouldRevalidate:b,unstable_useTransitions:O});function F(z){e&&e(z),z.defaultPrevented||I(z)}let B=T.createElement("a",{...k,...A,href:P.absoluteURL||j,onClick:P.isExternal||o?e:F,ref:O2(C,_),target:h,"data-discover":!R&&t==="render"?"true":void 0});return E&&!R?T.createElement(T.Fragment,null,B,T.createElement(x2,{page:j})):B});ri.displayName="Link";var P2=T.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:a=!1,style:o,to:c,viewTransition:u,children:h,...f},p){let y=Tl(c,{relative:f.relative}),b=Hn(),k=T.useContext(qu),{navigator:C,basename:w}=T.useContext(Rn),O=k!=null&&z2(y)&&u===!0,R=C.encodeLocation?C.encodeLocation(y).pathname:y.pathname,P=b.pathname,j=k&&k.navigation&&k.navigation.location?k.navigation.location.pathname:null;t||(P=P.toLowerCase(),j=j?j.toLowerCase():null,R=R.toLowerCase()),j&&w&&(j=Wi(j,w)||j);const E=R!=="/"&&R.endsWith("/")?R.length-1:R.length;let _=P===R||!a&&P.startsWith(R)&&P.charAt(E)==="/",A=j!=null&&(j===R||!a&&j.startsWith(R)&&j.charAt(R.length)==="/"),I={isActive:_,isPending:A,isTransitioning:O},F=_?e:void 0,B;typeof i=="function"?B=i(I):B=[i,_?"active":null,A?"pending":null,O?"transitioning":null].filter(Boolean).join(" ");let z=typeof o=="function"?o(I):o;return T.createElement(ri,{...f,"aria-current":F,className:B,ref:p,style:z,to:c,viewTransition:u},typeof h=="function"?h(I):h)});P2.displayName="NavLink";var D2=T.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:a,state:o,method:c=nu,action:u,onSubmit:h,relative:f,preventScrollReset:p,viewTransition:y,unstable_defaultShouldRevalidate:b,...k},C)=>{let{unstable_useTransitions:w}=T.useContext(Rn),O=U2(),R=B2(u,{relative:f}),P=c.toLowerCase()==="get"?"get":"post",j=typeof u=="string"&&lk.test(u),E=_=>{if(h&&h(_),_.defaultPrevented)return;_.preventDefault();let A=_.nativeEvent.submitter,I=A?.getAttribute("formmethod")||c,F=()=>O(A||_.currentTarget,{fetcherKey:e,method:I,navigate:t,replace:a,state:o,relative:f,preventScrollReset:p,viewTransition:y,unstable_defaultShouldRevalidate:b});w&&t!==!1?T.startTransition(()=>F()):F()};return T.createElement("form",{ref:C,method:P,action:R,onSubmit:i?h:E,...k,"data-discover":!j&&n==="render"?"true":void 0})});D2.displayName="Form";function M2(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ck(n){let e=T.useContext(zs);return ct(e,M2(n)),e}function N2(n,{target:e,replace:t,state:i,preventScrollReset:a,relative:o,viewTransition:c,unstable_defaultShouldRevalidate:u,unstable_useTransitions:h}={}){let f=Qt(),p=Hn(),y=Tl(n,{relative:o});return T.useCallback(b=>{if(d2(b,e)){b.preventDefault();let k=t!==void 0?t:cl(p)===cl(y),C=()=>f(n,{replace:k,state:i,preventScrollReset:a,relative:o,viewTransition:c,unstable_defaultShouldRevalidate:u});h?T.startTransition(()=>C()):C()}},[p,f,y,t,i,e,n,a,o,c,u,h])}function uk(n){En(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=T.useRef(kp(n)),t=T.useRef(!1),i=Hn(),a=T.useMemo(()=>h2(i.search,t.current?null:e.current),[i.search]),o=Qt(),c=T.useCallback((u,h)=>{const f=kp(typeof u=="function"?u(new URLSearchParams(a)):u);t.current=!0,o("?"+f,h)},[o,a]);return[a,c]}var I2=0,L2=()=>`__${String(++I2)}__`;function U2(){let{router:n}=ck("useSubmit"),{basename:e}=T.useContext(Rn),t=e2(),i=n.fetch,a=n.navigate;return T.useCallback(async(o,c={})=>{let{action:u,method:h,encType:f,formData:p,body:y}=m2(o,e);if(c.navigate===!1){let b=c.fetcherKey||L2();await i(b,t,c.action||u,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:p,body:y,formMethod:c.method||h,formEncType:c.encType||f,flushSync:c.flushSync})}else await a(c.action||u,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:p,body:y,formMethod:c.method||h,formEncType:c.encType||f,replace:c.replace,state:c.state,fromRouteId:t,flushSync:c.flushSync,viewTransition:c.viewTransition})},[i,a,e,t])}function B2(n,{relative:e}={}){let{basename:t}=T.useContext(Rn),i=T.useContext(Fn);ct(i,"useFormAction must be used inside a RouteContext");let[a]=i.matches.slice(-1),o={...Tl(n||".",{relative:e})},c=Hn();if(n==null){o.search=c.search;let u=new URLSearchParams(o.search),h=u.getAll("index");if(h.some(p=>p==="")){u.delete("index"),h.filter(y=>y).forEach(y=>u.append("index",y));let p=u.toString();o.search=p?`?${p}`:""}}return(!n||n===".")&&a.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(o.pathname=o.pathname==="/"?t:$i([t,o.pathname])),cl(o)}function z2(n,{relative:e}={}){let t=T.useContext(ZT);ct(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=ck("useViewTransitionState"),a=Tl(n,{relative:e});if(!t.isTransitioning)return!1;let o=Wi(t.currentLocation.pathname,i)||t.currentLocation.pathname,c=Wi(t.nextLocation.pathname,i)||t.nextLocation.pathname;return ku(a.pathname,c)!=null||ku(a.pathname,o)!=null}const wu=[{id:"creator",label:"Creator",subtitle:"Build  Remix  Demo  Commerce",cities:[{id:"projects",label:"Projects"},{id:"demos",label:"Demos"},{id:"commerce",label:"Commerce"}]},{id:"career",label:"Career",subtitle:"Timeline  Evidence  Reputation",cities:[{id:"timeline",label:"Timeline"},{id:"evidence",label:"Evidence"},{id:"reputation",label:"Reputation"}]},{id:"vehicles",label:"Vehicles",subtitle:"Intake  Service  Disputes",cities:[{id:"intake",label:"Intake"},{id:"service-history",label:"Service History"},{id:"disputes",label:"Disputes"}]},{id:"education",label:"Education",subtitle:"Presence  Submissions  Reviews",cities:[{id:"submissions",label:"Submissions"},{id:"reviews",label:"Reviews"},{id:"attendance",label:"Attendance"}]},{id:"safety",label:"Safety & Identity",subtitle:"Age Anchor  Shield Events",cities:[{id:"age-anchor",label:"Age Anchor"},{id:"shield-events",label:"Shield Events"},{id:"trusted-circle",label:"Trusted Circle"}]},{id:"payments",label:"Payments",subtitle:"Pre-Auth  Caps  Proof",cities:[{id:"preauth",label:"Pre-Auth Caps"},{id:"disputes",label:"Dispute Proof"},{id:"ledger",label:"Ledger"}]}];function q2(n){return n?(Array.isArray(n)?n:[]).map(e=>({id:String(e?.id??""),label:String(e?.label??e?.name??e?.title??e?.id??"City"),desc:e?.desc?String(e.desc):e?.subtitle?String(e.subtitle):void 0})).filter(e=>e.id):[]}function F2(n){const{witnessMode:e,onToggleWitnessMode:t}=n,i=Qt(),a=Hn(),[o,c]=T.useState(!0);T.useEffect(()=>{const z=window.setTimeout(()=>c(!1),450);return()=>window.clearTimeout(z)},[]);const[u,h]=T.useState(()=>{try{return window.innerWidth<900}catch{return!1}});T.useEffect(()=>{try{const z=u?"96px":"320px";document.documentElement.style.setProperty("--atlasW",z)}catch{}},[u]),T.useEffect(()=>{const z=()=>{window.innerWidth<900&&h(!0)};return window.addEventListener("resize",z),()=>window.removeEventListener("resize",z)},[]),T.useEffect(()=>{try{document.documentElement.style.setProperty("--atlas-w",u?"84px":"320px")}catch{}},[u]);const[f,p]=T.useState(()=>{const z={};for(const H of wu)z[String(H.id)]=!1;return z}),y=T.useRef(0),b=z=>a.pathname===z,k=z=>a.pathname===z||a.pathname.startsWith(z+"/"),C=z=>z?{border:"1px solid rgba(0,255,180,0.45)",background:"rgba(0,255,180,0.22)",color:"white",boxShadow:"0 10px 28px rgba(0,0,0,0.38)"}:{},w=T.useCallback((z,H)=>{try{H?.preventDefault?.(),H?.stopPropagation?.()}catch{}const ie=Date.now();if(!(ie-y.current<350)&&(y.current=ie,a.pathname!==z)){try{i(z)}catch{}setTimeout(()=>{window.location.pathname!==z&&window.location.assign(z)})}},[i,a.pathname]),O=T.useMemo(()=>wu??[],[]),R={position:"sticky",top:0,height:"100dvh",overflowY:"auto",padding:14,paddingBottom:"calc(14px + env(safe-area-inset-bottom))",borderRight:"1px solid rgba(255,255,255,0.10)",background:"rgba(0,0,0,0.58)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",width:u?82:320,flex:"0 0 auto",pointerEvents:"auto",touchAction:"manipulation",WebkitTapHighlightColor:"transparent"};R.transition="opacity 420ms ease, filter 420ms ease",o?(R.opacity=.72,R.filter="saturate(0.85) contrast(0.95)"):(R.opacity=1,R.filter="none");const P={margin:0,fontSize:16,fontWeight:950},j={marginTop:4,fontSize:12,color:"rgba(255,255,255,0.70)"},E={fontSize:12,fontWeight:800,color:"rgba(255,255,255,0.72)",paddingLeft:6,marginTop:14,display:u?"none":"block"},_={padding:"10px 12px",borderRadius:12,cursor:"pointer",fontWeight:900,border:"1px solid rgba(255,255,255,0.30)",background:"rgba(0,0,0,0.65)",color:"white",boxShadow:"0 6px 18px rgba(0,0,0,0.35)",userSelect:"none",WebkitTapHighlightColor:"transparent"},A={width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",gap:10,padding:"10px 12px",borderRadius:14,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.05)",color:"rgba(255,255,255,0.92)",cursor:"pointer",userSelect:"none",textDecoration:"none",touchAction:"manipulation",WebkitTapHighlightColor:"transparent"},I={...A,marginLeft:10,background:"rgba(0,0,0,0.20)",border:"1px solid rgba(255,255,255,0.10)",display:u?"none":"flex"},F={opacity:.7,fontWeight:900},B=z=>({onClick:H=>w(z,H)});return g.jsxs("aside",{style:R,children:[g.jsxs("div",{style:{display:"flex",width:"100%",maxWidth:1480,margin:"0 auto",alignItems:"center",justifyContent:"space-between",gap:10,marginBottom:10},children:[g.jsxs("div",{style:{minWidth:0},children:[g.jsx("div",{style:P,children:u?"AT":"Atlas"}),u?null:g.jsx("div",{style:j,children:"Planetary Index"})]}),g.jsx("button",{type:"button",onClick:z=>{z.preventDefault(),z.stopPropagation(),h(H=>!H)},style:{..._,padding:u?"10px 10px":"10px 12px",minWidth:u?42:96,textAlign:"center"},title:u?"Expand":"Collapse",children:u?"?":"Collapse"})]}),g.jsx("div",{style:E,children:"Planets"}),g.jsx("div",{style:{display:"grid",gap:10,marginTop:10},children:O.map(z=>{const H=String(z.id),ie=String(z.label??z.id),he=q2(z.cities),Z=!!f[H],le=`/planet/${H}`,N=k(le);return g.jsxs("div",{style:{display:"grid",gap:8},children:[g.jsxs("button",{type:"button",onClick:K=>{if(K.preventDefault(),K.stopPropagation(),u){w(`/planet/${H}`,K);return}p(ae=>({...ae,[H]:!ae[H]}))},style:{...A,...C(N),justifyContent:u?"center":"space-between",padding:u?"12px 10px":"10px 12px"},title:ie,children:[g.jsxs("div",{style:{display:"flex",width:"100%",maxWidth:1480,margin:"0 auto",flexDirection:"column",alignItems:u?"center":"flex-start"},children:[g.jsx("div",{style:{fontWeight:950,letterSpacing:.2},children:u?ie.slice(0,2).toUpperCase():ie}),!u&&z.subtitle?g.jsx("div",{style:{fontSize:12,color:"rgba(255,255,255,0.58)",marginTop:2},children:String(z.subtitle)}):null]}),u?null:g.jsx("div",{style:F,children:"?"})]}),!u&&Z?g.jsxs("div",{style:{display:"grid",gap:8},children:[(()=>{const K=`/planet/${H}`;return g.jsxs("button",{type:"button",...B(K),style:{...I,...C(b(K))},children:[g.jsx("div",{style:{fontWeight:900},children:"Overview"}),g.jsx("div",{style:F})]})})(),he.slice(0,12).map(K=>{const ae=`/planet/${H}/${K.id}`;return g.jsxs("button",{type:"button",...B(ae),style:{...I,...C(b(ae))},children:[g.jsxs("div",{style:{display:"flex",width:"100%",maxWidth:1480,margin:"0 auto",flexDirection:"column"},children:[g.jsx("div",{style:{fontWeight:900},children:K.label}),K.desc?g.jsx("div",{style:{fontSize:12,opacity:.7,marginTop:2},children:K.desc}):null]}),g.jsx("div",{style:F})]},K.id)})]}):null]},H)})}),u?null:g.jsx("div",{style:{marginTop:18,opacity:.58,fontSize:11,lineHeight:1.35,paddingLeft:6},children:"iOS-safe navigation: click + navigate() + hard fallback if needed."})]})}function H2(){const[n,e]=T.useState(!1),t=T.useMemo(()=>({minHeight:"100vh",color:"white",background:"radial-gradient(1200px 700px at 20% 20%, rgba(80,120,255,0.12), transparent 60%), radial-gradient(1000px 700px at 80% 30%, rgba(255,80,200,0.10), transparent 55%), #07070B"}),[]);return g.jsx("div",{style:t,children:g.jsxs("div",{style:{display:"flex"},children:[g.jsx(F2,{witnessMode:n,onToggleWitnessMode:()=>e(i=>!i)}),g.jsx("main",{style:{flex:1,minWidth:0,padding:22},children:g.jsx("div",{style:{maxWidth:1100,margin:"0 auto",borderRadius:22,border:"1px solid rgba(255,255,255,0.10)",background:"rgba(255,255,255,0.03)",padding:22,boxShadow:"0 12px 40px rgba(0,0,0,0.35)"},children:g.jsx(r2,{context:{witnessMode:n}})})}),g.jsx("div",{"aria-hidden":"true",style:{width:"var(--atlasW, 320px)",flex:"0 0 var(--atlasW, 320px)",pointerEvents:"none"}})]})})}function dk(n){return n?/(.|| |$||||||||)/u.test(n):!1}function V2(n){const e=Uint8Array.from(n,t=>t.charCodeAt(0)&255);return new TextDecoder("utf-8",{fatal:!1}).decode(e)}function $2(n){if(!n||!dk(n))return n;try{return V2(n)||n}catch{return n}}function W2(n){if(!n)return n;let e=n;for(let t=0;t<4&&dk(e);t++){const i=$2(e);if(!i||i===e)break;e=i}return e}function Li(n){const e=new WeakMap,t=i=>{if(typeof i=="string")return W2(i);if(i==null||typeof i!="object")return i;if(e.has(i))return e.get(i);if(Array.isArray(i)){const o=[];e.set(i,o);for(const c of i)o.push(t(c));return o}const a={};e.set(i,a);for(const[o,c]of Object.entries(i))a[o]=t(c);return a};return t(n)}function G2(n){const e=Li(n||""),t=a=>e.match(new RegExp(a+":\\s*([\\s\\S]*?)(?:\\n\\n|$)","i"))?.[1]?.trim()||"",i=a=>a.split(`
`).map(o=>o.replace(/^[-*]\s*/,"").trim()).filter(Boolean);return{h1:t("H1")||"Untitled Site",sub:t("Subheadline")||"Built from your description  ready to share",about:t("About"),services:i(t("Services")),products:i(t("Products")),testimonials:i(t("Testimonials")),contactRaw:t("Contact"),footer:t("Footer")}}function hk({rawText:n,projectId:e}){const t=G2(n),i=t.contactRaw.split(`
`).map(o=>o.split(":").map(c=>c.trim())),a={};for(const[o,c]of i)o&&(a[o.toLowerCase()]=c||"");return g.jsxs("div",{style:{background:"#f4f4f4",borderRadius:22,padding:18,color:"black",fontFamily:"system-ui"},children:[g.jsx("h1",{children:t.h1}),g.jsx("div",{style:{opacity:.7},children:t.sub}),g.jsxs("div",{style:{marginTop:14},children:[g.jsx("strong",{children:"About"}),g.jsx("p",{children:t.about})]}),!!t.services.length&&g.jsxs("div",{children:[g.jsx("strong",{children:"Services"}),g.jsx("ul",{children:t.services.map((o,c)=>g.jsx("li",{children:o},c))})]}),!!t.products.length&&g.jsxs("div",{children:[g.jsx("strong",{children:"Products"}),g.jsx("ul",{children:t.products.map((o,c)=>g.jsx("li",{children:o},c))})]}),g.jsxs("div",{children:[g.jsx("strong",{children:"Contact"}),g.jsxs("div",{children:["Location: ",a.location||""]}),g.jsxs("div",{children:["Phone: ",a.phone||""]}),g.jsxs("div",{children:["Email: ",a.email||""]}),g.jsxs("div",{children:["Instagram: ",a.instagram||""]}),g.jsxs("div",{children:["Website: ",a.website||""]})]}),g.jsx("div",{style:{marginTop:18,fontSize:12,opacity:.6},children:t.footer||`${t.h1}  Built with HomePlanet`}),e&&g.jsxs("div",{style:{fontSize:11,opacity:.5},children:["Project: ",e.slice(0,8)]})]})}const Hb=n=>{let e;const t=new Set,i=(f,p)=>{const y=typeof f=="function"?f(e):f;if(!Object.is(y,e)){const b=e;e=p??(typeof y!="object"||y===null)?y:Object.assign({},e,y),t.forEach(k=>k(e,b))}},a=()=>e,u={setState:i,getState:a,getInitialState:()=>h,subscribe:f=>(t.add(f),()=>t.delete(f))},h=e=n(i,a,u);return u},K2=(n=>n?Hb(n):Hb),J2=n=>n;function Y2(n,e=J2){const t=Go.useSyncExternalStore(n.subscribe,Go.useCallback(()=>e(n.getState()),[n,e]),Go.useCallback(()=>e(n.getInitialState()),[n,e]));return Go.useDebugValue(t),t}const Vb=n=>{const e=K2(n),t=i=>Y2(e,i);return Object.assign(t,e),t},Q2=(n=>n?Vb(n):Vb),Hu=Q2(n=>({activeProjectId:null,setActiveProjectId:e=>{n({activeProjectId:e});try{e?localStorage.setItem("hp_active_project_id",e):localStorage.removeItem("hp_active_project_id")}catch{}},hydrateActiveFromStorage:()=>{try{const e=localStorage.getItem("hp_active_project_id");e&&n({activeProjectId:e})}catch{}}}));function X2(n){return n==null?"":String(n)}function ds(n){const e=X2(n).split(/\r?\n/),t=a=>{const o=a.trim();return o?/^\d+(?:\.\d{1,2})?$/.test(o)?"$"+o:o.replace(/([\-:]\s*)(\d+(?:\.\d{1,2})?)\s*$/,(c,u,h)=>u+"$"+h):""};return e.map(a=>{const o=a.trim();if(!o)return"";const c=o.startsWith("- ")?o.slice(2).trim():o;return"- "+t(c)}).join(`
`).replace(/\n{3,}/g,`

`).trim()}function Z2(){const n=Qt(),{activeProjectId:e}=Hu(),t=e?e.slice(0,8):"none",i=e?`hp_creator_services_${e}`:"hp_creator_services_none",a=e?`hp_creator_products_${e}`:"hp_creator_products_none",[o,c]=T.useState(""),[u,h]=T.useState("");T.useEffect(()=>{try{c(ds(localStorage.getItem(i)??`- Hoodie - $45
- 99
- Private lessons - 75`)),h(ds(localStorage.getItem(a)??`- Water Bottle - 16
- Gift cards - 25`))}catch{}},[e]),T.useEffect(()=>{try{localStorage.setItem(i,ds(o)),localStorage.setItem(a,ds(u))}catch{}},[o,u,i,a]);const f=T.useMemo(()=>{const k=o.trim()?o.trim():"- 99",C=u.trim()?u.trim():"- 16";return`Services:
${k}

Products:
${C}
`},[o,u]),p={border:"1px solid rgba(255,255,255,0.12)",borderRadius:14,background:"rgba(255,255,255,0.03)",padding:14},y={width:"100%",minHeight:160,padding:12,borderRadius:12,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(0,0,0,0.15)",color:"white",outline:"none",fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace",fontSize:13,lineHeight:"18px",resize:"vertical"},b={padding:"8px 12px",borderRadius:12,border:"1px solid rgba(255,255,255,0.18)",background:"rgba(255,255,255,0.06)",color:"white",cursor:"pointer"};return g.jsxs("div",{style:{padding:18},children:[g.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:14},children:[g.jsxs("div",{children:[g.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Creator Studio  Services"}),g.jsxs("div",{style:{opacity:.7,fontSize:12},children:["Project: ",t]})]}),g.jsxs("div",{style:{display:"flex",gap:10},children:[g.jsx("button",{style:b,onClick:()=>n("/planet/creator/studio"),children:"Studio"}),g.jsx("button",{style:b,onClick:()=>n("/planet/creator/build"),children:"Build"})]})]}),g.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 420px",gap:14},children:[g.jsxs("div",{style:p,children:[g.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"Services"}),g.jsxs("div",{style:{opacity:.75,fontSize:12,marginBottom:10},children:["Use bullet lines. Prices auto-format on blur. Example: ",g.jsx("span",{style:{opacity:.9},children:"- Hoodie - 45"})]}),g.jsx("textarea",{style:y,value:o,onChange:k=>c(k.target.value),onBlur:()=>c(k=>{const C=ds(k);return console.log("[SERVICES BLUR]",{before:k,after:C}),C}),placeholder:"- Service 1 - 45`n- Service 2 - 99"}),g.jsx("div",{style:{height:14}}),g.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"Products"}),g.jsx("textarea",{style:y,value:u,onChange:k=>h(k.target.value),onBlur:()=>h(k=>{const C=ds(k);return console.log("[PRODUCTS BLUR]",{before:k,after:C}),C}),placeholder:"- Product 1 - 16`n- Product 2 - 24"})]}),g.jsxs("div",{style:p,children:[g.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Preview"}),g.jsx(hk,{rawText:f,projectId:e})]})]})]})}function hi(n){try{return n==null?"":typeof n=="string"?n.trim():typeof n=="number"?String(n):String(n??"").trim()}catch{return""}}function eO(n){try{const e=new Date(String(n));return Number.isNaN(e.getTime())?String(n??""):e.toLocaleString()}catch{return String(n??"")}}function tO(n){const e=hi(n).toLowerCase();return e?e.includes("fuck")||e.includes("shit")||e.includes("cunt")||e.includes("bitch")||e.includes("asshole")||e.includes("test customer")||e.includes("dummy")||e.includes("asdf")||e.includes("qwerty"):!1}function nO(n){const e=n?.payload||{},t=hi(e.name||e.full_name||e.fullName);return!tO(t)}function iO({projectId:n,slug:e}){const[t,i]=T.useState([]),[a,o]=T.useState(!1),[c,u]=T.useState(null),[h,f]=T.useState(null),[p,y]=T.useState(""),[b,k]=T.useState(null),[C,w]=T.useState(null),[O,R]=T.useState(!1),P=e?`slug: ${e}`:"";T.useEffect(()=>{let _=!1;return(async()=>{try{const{error:A}=await je.from("public_intake_submissions").select("receipt_id").limit(1);_||R(!A)}catch{_||R(!1)}})(),()=>{_=!0}},[]);const j=T.useCallback(async()=>{if(!(!n&&!e)){o(!0),u(null);try{const _=O?"id,created_at,slug,project_id,payload,receipt_id":"id,created_at,slug,project_id,payload",A=je.from("public_intake_submissions").select(_).order("created_at",{ascending:!1}).limit(200),{data:I,error:F}=e?await A.eq("slug",e):await A.eq("project_id",n);if(F)throw F;i(I??[])}catch(_){u(_?.message??String(_))}finally{o(!1)}}},[n,e,O]);T.useEffect(()=>{j()},[j]),T.useEffect(()=>{if(!n&&!e)return;const _=je.channel("intake-submissions:"+String(n??e??"none")).on("postgres_changes",{event:"INSERT",schema:"public",table:"public_intake_submissions",filter:e?"slug=eq."+e:"project_id=eq."+n},()=>{j()}).subscribe();return()=>{je.removeChannel(_)}},[n,e,j]);async function E(){const _=p.trim();if(w(null),k(null),!!_)try{const A=O?"id,created_at,slug,project_id,payload,receipt_id":"id,created_at,slug,project_id,payload",I=je.from("public_intake_submissions").select(A).limit(1),{data:F,error:B}=O?await I.eq("receipt_id",_).maybeSingle():await I.eq("id",_).maybeSingle();if(B){w(B.message);return}if(!F){w("Not found.");return}k(F),await j()}catch(A){w(A?.message??String(A))}}return T.useEffect(()=>{try{const _="last_receipt_id",A=window.localStorage.getItem(_);if(!A)return;y(A),window.localStorage.removeItem(_),setTimeout(()=>{E()},0)}catch{}},[n,e,O]),g.jsxs("div",{style:{marginTop:14,border:"1px solid rgba(255,255,255,0.12)",borderRadius:14,padding:14,background:"rgba(255,255,255,0.03)"},children:[g.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:10},children:[g.jsx("div",{style:{fontWeight:700,fontSize:16,color:"white"},children:"Intake"}),g.jsxs("div",{style:{opacity:.65,fontSize:12,color:"rgba(255,255,255,0.85)"},children:[t.length," ",t.length===1?"submission":"submissions"," ",P?`- ${P}`:""]}),g.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:g.jsx("button",{onClick:j,style:{padding:"6px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.04)",cursor:"pointer",color:"white",fontWeight:800},children:"Refresh"})})]}),g.jsxs("div",{style:{marginTop:10,border:"1px solid rgba(255,255,255,0.10)",borderRadius:12,padding:12,background:"rgba(0,0,0,0.12)"},children:[g.jsx("div",{style:{fontSize:13,fontWeight:800,color:"rgba(255,255,255,0.92)"},children:"Receipt lookup"}),g.jsxs("div",{style:{marginTop:8,display:"flex",gap:8},children:[g.jsx("input",{value:p,onChange:_=>y(_.target.value),placeholder:O?"Paste receipt_id":"Paste row id (uuid)",style:{width:"100%",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(0,0,0,0.25)",color:"white",outline:"none",fontSize:13}}),g.jsx("button",{onClick:E,style:{padding:"8px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.06)",cursor:"pointer",color:"white",fontWeight:800,whiteSpace:"nowrap"},children:"Find"})]}),C?g.jsx("div",{style:{marginTop:8,fontSize:12,color:"rgba(255,180,180,0.95)"},children:C}):null,b?g.jsxs("div",{style:{marginTop:8,fontSize:12,color:"rgba(255,255,255,0.80)"},children:["Found:"," ",g.jsx("span",{style:{fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace"},children:b.receipt_id??b.id})," "," ",String(b.created_at)]}):null]}),a&&g.jsx("div",{style:{marginTop:10,opacity:.75,fontSize:13,color:"rgba(255,255,255,0.85)"},children:"Loading..."}),c&&g.jsxs("div",{style:{marginTop:10,padding:10,borderRadius:10,border:"1px solid rgba(255,80,80,0.35)",background:"rgba(255,80,80,0.08)",color:"rgba(255,200,200,0.95)",fontSize:13},children:["Intake load failed: ",c]}),!a&&!c&&t.length===0&&g.jsx("div",{style:{marginTop:10,opacity:.7,fontSize:13,color:"rgba(255,255,255,0.85)"},children:"No submissions yet. Open the public link in incognito and submit a test, then hit Refresh."}),g.jsx("div",{style:{marginTop:10,display:"flex",flexDirection:"column",gap:10},children:t.filter(nO).map(_=>{const A=_.payload||{},I=hi(A.name||A.full_name||A.fullName),F=hi(A.email),B=hi(A.phone),z=hi(A.preferred_contact||A.preferredContact),H=hi(A.address),ie=hi(A.best_time||A.bestTime),he=hi(A.need_help_with||A.needHelpWith),Z=hi(A.message||A.issue||A.request),le=h===_.id,N=_.receipt_id??_.id;return g.jsxs("div",{style:{border:"1px solid rgba(255,255,255,0.10)",borderRadius:12,padding:12,background:"rgba(0,0,0,0.15)",color:"rgba(255,255,255,0.9)"},children:[g.jsxs("div",{style:{display:"flex",gap:10,alignItems:"baseline"},children:[g.jsx("div",{style:{fontWeight:800},children:I||F||B||"Submission"}),g.jsx("div",{style:{opacity:.65,fontSize:12},children:eO(_.created_at)}),g.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,flexWrap:"wrap",justifyContent:"flex-end"},children:[g.jsx("button",{onClick:()=>f(le?null:_.id),style:{padding:"6px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.04)",cursor:"pointer",color:"white",fontWeight:800},children:le?"Hide":"View"}),g.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(JSON.stringify(_.payload??{},null,2)),alert("Payload copied")}catch{}},style:{padding:"6px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.04)",cursor:"pointer",color:"white",fontWeight:800},children:"Copy JSON"}),g.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(String(N)),alert("Receipt ID copied")}catch{}},style:{padding:"6px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.04)",cursor:"pointer",color:"white",fontWeight:800},children:"Copy Receipt"})]})]}),g.jsxs("div",{style:{marginTop:8,display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[g.jsxs("div",{style:{fontSize:13},children:[g.jsx("div",{style:{opacity:.6,fontSize:12},children:"Email"}),g.jsx("div",{children:F||"-"})]}),g.jsxs("div",{style:{fontSize:13},children:[g.jsx("div",{style:{opacity:.6,fontSize:12},children:"Phone"}),g.jsx("div",{children:B||"-"})]}),g.jsxs("div",{style:{fontSize:13},children:[g.jsx("div",{style:{opacity:.6,fontSize:12},children:"Preferred"}),g.jsx("div",{children:z||"-"})]}),g.jsxs("div",{style:{fontSize:13},children:[g.jsx("div",{style:{opacity:.6,fontSize:12},children:"Address"}),g.jsx("div",{children:H||"-"})]}),ie&&g.jsxs("div",{style:{fontSize:13},children:[g.jsx("div",{style:{opacity:.6,fontSize:12},children:"Best time"}),g.jsx("div",{children:ie})]}),he&&g.jsxs("div",{style:{fontSize:13},children:[g.jsx("div",{style:{opacity:.6,fontSize:12},children:"Need help with"}),g.jsx("div",{children:he})]})]}),Z&&g.jsxs("div",{style:{marginTop:10,fontSize:13},children:[g.jsx("div",{style:{opacity:.6,fontSize:12},children:"Request"}),g.jsx("div",{style:{whiteSpace:"pre-wrap"},children:Z})]}),le&&g.jsxs("div",{style:{marginTop:10,fontSize:12,opacity:.9},children:[g.jsx("div",{style:{opacity:.6,fontSize:12},children:"Receipt"}),g.jsx("div",{style:{fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace"},children:String(N)})]})]},_.id)})})]})}const $b={};function rO(){const n=$b?.VITE_PUBLIC_BASE_URL??$b?.VITE_PUBLIC_BASE_URL?.toString?.();if(typeof n=="string"&&n.trim())return n.trim();try{return window.location.origin}catch{return"http://localhost:5174"}}function aO(n){const e="abcdefghijklmnopqrstuvwxyz0123456789",t=new Uint8Array(n);crypto.getRandomValues(t);let i="";for(let a=0;a<t.length;a++)i+=e[t[a]%e.length];return i}function sO({value:n,size:e=240}){const t=`https://api.qrserver.com/v1/create-qr-code/?size=${e}x${e}&data=`+encodeURIComponent(n);return g.jsx("img",{src:t,width:e,height:e,style:{borderRadius:14,display:"block"},alt:"QR code"})}function oO({mode:n,onBack:e,onBuild:t}){const i=Hu(),a=i?.activeProjectId??null,o=(Array.isArray(i?.projects)?i.projects:null)??(Array.isArray(i?.projectList)?i.projectList:null)??(Array.isArray(i?.items)?i.items:null)??[],c=i?.setActiveProjectId??i?.setActiveProject??i?.setActive??i?.setActiveId??null;T.useEffect(()=>{if(a||!c)return;const D=["hp_active_project_id","hp_active_project","activeProjectId","homeplanet_active_project_id"];for(const de of D)try{const ge=localStorage.getItem(de);if(ge&&typeof ge=="string"&&ge.length>5){c(ge);return}}catch{}const J=o?.[0],oe=J?.id??J?.project_id??J?.projectId??null;if(oe){c(oe);try{localStorage.setItem("hp_active_project_id",oe)}catch{}}},[a,c,o]);const[u,h]=T.useState(null),[f,p]=T.useState("idle"),[y,b]=T.useState(null),k={borderRadius:22,border:"1px solid rgba(255,255,255,0.10)",background:"rgba(0,0,0,0.35)",boxShadow:"0 18px 60px rgba(0,0,0,0.45)",padding:18},C={height:40,padding:"0 14px",borderRadius:999,border:"1px solid rgba(255,255,255,0.16)",background:"rgba(255,255,255,0.06)",color:"white",cursor:"pointer",fontWeight:900,fontSize:12,letterSpacing:.2,whiteSpace:"nowrap",display:"inline-flex",alignItems:"center",justifyContent:"center"},w={height:42,padding:"0 14px",borderRadius:999,border:"1px solid rgba(0,255,150,0.35)",background:"rgba(0,255,150,0.10)",color:"rgba(220,255,245,0.95)",cursor:"pointer",fontWeight:950,fontSize:12,letterSpacing:.2},O={borderRadius:18,border:"1px solid rgba(255,255,255,0.10)",background:"rgba(255,255,255,0.05)",padding:16,minWidth:0},R={fontSize:11,opacity:.8,marginBottom:6,fontWeight:900,letterSpacing:.2,color:"rgba(255,255,255,0.9)"},P={width:"100%",height:40,borderRadius:12,border:"1px solid rgba(255,255,255,0.14)",background:"rgba(0,0,0,0.35)",color:"white",padding:"0 12px",outline:"none"},j={width:"100%",borderRadius:12,border:"1px solid rgba(255,255,255,0.14)",background:"rgba(0,0,0,0.35)",color:"white",padding:12,outline:"none",minHeight:90,resize:"vertical"},E={display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},_={height:1,background:"rgba(255,255,255,0.08)",border:0,margin:"14px 0"},A={borderRadius:14,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(0,0,0,0.35)",padding:12,fontSize:12,color:"rgba(255,255,255,0.9)",overflowWrap:"anywhere"},I={width:"100%",aspectRatio:"1 / 1",borderRadius:18,border:"2px dashed rgba(255,255,255,0.18)",background:"rgba(255,255,255,0.03)",display:"flex",alignItems:"center",justifyContent:"center",color:"rgba(255,255,255,0.75)",fontWeight:900},F=n==="intake";if(n==="services")return g.jsx(Z2,{});const z=rO();T.useEffect(()=>{let D=!1;async function J(){if(b(null),!a){p("no-project"),b("activeProjectId is missing"),h(null);return}const oe=`hp_public_slug_${a}_${n}`,de=(()=>{try{return localStorage.getItem(oe)}catch{return null}})();if(de){p("cached"),h(de);return}p("fetching");const{data:ge,error:_e}=await je.from("public_pages").select("slug").eq("project_id",a).eq("mode",n).limit(1).maybeSingle();if(_e&&(p("fetch-error"),b(_e.message??String(_e))),!D&&ge?.slug){try{localStorage.setItem(oe,ge.slug)}catch{}p("found"),h(ge.slug);return}for(let Se=0;Se<3;Se++){const nt=aO(Se===0?10:12),{data:Fe,error:hn}=await je.from("public_pages").upsert([{project_id:a,mode:n,slug:nt}],{onConflict:"project_id,mode"}).select("slug").single();if(!D&&Fe?.slug){try{localStorage.setItem(oe,Fe.slug)}catch{}p("created"),h(Fe.slug);return}if(hn&&!String(hn.message||"").toLowerCase().includes("duplicate")){p("insert-error"),b(hn?.message??String(hn));break}}D||h(null)}return J(),()=>{D=!0}},[a,n]);const H=T.useMemo(()=>u?`${z}/c/${u}`:"",[z,u]);T.useEffect(()=>{const D=a,J=u;if(!D||!J)return;let oe=!1;return(async()=>{try{const{error:de}=await je.from("public_pages").upsert({project_id:D,mode:n,slug:J},{onConflict:"project_id,mode"});!oe&&de&&console.warn("[public_pages] upsert error:",de.message)}catch(de){oe||console.warn("[public_pages] upsert exception:",de?.message??de)}})(),()=>{oe=!0}},[u,n,a]);async function ie(){try{await navigator.clipboard.writeText(H),alert("Copied!")}catch{}}const he=`
@media print {
  body { background: #fff !important; color: #000 !important; }
  * { box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { color: #000 !important; text-decoration: none !important; }

  body * { visibility: hidden !important; }
  #print-surface, #print-surface * { visibility: visible !important; }

  #print-surface {
    position: absolute !important;
    left: 0 !important;
    top: 0 !important;
    width: 8.5in !important;
    max-width: 8.5in !important;
    padding: 0.5in !important;
    background: #fff !important;
    color: #000 !important;
    display: block !important;
  }

  #print-surface > * { break-inside: avoid !important; }

  input, textarea, select {
    background: #fff !important;
    color: #000 !important;
    border: 1px solid #000 !important;
  }

  [style*="background"] { background: transparent !important; }
  [style*="border"] { border-color: #000 !important; }

  @page { size: Letter; margin: 0.5in; }
}
`,Z=D=>{if(typeof D=="string")return D.trim();if(Array.isArray(D))return D.map(Z);if(D&&typeof D=="object"){const J={};for(const oe of Object.keys(D))J[oe]=Z(D[oe]);return J}return D},[le,N]=T.useState({full_name:"",phone:"",email:"",preferred_contact:"",help_request:"",address:"",best_time:""}),[,K]=T.useState(!1),[,ae]=T.useState(null),[,pe]=T.useState(null),ye=async()=>{if(!u){ae("Slug is not ready yet. Wait one second and try again.");return}if(K(!0),ae(null),pe(null),!(le.full_name.trim()||le.phone.trim()||le.email.trim()||le.help_request.trim())){K(!1),ae("Add at least a name/phone/email or a short description, then submit.");return}const{data:J,error:oe}=await je.from("public_pages").select("id, slug").eq("slug",u).maybeSingle();if(oe||!J?.id){K(!1),ae(oe?.message||"Could not resolve public page id for this slug.");return}const de={slug:u,payload:Z(le)},{error:ge}=await je.from("public_intake_submissions").insert(de);if(ge){K(!1),ae(ge.message||"Failed to submit intake.");return}K(!1),pe("Submitted successfully."),N({full_name:"",phone:"",email:"",preferred_contact:"",help_request:"",address:"",best_time:""})};return g.jsxs("div",{style:k,children:[g.jsx("style",{children:he}),g.jsxs("div",{style:{marginBottom:14,color:"white"},children:[g.jsx("div",{style:{margin:0,fontSize:18,fontWeight:950},children:F?"Scan to Submit Intake":`Creator Studio - ${n}`}),g.jsxs("div",{style:{marginTop:6,fontSize:12,opacity:.85},children:["Project: ",g.jsx("span",{style:{fontWeight:900},children:a?a.slice(0,8):"none"}),"  |  ","Slug: ",g.jsx("span",{style:{fontWeight:900},children:u||(a?"generating...":"none")})]})]}),F?g.jsxs("div",{id:"print-surface",style:{display:"grid",gridTemplateColumns:"1.35fr 0.9fr",gap:16,alignItems:"stretch"},children:[g.jsxs("div",{style:O,children:[g.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:10},children:[g.jsx("div",{style:{fontWeight:950,color:"white"},children:"Scan to Submit Intake"}),g.jsx("div",{style:{fontSize:11,opacity:.8,color:"rgba(255,255,255,0.85)"},children:"replace fields per industry"})]}),g.jsx("hr",{style:_}),g.jsxs("div",{style:E,children:[g.jsxs("div",{children:[g.jsx("div",{style:R,children:"Full name"}),g.jsx("input",{style:P,placeholder:"Customer name",value:le.full_name,onChange:D=>N(J=>({...J,full_name:D.target.value}))})]}),g.jsxs("div",{children:[g.jsx("div",{style:R,children:"Phone"}),g.jsx("input",{style:P,placeholder:"(555) 555-5555"})]})]}),g.jsx("div",{style:{height:12}}),g.jsxs("div",{style:E,children:[g.jsxs("div",{children:[g.jsx("div",{style:R,children:"Email"}),g.jsx("input",{style:P,placeholder:"email@example.com",value:le.email,onChange:D=>N(J=>({...J,email:D.target.value}))})]}),g.jsxs("div",{children:[g.jsx("div",{style:R,children:"Preferred contact"}),g.jsx("input",{style:P,placeholder:"Text / Call / Email",value:le.preferred_contact,onChange:D=>N(J=>({...J,preferred_contact:D.target.value}))})]})]}),g.jsx("div",{style:{height:12}}),g.jsxs("div",{children:[g.jsx("div",{style:R,children:"What do you need help with?"}),g.jsx("textarea",{style:j,placeholder:"Describe the issue / request...",value:le.help_request,onChange:D=>N(J=>({...J,help_request:D.target.value}))})]}),g.jsx("div",{style:{height:12}}),g.jsxs("div",{style:E,children:[g.jsxs("div",{children:[g.jsx("div",{style:R,children:"Address (optional)"}),g.jsx("input",{style:P,placeholder:"City, State",value:le.address,onChange:D=>N(J=>({...J,address:D.target.value}))})]}),g.jsxs("div",{children:[g.jsx("div",{style:R,children:"Best time"}),g.jsx("input",{style:P,placeholder:"Morning / Afternoon / Evening",value:le.best_time,onChange:D=>N(J=>({...J,best_time:D.target.value}))})]})]}),g.jsx("hr",{style:_}),g.jsx("button",{type:"button",style:w,onClick:ye,children:"Submit Intake"})]}),g.jsxs("div",{style:O,children:[g.jsx("div",{style:{fontWeight:950,color:"white"},children:"Share (QR + Link)"}),g.jsxs("div",{style:{fontSize:12,opacity:.85,marginTop:6,color:"rgba(255,255,255,0.85)"},children:["Customers scan this and submit.",g.jsxs("div",{style:{marginTop:6,fontSize:11,opacity:.85},children:["debug: project=",String(a??"none")," | phase=",f," | slug=",String(u??"null"),y?` | err=${y}`:""]})]}),g.jsx("div",{style:{height:12}}),g.jsx("div",{style:I,children:g.jsx("div",{style:{background:"white",padding:14,borderRadius:14,display:"inline-flex"},children:H?g.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[g.jsx(sO,{value:H,size:240}),g.jsxs("div",{style:{marginTop:8,fontSize:11,color:"black",textAlign:"center",wordBreak:"break-all"},children:["Scan or visit:",g.jsx("br",{}),g.jsx("strong",{children:H})]})]}):g.jsx("div",{style:{color:"rgba(0,0,0,0.7)",fontSize:12,padding:12},children:"Generating link..."})})}),g.jsx("div",{style:{height:12}}),g.jsx("div",{style:R,children:"Public link"}),g.jsx("div",{style:A,children:H||"Generating link..."}),g.jsx("div",{style:{height:12}}),g.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[g.jsx("button",{type:"button",style:C,onClick:ie,children:"Copy link"}),g.jsx("button",{type:"button",style:C,onClick:e,title:"Back to Studio",children:"Studio"}),g.jsx("button",{type:"button",style:C,onClick:t,title:"Back to Build",children:"Build"}),g.jsx("button",{type:"button",style:w,onClick:()=>window.print(),title:"Print / Save PDF",children:"Print / Save PDF"})]}),g.jsx("div",{style:{height:12}}),g.jsx(iO,{projectId:a,slug:u})]})]}):g.jsxs("div",{style:O,children:[g.jsx("div",{style:{fontWeight:950,color:"white"},children:"Mode placeholder"}),g.jsx("div",{style:{marginTop:6,fontSize:12,opacity:.85,color:"rgba(255,255,255,0.85)"},children:"We will build this mode after Intake is solid."})]})]})}function Wb(){const n=Qt(),[e,t]=T.useState(null),{mode:i}=Yi(),a=T.useMemo(()=>[{key:"intake",title:"Online Intake (QR)",desc:"One-page intake + QR customers can scan and submit.",badge:"recommended"},{key:"card",title:"Business Card",desc:"Print-ready card layout. Export and upload anywhere."},{key:"hanger",title:"Door Hanger",desc:"Door hanger layout + print export."},{key:"flyer",title:"Flyer / One-pager",desc:"Promo flyer with sections and call-to-action."},{key:"sign",title:"Sign / Banner",desc:"Large format layout preset for shops and print."},{key:"services",title:"Services + Products",desc:"Edit services/products list used in preview."}],[]),o={padding:18,maxWidth:1200,margin:"0 auto"},c={padding:16,borderRadius:18,border:"1px solid rgba(255,255,255,0.10)",background:"rgba(0,0,0,0.25)",boxShadow:"0 10px 30px rgba(0,0,0,0.25)",marginBottom:14,color:"white"},u={height:40,padding:"0 12px",borderRadius:999,border:"1px solid rgba(255,255,255,0.16)",background:"rgba(255,255,255,0.06)",color:"white",cursor:"pointer",fontWeight:900,fontSize:12,letterSpacing:.2,whiteSpace:"nowrap",display:"inline-flex",alignItems:"center",justifyContent:"center"},h={display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:14,alignItems:"stretch"},f={padding:16,borderRadius:18,border:"1px solid rgba(90,160,255,0.18)",background:"linear-gradient(180deg, rgba(40,80,140,0.06), rgba(0,0,0,0.45))",cursor:"pointer",transition:"transform .22s ease, box-shadow .22s ease, border-color .22s ease, background .22s ease",boxShadow:"0 8px 22px rgba(0,0,0,0.45)"},p={transform:"translateY(-2px)",boxShadow:"0 14px 34px rgba(0,0,0,0.65)",border:"1px solid rgba(120,190,255,0.32)",background:"linear-gradient(180deg, rgba(55,105,190,0.10), rgba(0,0,0,0.55))"},y={fontSize:16,fontWeight:950,margin:0,letterSpacing:.2,color:"rgba(255,255,255,0.96)"},b={fontSize:12,opacity:.84,marginTop:8,lineHeight:1.35,color:"rgba(255,255,255,0.84)"};if(i){const C=a.find(w=>w.key===i)?.title??`Creator Studio: ${i}`;return g.jsxs("div",{style:o,children:[g.jsx("div",{style:c,children:g.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[g.jsxs("div",{children:[g.jsx("h1",{style:{fontSize:22,margin:0},children:C}),g.jsx("div",{style:{opacity:.7,fontSize:12,marginTop:4},children:"Print-ready surface - export anytime."})]}),g.jsx("div",{style:{display:"flex",gap:10},children:g.jsx("button",{type:"button",style:u,onClick:()=>window.print(),title:"Print / Save PDF",children:"Print / Save PDF"})})]})}),g.jsx(oO,{mode:i,onBack:()=>n("/planet/creator/studio"),onBuild:()=>n("/planet/creator/build")})]})}return g.jsxs("div",{style:o,children:[g.jsx("div",{style:c,children:g.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:g.jsxs("div",{children:[g.jsx("h1",{style:{fontSize:22,margin:0},children:"Creator Studio"}),g.jsx("div",{style:{opacity:.7,fontSize:12,marginTop:4},children:"Choose what you are making, then customize and export print-ready."})]})})}),g.jsx("div",{style:h,children:a.map(k=>g.jsxs("div",{style:e===k.key?{...f,...p}:f,onMouseEnter:()=>t(k.key),onMouseLeave:()=>t(null),onFocus:()=>t(k.key),onBlur:()=>t(null),onClick:()=>n(`/planet/creator/studio/${k.key}`),onKeyDown:C=>{(C.key==="Enter"||C.key===" ")&&n(`/planet/creator/studio/${k.key}`)},role:"button",tabIndex:0,title:k.title,children:[g.jsxs("h3",{style:y,children:[k.title," ",k.badge?g.jsx("span",{style:{opacity:.7,marginLeft:8},children:"(recommended)"}):null]}),g.jsx("div",{style:b,children:k.desc})]},k.key))})]})}function lO(n){return n?(Array.isArray(n)?n:[]).map(e=>({id:String(e?.id??""),label:String(e?.label??e?.name??e?.title??e?.id??"City"),desc:e?.desc?String(e.desc):e?.subtitle?String(e.subtitle):void 0})).filter(e=>e.id):[]}function cO(n,e){return["projects","build"].find(a=>e.some(o=>o.id===a))??e[0]?.id??"projects"}function Gb(n){const e=Qt(),t=T.useRef(0),i=T.useCallback(a=>{try{a?.stopPropagation?.()}catch{}const o=Date.now();if(!(o-t.current<450)){t.current=o;try{e(n.to)}catch{}setTimeout(()=>{try{typeof window<"u"&&window.location.assign(n.to)}catch{}},0)}},[e,n.to]);return g.jsx("a",{href:n.to,onClick:i,onTouchEnd:i,onPointerUp:i,role:"link",tabIndex:0,style:{...n.style,WebkitTapHighlightColor:"transparent",touchAction:"manipulation",cursor:"pointer"},children:n.children})}function uO(){const{planetId:n}=Yi(),e=wu.find(O=>O.id===n),t=T.useMemo(()=>lO(e?.cities),[e]),i=T.useMemo(()=>cO(String(n??""),t),[n,t]);if(!e)return g.jsxs("div",{style:{padding:18},children:[g.jsx("h1",{style:{margin:0,fontSize:22},children:"Planet not found"}),g.jsx("p",{style:{marginTop:10,color:"rgba(255,255,255,0.70)"},children:"That planet id doesnt exist yet."})]});const a={title:" Build",subtitle:"Create  release  evolve",desc:"This is the gravity well. Everything begins here.",to:e.id==="creator"?"/planet/creator/build":`/planet/${e.id}/${i}`},o=t.filter(O=>O.id!==i).map(O=>({title:O.label,subtitle:O.desc??"",to:`/planet/${e.id}/${O.id}`,id:O.id})),c={padding:0},u={borderRadius:22,border:"1px solid rgba(255,255,255,0.10)",background:"rgba(255,255,255,0.03)",padding:16},h={display:"grid",gridTemplateColumns:"1.2fr 0.8fr",gap:14,alignItems:"start"},f={display:"grid",gap:12},p={display:"block",textDecoration:"none",borderRadius:18,border:"1px solid rgba(255,255,255,0.10)",background:"rgba(0,0,0,0.18)",padding:14,color:"rgba(255,255,255,0.92)",boxShadow:"0 14px 44px rgba(0,0,0,0.35)",backdropFilter:"blur(10px)"},y={...p,border:"1px solid rgba(255,255,255,0.18)",background:"linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.02))",padding:18,minHeight:140},b={...p,boxShadow:"0 10px 34px rgba(0,0,0,0.30)"},k={display:"inline-flex",alignItems:"center",gap:8,padding:"6px 10px",borderRadius:999,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.05)",color:"rgba(255,255,255,0.75)",fontSize:12,fontWeight:800,marginTop:10},C={margin:0,fontSize:22,fontWeight:950},w={marginTop:8,color:"rgba(255,255,255,0.70)",lineHeight:1.5};return g.jsx("div",{style:c,children:g.jsxs("div",{style:u,children:[g.jsx("div",{style:{display:"flex",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:g.jsxs("div",{children:[g.jsxs("h1",{style:{margin:0,fontSize:24},children:[" Planet: ",g.jsx("span",{style:{fontWeight:950},children:e.label??e.id})]}),g.jsx("div",{style:{marginTop:8,color:"rgba(255,255,255,0.65)"},children:e?.subtitle??""}),g.jsxs("div",{style:k,children:[g.jsx("span",{children:"Primary Path:"}),g.jsx("span",{style:{color:"rgba(255,255,255,0.92)"},children:"Build"})]})]})}),g.jsx("div",{style:{marginTop:14},children:g.jsxs("div",{style:h,children:[g.jsxs(Gb,{to:a.to,style:y,children:[g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12},children:[g.jsxs("div",{children:[g.jsx("h2",{style:C,children:a.title}),g.jsx("div",{style:{marginTop:6,color:"rgba(255,255,255,0.78)",fontWeight:800},children:a.subtitle})]}),g.jsx("div",{style:{padding:"6px 10px",borderRadius:999,border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.85)",fontSize:12,fontWeight:900,whiteSpace:"nowrap"},children:"Enter"})]}),g.jsx("div",{style:w,children:a.desc})]}),g.jsxs("div",{style:f,children:[g.jsx("div",{style:{fontWeight:900,color:"rgba(255,255,255,0.85)",marginLeft:2},children:"Cities"}),o.length===0?g.jsx("div",{style:{borderRadius:18,border:"1px dashed rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.02)",padding:14,color:"rgba(255,255,255,0.65)"},children:"No other cities yet. Build is the entry point."}):o.slice(0,6).map(O=>g.jsxs(Gb,{to:O.to,style:b,children:[g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:10,alignItems:"center"},children:[g.jsx("div",{style:{fontWeight:950},children:O.title}),g.jsx("div",{style:{opacity:.65,fontWeight:900},children:""})]}),O.subtitle?g.jsx("div",{style:{marginTop:8,color:"rgba(255,255,255,0.65)",lineHeight:1.45},children:O.subtitle}):null]},O.id))]})]})})]})})}function dO(){const{planetId:n,cityId:e}=Yi(),t=wu.find(a=>a.id===n),i=t?.cities.find(a=>a.id===e);return g.jsxs("div",{children:[g.jsxs("h1",{style:{fontSize:24,margin:0},children:[" ",t?.label??n," / ",i?.label??e]}),g.jsx("p",{style:{marginTop:10,color:"rgba(255,255,255,0.70)",lineHeight:1.5},children:"Placeholder city page. Next we wire real actions + presence-first capture for this city."}),g.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",marginTop:14},children:[g.jsxs("div",{style:{flex:"1 1 260px",borderRadius:18,border:"1px solid rgba(255,255,255,0.10)",padding:14,background:"rgba(255,255,255,0.03)"},children:[g.jsx("div",{style:{fontWeight:800},children:"Next Action"}),g.jsx("div",{style:{marginTop:6,color:"rgba(255,255,255,0.65)"},children:"Add one Create flow here (single form + save + visible proof)."})]}),g.jsxs("div",{style:{flex:"1 1 260px",borderRadius:18,border:"1px solid rgba(255,255,255,0.10)",padding:14,background:"rgba(255,255,255,0.03)"},children:[g.jsx("div",{style:{fontWeight:800},children:"Presence"}),g.jsx("div",{style:{marginTop:6,color:"rgba(255,255,255,0.65)"},children:"Auto-anchor presence at inception (no interruptions)."})]}),g.jsxs("div",{style:{flex:"1 1 260px",borderRadius:18,border:"1px solid rgba(255,255,255,0.10)",padding:14,background:"rgba(255,255,255,0.03)"},children:[g.jsx("div",{style:{fontWeight:800},children:"Telemetry Lens"}),g.jsx("div",{style:{marginTop:6,color:"rgba(255,255,255,0.65)"},children:"Later: witness logs & live build mode overlay."})]})]})]})}async function fk(n,e){const{data:t}=await je.auth.getUser();if(!t?.user)throw new Error("Not authenticated");const i=t.user.id,{data:a,error:o}=await je.from("projects").select("id").eq("owner_id",i).eq("kind",n).eq("status","active").order("updated_at",{ascending:!1}).limit(1);if(!o&&a&&a.length>0)return{id:a[0].id};const{data:c,error:u}=await je.from("projects").insert({kind:n,title:e,status:"active",owner_id:i}).select("id").single();if(u)throw u;return{id:c.id}}function hO(){const n=Qt(),{setActiveProjectId:e}=Hu(),[t,i]=T.useState([]),[a,o]=T.useState(!0),[c,u]=T.useState(null),h=T.useMemo(()=>t.filter(y=>y.status!=="deleted"),[t]);async function f(){o(!0),u(null);const{data:y}=await je.auth.getUser(),b=y?.user;if(!b){i([]),u("Not authenticated"),o(!1);return}const{data:k,error:C}=await je.from("projects").select("id, kind, title, status, updated_at, created_at").eq("owner_id",b.id).order("updated_at",{ascending:!1});C?(u(C.message),i([])):i(k??[]),o(!1)}T.useEffect(()=>{let y=!1;return(async()=>y||await f())(),()=>{y=!0}},[]);async function p(){console.log("[HP] New Build Project CLICKED",new Date().toISOString());try{console.log("[HP] Checking auth session...");const y=await je.auth.getSession();console.log("[HP] Session:",y?.data?.session?"YES":"NO",y),u(null);const b=await fk("build","Untitled Build");e(b.id),n("/planet/creator/build")}catch(y){console.error("[HP] createBuildProject FAILED:",y),u(y?.message??String(y))}}return g.jsxs("div",{style:{padding:18,maxWidth:980,margin:"0 auto"},children:[g.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:14},children:[g.jsxs("div",{children:[g.jsx("h1",{style:{fontSize:22,margin:0},children:"Creator Projects"}),g.jsx("div",{style:{opacity:.82,fontSize:12},children:"Canonical registry (projects table)"})]}),g.jsxs("div",{style:{display:"flex",gap:10},children:[g.jsx("button",{onClick:()=>{f()},style:{padding:"10px 12px",borderRadius:12,border:"1px solid rgba(255,255,255,0.28)",background:"rgba(0,0,0,0.45)",color:"white",cursor:"pointer",fontWeight:800},children:"Refresh"}),g.jsx("button",{onClick:()=>{p()},style:{padding:"10px 12px",borderRadius:12,border:"1px solid rgba(255,255,255,0.28)",background:"rgba(0,0,0,0.45)",color:"white",cursor:"pointer",fontWeight:900},children:"New Build Project"})]})]}),a&&g.jsx("div",{style:{opacity:.8},children:"Loading"}),!a&&c&&g.jsxs("div",{style:{padding:12,borderRadius:12,border:"1px solid rgba(255,255,255,0.24)"},children:[g.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"Could not load projects"}),g.jsx("div",{style:{opacity:.8,fontSize:13},children:c})]}),!a&&!c&&h.length===0&&g.jsxs("div",{style:{padding:14,borderRadius:14,border:"1px solid rgba(255,255,255,0.24)"},children:[g.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"No projects yet."}),g.jsx("div",{style:{opacity:.8,fontSize:13,marginBottom:12},children:"Create your first canonical build project."}),g.jsx("button",{onClick:()=>{p()},style:{padding:"10px 12px",borderRadius:12,border:"1px solid rgba(255,255,255,0.28)",background:"rgba(0,0,0,0.45)",color:"white",cursor:"pointer",fontWeight:900},children:"Create Build Project"})]}),!a&&!c&&h.length>0&&g.jsx("div",{style:{display:"grid",gap:10},children:h.map(y=>g.jsxs("button",{onClick:()=>{e(y.id),y.kind==="city"?n("/planet/creator/city"):n("/planet/creator/build")},style:{textAlign:"left",padding:14,borderRadius:14,border:"1px solid rgba(255,255,255,0.24)",background:"rgba(255,255,255,0.12)",color:"rgba(255,255,255,0.92)",cursor:"pointer"},children:[g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[g.jsx("div",{style:{fontWeight:800},children:y.title?.trim()?y.title:"Untitled"}),g.jsx("div",{style:{opacity:.82,fontSize:12},children:y.kind})]}),g.jsx("div",{style:{opacity:.82,fontSize:12,marginTop:6},children:y.id}),g.jsx("div",{style:{opacity:.82,fontSize:11,marginTop:4},children:"Click to open"})]},y.id))})]})}function fO(){const n=window;return n.SpeechRecognition||n.webkitSpeechRecognition||null}function Kb(n){return String(n||"").replace(/\s+/g," ").replace(/\u00A0/g," ").trim()}function pO(n){const{onFinal:e,disabled:t,lang:i="en-US"}=n,[a,o]=T.useState("idle"),[c,u]=T.useState(null),[h,f]=T.useState(""),p=T.useRef(null),y=T.useRef(!1),b=T.useRef(null),k=T.useRef({t:"",ts:0}),C=T.useRef(new Map),w=()=>{b.current&&window.clearTimeout(b.current),b.current=null},O=()=>{y.current=!1,w(),o("idle"),f("");try{p.current?.stop?.()}catch{}},R=()=>{try{p.current?.abort?.()}catch{}p.current=null},P=F=>{const B=Kb(F);if(!B)return!1;const z=Date.now();if(B===k.current.t&&z-k.current.ts<2500)return!1;const H=C.current.get(B);if(H&&z-H<4e3)return!1;k.current={t:B,ts:z},C.current.set(B,z);for(const[ie,he]of C.current.entries())z-he>1e4&&C.current.delete(ie);return!0},j=()=>{if(p.current)return p.current;const F=fO();if(!F)throw new Error("SpeechRecognition not supported in this browser");const B=new F;return B.continuous=!1,B.interimResults=!0,B.maxAlternatives=1,B.lang=i,B.onstart=()=>{u(null),f(""),o("listening")},B.onspeechend=()=>{try{B.stop()}catch{}},B.onerror=z=>{const H=z?.error?String(z.error):"speech error";if(u(H),H==="not-allowed"||H==="service-not-allowed"){y.current=!1,o("idle"),f("");return}y.current?(w(),b.current=window.setTimeout(()=>{try{B.start(),o("starting")}catch{}},180)):o("idle")},B.onresult=z=>{try{let H="";for(let ie=z.resultIndex;ie<z.results.length;ie++){const he=z.results[ie],Z=Kb(he?.[0]?.transcript||"");Z&&(he.isFinal?(f(""),P(Z)&&e?.(Z)):H=Z)}H&&f(H)}catch{}},B.onend=()=>{y.current?(w(),b.current=window.setTimeout(()=>{try{B.start(),o("starting")}catch{R();try{j().start(),o("starting")}catch{}}},120)):o("idle")},p.current=B,B},E=()=>{u(null),f(""),y.current=!0,o("starting"),k.current={t:"",ts:0},C.current=new Map;try{p.current?.abort?.()}catch{}try{const F=j();window.setTimeout(()=>{try{F.start()}catch(B){const z=String(B?.message||B);/start/i.test(z)||u(z)}},40)}catch(F){u(String(F?.message||F)),o("idle")}},_=()=>{t||(y.current?O():E())};T.useEffect(()=>()=>{try{y.current=!1,O(),R()}catch{}},[]);const A=a==="listening"||a==="starting",I=T.useMemo(()=>({wrap:{display:"inline-flex",alignItems:"center",gap:10},btn:{height:38,padding:"0 14px",borderRadius:12,display:"inline-flex",alignItems:"center",gap:10,border:A?"1px solid rgba(0,255,150,0.55)":"1px solid rgba(255,255,255,0.16)",background:A?"rgba(0,255,150,0.10)":"rgba(0,0,0,0.22)",boxShadow:A?"0 0 0 3px rgba(0,255,150,0.16), 0 14px 36px rgba(0,0,0,0.45)":"none",cursor:t?"not-allowed":"pointer",userSelect:"none",transition:"all 160ms ease",color:"rgba(255,255,255,0.92)",fontWeight:900,letterSpacing:.2},icon:{display:"inline-flex",alignItems:"center",justifyContent:"center"},status:{fontSize:12,opacity:.78,color:"rgba(255,255,255,0.82)",fontWeight:700,maxWidth:260,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},err:{fontSize:12,opacity:.85}}),[t,A]);return g.jsxs("div",{style:I.wrap,children:[g.jsxs("button",{type:"button",onClick:_,disabled:!!t,"aria-pressed":A,title:A?"Stop dictation":"Start dictation",style:I.btn,children:[g.jsx("span",{style:I.icon,"aria-hidden":"true",children:g.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",children:g.jsx("path",{fill:A?"rgba(0,255,150,0.95)":"rgba(210,210,210,0.90)",d:"M12 14.25a3.25 3.25 0 0 0 3.25-3.25V6.5A3.25 3.25 0 0 0 12 3.25 3.25 3.25 0 0 0 8.75 6.5V11A3.25 3.25 0 0 0 12 14.25Zm6-3.25a.75.75 0 0 0-1.5 0 4.5 4.5 0 0 1-9 0A.75.75 0 0 0 6 11a6 6 0 0 0 5.25 5.96V20H9a.75.75 0 0 0 0 1.5h6A.75.75 0 0 0 15 20h-2.25v-3.04A6 6 0 0 0 18 11Z"})})}),A?"Listening":"Speak"]}),g.jsxs("div",{style:I.status,children:[c?g.jsxs("span",{style:I.err,children:["Mic: ",c]}):null,!c&&A?h||(a==="starting"?"":""):null]})]})}const mO="hp.projects.v1",vm="hp.activeProjectId.v1",gO=new Set;function pk(){gO.forEach(n=>n())}function vO(){return localStorage.getItem(vm)}function hs(n){localStorage.setItem(vm,n),pk()}function yO(n){n.key&&(n.key===mO||n.key===vm)&&pk()}typeof window<"u"&&window.addEventListener("storage",yO);function ru(n){const e=String(n||"").trim();if(!e)return"Untitled Site";const t=e.split(`
`).map(h=>h.trim()).filter(Boolean)[0]||e,i=t.split(/[.!?]/).map(h=>h.trim()).filter(Boolean)[0]||t,a=i.match(/\b(called|named)\s+([A-Za-z0-9&'".\- ]{2,60})/i);if(a?.[2])return a[2].trim().replace(/^["']+|["']+$/g,"");const u=i.replace(/^i\s+(run|own|have|started)\s+/i,"").trim().replace(/^a\s+|an\s+|the\s+/i,"").trim().slice(0,56).trim();return u?u.replace(/^["']+|["']+$/g,""):"Untitled Site"}function Bo(n){const e=String(n||"").trim(),t=ru(e),a=(y=>e.match(y)?.[1]?.trim())(/\b(?:in|based in|located in)\s+([A-Za-z .,'-]{2,40})/i),o=e.match(/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2}/i)?.[0],c=e.match(/\b(\+?1[\s.-]?)?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}\b/)?.[0],u=/\b(book|booking|schedule|appointment|reserve)\b/i.test(e),h=/\b(quote|estimate|pricing|price)\b/i.test(e),f=/\b(shop|store|buy|order)\b/i.test(e);return`H1: ${t}

Subheadline: Built from your description  ready to share

About:
${e||"Describe what you do, who it's for, and what you want customers to do."}

Services:
- Classes
- Private lessons
- Events

Products:
- Merchandise
- Gift cards

CTA: ${u&&"View Schedule"||f&&"Shop"||h&&"Get a Quote"||"Contact"}

Contact:
${[a?`Location: ${a}`:"Location:",c?`Phone: ${c}`:"Phone:",o?`Email: ${o}`:"Email:","Instagram:","Website:"].join(`
`)}
`}function bO(){const n=Qt(),[e,t]=T.useState(()=>typeof window<"u"?window.innerWidth<900:!0);T.useEffect(()=>{const N=()=>t(window.innerWidth<900);return window.addEventListener("resize",N),()=>window.removeEventListener("resize",N)},[]);const{activeProjectId:i,setActiveProjectId:a,hydrateActiveFromStorage:o}=Hu(),[c,u]=T.useState("I run a Tampa-based dance studio that teaches hip hop and contemporary classes for kids and adults. Booking online. Contact: hello@movetampa.com"),[h,f]=T.useState(()=>Bo("I run a Tampa-based dance studio that teaches hip hop and contemporary classes for kids and adults. Booking online. Contact: hello@movetampa.com")),[p,y]=T.useState(1),[b,k]=T.useState("idle"),[C,w]=T.useState(null),O=T.useRef(null),R=T.useRef(null),P=T.useRef(""),j=T.useMemo(()=>ru(c),[c]);function E(N){const K=String(N??"").trim();K&&u(ae=>{const pe=ae&&!ae.endsWith(`
`)?`
`:"",ye=`${ae}${pe}${K}`,D=Bo(ye),J=Li(D);return f(J),B(J,ye),ye})}T.useEffect(()=>{o?.();const N=vO();N&&!i&&a(N)},[]);async function _(){return i||(O.current||(k("creating"),O.current=(async()=>{const N=await fk("build","Untitled Site");return a(N.id),hs(N.id),k("idle"),N.id})()),O.current)}async function A(N){const{data:K,error:ae}=await je.from("project_drafts").select("project_id, body").eq("project_id",N).maybeSingle();if(ae)throw ae;const pe=K;if(pe?.body!=null){const ye=Li(pe.body);f(ye);const D=ye.match(/About:\s*([\s\S]*?)\n\n(?:Services:|Products:|CTA:|Contact:)/i);D?.[1]&&u(D[1].trim()),P.current=ru(D?.[1]||ye)}}async function I(N,K){try{const ae=ru(K);if(!ae||ae===P.current)return;const{data:pe,error:ye}=await je.from("projects").select("title").eq("id",N).maybeSingle();if(ye)return;const D=(pe?.title??"").trim();if(!(!D||D.toLowerCase().includes("untitled")))return;const{error:oe}=await je.from("projects").update({title:ae}).eq("id",N);oe||(P.current=ae)}catch{}}async function F(N,K,ae){const{data:pe}=await je.auth.getUser();if(!pe?.user)throw new Error("Not authenticated");k("saving");const{error:ye}=await je.from("project_drafts").upsert({project_id:N,owner_id:pe.user.id,body:K},{onConflict:"project_id"});if(ye)throw ye;I(N,ae),k("saved"),window.setTimeout(()=>k("idle"),650)}T.useEffect(()=>{let N=!1;return(async()=>{if(i)try{await A(i)}catch(K){N||(w(K?.message??String(K)),k("error"))}})(),()=>{N=!0}},[i]);function B(N,K){R.current&&window.clearTimeout(R.current),R.current=window.setTimeout(async()=>{try{w(null);const ae=await _();hs(ae),await F(ae,N,K)}catch(ae){w(ae?.message??String(ae)),k("error")}},350)}T.useEffect(()=>{(async()=>{try{if(!i){const{data:N}=await je.auth.getUser();if(!N?.user)return;const K=await _();hs(K),await F(K,h,c)}}catch(N){w(N?.message??String(N)),k("error")}})()},[]);const z="I run a Tampa-based dance studio that teaches hip hop and contemporary classes for kids and adults. Booking online. Contact: hello@movetampa.com";async function H(){try{w(null);const N=await _();hs(N);const K=Li(c),ae=Li(h);u(K),f(ae),await F(N,ae,K),y(pe=>pe+1)}catch(N){w(N?.message??String(N)),k("error")}}async function ie(){try{w(null);const N=await _();hs(N);const K=z,ae=Bo(K),pe=Li(K),ye=Li(ae);u(pe),f(ye),await F(N,ye,pe),y(D=>D+1)}catch(N){w(N?.message??String(N)),k("error")}}const he=b==="creating"&&"creating"||b==="saving"&&"saving"||b==="saved"&&"saved "||b==="error"&&"error"||(i?"auto-saved":"start typing"),Z={height:40,padding:"0 12px",borderRadius:999,border:"1px solid rgba(255,255,255,0.16)",background:"rgba(255,255,255,0.06)",color:"white",cursor:"pointer",fontWeight:900,fontSize:12,letterSpacing:.2,whiteSpace:"nowrap",display:"inline-flex",alignItems:"center",justifyContent:"center"},le={padding:14,borderRadius:18,border:"1px solid rgba(255,255,255,0.10)",background:"rgba(0,0,0,0.22)",boxShadow:"0 10px 30px rgba(0,0,0,0.25)",minWidth:0};return g.jsxs("div",{style:{padding:18,maxWidth:1200,margin:"0 auto"},children:[g.jsxs("div",{style:{marginBottom:12,padding:"10px 12px",borderRadius:14,border:"2px solid rgba(0,255,150,0.55)",background:"rgba(0,255,150,0.14)",color:"white",fontWeight:900},children:["MIC BUILD ACTIVE  (CreatorBuild.tsx)",g.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",marginTop:10,flexWrap:"wrap"},children:[g.jsx("button",{type:"button",onClick:N=>{N.preventDefault(),N.stopPropagation(),window.print()},style:{touchAction:"manipulation",WebkitTapHighlightColor:"transparent"},children:"Print / Save PDF"}),g.jsx("button",{type:"button",onClick:N=>{N.preventDefault(),N.stopPropagation(),H()},style:{marginLeft:10,height:40,padding:"0 12px",borderRadius:12,border:"1px solid rgba(255,255,255,0.16)",background:"rgba(255,255,255,0.06)",color:"white",cursor:"pointer",fontWeight:900,fontSize:12},title:"Fix ghost characters by rewriting cleaned text back into Supabase",children:"Repair ghosts & save"}),g.jsx("button",{type:"button",onClick:N=>{N.preventDefault(),N.stopPropagation(),ie()},style:{marginLeft:10,height:40,padding:"0 12px",borderRadius:12,border:"1px solid rgba(255,120,120,0.35)",background:"rgba(255,80,80,0.14)",color:"white",cursor:"pointer",fontWeight:900,fontSize:12},title:"Nuclear option: regenerate from idea and overwrite the stored draft",children:"Reset build fresh"})]})]}),g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12,marginBottom:14},children:[g.jsxs("div",{children:[g.jsx("h1",{style:{fontSize:22,margin:0},children:"Creator"}),g.jsx("div",{style:{opacity:.65,fontSize:12},children:"Describe  Build  Preview"})]}),g.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,minWidth:0},children:[g.jsx("div",{style:{opacity:.75,fontSize:12},children:he}),g.jsx("button",{type:"button",onClick:N=>{N.preventDefault(),N.stopPropagation(),n(-1)},style:Z,title:"Back",children:" Back"}),g.jsx("button",{type:"button",onClick:N=>{N.preventDefault(),N.stopPropagation(),n("/planet/creator/projects")},style:Z,children:"Projects"})]})]}),C&&g.jsxs("div",{style:{padding:12,borderRadius:12,border:"1px solid rgba(255,255,255,0.14)",marginBottom:12},children:[g.jsx("div",{style:{fontWeight:800,marginBottom:6},children:"Save error"}),g.jsx("div",{style:{opacity:.85,fontSize:13},children:C})]}),g.jsxs("div",{style:{display:"grid",gridTemplateColumns:e?"1fr":"1fr 1fr",gap:18,alignItems:"start"},children:[g.jsxs("div",{style:le,children:[g.jsx("div",{style:{fontSize:18,fontWeight:900,marginBottom:6},children:"Describe your business or idea"}),g.jsx("div",{style:{opacity:.75,fontSize:12,marginBottom:10},children:"Type a few sentences  or tap the mic  well turn it into a site."}),g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8,gap:10},children:[g.jsx("div",{style:{opacity:.65,fontSize:12},children:"Speak it"}),g.jsx(pO,{onFinal:E})]}),g.jsx("textarea",{id:"creator-idea",name:"creator-idea",value:c,onChange:N=>{const K=N.target.value;u(K);const ae=Bo(K),pe=Li(ae);f(pe),B(pe,K)},placeholder:"Example: I run a Tampa-based dance studio teaching hip hop & contemporary for kids and adults. Booking online. Contact: hello@...",style:{width:"100%",minHeight:280,padding:14,borderRadius:14,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.03)",outline:"none",fontSize:15,lineHeight:1.5,color:"rgba(255,255,255,0.92)",caretColor:"rgba(255,255,255,0.92)"}}),g.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",marginTop:12,flexWrap:"wrap"},children:[g.jsx("button",{onClick:async()=>{const N=Bo(c),K=Li(N);f(K),y(ae=>ae+1);try{const ae=await _();hs(ae),await F(ae,K,c)}catch{}n("/planet/creator/studio")},style:{height:46,padding:"0 16px",borderRadius:14,border:"none",background:"white",color:"black",fontWeight:900,cursor:"pointer"},children:"Launch Creator Studio"}),g.jsxs("div",{style:{fontSize:12,opacity:.75},children:[g.jsx("span",{style:{fontWeight:900},children:j})," ",g.jsx("span",{style:{opacity:.85},children:" Auto-generated  rename anytime."})]})]}),g.jsxs("div",{style:{marginTop:10,opacity:.65,fontSize:12},children:["Active Project ID: ",i??"none yet"]})]}),g.jsx("div",{style:le,children:g.jsx(hk,{rawText:h,projectId:i},p)})]})]})}function Jb(n){return new Date(n).toLocaleString()}function SO(){const{releaseId:n}=Yi(),[e,t]=T.useState(null),[i,a]=T.useState([]);return T.useEffect(()=>{if(!n)return;const c=JSON.parse(localStorage.getItem("hp.creator.build.releases.v1")||"[]").find(p=>p.id===n)||null;if(t(c),!c)return;const u=`hp.creator.build.artifacts.v1.${c.projectId}`,f=JSON.parse(localStorage.getItem(u)||"[]").filter(p=>c.artifactIds.includes(p.id));a(f.sort((p,y)=>p.createdAt-y.createdAt))},[n]),e?g.jsxs("div",{style:{maxWidth:980},children:[g.jsxs("h1",{style:{fontSize:26,marginBottom:6},children:[" ",e.title]}),g.jsxs("div",{style:{color:"rgba(255,255,255,0.65)",marginBottom:16},children:["Released: ",Jb(e.createdAt),"  Release ID: ",e.id]}),g.jsx("div",{style:{borderRadius:16,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.04)",padding:16,marginBottom:20,fontSize:16,lineHeight:1.6},children:e.statement}),g.jsxs("h2",{style:{fontSize:20,marginBottom:10},children:["Frozen Artifacts (",i.length,")"]}),i.map(o=>g.jsxs("div",{style:{borderRadius:14,border:"1px solid rgba(255,255,255,0.10)",background:"rgba(0,0,0,0.20)",padding:14,marginBottom:12},children:[g.jsx("div",{style:{fontWeight:900,fontSize:15},children:o.title}),g.jsx("div",{style:{marginTop:8,whiteSpace:"pre-wrap",lineHeight:1.5,fontSize:14},children:o.body}),g.jsxs("div",{style:{marginTop:10,fontSize:11,color:"rgba(255,255,255,0.55)"},children:["Presence Anchor: ",Jb(o.createdAt),"  Artifact ID: ",o.id]})]},o.id)),g.jsx("div",{style:{marginTop:24,fontSize:13,color:"rgba(255,255,255,0.55)"},children:"This release is immutable. Artifacts were anchored at creation and frozen at release. This record exists to establish public trust."})]}):g.jsxs("div",{children:[g.jsx("h1",{children:" Release Viewer"}),g.jsx("p",{children:"This release does not exist or was removed."})]})}function Yb({title:n,body:e}){return g.jsxs("div",{children:[g.jsx("h1",{style:{fontSize:24,margin:0},children:n}),g.jsx("p",{style:{marginTop:10,color:"rgba(255,255,255,0.70)",lineHeight:1.6,maxWidth:880},children:e}),g.jsx("div",{style:{marginTop:14,color:"rgba(255,255,255,0.55)",fontSize:12},children:"(Placeholder page  we can render your PDFs / doctrine text here next.)"})]})}function TO(){const n=Qt(),e=Hn(),[t,i]=T.useState(""),[a,o]=T.useState(""),[c,u]=T.useState(!1),[h,f]=T.useState(null);T.useEffect(()=>{let b=!0;return je.auth.getSession().then(({data:k})=>{if(b&&k.session){const C=e?.state?.from;n(C||"/planet/creator/projects",{replace:!0})}}),()=>{b=!1}},[n,e]);const p=T.useMemo(()=>t.trim().length>3&&a.length>0&&!c,[t,a,c]);async function y(b){b.preventDefault(),f(null),u(!0);try{const{error:k}=await je.auth.signInWithPassword({email:t.trim(),password:a});if(k)throw k;const C=e?.state?.from;n(C||"/planet/creator/projects",{replace:!0})}catch(k){f(k?.message??"Sign-in failed")}finally{u(!1)}}return g.jsx("div",{className:"hpAuthPage",children:g.jsxs("div",{style:{width:360},children:[g.jsx("h2",{style:{margin:0,marginBottom:10},children:"HomePlanet"}),g.jsx("p",{style:{marginTop:0,opacity:.75,fontSize:13},children:"Sign in to continue."}),g.jsx("form",{onSubmit:y,children:g.jsxs("div",{style:{display:"grid",gap:10},children:[g.jsx("input",{type:"email",placeholder:"you@domain.com",value:t,onChange:b=>i(b.target.value),autoComplete:"email",style:{width:"100%",padding:"10px 12px",borderRadius:10,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(0,0,0,0.25)",color:"rgba(255,255,255,0.92)"}}),g.jsx("input",{type:"password",placeholder:"",value:a,onChange:b=>o(b.target.value),autoComplete:"current-password",style:{width:"100%",padding:"10px 12px",borderRadius:10,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(0,0,0,0.25)",color:"rgba(255,255,255,0.92)"}}),g.jsx("button",{type:"submit",disabled:!p,style:{width:"100%",padding:"10px 12px",borderRadius:10,border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.92)",cursor:p?"pointer":"not-allowed",opacity:p?1:.55,fontWeight:800},children:c?"Signing in...":"Sign in"}),h?g.jsx("div",{style:{opacity:.9,fontSize:13},children:h}):null,g.jsxs("div",{style:{display:"flex",gap:10,fontSize:13,opacity:.8},children:[g.jsx(ri,{to:"/signup",children:"Sign up"}),g.jsx("span",{style:{opacity:.5},children:""}),g.jsx(ri,{to:"/reset-password",children:"Forgot password?"})]})]})})]})})}function kO(){const{signUp:n}=$T(),e=Qt(),[t,i]=T.useState(""),[a,o]=T.useState(""),[c,u]=T.useState(!1),[h,f]=T.useState(null);async function p(y){y.preventDefault(),f(null),u(!0);try{await n(t,a),e("/login",{replace:!0})}catch(b){f(b?.message??"Sign up failed")}finally{u(!1)}}return g.jsxs("div",{style:{width:360},children:[g.jsx("h2",{style:{margin:0,marginBottom:10},children:"HomePlanet"}),g.jsx("p",{style:{marginTop:0,opacity:.75,fontSize:13},children:"Create an account."}),g.jsxs("form",{onSubmit:p,style:{display:"grid",gap:10},children:[g.jsx("input",{value:t,onChange:y=>i(y.target.value),placeholder:"email",type:"email",autoComplete:"email",required:!0,style:{padding:10,borderRadius:10,border:"1px solid rgba(255,255,255,0.15)",background:"rgba(0,0,0,0.4)",color:"#fff"}}),g.jsx("input",{value:a,onChange:y=>o(y.target.value),placeholder:"password",type:"password",autoComplete:"new-password",required:!0,style:{padding:10,borderRadius:10,border:"1px solid rgba(255,255,255,0.15)",background:"rgba(0,0,0,0.4)",color:"#fff"}}),h&&g.jsx("div",{style:{color:"salmon",fontSize:13},children:h}),g.jsx("button",{disabled:c,style:{padding:10,borderRadius:12,border:"1px solid rgba(255,255,255,0.15)",background:"rgba(255,255,255,0.08)",color:"#fff",cursor:"pointer"},children:c?"Working":"Sign up"})]}),g.jsxs("div",{style:{marginTop:10,fontSize:13,opacity:.8},children:["Already have an account? ",g.jsx(ri,{to:"/login",children:"Sign in"})]})]})}function wO(){const n=Qt(),[e,t]=T.useState(""),[i,a]=T.useState(!1),[o,c]=T.useState(null),[u,h]=T.useState(!1);T.useEffect(()=>{je.auth.getSession().then(({data:p})=>{h(!!p.session)})},[]);async function f(p){p.preventDefault(),c(null),a(!0);try{const{error:y}=await je.auth.updateUser({password:e});if(y)throw y;n("/login",{replace:!0})}catch(y){c(y?.message??"Failed to update password")}finally{a(!1)}}return u?g.jsxs("div",{style:{width:360},children:[g.jsx("h2",{style:{margin:0,marginBottom:10},children:"Set new password"}),g.jsxs("form",{onSubmit:f,style:{display:"grid",gap:10},children:[g.jsx("input",{value:e,onChange:p=>t(p.target.value),placeholder:"new password",type:"password",autoComplete:"new-password",required:!0,style:{padding:10,borderRadius:10,border:"1px solid rgba(255,255,255,0.15)",background:"rgba(0,0,0,0.4)",color:"#fff"}}),o&&g.jsx("div",{style:{color:"salmon",fontSize:13},children:o}),g.jsx("button",{disabled:i,style:{padding:10,borderRadius:12,border:"1px solid rgba(255,255,255,0.15)",background:"rgba(255,255,255,0.08)",color:"#fff",cursor:"pointer"},children:i?"Working":"Update password"})]})]}):g.jsx("div",{style:{width:420,opacity:.8,fontSize:13},children:"Open the password reset link from your email in this browser. Once loaded, you can set a new password here."})}var Qb={};function CO(n,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(i){if(i!=="default"&&!(i in n)){var a=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,a.get?a:{enumerable:!0,get:function(){return t[i]}})}})}),Object.freeze(n)}var _O=Object.defineProperty,xO=(n,e,t)=>e in n?_O(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Xb=(n,e,t)=>xO(n,typeof e!="symbol"?e+"":e,t);class Yt{constructor(){Xb(this,"_locking"),Xb(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const t=new Promise(a=>e=()=>{this._locks-=1,a()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),i}}function mt(n,e){if(!n)throw new Error(e)}const EO=34028234663852886e22,RO=-34028234663852886e22,OO=4294967295,AO=2147483647,jO=-2147483648;function au(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>AO||n<jO)throw new Error("invalid int 32: "+n)}function wp(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>OO||n<0)throw new Error("invalid uint 32: "+n)}function mk(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>EO||n<RO))throw new Error("invalid float 32: "+n)}const gk=Symbol("@bufbuild/protobuf/enum-type");function PO(n){const e=n[gk];return mt(e,"missing enum type on enum object"),e}function vk(n,e,t,i){n[gk]=yk(e,t.map(a=>({no:a.no,name:a.name,localName:n[a.no]})))}function yk(n,e,t){const i=Object.create(null),a=Object.create(null),o=[];for(const c of e){const u=bk(c);o.push(u),i[c.name]=u,a[c.no]=u}return{typeName:n,values:o,findName(c){return i[c]},findNumber(c){return a[c]}}}function DO(n,e,t){const i={};for(const a of e){const o=bk(a);i[o.localName]=o.no,i[o.no]=o.localName}return vk(i,n,e),i}function bk(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class ym{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const i=this.getType(),a=i.runtime.bin,o=a.makeReadOptions(t);return a.readMessage(this,o.readerFactory(e),e.byteLength,o),this}fromJson(e,t){const i=this.getType(),a=i.runtime.json,o=a.makeReadOptions(t);return a.readMessage(i,e,o,this),this}fromJsonString(e,t){let i;try{i=JSON.parse(e)}catch(a){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(a instanceof Error?a.message:String(a)))}return this.fromJson(i,t)}toBinary(e){const t=this.getType(),i=t.runtime.bin,a=i.makeWriteOptions(e),o=a.writerFactory();return i.writeMessage(this,o,a),o.finish()}toJson(e){const t=this.getType(),i=t.runtime.json,a=i.makeWriteOptions(e);return i.writeMessage(this,a)}toJsonString(e){var t;const i=this.toJson(e);return JSON.stringify(i,null,(t=e?.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function MO(n,e,t,i){var a;const o=(a=i?.localName)!==null&&a!==void 0?a:e.substring(e.lastIndexOf(".")+1),c={[o]:function(u){n.util.initFields(this),n.util.initPartial(u,this)}}[o];return Object.setPrototypeOf(c.prototype,new ym),Object.assign(c,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(u,h){return new c().fromBinary(u,h)},fromJson(u,h){return new c().fromJson(u,h)},fromJsonString(u,h){return new c().fromJsonString(u,h)},equals(u,h){return n.util.equals(c,u,h)}}),c}function NO(){let n=0,e=0;for(let i=0;i<28;i+=7){let a=this.buf[this.pos++];if(n|=(a&127)<<i,(a&128)==0)return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,(t&128)==0)return this.assertBounds(),[n,e];for(let i=3;i<=31;i+=7){let a=this.buf[this.pos++];if(e|=(a&127)<<i,(a&128)==0)return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function Uf(n,e,t){for(let o=0;o<28;o=o+7){const c=n>>>o,u=!(!(c>>>7)&&e==0),h=(u?c|128:c)&255;if(t.push(h),!u)return}const i=n>>>28&15|(e&7)<<4,a=e>>3!=0;if(t.push((a?i|128:i)&255),!!a){for(let o=3;o<31;o=o+7){const c=e>>>o,u=!!(c>>>7),h=(u?c|128:c)&255;if(t.push(h),!u)return}t.push(e>>>31&1)}}const su=4294967296;function Zb(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let i=0,a=0;function o(c,u){const h=Number(n.slice(c,u));a*=t,i=i*t+h,i>=su&&(a=a+(i/su|0),i=i%su)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),e?Tk(i,a):bm(i,a)}function IO(n,e){let t=bm(n,e);const i=t.hi&2147483648;i&&(t=Tk(t.lo,t.hi));const a=Sk(t.lo,t.hi);return i?"-"+a:a}function Sk(n,e){if({lo:n,hi:e}=LO(n,e),e<=2097151)return String(su*e+n);const t=n&16777215,i=(n>>>24|e<<8)&16777215,a=e>>16&65535;let o=t+i*6777216+a*6710656,c=i+a*8147497,u=a*2;const h=1e7;return o>=h&&(c+=Math.floor(o/h),o%=h),c>=h&&(u+=Math.floor(c/h),c%=h),u.toString()+eS(c)+eS(o)}function LO(n,e){return{lo:n>>>0,hi:e>>>0}}function bm(n,e){return{lo:n|0,hi:e|0}}function Tk(n,e){return e=~e,n?n=~n+1:e+=1,bm(n,e)}const eS=n=>{const e=String(n);return"0000000".slice(e.length)+e};function tS(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function UO(){let n=this.buf[this.pos++],e=n&127;if((n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,(n&128)==0)return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;(n&128)!==0&&t<10;t++)n=this.buf[this.pos++];if((n&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function BO(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof process!="object"||typeof Qb!="object"||Qb.BUF_BIGINT_DISABLE!=="1")){const a=BigInt("-9223372036854775808"),o=BigInt("9223372036854775807"),c=BigInt("0"),u=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(h){const f=typeof h=="bigint"?h:BigInt(h);if(f>o||f<a)throw new Error("int64 invalid: ".concat(h));return f},uParse(h){const f=typeof h=="bigint"?h:BigInt(h);if(f>u||f<c)throw new Error("uint64 invalid: ".concat(h));return f},enc(h){return n.setBigInt64(0,this.parse(h),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(h){return n.setBigInt64(0,this.uParse(h),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(h,f){return n.setInt32(0,h,!0),n.setInt32(4,f,!0),n.getBigInt64(0,!0)},uDec(h,f){return n.setInt32(0,h,!0),n.setInt32(4,f,!0),n.getBigUint64(0,!0)}}}const t=a=>mt(/^-?[0-9]+$/.test(a),"int64 invalid: ".concat(a)),i=a=>mt(/^[0-9]+$/.test(a),"uint64 invalid: ".concat(a));return{zero:"0",supported:!1,parse(a){return typeof a!="string"&&(a=a.toString()),t(a),a},uParse(a){return typeof a!="string"&&(a=a.toString()),i(a),a},enc(a){return typeof a!="string"&&(a=a.toString()),t(a),Zb(a)},uEnc(a){return typeof a!="string"&&(a=a.toString()),i(a),Zb(a)},dec(a,o){return IO(a,o)},uDec(a,o){return Sk(a,o)}}}const lt=BO();var se;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(se||(se={}));var Ir;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(Ir||(Ir={}));function Cr(n,e,t){if(e===t)return!0;if(n==se.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}switch(n){case se.UINT64:case se.FIXED64:case se.INT64:case se.SFIXED64:case se.SINT64:return e==t}return!1}function Ds(n,e){switch(n){case se.BOOL:return!1;case se.UINT64:case se.FIXED64:case se.INT64:case se.SFIXED64:case se.SINT64:return e==0?lt.zero:"0";case se.DOUBLE:case se.FLOAT:return 0;case se.BYTES:return new Uint8Array(0);case se.STRING:return"";default:return 0}}function kk(n,e){switch(n){case se.BOOL:return e===!1;case se.STRING:return e==="";case se.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var St;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(St||(St={}));class zO{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let a=0;a<this.chunks.length;a++)e+=this.chunks[a].length;let t=new Uint8Array(e),i=0;for(let a=0;a<this.chunks.length;a++)t.set(this.chunks[a],i),i+=this.chunks[a].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(wp(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return au(e),tS(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){mk(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){wp(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){au(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return au(e),e=(e<<1^e>>31)>>>0,tS(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),a=lt.enc(e);return i.setInt32(0,a.lo,!0),i.setInt32(4,a.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),a=lt.uEnc(e);return i.setInt32(0,a.lo,!0),i.setInt32(4,a.hi,!0),this.raw(t)}int64(e){let t=lt.enc(e);return Uf(t.lo,t.hi,this.buf),this}sint64(e){let t=lt.enc(e),i=t.hi>>31,a=t.lo<<1^i,o=(t.hi<<1|t.lo>>>31)^i;return Uf(a,o,this.buf),this}uint64(e){let t=lt.uEnc(e);return Uf(t.lo,t.hi,this.buf),this}}class qO{constructor(e,t){this.varint64=NO,this.uint32=UO,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,i=e&7;if(t<=0||i<0||i>5)throw new Error("illegal tag: field no "+t+" wire type "+i);return[t,i]}skip(e,t){let i=this.pos;switch(e){case St.Varint:for(;this.buf[this.pos++]&128;);break;case St.Bit64:this.pos+=4;case St.Bit32:this.pos+=4;break;case St.LengthDelimited:let a=this.uint32();this.pos+=a;break;case St.StartGroup:for(;;){const[o,c]=this.tag();if(c===St.EndGroup){if(t!==void 0&&o!==t)throw new Error("invalid end group tag");break}this.skip(c,o)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return lt.dec(...this.varint64())}uint64(){return lt.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),i=-(e&1);return e=(e>>>1|(t&1)<<31)^i,t=t>>>1^i,lt.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return lt.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return lt.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function FO(n,e,t,i){let a;return{typeName:e,extendee:t,get field(){if(!a){const o=typeof i=="function"?i():i;o.name=e.split(".").pop(),o.jsonName="[".concat(e,"]"),a=n.util.newFieldList([o]).list()[0]}return a},runtime:n}}function wk(n){const e=n.field.localName,t=Object.create(null);return t[e]=HO(n),[t,()=>t[e]]}function HO(n){const e=n.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Ds(e.T,e.L);case"message":const t=e.T,i=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function VO(n,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=n.length-1;t>=0;--t)if(n[t].no==e.no)return[n[t]];return[]}return n.filter(t=>t.no===e.no)}let qi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Vu=[];for(let n=0;n<qi.length;n++)Vu[qi[n].charCodeAt(0)]=n;Vu[45]=qi.indexOf("+");Vu[95]=qi.indexOf("/");const Ck={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),i=0,a=0,o,c=0;for(let u=0;u<n.length;u++){if(o=Vu[n.charCodeAt(u)],o===void 0)switch(n[u]){case"=":a=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(a){case 0:c=o,a=1;break;case 1:t[i++]=c<<2|(o&48)>>4,c=o,a=2;break;case 2:t[i++]=(c&15)<<4|(o&60)>>2,c=o,a=3;break;case 3:t[i++]=(c&3)<<6|o,a=0;break}}if(a==1)throw Error("invalid base64 string.");return t.subarray(0,i)},enc(n){let e="",t=0,i,a=0;for(let o=0;o<n.length;o++)switch(i=n[o],t){case 0:e+=qi[i>>2],a=(i&3)<<4,t=1;break;case 1:e+=qi[a|i>>4],a=(i&15)<<2,t=2;break;case 2:e+=qi[a|i>>6],e+=qi[i&63],t=0;break}return t&&(e+=qi[a],e+="=",t==1&&(e+="=")),e}};function $O(n,e,t){xk(e,n);const i=e.runtime.bin.makeReadOptions(t),a=VO(n.getType().runtime.bin.listUnknownFields(n),e.field),[o,c]=wk(e);for(const u of a)e.runtime.bin.readField(o,i.readerFactory(u.data),e.field,u.wireType,i);return c()}function WO(n,e,t,i){xk(e,n);const a=e.runtime.bin.makeReadOptions(i),o=e.runtime.bin.makeWriteOptions(i);if(_k(n,e)){const f=n.getType().runtime.bin.listUnknownFields(n).filter(p=>p.no!=e.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const p of f)n.getType().runtime.bin.onUnknownField(n,p.no,p.wireType,p.data)}const c=o.writerFactory();let u=e.field;!u.opt&&!u.repeated&&(u.kind=="enum"||u.kind=="scalar")&&(u=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(u,t,c,o);const h=a.readerFactory(c.finish());for(;h.pos<h.len;){const[f,p]=h.tag(),y=h.skip(p,f);n.getType().runtime.bin.onUnknownField(n,f,p,y)}}function _k(n,e){const t=n.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(n).find(i=>i.no==e.field.no)}function xk(n,e){mt(n.extendee.typeName==e.getType().typeName,"extension ".concat(n.typeName," can only be applied to message ").concat(n.extendee.typeName))}function Ek(n,e){const t=n.localName;if(n.repeated)return e[t].length>0;if(n.oneof)return e[n.oneof.localName].case===t;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?e[t]!==void 0:n.kind=="enum"?e[t]!==n.T.values[0].no:!kk(n.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function nS(n,e){const t=n.localName,i=!n.opt&&!n.req;if(n.repeated)e[t]=[];else if(n.oneof)e[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":e[t]={};break;case"enum":e[t]=i?n.T.values[0].no:void 0;break;case"scalar":e[t]=i?Ds(n.T,n.L):void 0;break;case"message":e[t]=void 0;break}}function Fi(n,e){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(ym.prototype).every(i=>i in n&&typeof n[i]=="function"))return!1;const t=n.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function Rk(n,e){return Fi(e)||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}se.DOUBLE,se.FLOAT,se.INT64,se.UINT64,se.INT32,se.UINT32,se.BOOL,se.STRING,se.BYTES;const iS={ignoreUnknownFields:!1},rS={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function GO(n){return n?Object.assign(Object.assign({},iS),n):iS}function KO(n){return n?Object.assign(Object.assign({},rS),n):rS}const Cu=Symbol(),ou=Symbol();function JO(){return{makeReadOptions:GO,makeWriteOptions:KO,readMessage(n,e,t,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(n.typeName," from JSON: ").concat(fi(e)));i=i??new n;const a=new Map,o=t.typeRegistry;for(const[c,u]of Object.entries(e)){const h=n.fields.findJsonName(c);if(h){if(h.oneof){if(u===null&&h.kind=="scalar")continue;const f=a.get(h.oneof);if(f!==void 0)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: multiple keys for oneof "').concat(h.oneof.name,'" present: "').concat(f,'", "').concat(c,'"'));a.set(h.oneof,c)}aS(i,u,h,t,n)}else{let f=!1;if(o?.findExtension&&c.startsWith("[")&&c.endsWith("]")){const p=o.findExtension(c.substring(1,c.length-1));if(p&&p.extendee.typeName==n.typeName){f=!0;const[y,b]=wk(p);aS(y,u,p.field,t,p),WO(i,p,b(),t)}}if(!f&&!t.ignoreUnknownFields)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: key "').concat(c,'" is unknown'))}}return i},writeMessage(n,e){const t=n.getType(),i={};let a;try{for(a of t.fields.byNumber()){if(!Ek(a,n)){if(a.req)throw"required field not set";if(!e.emitDefaultValues||!QO(a))continue}const c=a.oneof?n[a.oneof.localName].value:n[a.localName],u=sS(a,c,e);u!==void 0&&(i[e.useProtoFieldName?a.name:a.jsonName]=u)}const o=e.typeRegistry;if(o?.findExtensionFor)for(const c of t.runtime.bin.listUnknownFields(n)){const u=o.findExtensionFor(t.typeName,c.no);if(u&&_k(n,u)){const h=$O(n,u,e),f=sS(u.field,h,e);f!==void 0&&(i[u.field.jsonName]=f)}}}catch(o){const c=a?"cannot encode field ".concat(t.typeName,".").concat(a.name," to JSON"):"cannot encode message ".concat(t.typeName," to JSON"),u=o instanceof Error?o.message:String(o);throw new Error(c+(u.length>0?": ".concat(u):""))}return i},readScalar(n,e,t){return Zo(n,e,t??Ir.BIGINT,!0)},writeScalar(n,e,t){if(e!==void 0&&(t||kk(n,e)))return lu(n,e)},debug:fi}}function fi(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":'"'.concat(n.split('"').join('\\"'),'"');default:return String(n)}}function aS(n,e,t,i,a){let o=t.localName;if(t.repeated){if(mt(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(a.typeName,".").concat(t.name," from JSON: ").concat(fi(e)));const c=n[o];for(const u of e){if(u===null)throw new Error("cannot decode field ".concat(a.typeName,".").concat(t.name," from JSON: ").concat(fi(u)));switch(t.kind){case"message":c.push(t.T.fromJson(u,i));break;case"enum":const h=Bf(t.T,u,i.ignoreUnknownFields,!0);h!==ou&&c.push(h);break;case"scalar":try{c.push(Zo(t.T,u,t.L,!0))}catch(f){let p="cannot decode field ".concat(a.typeName,".").concat(t.name," from JSON: ").concat(fi(u));throw f instanceof Error&&f.message.length>0&&(p+=": ".concat(f.message)),new Error(p)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(a.typeName,".").concat(t.name," from JSON: ").concat(fi(e)));const c=n[o];for(const[u,h]of Object.entries(e)){if(h===null)throw new Error("cannot decode field ".concat(a.typeName,".").concat(t.name," from JSON: map value null"));let f;try{f=YO(t.K,u)}catch(p){let y="cannot decode map key for field ".concat(a.typeName,".").concat(t.name," from JSON: ").concat(fi(e));throw p instanceof Error&&p.message.length>0&&(y+=": ".concat(p.message)),new Error(y)}switch(t.V.kind){case"message":c[f]=t.V.T.fromJson(h,i);break;case"enum":const p=Bf(t.V.T,h,i.ignoreUnknownFields,!0);p!==ou&&(c[f]=p);break;case"scalar":try{c[f]=Zo(t.V.T,h,Ir.BIGINT,!0)}catch(y){let b="cannot decode map value for field ".concat(a.typeName,".").concat(t.name," from JSON: ").concat(fi(e));throw y instanceof Error&&y.message.length>0&&(b+=": ".concat(y.message)),new Error(b)}break}}}else switch(t.oneof&&(n=n[t.oneof.localName]={case:o},o="value"),t.kind){case"message":const c=t.T;if(e===null&&c.typeName!="google.protobuf.Value")return;let u=n[o];Fi(u)?u.fromJson(e,i):(n[o]=u=c.fromJson(e,i),c.fieldWrapper&&!t.oneof&&(n[o]=c.fieldWrapper.unwrapField(u)));break;case"enum":const h=Bf(t.T,e,i.ignoreUnknownFields,!1);switch(h){case Cu:nS(t,n);break;case ou:break;default:n[o]=h;break}break;case"scalar":try{const f=Zo(t.T,e,t.L,!1);f===Cu?nS(t,n):n[o]=f}catch(f){let p="cannot decode field ".concat(a.typeName,".").concat(t.name," from JSON: ").concat(fi(e));throw f instanceof Error&&f.message.length>0&&(p+=": ".concat(f.message)),new Error(p)}break}}function YO(n,e){if(n===se.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Zo(n,e,Ir.BIGINT,!0).toString()}function Zo(n,e,t,i){if(e===null)return i?Ds(n,t):Cu;switch(n){case se.DOUBLE:case se.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const a=Number(e);if(Number.isNaN(a)||!Number.isFinite(a))break;return n==se.FLOAT&&mk(a),a;case se.INT32:case se.FIXED32:case se.SFIXED32:case se.SINT32:case se.UINT32:let o;if(typeof e=="number"?o=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(o=Number(e)),o===void 0)break;return n==se.UINT32||n==se.FIXED32?wp(o):au(o),o;case se.INT64:case se.SFIXED64:case se.SINT64:if(typeof e!="number"&&typeof e!="string")break;const c=lt.parse(e);return t?c.toString():c;case se.FIXED64:case se.UINT64:if(typeof e!="number"&&typeof e!="string")break;const u=lt.uParse(e);return t?u.toString():u;case se.BOOL:if(typeof e!="boolean")break;return e;case se.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case se.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Ck.dec(e)}throw new Error}function Bf(n,e,t,i){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:i?n.values[0].no:Cu;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const a=n.findName(e);if(a!==void 0)return a.no;if(t)return ou;break}throw new Error("cannot decode enum ".concat(n.typeName," from JSON: ").concat(fi(e)))}function QO(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function sS(n,e,t){if(n.kind=="map"){mt(typeof e=="object"&&e!=null);const i={},a=Object.entries(e);switch(n.V.kind){case"scalar":for(const[c,u]of a)i[c.toString()]=lu(n.V.T,u);break;case"message":for(const[c,u]of a)i[c.toString()]=u.toJson(t);break;case"enum":const o=n.V.T;for(const[c,u]of a)i[c.toString()]=zf(o,u,t.enumAsInteger);break}return t.emitDefaultValues||a.length>0?i:void 0}if(n.repeated){mt(Array.isArray(e));const i=[];switch(n.kind){case"scalar":for(let a=0;a<e.length;a++)i.push(lu(n.T,e[a]));break;case"enum":for(let a=0;a<e.length;a++)i.push(zf(n.T,e[a],t.enumAsInteger));break;case"message":for(let a=0;a<e.length;a++)i.push(e[a].toJson(t));break}return t.emitDefaultValues||i.length>0?i:void 0}switch(n.kind){case"scalar":return lu(n.T,e);case"enum":return zf(n.T,e,t.enumAsInteger);case"message":return Rk(n.T,e).toJson(t)}}function zf(n,e,t){var i;if(mt(typeof e=="number"),n.typeName=="google.protobuf.NullValue")return null;if(t)return e;const a=n.findNumber(e);return(i=a?.name)!==null&&i!==void 0?i:e}function lu(n,e){switch(n){case se.INT32:case se.SFIXED32:case se.SINT32:case se.FIXED32:case se.UINT32:return mt(typeof e=="number"),e;case se.FLOAT:case se.DOUBLE:return mt(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case se.STRING:return mt(typeof e=="string"),e;case se.BOOL:return mt(typeof e=="boolean"),e;case se.UINT64:case se.FIXED64:case se.INT64:case se.SFIXED64:case se.SINT64:return mt(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case se.BYTES:return mt(e instanceof Uint8Array),Ck.enc(e)}}const fs=Symbol("@bufbuild/protobuf/unknown-fields"),oS={readUnknownFields:!0,readerFactory:n=>new qO(n)},lS={writeUnknownFields:!0,writerFactory:()=>new zO};function XO(n){return n?Object.assign(Object.assign({},oS),n):oS}function ZO(n){return n?Object.assign(Object.assign({},lS),n):lS}function eA(){return{makeReadOptions:XO,makeWriteOptions:ZO,listUnknownFields(n){var e;return(e=n[fs])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[fs]},writeUnknownFields(n,e){const i=n[fs];if(i)for(const a of i)e.tag(a.no,a.wireType).raw(a.data)},onUnknownField(n,e,t,i){const a=n;Array.isArray(a[fs])||(a[fs]=[]),a[fs].push({no:e,wireType:t,data:i})},readMessage(n,e,t,i,a){const o=n.getType(),c=a?e.len:e.pos+t;let u,h;for(;e.pos<c&&([u,h]=e.tag(),!(a===!0&&h==St.EndGroup));){const f=o.fields.find(u);if(!f){const p=e.skip(h,u);i.readUnknownFields&&this.onUnknownField(n,u,h,p);continue}cS(n,e,f,h,i)}if(a&&(h!=St.EndGroup||u!==t))throw new Error("invalid end group tag")},readField:cS,writeMessage(n,e,t){const i=n.getType();for(const a of i.fields.byNumber()){if(!Ek(a,n)){if(a.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(a.name," to binary: required field not set"));continue}const o=a.oneof?n[a.oneof.localName].value:n[a.localName];uS(a,o,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e},writeField(n,e,t,i){e!==void 0&&uS(n,e,t,i)}}}function cS(n,e,t,i,a){let{repeated:o,localName:c}=t;switch(t.oneof&&(n=n[t.oneof.localName],n.case!=c&&delete n.value,n.case=c,c="value"),t.kind){case"scalar":case"enum":const u=t.kind=="enum"?se.INT32:t.T;let h=_u;if(t.kind=="scalar"&&t.L>0&&(h=nA),o){let b=n[c];if(i==St.LengthDelimited&&u!=se.STRING&&u!=se.BYTES){let C=e.uint32()+e.pos;for(;e.pos<C;)b.push(h(e,u))}else b.push(h(e,u))}else n[c]=h(e,u);break;case"message":const f=t.T;o?n[c].push(cu(e,new f,a,t)):Fi(n[c])?cu(e,n[c],a,t):(n[c]=cu(e,new f,a,t),f.fieldWrapper&&!t.oneof&&!t.repeated&&(n[c]=f.fieldWrapper.unwrapField(n[c])));break;case"map":let[p,y]=tA(t,e,a);n[c][p]=y;break}}function cu(n,e,t,i){const a=e.getType().runtime.bin,o=i?.delimited;return a.readMessage(e,n,o?i.no:n.uint32(),t,o),e}function tA(n,e,t){const i=e.uint32(),a=e.pos+i;let o,c;for(;e.pos<a;){const[u]=e.tag();switch(u){case 1:o=_u(e,n.K);break;case 2:switch(n.V.kind){case"scalar":c=_u(e,n.V.T);break;case"enum":c=e.int32();break;case"message":c=cu(e,new n.V.T,t,void 0);break}break}}if(o===void 0&&(o=Ds(n.K,Ir.BIGINT)),typeof o!="string"&&typeof o!="number"&&(o=o.toString()),c===void 0)switch(n.V.kind){case"scalar":c=Ds(n.V.T,Ir.BIGINT);break;case"enum":c=n.V.T.values[0].no;break;case"message":c=new n.V.T;break}return[o,c]}function nA(n,e){const t=_u(n,e);return typeof t=="bigint"?t.toString():t}function _u(n,e){switch(e){case se.STRING:return n.string();case se.BOOL:return n.bool();case se.DOUBLE:return n.double();case se.FLOAT:return n.float();case se.INT32:return n.int32();case se.INT64:return n.int64();case se.UINT64:return n.uint64();case se.FIXED64:return n.fixed64();case se.BYTES:return n.bytes();case se.FIXED32:return n.fixed32();case se.SFIXED32:return n.sfixed32();case se.SFIXED64:return n.sfixed64();case se.SINT64:return n.sint64();case se.UINT32:return n.uint32();case se.SINT32:return n.sint32()}}function uS(n,e,t,i){mt(e!==void 0);const a=n.repeated;switch(n.kind){case"scalar":case"enum":let o=n.kind=="enum"?se.INT32:n.T;if(a)if(mt(Array.isArray(e)),n.packed)rA(t,o,n.no,e);else for(const c of e)el(t,o,n.no,c);else el(t,o,n.no,e);break;case"message":if(a){mt(Array.isArray(e));for(const c of e)dS(t,i,n,c)}else dS(t,i,n,e);break;case"map":mt(typeof e=="object"&&e!=null);for(const[c,u]of Object.entries(e))iA(t,i,n,c,u);break}}function iA(n,e,t,i,a){n.tag(t.no,St.LengthDelimited),n.fork();let o=i;switch(t.K){case se.INT32:case se.FIXED32:case se.UINT32:case se.SFIXED32:case se.SINT32:o=Number.parseInt(i);break;case se.BOOL:mt(i=="true"||i=="false"),o=i=="true";break}switch(el(n,t.K,1,o),t.V.kind){case"scalar":el(n,t.V.T,2,a);break;case"enum":el(n,se.INT32,2,a);break;case"message":mt(a!==void 0),n.tag(2,St.LengthDelimited).bytes(a.toBinary(e));break}n.join()}function dS(n,e,t,i){const a=Rk(t.T,i);t.delimited?n.tag(t.no,St.StartGroup).raw(a.toBinary(e)).tag(t.no,St.EndGroup):n.tag(t.no,St.LengthDelimited).bytes(a.toBinary(e))}function el(n,e,t,i){mt(i!==void 0);let[a,o]=Ok(e);n.tag(t,a)[o](i)}function rA(n,e,t,i){if(!i.length)return;n.tag(t,St.LengthDelimited).fork();let[,a]=Ok(e);for(let o=0;o<i.length;o++)n[a](i[o]);n.join()}function Ok(n){let e=St.Varint;switch(n){case se.BYTES:case se.STRING:e=St.LengthDelimited;break;case se.DOUBLE:case se.FIXED64:case se.SFIXED64:e=St.Bit64;break;case se.FIXED32:case se.SFIXED32:case se.FLOAT:e=St.Bit32;break}const t=se[n].toLowerCase();return[e,t]}function aA(){return{setEnumType:vk,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const i of t.fields.byMember()){const a=i.localName,o=e,c=n;if(c[a]!=null)switch(i.kind){case"oneof":const u=c[a].case;if(u===void 0)continue;const h=i.findField(u);let f=c[a].value;h&&h.kind=="message"&&!Fi(f,h.T)?f=new h.T(f):h&&h.kind==="scalar"&&h.T===se.BYTES&&(f=zo(f)),o[a]={case:u,value:f};break;case"scalar":case"enum":let p=c[a];i.T===se.BYTES&&(p=i.repeated?p.map(zo):zo(p)),o[a]=p;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===se.BYTES)for(const[k,C]of Object.entries(c[a]))o[a][k]=zo(C);else Object.assign(o[a],c[a]);break;case"message":const b=i.V.T;for(const k of Object.keys(c[a])){let C=c[a][k];b.fieldWrapper||(C=new b(C)),o[a][k]=C}break}break;case"message":const y=i.T;if(i.repeated)o[a]=c[a].map(b=>Fi(b,y)?b:new y(b));else{const b=c[a];y.fieldWrapper?y.typeName==="google.protobuf.BytesValue"?o[a]=zo(b):o[a]=b:o[a]=Fi(b,y)?b:new y(b)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(i=>{const a=e[i.localName],o=t[i.localName];if(i.repeated){if(a.length!==o.length)return!1;switch(i.kind){case"message":return a.every((c,u)=>i.T.equals(c,o[u]));case"scalar":return a.every((c,u)=>Cr(i.T,c,o[u]));case"enum":return a.every((c,u)=>Cr(se.INT32,c,o[u]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let c=a,u=o;return i.T.fieldWrapper&&(c!==void 0&&!Fi(c)&&(c=i.T.fieldWrapper.wrapField(c)),u!==void 0&&!Fi(u)&&(u=i.T.fieldWrapper.wrapField(u))),i.T.equals(c,u);case"enum":return Cr(se.INT32,a,o);case"scalar":return Cr(i.T,a,o);case"oneof":if(a.case!==o.case)return!1;const h=i.findField(a.case);if(h===void 0)return!0;switch(h.kind){case"message":return h.T.equals(a.value,o.value);case"enum":return Cr(se.INT32,a.value,o.value);case"scalar":return Cr(h.T,a.value,o.value)}throw new Error("oneof cannot contain ".concat(h.kind));case"map":const f=Object.keys(a).concat(Object.keys(o));switch(i.V.kind){case"message":const p=i.V.T;return f.every(b=>p.equals(a[b],o[b]));case"enum":return f.every(b=>Cr(se.INT32,a[b],o[b]));case"scalar":const y=i.V.T;return f.every(b=>Cr(y,a[b],o[b]))}break}})},clone(n){const e=n.getType(),t=new e,i=t;for(const a of e.fields.byMember()){const o=n[a.localName];let c;if(a.repeated)c=o.map(Jc);else if(a.kind=="map"){c=i[a.localName];for(const[u,h]of Object.entries(o))c[u]=Jc(h)}else a.kind=="oneof"?c=a.findField(o.case)?{case:o.case,value:Jc(o.value)}:{case:void 0}:c=Jc(o);i[a.localName]=c}for(const a of e.runtime.bin.listUnknownFields(n))e.runtime.bin.onUnknownField(i,a.no,a.wireType,a.data);return t}}}function Jc(n){if(n===void 0)return n;if(Fi(n))return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function zo(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function sA(n,e,t){return{syntax:n,json:JO(),bin:eA(),util:Object.assign(Object.assign({},aA()),{newFieldList:e,initFields:t}),makeMessageType(i,a,o){return MO(this,i,a,o)},makeEnum:DO,makeEnumType:yk,getEnumType:PO,makeExtension(i,a,o){return FO(this,i,a,o)}}}class oA{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const i of this.list())t[i.jsonName]=t[i.name]=i;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const i of this.list())t[i.no]=i;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const i of this.list())i.oneof?i.oneof!==t&&(t=i.oneof,e.push(t)):e.push(i)}return this.members}}function Ak(n,e){const t=jk(n);return e?t:fA(hA(t))}function lA(n){return Ak(n,!1)}const cA=jk;function jk(n){let e=!1;const t=[];for(let i=0;i<n.length;i++){let a=n.charAt(i);switch(a){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(a),e=!1;break;default:e&&(e=!1,a=a.toUpperCase()),t.push(a);break}}return t.join("")}const uA=new Set(["constructor","toString","toJSON","valueOf"]),dA=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Pk=n=>"".concat(n,"$"),hA=n=>dA.has(n)?Pk(n):n,fA=n=>uA.has(n)?Pk(n):n;class pA{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=lA(e)}addField(e){mt(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}function mA(n,e){var t,i,a,o,c,u;const h=[];let f;for(const p of typeof n=="function"?n():n){const y=p;if(y.localName=Ak(p.name,p.oneof!==void 0),y.jsonName=(t=p.jsonName)!==null&&t!==void 0?t:cA(p.name),y.repeated=(i=p.repeated)!==null&&i!==void 0?i:!1,p.kind=="scalar"&&(y.L=(a=p.L)!==null&&a!==void 0?a:Ir.BIGINT),y.delimited=(o=p.delimited)!==null&&o!==void 0?o:!1,y.req=(c=p.req)!==null&&c!==void 0?c:!1,y.opt=(u=p.opt)!==null&&u!==void 0?u:!1,p.packed===void 0&&(y.packed=p.kind=="enum"||p.kind=="scalar"&&p.T!=se.BYTES&&p.T!=se.STRING),p.oneof!==void 0){const b=typeof p.oneof=="string"?p.oneof:p.oneof.name;(!f||f.name!=b)&&(f=new pA(b)),y.oneof=f,f.addField(y)}h.push(y)}return h}const W=sA("proto3",n=>new oA(n,e=>mA(e)),n=>{for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,i=n;if(e.repeated){i[t]=[];continue}switch(e.kind){case"oneof":i[t]={case:void 0};break;case"enum":i[t]=0;break;case"map":i[t]={};break;case"scalar":i[t]=Ds(e.T,e.L);break}}});class on extends ym{constructor(e){super(),this.seconds=lt.zero,this.nanos=0,W.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(W.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const a=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(a))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(a<Date.parse("0001-01-01T00:00:00Z")||a>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=lt.parse(a/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const t=Number(this.seconds)*1e3;if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const a=(this.nanos+1e9).toString().substring(1);a.substring(3)==="000000"?i="."+a.substring(0,3)+"Z":a.substring(6)==="000"?i="."+a.substring(0,6)+"Z":i="."+a+"Z"}return new Date(t).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return on.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new on({seconds:lt.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return new on().fromBinary(e,t)}static fromJson(e,t){return new on().fromJson(e,t)}static fromJsonString(e,t){return new on().fromJsonString(e,t)}static equals(e,t){return W.util.equals(on,e,t)}}on.runtime=W;on.typeName="google.protobuf.Timestamp";on.fields=W.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const gA=W.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:on},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:vA,repeated:!0},{no:5,name:"events",kind:"message",T:bA,repeated:!0}]),vA=W.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:yA,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),yA=W.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:on},{no:3,name:"value",kind:"scalar",T:2}]),bA=W.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:on},{no:7,name:"normalized_end_timestamp",kind:"message",T:on,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),Dk=W.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Zn=W.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),xt=W.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Sm=W.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Jo=W.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),ul=W.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),ii=W.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),da=W.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),SA=W.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Dt=W.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),$u=W.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:xu,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Wk}]),xu=W.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),TA=W.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:W.getEnumType(xt),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),va=W.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:W.getEnumType(_s)},{no:4,name:"tracks",kind:"message",T:Ts,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:TA},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:W.getEnumType(dl)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:W.getEnumType(ii)},{no:18,name:"kind_details",kind:"enum",T:W.getEnumType(kA),repeated:!0}]),_s=W.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),dl=W.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),kA=W.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),At=W.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),wA=W.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Pr,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:W.getEnumType(Mk)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),Ts=W.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:W.getEnumType(Zn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:W.getEnumType(xt)},{no:10,name:"layers",kind:"message",T:Pr,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:wA,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:W.getEnumType(At)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Wk},{no:19,name:"audio_features",kind:"enum",T:W.getEnumType(Dt),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:W.getEnumType(Dk)}]),Pr=W.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:W.getEnumType(Sm)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Mk=W.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Jt=W.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:W.getEnumType(Ae)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Tm,oneof:"value"},{no:3,name:"speaker",kind:"message",T:CA,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:Uk,oneof:"value"},{no:7,name:"transcription",kind:"message",T:_A,oneof:"value"},{no:8,name:"metrics",kind:"message",T:gA,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Eu,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:km,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:wm,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Cm,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Ru,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Ou,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Au,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:Nk,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),Ae=W.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Nk=W.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:W.getEnumType(At)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),Ik=W.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Tm,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Eu,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:km,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:wm,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Cm,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:Ru,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:Ou,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:Au,oneof:"value"}]),CA=W.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:Lk,repeated:!0}]),Lk=W.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Tm=W.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),Uk=W.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),_A=W.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:xA,repeated:!0}]),xA=W.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Eu=W.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),km=W.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),wm=W.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Cm=W.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Bk,oneof:"value"}]),Bk=W.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),zk=W.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),qk=W.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:W.getEnumType(Fk)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),Fk=W.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Hk=W.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:W.getEnumType(Vk)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Vk=W.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),$k=W.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:hS},{no:2,name:"screen",kind:"message",T:hS},{no:3,name:"resume_connection",kind:"enum",T:W.getEnumType(ul)},{no:4,name:"disabled_codecs",kind:"message",T:EA},{no:5,name:"force_relay",kind:"enum",T:W.getEnumType(ul)}]),hS=W.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:W.getEnumType(ul)}]),EA=W.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:xu,repeated:!0},{no:2,name:"publish",kind:"message",T:xu,repeated:!0}]),Wk=W.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Cp=W.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Gk=W.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:W.getEnumType(Cp)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),Kk=W.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Ru=W.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:W.getEnumType(At)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Gk,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:Kk,oneof:"content_header"}],{localName:"DataStream_Header"}),Ou=W.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Au=W.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),RA=W.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),ei=W.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),_p=W.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),OA=W.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),AA=W.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Lr,oneof:"message"},{no:2,name:"answer",kind:"message",T:Lr,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Wu,oneof:"message"},{no:4,name:"add_track",kind:"message",T:hl,oneof:"message"},{no:5,name:"mute",kind:"message",T:Gu,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Ku,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Jk,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ju,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Qk,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:ew,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Om,oneof:"message"},{no:13,name:"simulate",kind:"message",T:di,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Em,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:iw,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:xm,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Yk,oneof:"message"}]),fS=W.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:jA,oneof:"message"},{no:2,name:"answer",kind:"message",T:Lr,oneof:"message"},{no:3,name:"offer",kind:"message",T:Lr,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Wu,oneof:"message"},{no:5,name:"update",kind:"message",T:MA,oneof:"message"},{no:6,name:"track_published",kind:"message",T:_m,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ju,oneof:"message"},{no:9,name:"mute",kind:"message",T:Gu,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:NA,oneof:"message"},{no:11,name:"room_update",kind:"message",T:IA,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:UA,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:zA,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:FA,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:VA,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:DA,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:PA,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:WA,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:JA,oneof:"message"},{no:22,name:"request_response",kind:"message",T:YA,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:QA,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:$A,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:tj,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:HA,oneof:"message"}]),xp=W.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Pr,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:W.getEnumType(Mk)}]),hl=W.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:W.getEnumType(Zn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:W.getEnumType(xt)},{no:9,name:"layers",kind:"message",T:Pr,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:xp,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:W.getEnumType(At)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:W.getEnumType(Dk)},{no:17,name:"audio_features",kind:"enum",T:W.getEnumType(Dt),repeated:!0}]),Wu=W.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:W.getEnumType(ei)},{no:3,name:"final",kind:"scalar",T:8}]),Gu=W.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),jA=W.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:$u},{no:2,name:"participant",kind:"message",T:va},{no:3,name:"other_participants",kind:"message",T:va,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Xk,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:$k},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:qk},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:xu,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),PA=W.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:Xk,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:$k},{no:3,name:"server_info",kind:"message",T:qk},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),_m=W.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Ts}]),DA=W.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Lr=W.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),MA=W.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:va,repeated:!0}]),Ku=W.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:zk,repeated:!0}]),Jk=W.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:W.getEnumType(Sm)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),xm=W.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:W.getEnumType(Dt),repeated:!0}]),Yk=W.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Ju=W.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:W.getEnumType(ii)},{no:3,name:"action",kind:"enum",T:W.getEnumType(xs)},{no:4,name:"regions",kind:"message",T:GA}]),xs=W.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),Qk=W.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Pr,repeated:!0}]),Em=W.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),Xk=W.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),NA=W.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:Lk,repeated:!0}]),IA=W.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:$u}]),LA=W.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:W.getEnumType(Jo)},{no:3,name:"score",kind:"scalar",T:2}]),UA=W.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:LA,repeated:!0}]),BA=W.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:W.getEnumType(_p)}]),zA=W.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:BA,repeated:!0}]),Rm=W.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:W.getEnumType(Sm)},{no:2,name:"enabled",kind:"scalar",T:8}]),qA=W.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Rm,repeated:!0}]),FA=W.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Rm,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:qA,repeated:!0}]),HA=W.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:RA,repeated:!0}]),Zk=W.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),ew=W.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Zk,repeated:!0}]),VA=W.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),$A=W.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:$u},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:va},{no:4,name:"other_participants",kind:"message",T:va,repeated:!0}]),Om=W.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Lr},{no:2,name:"subscription",kind:"message",T:Ku},{no:3,name:"publish_tracks",kind:"message",T:_m,repeated:!0},{no:4,name:"data_channels",kind:"message",T:nw,repeated:!0},{no:5,name:"offer",kind:"message",T:Lr},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:tw,repeated:!0}]),tw=W.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),nw=W.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:W.getEnumType(ei)}]),di=W.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:W.getEnumType(OA),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),iw=W.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),WA=W.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),GA=W.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:KA,repeated:!0}]),KA=W.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),JA=W.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:W.getEnumType(SA)}]),YA=W.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:W.getEnumType(Am)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:Wu,oneof:"request"},{no:5,name:"add_track",kind:"message",T:hl,oneof:"request"},{no:6,name:"mute",kind:"message",T:Gu,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:Em,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:xm,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:Yk,oneof:"request"}]),Am=W.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),QA=W.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),rw=W.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),XA=W.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:Hk},{no:2,name:"connection_settings",kind:"message",T:rw},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:hl,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Lr},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:W.getEnumType(da)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:Om}]),ZA=W.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:W.getEnumType(ej)},{no:2,name:"join_request",kind:"scalar",T:12}]),ej=W.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),tj=W.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function nj(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var uu={exports:{}},ij=uu.exports,pS;function rj(){return pS||(pS=1,(function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(ij,function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"],o={},c=null;function u(w,O){var R=w[O];if(typeof R.bind=="function")return R.bind(w);try{return Function.prototype.bind.call(R,w)}catch{return function(){return Function.prototype.apply.apply(R,[w,arguments])}}}function h(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function f(w){return w==="debug"&&(w="log"),typeof console===t?!1:w==="trace"&&i?h:console[w]!==void 0?u(console,w):console.log!==void 0?u(console,"log"):e}function p(){for(var w=this.getLevel(),O=0;O<a.length;O++){var R=a[O];this[R]=O<w?e:this.methodFactory(R,w,this.name)}if(this.log=this.debug,typeof console===t&&w<this.levels.SILENT)return"No console available for logging"}function y(w){return function(){typeof console!==t&&(p.call(this),this[w].apply(this,arguments))}}function b(w,O,R){return f(w)||y.apply(this,arguments)}function k(w,O){var R=this,P,j,E,_="loglevel";typeof w=="string"?_+=":"+w:typeof w=="symbol"&&(_=void 0);function A(H){var ie=(a[H]||"silent").toUpperCase();if(!(typeof window===t||!_)){try{window.localStorage[_]=ie;return}catch{}try{window.document.cookie=encodeURIComponent(_)+"="+ie+";"}catch{}}}function I(){var H;if(!(typeof window===t||!_)){try{H=window.localStorage[_]}catch{}if(typeof H===t)try{var ie=window.document.cookie,he=encodeURIComponent(_),Z=ie.indexOf(he+"=");Z!==-1&&(H=/^([^;]+)/.exec(ie.slice(Z+he.length+1))[1])}catch{}return R.levels[H]===void 0&&(H=void 0),H}}function F(){if(!(typeof window===t||!_)){try{window.localStorage.removeItem(_)}catch{}try{window.document.cookie=encodeURIComponent(_)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function B(H){var ie=H;if(typeof ie=="string"&&R.levels[ie.toUpperCase()]!==void 0&&(ie=R.levels[ie.toUpperCase()]),typeof ie=="number"&&ie>=0&&ie<=R.levels.SILENT)return ie;throw new TypeError("log.setLevel() called with invalid level: "+H)}R.name=w,R.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},R.methodFactory=O||b,R.getLevel=function(){return E??j??P},R.setLevel=function(H,ie){return E=B(H),ie!==!1&&A(E),p.call(R)},R.setDefaultLevel=function(H){j=B(H),I()||R.setLevel(H,!1)},R.resetLevel=function(){E=null,F(),p.call(R)},R.enableAll=function(H){R.setLevel(R.levels.TRACE,H)},R.disableAll=function(H){R.setLevel(R.levels.SILENT,H)},R.rebuild=function(){if(c!==R&&(P=B(c.getLevel())),p.call(R),c===R)for(var H in o)o[H].rebuild()},P=B(c?c.getLevel():"WARN");var z=I();z!=null&&(E=B(z)),p.call(R)}c=new k,c.getLogger=function(O){if(typeof O!="symbol"&&typeof O!="string"||O==="")throw new TypeError("You must supply a name when creating a logger.");var R=o[O];return R||(R=o[O]=new k(O,c.methodFactory)),R};var C=typeof window!==t?window.log:void 0;return c.noConflict=function(){return typeof window!==t&&window.log===c&&(window.log=C),c},c.getLoggers=function(){return o},c.default=c,c})})(uu)),uu.exports}var Yu=rj(),Ep;(function(n){n[n.trace=0]="trace",n[n.debug=1]="debug",n[n.info=2]="info",n[n.warn=3]="warn",n[n.error=4]="error",n[n.silent=5]="silent"})(Ep||(Ep={}));var ai;(function(n){n.Default="livekit",n.Room="livekit-room",n.TokenSource="livekit-token-source",n.Participant="livekit-participant",n.Track="livekit-track",n.Publication="livekit-track-publication",n.Engine="livekit-engine",n.Signal="livekit-signal",n.PCManager="livekit-pc-manager",n.PCTransport="livekit-pc-transport",n.E2EE="lk-e2ee"})(ai||(ai={}));let Ee=Yu.getLogger("livekit");Object.values(ai).map(n=>Yu.getLogger(n));Ee.setDefaultLevel(Ep.info);function Gi(n){const e=Yu.getLogger(n);return e.setDefaultLevel(Ee.getLevel()),e}const aj=Yu.getLogger("lk-e2ee"),qo=7e3,sj=[0,300,4*300,9*300,16*300,qo,qo,qo,qo,qo];class oj{constructor(e){this._retryDelays=e!==void 0?[...e]:sj}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+Math.random()*1e3}}function lj(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,i=Object.getOwnPropertySymbols(n);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(n,i[a])&&(t[i[a]]=n[i[a]]);return t}function M(n,e,t,i){function a(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function u(p){try{f(i.next(p))}catch(y){c(y)}}function h(p){try{f(i.throw(p))}catch(y){c(y)}}function f(p){p.done?o(p.value):a(p.value).then(u,h)}f((i=i.apply(n,e||[])).next())})}function mS(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Hi(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof mS=="function"?mS(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(c){return new Promise(function(u,h){c=n[o](c),a(u,h,c.done,c.value)})}}function a(o,c,u,h){Promise.resolve(h).then(function(f){o({value:f,done:u})},c)}}var Yc={exports:{}},gS;function cj(){if(gS)return Yc.exports;gS=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(_,A,I){return Function.prototype.apply.call(_,A,I)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(_){return Object.getOwnPropertyNames(_).concat(Object.getOwnPropertySymbols(_))}:t=function(_){return Object.getOwnPropertyNames(_)};function i(E){console&&console.warn&&console.warn(E)}var a=Number.isNaN||function(_){return _!==_};function o(){o.init.call(this)}Yc.exports=o,Yc.exports.once=R,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function u(E){if(typeof E!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof E)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(E){if(typeof E!="number"||E<0||a(E))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+E+".");c=E}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(_){if(typeof _!="number"||_<0||a(_))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+_+".");return this._maxListeners=_,this};function h(E){return E._maxListeners===void 0?o.defaultMaxListeners:E._maxListeners}o.prototype.getMaxListeners=function(){return h(this)},o.prototype.emit=function(_){for(var A=[],I=1;I<arguments.length;I++)A.push(arguments[I]);var F=_==="error",B=this._events;if(B!==void 0)F=F&&B.error===void 0;else if(!F)return!1;if(F){var z;if(A.length>0&&(z=A[0]),z instanceof Error)throw z;var H=new Error("Unhandled error."+(z?" ("+z.message+")":""));throw H.context=z,H}var ie=B[_];if(ie===void 0)return!1;if(typeof ie=="function")e(ie,this,A);else for(var he=ie.length,Z=C(ie,he),I=0;I<he;++I)e(Z[I],this,A);return!0};function f(E,_,A,I){var F,B,z;if(u(A),B=E._events,B===void 0?(B=E._events=Object.create(null),E._eventsCount=0):(B.newListener!==void 0&&(E.emit("newListener",_,A.listener?A.listener:A),B=E._events),z=B[_]),z===void 0)z=B[_]=A,++E._eventsCount;else if(typeof z=="function"?z=B[_]=I?[A,z]:[z,A]:I?z.unshift(A):z.push(A),F=h(E),F>0&&z.length>F&&!z.warned){z.warned=!0;var H=new Error("Possible EventEmitter memory leak detected. "+z.length+" "+String(_)+" listeners added. Use emitter.setMaxListeners() to increase limit");H.name="MaxListenersExceededWarning",H.emitter=E,H.type=_,H.count=z.length,i(H)}return E}o.prototype.addListener=function(_,A){return f(this,_,A,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(_,A){return f(this,_,A,!0)};function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(E,_,A){var I={fired:!1,wrapFn:void 0,target:E,type:_,listener:A},F=p.bind(I);return F.listener=A,I.wrapFn=F,F}o.prototype.once=function(_,A){return u(A),this.on(_,y(this,_,A)),this},o.prototype.prependOnceListener=function(_,A){return u(A),this.prependListener(_,y(this,_,A)),this},o.prototype.removeListener=function(_,A){var I,F,B,z,H;if(u(A),F=this._events,F===void 0)return this;if(I=F[_],I===void 0)return this;if(I===A||I.listener===A)--this._eventsCount===0?this._events=Object.create(null):(delete F[_],F.removeListener&&this.emit("removeListener",_,I.listener||A));else if(typeof I!="function"){for(B=-1,z=I.length-1;z>=0;z--)if(I[z]===A||I[z].listener===A){H=I[z].listener,B=z;break}if(B<0)return this;B===0?I.shift():w(I,B),I.length===1&&(F[_]=I[0]),F.removeListener!==void 0&&this.emit("removeListener",_,H||A)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(_){var A,I,F;if(I=this._events,I===void 0)return this;if(I.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):I[_]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete I[_]),this;if(arguments.length===0){var B=Object.keys(I),z;for(F=0;F<B.length;++F)z=B[F],z!=="removeListener"&&this.removeAllListeners(z);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(A=I[_],typeof A=="function")this.removeListener(_,A);else if(A!==void 0)for(F=A.length-1;F>=0;F--)this.removeListener(_,A[F]);return this};function b(E,_,A){var I=E._events;if(I===void 0)return[];var F=I[_];return F===void 0?[]:typeof F=="function"?A?[F.listener||F]:[F]:A?O(F):C(F,F.length)}o.prototype.listeners=function(_){return b(this,_,!0)},o.prototype.rawListeners=function(_){return b(this,_,!1)},o.listenerCount=function(E,_){return typeof E.listenerCount=="function"?E.listenerCount(_):k.call(E,_)},o.prototype.listenerCount=k;function k(E){var _=this._events;if(_!==void 0){var A=_[E];if(typeof A=="function")return 1;if(A!==void 0)return A.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function C(E,_){for(var A=new Array(_),I=0;I<_;++I)A[I]=E[I];return A}function w(E,_){for(;_+1<E.length;_++)E[_]=E[_+1];E.pop()}function O(E){for(var _=new Array(E.length),A=0;A<_.length;++A)_[A]=E[A].listener||E[A];return _}function R(E,_){return new Promise(function(A,I){function F(z){E.removeListener(_,B),I(z)}function B(){typeof E.removeListener=="function"&&E.removeListener("error",F),A([].slice.call(arguments))}j(E,_,B,{once:!0}),_!=="error"&&P(E,F,{once:!0})})}function P(E,_,A){typeof E.on=="function"&&j(E,"error",_,A)}function j(E,_,A,I){if(typeof E.on=="function")I.once?E.once(_,A):E.on(_,A);else if(typeof E.addEventListener=="function")E.addEventListener(_,function F(B){I.once&&E.removeEventListener(_,F),A(B)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof E)}return Yc.exports}var vi=cj();let aw=!0,sw=!0;function Yo(n,e,t){const i=n.match(e);return i&&i.length>=t&&parseFloat(i[t],10)}function Sa(n,e,t){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,a=i.addEventListener;i.addEventListener=function(c,u){if(c!==e)return a.apply(this,arguments);const h=f=>{const p=t(f);p&&(u.handleEvent?u.handleEvent(p):u(p))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(u,h),a.apply(this,[c,h])};const o=i.removeEventListener;i.removeEventListener=function(c,u){if(c!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(u))return o.apply(this,arguments);const h=this._eventMap[e].get(u);return this._eventMap[e].delete(u),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[c,h])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function uj(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(aw=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function dj(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(sw=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function ow(){if(typeof window=="object"){if(aw)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function jm(n,e){sw&&console.warn(n+" is deprecated, please use "+e+" instead.")}function hj(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.userAgentData&&t.userAgentData.brands){const i=t.userAgentData.brands.find(a=>a.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Yo(t.userAgent,/Firefox\/(\d+)\./,1));else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Yo(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Yo(t.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype,e._safariVersion=Yo(t.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function vS(n){return Object.prototype.toString.call(n)==="[object Object]"}function lw(n){return vS(n)?Object.keys(n).reduce(function(e,t){const i=vS(n[t]),a=i?lw(n[t]):n[t],o=i&&!Object.keys(a).length;return a===void 0||o?e:Object.assign(e,{[t]:a})},{}):n}function Rp(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Rp(n,n.get(e[i]),t):i.endsWith("Ids")&&e[i].forEach(a=>{Rp(n,n.get(a),t)})}))}function yS(n,e,t){const i=t?"outbound-rtp":"inbound-rtp",a=new Map;if(e===null)return a;const o=[];return n.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&o.push(c)}),o.forEach(c=>{n.forEach(u=>{u.type===i&&u.trackId===c.id&&Rp(n,u,a)})}),a}const bS=ow;function cw(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const i=function(u){if(typeof u!="object"||u.mandatory||u.optional)return u;const h={};return Object.keys(u).forEach(f=>{if(f==="require"||f==="advanced"||f==="mediaSource")return;const p=typeof u[f]=="object"?u[f]:{ideal:u[f]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const y=function(b,k){return b?b+k.charAt(0).toUpperCase()+k.slice(1):k==="deviceId"?"sourceId":k};if(p.ideal!==void 0){h.optional=h.optional||[];let b={};typeof p.ideal=="number"?(b[y("min",f)]=p.ideal,h.optional.push(b),b={},b[y("max",f)]=p.ideal,h.optional.push(b)):(b[y("",f)]=p.ideal,h.optional.push(b))}p.exact!==void 0&&typeof p.exact!="number"?(h.mandatory=h.mandatory||{},h.mandatory[y("",f)]=p.exact):["min","max"].forEach(b=>{p[b]!==void 0&&(h.mandatory=h.mandatory||{},h.mandatory[y(b,f)]=p[b])})}),u.advanced&&(h.optional=(h.optional||[]).concat(u.advanced)),h},a=function(u,h){if(e.version>=61)return h(u);if(u=JSON.parse(JSON.stringify(u)),u&&typeof u.audio=="object"){const f=function(p,y,b){y in p&&!(b in p)&&(p[b]=p[y],delete p[y])};u=JSON.parse(JSON.stringify(u)),f(u.audio,"autoGainControl","googAutoGainControl"),f(u.audio,"noiseSuppression","googNoiseSuppression"),u.audio=i(u.audio)}if(u&&typeof u.video=="object"){let f=u.video.facingMode;f=f&&(typeof f=="object"?f:{ideal:f});const p=e.version<66;if(f&&(f.exact==="user"||f.exact==="environment"||f.ideal==="user"||f.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!p)){delete u.video.facingMode;let y;if(f.exact==="environment"||f.ideal==="environment"?y=["back","rear"]:(f.exact==="user"||f.ideal==="user")&&(y=["front"]),y)return t.mediaDevices.enumerateDevices().then(b=>{b=b.filter(C=>C.kind==="videoinput");let k=b.find(C=>y.some(w=>C.label.toLowerCase().includes(w)));return!k&&b.length&&y.includes("back")&&(k=b[b.length-1]),k&&(u.video.deviceId=f.exact?{exact:k.deviceId}:{ideal:k.deviceId}),u.video=i(u.video),bS("chrome: "+JSON.stringify(u)),h(u)})}u.video=i(u.video)}return bS("chrome: "+JSON.stringify(u)),h(u)},o=function(u){return e.version>=64?u:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[u.name]||u.name,message:u.message,constraint:u.constraint||u.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},c=function(u,h,f){a(u,p=>{t.webkitGetUserMedia(p,h,y=>{f&&f(o(y))})})};if(t.getUserMedia=c.bind(t),t.mediaDevices.getUserMedia){const u=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(h){return a(h,f=>u(f).then(p=>{if(f.audio&&!p.getAudioTracks().length||f.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(y=>{y.stop()}),new DOMException("","NotFoundError");return p},p=>Promise.reject(o(p))))}}}function uw(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function dw(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",a=>{let o;n.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(u=>u.track&&u.track.id===a.track.id):o={track:a.track};const c=new Event("track");c.track=a.track,c.receiver=o,c.transceiver={receiver:o},c.streams=[i.stream],this.dispatchEvent(c)}),i.stream.getTracks().forEach(a=>{let o;n.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(u=>u.track&&u.track.id===a.id):o={track:a};const c=new Event("track");c.track=a,c.receiver=o,c.transceiver={receiver:o},c.streams=[i.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Sa(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function hw(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(a,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=a.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:a}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const a=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(u,h){let f=a.apply(this,arguments);return f||(f=e(this,u),this._senders.push(f)),f};const o=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(u){o.apply(this,arguments);const h=this._senders.indexOf(u);h!==-1&&this._senders.splice(h,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],t.apply(this,[o]),o.getTracks().forEach(c=>{this._senders.push(e(this,c))})};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(c=>{const u=this._senders.find(h=>h.track===c);u&&this._senders.splice(this._senders.indexOf(u),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(a=>a._pc=this),i},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function fw(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(c=>c._pc=this),o});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),n.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>yS(c,o.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const a=t.apply(this,[]);return a.forEach(o=>o._pc=this),a}),Sa(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(o=>yS(o,a.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const i=arguments[0];let a,o,c;return this.getSenders().forEach(u=>{u.track===i&&(a?c=!0:a=u)}),this.getReceivers().forEach(u=>(u.track===i&&(o?c=!0:o=u),u.track===i)),c||a&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function pw(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(c,u){if(!u)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const h=e.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(h)===-1&&this._shimmedLocalStreams[u.id].push(h):this._shimmedLocalStreams[u.id]=[u,h],h};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(f=>{if(this.getSenders().find(y=>y.track===f))throw new DOMException("Track already exists.","InvalidAccessError")});const u=this.getSenders();t.apply(this,arguments);const h=this.getSenders().filter(f=>u.indexOf(f)===-1);this._shimmedLocalStreams[c.id]=[c].concat(h)};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],i.apply(this,arguments)};const a=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(u=>{const h=this._shimmedLocalStreams[u].indexOf(c);h!==-1&&this._shimmedLocalStreams[u].splice(h,1),this._shimmedLocalStreams[u].length===1&&delete this._shimmedLocalStreams[u]}),a.apply(this,arguments)}}function mw(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return pw(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const p=t.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(y=>this._reverseStreams[y.id])};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(y=>{if(this.getSenders().find(k=>k.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const y=new n.MediaStream(p.getTracks());this._streams[p.id]=y,this._reverseStreams[y.id]=p,p=y}i.apply(this,[p])};const a=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},n.RTCPeerConnection.prototype.addTrack=function(p,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(w=>w===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(w=>w.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const C=this._streams[y.id];if(C)C.addTrack(p),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const w=new n.MediaStream([p]);this._streams[y.id]=w,this._reverseStreams[w.id]=y,this.addStream(w)}return this.getSenders().find(w=>w.track===p)};function o(f,p){let y=p.sdp;return Object.keys(f._reverseStreams||[]).forEach(b=>{const k=f._reverseStreams[b],C=f._streams[k.id];y=y.replace(new RegExp(C.id,"g"),k.id)}),new RTCSessionDescription({type:p.type,sdp:y})}function c(f,p){let y=p.sdp;return Object.keys(f._reverseStreams||[]).forEach(b=>{const k=f._reverseStreams[b],C=f._streams[k.id];y=y.replace(new RegExp(k.id,"g"),C.id)}),new RTCSessionDescription({type:p.type,sdp:y})}["createOffer","createAnswer"].forEach(function(f){const p=n.RTCPeerConnection.prototype[f],y={[f](){const b=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[C=>{const w=o(this,C);b[0].apply(null,[w])},C=>{b[1]&&b[1].apply(null,C)},arguments[2]]):p.apply(this,arguments).then(C=>o(this,C))}};n.RTCPeerConnection.prototype[f]=y[f]});const u=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?u.apply(this,arguments):(arguments[0]=c(this,arguments[0]),u.apply(this,arguments))};const h=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const f=h.get.apply(this);return f.type===""?f:o(this,f)}}),n.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(p._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let b;Object.keys(this._streams).forEach(k=>{this._streams[k].getTracks().find(w=>p.track===w)&&(b=this._streams[k])}),b&&(b.getTracks().length===1?this.removeStream(this._reverseStreams[b.id]):b.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Op(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=n.RTCPeerConnection.prototype[t],a={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=a[t]})}function gw(n,e){Sa(n,"negotiationneeded",t=>{const i=t.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return t})}var SS=Object.freeze({__proto__:null,fixNegotiationNeeded:gw,shimAddTrackRemoveTrack:mw,shimAddTrackRemoveTrackWithNative:pw,shimGetSendersWithDtmf:hw,shimGetUserMedia:cw,shimMediaStream:uw,shimOnTrack:dw,shimPeerConnection:Op,shimSenderReceiverGetStats:fw});function vw(n,e){const t=n&&n.navigator,i=n&&n.MediaStreamTrack;if(t.getUserMedia=function(a,o,c){jm("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(a).then(o,c)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const a=function(c,u,h){u in c&&!(h in c)&&(c[h]=c[u],delete c[u])},o=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),a(c.audio,"autoGainControl","mozAutoGainControl"),a(c.audio,"noiseSuppression","mozNoiseSuppression")),o(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const u=c.apply(this,arguments);return a(u,"mozAutoGainControl","autoGainControl"),a(u,"mozNoiseSuppression","noiseSuppression"),u}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),a(u,"autoGainControl","mozAutoGainControl"),a(u,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[u])}}}}function fj(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(i)})}function yw(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ap(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){const o=n.RTCPeerConnection.prototype[a],c={[a](){return arguments[0]=new(a==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};n.RTCPeerConnection.prototype[a]=c[a]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[o,c,u]=arguments;return i.apply(this,[o||null]).then(h=>{if(e.version<53&&!c)try{h.forEach(f=>{f.type=t[f.type]||f.type})}catch(f){if(f.name!=="TypeError")throw f;h.forEach((p,y)=>{h.set(y,Object.assign({},p,{type:t[p.type]||p.type}))})}return h}).then(c,u)}}function bw(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const a=e.apply(this,[]);return a.forEach(o=>o._pc=this),a});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const a=t.apply(this,arguments);return a._pc=this,a}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Sw(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(a=>a._pc=this),i}),Sa(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Tw(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){jm("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&t.getTracks().includes(i.track)&&this.removeTrack(i)})})}function kw(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function ww(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const a=i.length>0;a&&i.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(a){const{sender:c}=o,u=c.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=i,c.sendEncodings=i,this.setParametersPromises.push(c.setParameters(u).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return o})}function Cw(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function _w(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function xw(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var TS=Object.freeze({__proto__:null,shimAddTransceiver:ww,shimCreateAnswer:xw,shimCreateOffer:_w,shimGetDisplayMedia:fj,shimGetParameters:Cw,shimGetUserMedia:vw,shimOnTrack:yw,shimPeerConnection:Ap,shimRTCDataChannel:kw,shimReceiverGetStats:Sw,shimRemoveStream:Tw,shimSenderGetStats:bw});function Ew(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(a=>e.call(this,a,i)),i.getVideoTracks().forEach(a=>e.call(this,a,i))},n.RTCPeerConnection.prototype.addTrack=function(i){for(var a=arguments.length,o=new Array(a>1?a-1:0),c=1;c<a;c++)o[c-1]=arguments[c];return o&&o.forEach(u=>{this._localStreams?this._localStreams.includes(u)||this._localStreams.push(u):this._localStreams=[u]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);const a=t.getTracks();this.getSenders().forEach(o=>{a.includes(o.track)&&this.removeTrack(o)})})}}function Rw(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(a=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(a))return;this._remoteStreams.push(a);const o=new Event("addstream");o.stream=a,this.dispatchEvent(o)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(o=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(o)>=0)return;i._remoteStreams.push(o);const c=new Event("addstream");c.stream=o,i.dispatchEvent(c)})}),e.apply(i,arguments)}}}function Ow(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,i=e.createAnswer,a=e.setLocalDescription,o=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(f,p){const y=arguments.length>=2?arguments[2]:arguments[0],b=t.apply(this,[y]);return p?(b.then(f,p),Promise.resolve()):b},e.createAnswer=function(f,p){const y=arguments.length>=2?arguments[2]:arguments[0],b=i.apply(this,[y]);return p?(b.then(f,p),Promise.resolve()):b};let u=function(h,f,p){const y=a.apply(this,[h]);return p?(y.then(f,p),Promise.resolve()):y};e.setLocalDescription=u,u=function(h,f,p){const y=o.apply(this,[h]);return p?(y.then(f,p),Promise.resolve()):y},e.setRemoteDescription=u,u=function(h,f,p){const y=c.apply(this,[h]);return p?(y.then(f,p),Promise.resolve()):y},e.addIceCandidate=u}function Aw(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,i=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=a=>i(jw(a))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,a,o){e.mediaDevices.getUserMedia(i).then(a,o)}).bind(e))}function jw(n){return n&&n.video!==void 0?Object.assign({},n,{video:lw(n.video)}):n}function Pw(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(i,a){if(i&&i.iceServers){const o=[];for(let c=0;c<i.iceServers.length;c++){let u=i.iceServers[c];u.urls===void 0&&u.url?(jm("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,o.push(u)):o.push(i.iceServers[c])}i.iceServers=o}return new e(i,a)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Dw(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Mw(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const a=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):i.offerToReceiveAudio===!0&&!a&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const o=this.getTransceivers().find(c=>c.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Nw(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var kS=Object.freeze({__proto__:null,shimAudioContext:Nw,shimCallbacksAPI:Ow,shimConstraints:jw,shimCreateOfferLegacy:Mw,shimGetUserMedia:Aw,shimLocalStreamsAPI:Ew,shimRTCIceServerUrls:Pw,shimRemoteStreamsAPI:Rw,shimTrackEventTransceiver:Dw}),qf={exports:{}},wS;function pj(){return wS||(wS=1,(function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(t){return t.split(`
m=`).map((a,o)=>(o>0?"m="+a:a).trim()+`\r
`)},e.getDescription=function(t){const i=e.splitSections(t);return i&&i[0]},e.getMediaSections=function(t){const i=e.splitSections(t);return i.shift(),i},e.matchPrefix=function(t,i){return e.splitLines(t).filter(a=>a.indexOf(i)===0)},e.parseCandidate=function(t){let i;t.indexOf("a=candidate:")===0?i=t.substring(12).split(" "):i=t.substring(10).split(" ");const a={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":a.relatedAddress=i[o+1];break;case"rport":a.relatedPort=parseInt(i[o+1],10);break;case"tcptype":a.tcpType=i[o+1];break;case"ufrag":a.ufrag=i[o+1],a.usernameFragment=i[o+1];break;default:a[i[o]]===void 0&&(a[i[o]]=i[o+1]);break}return a},e.writeCandidate=function(t){const i=[];i.push(t.foundation);const a=t.component;a==="rtp"?i.push(1):a==="rtcp"?i.push(2):i.push(a),i.push(t.protocol.toUpperCase()),i.push(t.priority),i.push(t.address||t.ip),i.push(t.port);const o=t.type;return i.push("typ"),i.push(o),o!=="host"&&t.relatedAddress&&t.relatedPort&&(i.push("raddr"),i.push(t.relatedAddress),i.push("rport"),i.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(i.push("ufrag"),i.push(t.usernameFragment||t.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let i=t.substring(9).split(" ");const a={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),a.name=i[0],a.clockRate=parseInt(i[1],10),a.channels=i.length===3?parseInt(i[2],10):1,a.numChannels=a.channels,a},e.writeRtpMap=function(t){let i=t.payloadType;t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType);const a=t.channels||t.numChannels||1;return"a=rtpmap:"+i+" "+t.name+"/"+t.clockRate+(a!==1?"/"+a:"")+`\r
`},e.parseExtmap=function(t){const i=t.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const i={};let a;const o=t.substring(t.indexOf(" ")+1).split(";");for(let c=0;c<o.length;c++)a=o[c].trim().split("="),i[a[0].trim()]=a[1];return i},e.writeFmtp=function(t){let i="",a=t.payloadType;if(t.preferredPayloadType!==void 0&&(a=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const o=[];Object.keys(t.parameters).forEach(c=>{t.parameters[c]!==void 0?o.push(c+"="+t.parameters[c]):o.push(c)}),i+="a=fmtp:"+a+" "+o.join(";")+`\r
`}return i},e.parseRtcpFb=function(t){const i=t.substring(t.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(t){let i="",a=t.payloadType;return t.preferredPayloadType!==void 0&&(a=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(o=>{i+="a=rtcp-fb:"+a+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(t){const i=t.indexOf(" "),a={ssrc:parseInt(t.substring(7,i),10)},o=t.indexOf(":",i);return o>-1?(a.attribute=t.substring(i+1,o),a.value=t.substring(o+1)):a.attribute=t.substring(i+1),a},e.parseSsrcGroup=function(t){const i=t.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(a=>parseInt(a,10))}},e.getMid=function(t){const i=e.matchPrefix(t,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(t){const i=t.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(t,i){return{role:"auto",fingerprints:e.matchPrefix(t+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,i){let a="a=setup:"+i+`\r
`;return t.fingerprints.forEach(o=>{a+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),a},e.parseCryptoLine=function(t){const i=t.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const i=t.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,i){return e.matchPrefix(t+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,i){const a=e.matchPrefix(t+i,"a=ice-ufrag:")[0],o=e.matchPrefix(t+i,"a=ice-pwd:")[0];return a&&o?{usernameFragment:a.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(t){let i="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(t){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(t)[0].split(" ");i.profile=o[2];for(let u=3;u<o.length;u++){const h=o[u],f=e.matchPrefix(t,"a=rtpmap:"+h+" ")[0];if(f){const p=e.parseRtpMap(f),y=e.matchPrefix(t,"a=fmtp:"+h+" ");switch(p.parameters=y.length?e.parseFmtp(y[0]):{},p.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+h+" ").map(e.parseRtcpFb),i.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(p.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(u=>{i.headerExtensions.push(e.parseExtmap(u))});const c=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(u=>{c.forEach(h=>{u.rtcpFeedback.find(p=>p.type===h.type&&p.parameter===h.parameter)||u.rtcpFeedback.push(h)})}),i},e.writeRtpDescription=function(t,i){let a="";a+="m="+t+" ",a+=i.codecs.length>0?"9":"0",a+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",a+=i.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(c=>{a+=e.writeRtpMap(c),a+=e.writeFmtp(c),a+=e.writeRtcpFb(c)});let o=0;return i.codecs.forEach(c=>{c.maxptime>o&&(o=c.maxptime)}),o>0&&(a+="a=maxptime:"+o+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(c=>{a+=e.writeExtmap(c)}),a},e.parseRtpEncodingParameters=function(t){const i=[],a=e.parseRtpParameters(t),o=a.fecMechanisms.indexOf("RED")!==-1,c=a.fecMechanisms.indexOf("ULPFEC")!==-1,u=e.matchPrefix(t,"a=ssrc:").map(b=>e.parseSsrcMedia(b)).filter(b=>b.attribute==="cname"),h=u.length>0&&u[0].ssrc;let f;const p=e.matchPrefix(t,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(C=>parseInt(C,10)));p.length>0&&p[0].length>1&&p[0][0]===h&&(f=p[0][1]),a.codecs.forEach(b=>{if(b.name.toUpperCase()==="RTX"&&b.parameters.apt){let k={ssrc:h,codecPayloadType:parseInt(b.parameters.apt,10)};h&&f&&(k.rtx={ssrc:f}),i.push(k),o&&(k=JSON.parse(JSON.stringify(k)),k.fec={ssrc:h,mechanism:c?"red+ulpfec":"red"},i.push(k))}}),i.length===0&&h&&i.push({ssrc:h});let y=e.matchPrefix(t,"b=");return y.length&&(y[0].indexOf("b=TIAS:")===0?y=parseInt(y[0].substring(7),10):y[0].indexOf("b=AS:")===0?y=parseInt(y[0].substring(5),10)*1e3*.95-2e3*8:y=void 0,i.forEach(b=>{b.maxBitrate=y})),i},e.parseRtcpParameters=function(t){const i={},a=e.matchPrefix(t,"a=ssrc:").map(u=>e.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];a&&(i.cname=a.value,i.ssrc=a.ssrc);const o=e.matchPrefix(t,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=o.length===0;const c=e.matchPrefix(t,"a=rtcp-mux");return i.mux=c.length>0,i},e.writeRtcpParameters=function(t){let i="";return t.reducedSize&&(i+=`a=rtcp-rsize\r
`),t.mux&&(i+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(i+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),i},e.parseMsid=function(t){let i;const a=e.matchPrefix(t,"a=msid:");if(a.length===1)return i=a[0].substring(7).split(" "),{stream:i[0],track:i[1]};const o=e.matchPrefix(t,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");if(o.length>0)return i=o[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(t){const i=e.parseMLine(t),a=e.matchPrefix(t,"a=max-message-size:");let o;a.length>0&&(o=parseInt(a[0].substring(19),10)),isNaN(o)&&(o=65536);const c=e.matchPrefix(t,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:i.fmt,maxMessageSize:o};const u=e.matchPrefix(t,"a=sctpmap:");if(u.length>0){const h=u[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:o}}},e.writeSctpDescription=function(t,i){let a=[];return t.protocol!=="DTLS/SCTP"?a=["m="+t.kind+" 9 "+t.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:a=["m="+t.kind+" 9 "+t.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&a.push("a=max-message-size:"+i.maxMessageSize+`\r
`),a.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,i,a){let o;const c=i!==void 0?i:2;return t?o=t:o=e.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+o+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,i){const a=e.splitLines(t);for(let o=0;o<a.length;o++)switch(a[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[o].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const a=e.splitLines(t)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},e.parseOLine=function(t){const a=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const i=e.splitLines(t);for(let a=0;a<i.length;a++)if(i[a].length<2||i[a].charAt(1)!=="=")return!1;return!0},n.exports=e})(qf)),qf.exports}var Iw=pj(),Es=nj(Iw),mj=CO({__proto__:null,default:Es},[Iw]);function du(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const a=new e(i),o=Es.parseCandidate(i.candidate);for(const c in o)c in a||Object.defineProperty(a,c,{value:o[c]});return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new e(i)},n.RTCIceCandidate.prototype=e.prototype,Sa(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function jp(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||Sa(n,"icecandidate",e=>{if(e.candidate){const t=Es.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function hu(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(u){if(!u||!u.sdp)return!1;const h=Es.splitSections(u.sdp);return h.shift(),h.some(f=>{const p=Es.parseMLine(f);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},i=function(u){const h=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;const f=parseInt(h[1],10);return f!==f?-1:f},a=function(u){let h=65536;return e.browser==="firefox"&&(e.version<57?u===-1?h=16384:h=2147483637:e.version<60?h=e.version===57?65535:65536:h=2147483637),h},o=function(u,h){let f=65536;e.browser==="firefox"&&e.version===57&&(f=65535);const p=Es.matchPrefix(u.sdp,"a=max-message-size:");return p.length>0?f=parseInt(p[0].substring(19),10):e.browser==="firefox"&&h!==-1&&(f=2147483637),f},c=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:h}=this.getConfiguration();h==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const h=i(arguments[0]),f=a(h),p=o(arguments[0],h);let y;f===0&&p===0?y=Number.POSITIVE_INFINITY:f===0||p===0?y=Math.max(f,p):y=Math.min(f,p);const b={};Object.defineProperty(b,"maxMessageSize",{get(){return y}}),this._sctp=b}return c.apply(this,arguments)}}function fu(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(i,a){const o=i.send;i.send=function(){const u=arguments[0],h=u.length||u.size||u.byteLength;if(i.readyState==="open"&&a.sctp&&h>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const a=t.apply(this,arguments);return e(a,this),a},Sa(n,"datachannel",i=>(e(i.channel,i.target),i))}function Pp(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const i=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{const o=a.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const c=new Event("connectionstatechange",a);o.dispatchEvent(c)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Dp(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=a.sdp.split(`
`).filter(c=>c.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&a instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:a.type,sdp:o}):a.sdp=o}return t.apply(this,arguments)}}function pu(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function mu(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return t.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer";break}return a.sdp||a.type!=="offer"&&a.type!=="answer"?t.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>t.apply(this,[c]))})}var gj=Object.freeze({__proto__:null,removeExtmapAllowMixed:Dp,shimAddIceCandidateNullOrEmpty:pu,shimConnectionState:Pp,shimMaxMessageSize:hu,shimParameterlessSetLocalDescription:mu,shimRTCIceCandidate:du,shimRTCIceCandidateRelayProtocol:jp,shimSendThrowTypeError:fu});function vj(){let{window:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const t=ow,i=hj(n),a={browserDetails:i,commonShim:gj,extractVersion:Yo,disableLog:uj,disableWarnings:dj,sdp:mj};switch(i.browser){case"chrome":if(!SS||!Op||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),a;if(i.version===null)return t("Chrome shim can not determine version, not shimming."),a;t("adapter.js shimming chrome."),a.browserShim=SS,pu(n,i),mu(n),cw(n,i),uw(n),Op(n,i),dw(n),mw(n,i),hw(n),fw(n),gw(n,i),du(n),jp(n),Pp(n),hu(n,i),fu(n),Dp(n,i);break;case"firefox":if(!TS||!Ap||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),a;t("adapter.js shimming firefox."),a.browserShim=TS,pu(n,i),mu(n),vw(n,i),Ap(n,i),yw(n),Tw(n),bw(n),Sw(n),kw(n),ww(n),Cw(n),_w(n),xw(n),du(n),Pp(n),hu(n,i),fu(n);break;case"safari":if(!kS||!e.shimSafari)return t("Safari shim is not included in this adapter release."),a;t("adapter.js shimming safari."),a.browserShim=kS,pu(n,i),mu(n),Pw(n),Mw(n),Ow(n),Ew(n),Rw(n),Dw(n),Aw(n),Nw(n),du(n),jp(n),hu(n,i),fu(n),Dp(n,i);break;default:t("Unsupported browser!");break}return a}vj({window:typeof window>"u"?void 0:window});class ln extends Promise{constructor(e){super(e)}catch(e){return super.catch(e)}static reject(e){return super.reject(e)}static all(e){return super.all(e)}static race(e){return super.race(e)}}const yj=/version\/(\d+(\.?_?\d+)+)/i;let Ff;function un(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const t=navigator.userAgent.toLowerCase();if(Ff===void 0||e){const i=bj.find(a=>{let{test:o}=a;return o.test(t)});Ff=i?.describe(t)}return Ff}const bj=[{test:/firefox|iceweasel|fxios/i,describe(n){return{name:"Firefox",version:gu(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Hf(n)}}},{test:/chrom|crios|crmo/i,describe(n){return{name:"Chrome",version:gu(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Hf(n)}}},{test:/safari|applewebkit/i,describe(n){return{name:"Safari",version:gu(yj,n),os:n.includes("mobile/")?"iOS":"macOS",osVersion:Hf(n)}}}];function gu(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(n);return i&&i.length>=t&&i[t]||""}function Hf(n){return n.includes("mac os")?gu(/\(.+?(\d+_\d+(:?_\d+)?)/,n,1).replace(/_/g,"."):void 0}var Sj="2.17.0";const Tj=Sj,kj=16;class yi extends Error{constructor(e,t){super(t||"an error has occured"),this.name="LiveKitError",this.code=e}}var tt;(function(n){n[n.NotAllowed=0]="NotAllowed",n[n.ServerUnreachable=1]="ServerUnreachable",n[n.InternalError=2]="InternalError",n[n.Cancelled=3]="Cancelled",n[n.LeaveRequest=4]="LeaveRequest",n[n.Timeout=5]="Timeout",n[n.WebSocket=6]="WebSocket",n[n.ServiceNotFound=7]="ServiceNotFound"})(tt||(tt={}));class ke extends yi{constructor(e,t,i,a){super(1,e),this.name="ConnectionError",this.status=i,this.reason=t,this.context=a,this.reasonName=tt[t]}static notAllowed(e,t,i){return new ke(e,tt.NotAllowed,t,i)}static timeout(e){return new ke(e,tt.Timeout)}static leaveRequest(e,t){return new ke(e,tt.LeaveRequest,void 0,t)}static internal(e,t){return new ke(e,tt.InternalError,void 0,t)}static cancelled(e){return new ke(e,tt.Cancelled)}static serverUnreachable(e,t){return new ke(e,tt.ServerUnreachable,t)}static websocket(e,t,i){return new ke(e,tt.WebSocket,t,i)}static serviceNotFound(e,t){return new ke(e,tt.ServiceNotFound,void 0,t)}}class Pm extends yi{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Vi extends yi{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class wj extends yi{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class bt extends yi{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class Rs extends yi{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class CS extends yi{constructor(e,t){super(15,e),this.name="PublishTrackError",this.status=t}}class _S extends yi{constructor(e,t){super(15,e),this.name="SignalRequestError",this.reason=t,this.reasonName=typeof t=="string"?t:Am[t]}}var Kt;(function(n){n[n.AlreadyOpened=0]="AlreadyOpened",n[n.AbnormalEnd=1]="AbnormalEnd",n[n.DecodeFailed=2]="DecodeFailed",n[n.LengthExceeded=3]="LengthExceeded",n[n.Incomplete=4]="Incomplete",n[n.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",n[n.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(Kt||(Kt={}));class zn extends yi{constructor(e,t){super(16,e),this.name="DataStreamError",this.reason=t,this.reasonName=Kt[t]}}class ps extends yi{constructor(e){super(18,e),this.name="SignalReconnectError"}}var fl;(function(n){n.PermissionDenied="PermissionDenied",n.NotFound="NotFound",n.DeviceInUse="DeviceInUse",n.Other="Other"})(fl||(fl={}));(function(n){function e(t){if(t&&"name"in t)return t.name==="NotFoundError"||t.name==="DevicesNotFoundError"?n.NotFound:t.name==="NotAllowedError"||t.name==="PermissionDeniedError"?n.PermissionDenied:t.name==="NotReadableError"||t.name==="TrackStartError"?n.DeviceInUse:n.Other}n.getFailure=e})(fl||(fl={}));class Ft{}Ft.setTimeout=function(){return setTimeout(...arguments)};Ft.setInterval=function(){return setInterval(...arguments)};Ft.clearTimeout=function(){return clearTimeout(...arguments)};Ft.clearInterval=function(){return clearInterval(...arguments)};var X;(function(n){n.Connected="connected",n.Reconnecting="reconnecting",n.SignalReconnecting="signalReconnecting",n.Reconnected="reconnected",n.Disconnected="disconnected",n.ConnectionStateChanged="connectionStateChanged",n.Moved="moved",n.MediaDevicesChanged="mediaDevicesChanged",n.ParticipantConnected="participantConnected",n.ParticipantDisconnected="participantDisconnected",n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalAudioSilenceDetected="localAudioSilenceDetected",n.ActiveSpeakersChanged="activeSpeakersChanged",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.ParticipantAttributesChanged="participantAttributesChanged",n.ParticipantActive="participantActive",n.RoomMetadataChanged="roomMetadataChanged",n.DataReceived="dataReceived",n.SipDTMFReceived="sipDTMFReceived",n.TranscriptionReceived="transcriptionReceived",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.AudioPlaybackStatusChanged="audioPlaybackChanged",n.VideoPlaybackStatusChanged="videoPlaybackChanged",n.MediaDevicesError="mediaDevicesError",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.SignalConnected="signalConnected",n.RecordingStatusChanged="recordingStatusChanged",n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ActiveDeviceChanged="activeDeviceChanged",n.ChatMessage="chatMessage",n.LocalTrackSubscribed="localTrackSubscribed",n.MetricsReceived="metricsReceived"})(X||(X={}));var te;(function(n){n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalTrackCpuConstrained="localTrackCpuConstrained",n.LocalSenderCreated="localSenderCreated",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.DataReceived="dataReceived",n.SipDTMFReceived="sipDTMFReceived",n.TranscriptionReceived="transcriptionReceived",n.IsSpeakingChanged="isSpeakingChanged",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.TrackCpuConstrained="trackCpuConstrained",n.MediaDevicesError="mediaDevicesError",n.AudioStreamAcquired="audioStreamAcquired",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.PCTrackAdded="pcTrackAdded",n.AttributesChanged="attributesChanged",n.LocalTrackSubscribed="localTrackSubscribed",n.ChatMessage="chatMessage",n.Active="active"})(te||(te={}));var ue;(function(n){n.TransportsCreated="transportsCreated",n.Connected="connected",n.Disconnected="disconnected",n.Resuming="resuming",n.Resumed="resumed",n.Restarting="restarting",n.Restarted="restarted",n.SignalResumed="signalResumed",n.SignalRestarted="signalRestarted",n.Closing="closing",n.MediaTrackAdded="mediaTrackAdded",n.ActiveSpeakersUpdate="activeSpeakersUpdate",n.DataPacketReceived="dataPacketReceived",n.RTPVideoMapUpdate="rtpVideoMapUpdate",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ParticipantUpdate="participantUpdate",n.RoomUpdate="roomUpdate",n.SpeakersChanged="speakersChanged",n.StreamStateChanged="streamStateChanged",n.ConnectionQualityUpdate="connectionQualityUpdate",n.SubscriptionError="subscriptionError",n.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",n.RemoteMute="remoteMute",n.SubscribedQualityUpdate="subscribedQualityUpdate",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalTrackSubscribed="localTrackSubscribed",n.Offline="offline",n.SignalRequestResponse="signalRequestResponse",n.SignalConnected="signalConnected",n.RoomMoved="roomMoved"})(ue||(ue={}));var ce;(function(n){n.Message="message",n.Muted="muted",n.Unmuted="unmuted",n.Restarted="restarted",n.Ended="ended",n.Subscribed="subscribed",n.Unsubscribed="unsubscribed",n.CpuConstrained="cpuConstrained",n.UpdateSettings="updateSettings",n.UpdateSubscription="updateSubscription",n.AudioPlaybackStarted="audioPlaybackStarted",n.AudioPlaybackFailed="audioPlaybackFailed",n.AudioSilenceDetected="audioSilenceDetected",n.VisibilityChanged="visibilityChanged",n.VideoDimensionsChanged="videoDimensionsChanged",n.VideoPlaybackStarted="videoPlaybackStarted",n.VideoPlaybackFailed="videoPlaybackFailed",n.ElementAttached="elementAttached",n.ElementDetached="elementDetached",n.UpstreamPaused="upstreamPaused",n.UpstreamResumed="upstreamResumed",n.SubscriptionPermissionChanged="subscriptionPermissionChanged",n.SubscriptionStatusChanged="subscriptionStatusChanged",n.SubscriptionFailed="subscriptionFailed",n.TrackProcessorUpdate="trackProcessorUpdate",n.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",n.TranscriptionReceived="transcriptionReceived",n.TimeSyncUpdate="timeSyncUpdate",n.PreConnectBufferFlushed="preConnectBufferFlushed"})(ce||(ce={}));function Cj(n){return typeof n>"u"?n:typeof structuredClone=="function"?typeof n=="object"&&n!==null?structuredClone(Object.assign({},n)):structuredClone(n):JSON.parse(JSON.stringify(n))}class Qe{constructor(e,t,i,a,o){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(t!==void 0&&i!==void 0)this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:i,maxFramerate:a,priority:o};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const _j=["vp8","h264"],xj=["vp8","h264","vp9","av1","h265"];function Ej(n){return!!_j.find(e=>e===n)}const Rj=Ej;var xS;(function(n){n[n.PREFER_REGRESSION=0]="PREFER_REGRESSION",n[n.SIMULCAST=1]="SIMULCAST",n[n.REGRESSION=2]="REGRESSION"})(xS||(xS={}));var Mp;(function(n){n.telephone={maxBitrate:12e3},n.speech={maxBitrate:24e3},n.music={maxBitrate:48e3},n.musicStereo={maxBitrate:64e3},n.musicHighQuality={maxBitrate:96e3},n.musicHighQualityStereo={maxBitrate:128e3}})(Mp||(Mp={}));const pl={h90:new Qe(160,90,9e4,20),h180:new Qe(320,180,16e4,20),h216:new Qe(384,216,18e4,20),h360:new Qe(640,360,45e4,20),h540:new Qe(960,540,8e5,25),h720:new Qe(1280,720,17e5,30),h1080:new Qe(1920,1080,3e6,30),h1440:new Qe(2560,1440,5e6,30),h2160:new Qe(3840,2160,8e6,30)},Np={h120:new Qe(160,120,7e4,20),h180:new Qe(240,180,125e3,20),h240:new Qe(320,240,14e4,20),h360:new Qe(480,360,33e4,20),h480:new Qe(640,480,5e5,20),h540:new Qe(720,540,6e5,25),h720:new Qe(960,720,13e5,30),h1080:new Qe(1440,1080,23e5,30),h1440:new Qe(1920,1440,38e5,30)},Dm={h360fps3:new Qe(640,360,2e5,3,"medium"),h360fps15:new Qe(640,360,4e5,15,"medium"),h720fps5:new Qe(1280,720,8e5,5,"medium"),h720fps15:new Qe(1280,720,15e5,15,"medium"),h720fps30:new Qe(1280,720,2e6,30,"medium"),h1080fps15:new Qe(1920,1080,25e5,15,"medium"),h1080fps30:new Qe(1920,1080,5e6,30,"medium"),original:new Qe(0,0,7e6,30,"medium")};function Lw(n,e,t){var i,a,o,c;const{optionsWithoutProcessor:u,audioProcessor:h,videoProcessor:f}=zw(n??{}),p=e?.processor,y=t?.processor,b=u??{};return b.audio===!0&&(b.audio={}),b.video===!0&&(b.video={}),b.audio&&(Ip(b.audio,e),(i=(o=b.audio).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"}),(h||p)&&(b.audio.processor=h??p)),b.video&&(Ip(b.video,t),(a=(c=b.video).deviceId)!==null&&a!==void 0||(c.deviceId={ideal:"default"}),(f||y)&&(b.video.processor=f??y)),b}function Ip(n,e){return Object.keys(e).forEach(t=>{n[t]===void 0&&(n[t]=e[t])}),n}function Mm(n){var e,t,i,a;const o={};if(n.video)if(typeof n.video=="object"){const c={},u=c,h=n.video;Object.keys(h).forEach(f=>{f==="resolution"?Ip(u,h.resolution):u[f]=h[f]}),o.video=c,(e=(i=o.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else o.video=n.video?{deviceId:{ideal:"default"}}:!1;else o.video=!1;return n.audio?typeof n.audio=="object"?(o.audio=n.audio,(t=(a=o.audio).deviceId)!==null&&t!==void 0||(a.deviceId={ideal:"default"})):o.audio={deviceId:{ideal:"default"}}:o.audio=!1,o}function Uw(n){return M(this,arguments,void 0,function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const i=Bw();if(i){const a=i.createAnalyser();a.fftSize=2048;const o=a.frequencyBinCount,c=new Uint8Array(o);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(a),yield Ht(t),a.getByteTimeDomainData(c);const h=c.some(f=>f!==128&&f!==0);return i.close(),!h}return!1})()})}function Bw(){var n;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const t=new e({latencyHint:"interactive"});if(t.state==="suspended"&&typeof window<"u"&&(!((n=window.document)===null||n===void 0)&&n.body)){const i=()=>M(this,void 0,void 0,function*(){var a;try{t.state==="suspended"&&(yield t.resume())}catch(o){console.warn("Error trying to auto-resume audio context",o)}finally{(a=window.document.body)===null||a===void 0||a.removeEventListener("click",i)}});t.addEventListener("statechange",()=>{var a;t.state==="closed"&&((a=window.document.body)===null||a===void 0||a.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return t}}function Oj(n){return n==="audioinput"?Q.Source.Microphone:n==="videoinput"?Q.Source.Camera:Q.Source.Unknown}function Lp(n){return n===Q.Source.Microphone?"audioinput":n===Q.Source.Camera?"videoinput":void 0}function Aj(n){var e,t;let i=(e=n.video)!==null&&e!==void 0?e:!0;return n.resolution&&n.resolution.width>0&&n.resolution.height>0&&(i=typeof i=="boolean"?{}:i,ba()?i=Object.assign(Object.assign({},i),{width:{max:n.resolution.width},height:{max:n.resolution.height},frameRate:n.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:n.resolution.width},height:{ideal:n.resolution.height},frameRate:n.resolution.frameRate})),{audio:(t=n.audio)!==null&&t!==void 0?t:!1,video:i,controller:n.controller,selfBrowserSurface:n.selfBrowserSurface,surfaceSwitching:n.surfaceSwitching,systemAudio:n.systemAudio,preferCurrentTab:n.preferCurrentTab}}function tl(n){return n.split("/")[1].toLowerCase()}function jj(n){const e=[];return n.forEach(t=>{t.track!==void 0&&e.push(new _m({cid:t.track.mediaStreamID,track:t.trackInfo}))}),e}function Me(n){return"mediaStreamTrack"in n?{trackID:n.sid,source:n.source,muted:n.isMuted,enabled:n.mediaStreamTrack.enabled,kind:n.kind,streamID:n.mediaStreamID,streamTrackID:n.mediaStreamTrack.id}:{trackID:n.trackSid,enabled:n.isEnabled,muted:n.isMuted,trackInfo:Object.assign({mimeType:n.mimeType,name:n.trackName,encrypted:n.isEncrypted,kind:n.kind,source:n.source},n.track?Me(n.track):{})}}function Pj(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function Dj(n,e){var t;n===void 0&&(n={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(n)],a={};for(const o of i)n[o]!==e[o]&&(a[o]=(t=e[o])!==null&&t!==void 0?t:"");return a}function zw(n){const e=Object.assign({},n);let t,i;return typeof e.audio=="object"&&e.audio.processor&&(t=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:t,videoProcessor:i,optionsWithoutProcessor:Cj(e)}}function Mj(n){switch(n){case xt.CAMERA:return Q.Source.Camera;case xt.MICROPHONE:return Q.Source.Microphone;case xt.SCREEN_SHARE:return Q.Source.ScreenShare;case xt.SCREEN_SHARE_AUDIO:return Q.Source.ScreenShareAudio;default:return Q.Source.Unknown}}function ES(n,e){return n.width*n.height<e.width*e.height}function Nj(n,e){var t;return(t=n.layers)===null||t===void 0?void 0:t.find(i=>i.quality===e)}const Ij=5e3,Fo=[];var xn;(function(n){n[n.LOW=0]="LOW",n[n.MEDIUM=1]="MEDIUM",n[n.HIGH=2]="HIGH"})(xn||(xn={}));class Q extends vi.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var a;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=Q.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Ee,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),Ij):this.handleAppVisibilityChanged()},this.log=Gi((a=i.loggerName)!==null&&a!==void 0?a:ai.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=Q.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Me(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===Q.Kind.Video&&(t="video"),this.attachedElements.length===0&&this.kind===Q.Kind.Video&&this.addAppVisibilityListener(),e||(t==="audio"&&(Fo.forEach(o=>{o.parentElement===null&&!e&&(e=o)}),e&&Fo.splice(Fo.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),ks(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),a=i.some(o=>o.kind==="audio");return e.play().then(()=>{this.emit(a?ce.AudioPlaybackStarted:ce.VideoPlaybackStarted)}).catch(o=>{o.name==="NotAllowedError"?this.emit(a?ce.AudioPlaybackFailed:ce.VideoPlaybackFailed,o):o.name==="AbortError"?Ee.debug("".concat(a?"audio":"video"," playback aborted, likely due to new play request")):Ee.warn("could not playback ".concat(a?"audio":"video"),o),a&&e&&i.some(c=>c.kind==="video")&&o.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(ce.ElementAttached,e),e}detach(e){try{if(e){Os(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(ce.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach(i=>{Os(this.mediaStreamTrack,i),t.push(i),this.recycleElement(i),this.emit(ce.ElementDetached,i)}),this.attachedElements=[],t}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Gi(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),Fo.forEach(i=>{i.parentElement||(t=!1)}),t&&Fo.push(e)}}handleAppVisibilityChanged(){return M(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===Q.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){cn()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){cn()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function ks(n,e){let t;e.srcObject instanceof MediaStream?t=e.srcObject:t=new MediaStream;let i;n.kind==="audio"?i=t.getAudioTracks():i=t.getVideoTracks(),i.includes(n)||(i.forEach(a=>{t.removeTrack(a)}),t.addTrack(n)),(!ba()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=t.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==t&&(e.srcObject=t,(ba()||ya())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=t,e.play().catch(()=>{})},0))}function Os(n,e){if(e.srcObject instanceof MediaStream){const t=e.srcObject;t.removeTrack(n),t.getTracks().length>0?e.srcObject=t:e.srcObject=null}}(function(n){let e;(function(f){f.Audio="audio",f.Video="video",f.Unknown="unknown"})(e=n.Kind||(n.Kind={}));let t;(function(f){f.Camera="camera",f.Microphone="microphone",f.ScreenShare="screen_share",f.ScreenShareAudio="screen_share_audio",f.Unknown="unknown"})(t=n.Source||(n.Source={}));let i;(function(f){f.Active="active",f.Paused="paused",f.Unknown="unknown"})(i=n.StreamState||(n.StreamState={}));function a(f){switch(f){case e.Audio:return Zn.AUDIO;case e.Video:return Zn.VIDEO;default:return Zn.DATA}}n.kindToProto=a;function o(f){switch(f){case Zn.AUDIO:return e.Audio;case Zn.VIDEO:return e.Video;default:return e.Unknown}}n.kindFromProto=o;function c(f){switch(f){case t.Camera:return xt.CAMERA;case t.Microphone:return xt.MICROPHONE;case t.ScreenShare:return xt.SCREEN_SHARE;case t.ScreenShareAudio:return xt.SCREEN_SHARE_AUDIO;default:return xt.UNKNOWN}}n.sourceToProto=c;function u(f){switch(f){case xt.CAMERA:return t.Camera;case xt.MICROPHONE:return t.Microphone;case xt.SCREEN_SHARE:return t.ScreenShare;case xt.SCREEN_SHARE_AUDIO:return t.ScreenShareAudio;default:return t.Unknown}}n.sourceFromProto=u;function h(f){switch(f){case _p.ACTIVE:return i.Active;case _p.PAUSED:return i.Paused;default:return i.Unknown}}n.streamStateFromProto=h})(Q||(Q={}));const Lj="|",RS="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function Uj(n){const e=n.split(Lj);return e.length>1?[e[0],n.substr(e[0].length+1)]:[n,""]}function Ht(n){return new ln(e=>Ft.setTimeout(e,n))}function Up(){return"addTransceiver"in RTCPeerConnection.prototype}function Bp(){return"addTrack"in RTCPeerConnection.prototype}function Bj(){if(!("getCapabilities"in RTCRtpSender)||ba()||ya())return!1;const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function zj(){if(!("getCapabilities"in RTCRtpSender)||ya())return!1;if(ba()){const t=un();if(t?.version&&gi(t.version,"16")<0||t?.os==="iOS"&&t?.osVersion&&gi(t.osVersion,"16")<0)return!1}const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function ti(n){return n==="av1"||n==="vp9"}function zp(n){return!document||ml()?!1:(n||(n=document.createElement("audio")),"setSinkId"in n)}function qj(){return typeof RTCPeerConnection>"u"?!1:Up()||Bp()}function ya(){var n;return((n=un())===null||n===void 0?void 0:n.name)==="Firefox"}function OS(){const n=un();return!!n&&n.name==="Chrome"&&n.os!=="iOS"}function ba(){var n;return((n=un())===null||n===void 0?void 0:n.name)==="Safari"}function ml(){const n=un();return n?.name==="Safari"||n?.os==="iOS"}function Fj(){const n=un();return n?.name==="Safari"&&n.version.startsWith("17.")||n?.os==="iOS"&&!!n?.osVersion&&gi(n.osVersion,"17")>=0}function Hj(n){return n||(n=un()),n?.name==="Safari"&&gi(n.version,"18.3")>0||n?.os==="iOS"&&!!n?.osVersion&&gi(n.osVersion,"18.3")>0}function qw(){var n,e;return cn()?(e=(n=navigator.userAgentData)===null||n===void 0?void 0:n.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function Vj(){const n=un(),e="17.2";if(n)return n.name!=="Safari"&&n.os!=="iOS"||n.os==="iOS"&&n.osVersion&&gi(n.osVersion,e)>=0?!0:n.name==="Safari"&&gi(n.version,e)>=0}function cn(){return typeof document<"u"}function mi(){return navigator.product=="ReactNative"}function Ms(n){return n.hostname.endsWith(".livekit.cloud")||n.hostname.endsWith(".livekit.run")}function Vf(n){return Ms(n)?n.hostname.split(".")[0]:null}function Fw(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Hw(){if(!mi())return;let n=Fw();if(n)return n.platform}function AS(){if(cn())return window.devicePixelRatio;if(mi()){let n=Fw();if(n)return n.devicePixelRatio}return 1}function gi(n,e){const t=n.split("."),i=e.split("."),a=Math.min(t.length,i.length);for(let o=0;o<a;++o){const c=parseInt(t[o],10),u=parseInt(i[o],10);if(c>u)return 1;if(c<u)return-1;if(o===a-1&&c===u)return 0}return n===""&&e!==""?-1:e===""?1:t.length==i.length?0:t.length<i.length?-1:1}function $j(n){for(const e of n)e.target.handleResize(e)}function Wj(n){for(const e of n)e.target.handleVisibilityChanged(e)}let $f=null;const jS=()=>($f||($f=new ResizeObserver($j)),$f);let Wf=null;const PS=()=>(Wf||(Wf=new IntersectionObserver(Wj,{root:null,rootMargin:"0px"})),Wf);function Gj(){var n;const e=new Hk({sdk:Vk.JS,protocol:kj,version:Tj});return mi()&&(e.os=(n=Hw())!==null&&n!==void 0?n:""),e}function DS(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const a=document.createElement("canvas");a.width=n,a.height=e;const o=a.getContext("2d");o?.fillRect(0,0,a.width,a.height),i&&o&&(o.beginPath(),o.arc(n/2,e/2,50,0,Math.PI*2,!0),o.closePath(),o.fillStyle="grey",o.fill());const c=a.captureStream(),[u]=c.getTracks();if(!u)throw Error("Could not get empty media stream video track");return u.enabled=t,u}let Ho;function Gf(){if(!Ho){const n=new AudioContext,e=n.createOscillator(),t=n.createGain();t.gain.setValueAtTime(0,0);const i=n.createMediaStreamDestination();if(e.connect(t),t.connect(i),e.start(),[Ho]=i.stream.getAudioTracks(),!Ho)throw Error("Could not get empty media stream audio track");Ho.enabled=!1}return Ho.clone()}class qn{get isResolved(){return this._isResolved}constructor(e,t){this._isResolved=!1,this.onFinally=t,this.promise=new Promise((i,a)=>M(this,void 0,void 0,function*(){this.resolve=i,this.reject=a,e&&(yield e(i,a))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function Kj(n){return xj.includes(n)}function Dr(n){if(typeof n=="string"||typeof n=="number")return n;if(Array.isArray(n))return n[0];if(n.exact!==void 0)return Array.isArray(n.exact)?n.exact[0]:n.exact;if(n.ideal!==void 0)return Array.isArray(n.ideal)?n.ideal[0]:n.ideal;throw Error("could not unwrap constraint")}function Jj(n){return n.startsWith("http")?n.replace(/^(http)/,"ws"):n}function gl(n){return n.startsWith("ws")?n.replace(/^(ws)/,"http"):n}function Yj(n,e){return n.segments.map(t=>{let{id:i,text:a,language:o,startTime:c,endTime:u,final:h}=t;var f;const p=(f=e.get(i))!==null&&f!==void 0?f:Date.now(),y=Date.now();return h?e.delete(i):e.set(i,p),{id:i,text:a,startTime:Number.parseInt(c.toString()),endTime:Number.parseInt(u.toString()),final:h,language:o,firstReceivedTime:p,lastReceivedTime:y}})}function Qj(n){const{id:e,timestamp:t,message:i,editTimestamp:a}=n;return{id:e,timestamp:Number.parseInt(t.toString()),editTimestamp:a?Number.parseInt(a.toString()):void 0,message:i}}function MS(n){switch(n.reason){case tt.LeaveRequest:return n.context;case tt.Cancelled:return ii.CLIENT_INITIATED;case tt.NotAllowed:return ii.USER_REJECTED;case tt.ServerUnreachable:return ii.JOIN_FAILURE;default:return ii.UNKNOWN_REASON}}function vu(n){return n!==void 0?Number(n):void 0}function ha(n){return n!==void 0?BigInt(n):void 0}function ga(n){return!!n&&!(n instanceof MediaStreamTrack)&&n.isLocal}function pi(n){return!!n&&n.kind==Q.Kind.Audio}function Ur(n){return!!n&&n.kind==Q.Kind.Video}function _r(n){return ga(n)&&Ur(n)}function Ui(n){return ga(n)&&pi(n)}function qp(n){return!!n&&!n.isLocal}function Xj(n){return!!n&&!n.isLocal}function Kf(n){return qp(n)&&Ur(n)}function Zj(n){return n.isLocal}function eP(n,e){const t=[];let i=new TextEncoder().encode(n);for(;i.length>e;){let a=e;for(;a>0;){const o=i[a];if(o!==void 0&&(o&192)!==128)break;a--}t.push(i.slice(0,a)),i=i.slice(a)}return i.length>0&&t.push(i),t}function tP(n){var e;const t=n.get("Cache-Control");if(t){const i=(e=t.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function nP(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=iP(n,e);return t?i:Nm(i,"v1")}function iP(n,e){const t=new URL(Jj(n));return e.forEach((i,a)=>{t.searchParams.set(a,i)}),Nm(t,"rtc")}function rP(n){const e=new URL(gl(n));return Nm(e,"validate")}function Vw(n){return n.endsWith("/")?n:"".concat(n,"/")}function Nm(n,e){return n.pathname="".concat(Vw(n.pathname)).concat(e),n}function NS(n){if(typeof n=="string")return fS.fromJson(JSON.parse(n),{ignoreUnknownFields:!0});if(n instanceof ArrayBuffer)return fS.fromBinary(new Uint8Array(n));throw new Error("could not decode websocket message: ".concat(typeof n))}function aP(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(n instanceof AbortSignal))return e;const t=n.reason;switch(typeof t){case"string":return t;case"object":return t instanceof Error?t.message:e;default:return"toString"in t?t.toString():e}}const sP=10,Vo="lk_e2ee",oP="LKFrameEncryptionKey",lP={sharedKey:!1,ratchetSalt:oP,ratchetWindowSize:8,failureTolerance:sP,keyringSize:16};var Mr;(function(n){n.SetKey="setKey",n.RatchetRequest="ratchetRequest",n.KeyRatcheted="keyRatcheted"})(Mr||(Mr={}));var IS;(function(n){n.KeyRatcheted="keyRatcheted"})(IS||(IS={}));var jr;(function(n){n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError"})(jr||(jr={}));var LS;(function(n){n.Error="cryptorError"})(LS||(LS={}));function cP(){return uP()||Fp()}function Fp(){return typeof window.RTCRtpScriptTransform<"u"}function uP(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function dP(n){var e,t,i,a,o;if(((e=n.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((t=n.value)===null||t===void 0?void 0:t.case)!=="metrics"&&((i=n.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((a=n.value)===null||a===void 0?void 0:a.case)!=="transcription"&&((o=n.value)===null||o===void 0?void 0:o.case)!=="encryptedPacket")return new Ik({value:n.value})}class kL extends vi.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(t,i,a)=>{Ee.debug("key ratcheted event received",{ratchetResult:t,participantId:i,keyIndex:a})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},lP),e),this.on(Mr.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,t,i){const a={key:e,participantIdentity:t,keyIndex:i};if(!this.options.sharedKey&&!t)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(t??"shared","-").concat(i??0),a),this.emit(Mr.SetKey,a)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,t){this.emit(Mr.RatchetRequest,e,t)}}var US;(function(n){n[n.InvalidKey=0]="InvalidKey",n[n.MissingKey=1]="MissingKey",n[n.InternalError=2]="InternalError"})(US||(US={}));class hP extends vi.EventEmitter{constructor(e,t){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var a,o;const{kind:c,data:u}=i.data;switch(c){case"error":if(Ee.error(u.error.message),u.uuid){const p=this.decryptDataRequests.get(u.uuid);if(p?.reject){p.reject(u.error);break}const y=this.encryptDataRequests.get(u.uuid);if(y?.reject){y.reject(u.error);break}}this.emit(jr.EncryptionError,u.error,u.participantIdentity);break;case"initAck":u.enabled&&this.keyProvider.getKeys().forEach(p=>{this.postKey(p)});break;case"enable":if(u.enabled&&this.keyProvider.getKeys().forEach(p=>{this.postKey(p)}),this.encryptionEnabled!==u.enabled&&u.participantIdentity===((a=this.room)===null||a===void 0?void 0:a.localParticipant.identity))this.emit(jr.ParticipantEncryptionStatusChanged,u.enabled,this.room.localParticipant),this.encryptionEnabled=u.enabled;else if(u.participantIdentity){const p=(o=this.room)===null||o===void 0?void 0:o.getParticipantByIdentity(u.participantIdentity);if(!p)throw TypeError("couldn't set encryption status, participant not found".concat(u.participantIdentity));this.emit(jr.ParticipantEncryptionStatusChanged,u.enabled,p)}break;case"ratchetKey":this.keyProvider.emit(Mr.KeyRatcheted,u.ratchetResult,u.participantIdentity,u.keyIndex);break;case"decryptDataResponse":const h=this.decryptDataRequests.get(u.uuid);h?.resolve&&h.resolve(u);break;case"encryptDataResponse":const f=this.encryptDataRequests.get(u.uuid);f?.resolve&&f.resolve(u);break}},this.onWorkerError=i=>{Ee.error("e2ee worker encountered an error:",{error:i.error}),this.emit(jr.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=t}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!cP())throw new Pm("tried to setup end-to-end encryption on an unsupported browser");if(Ee.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:aj.getLevel()}};this.worker&&(Ee.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){Ee.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){!e||e.length===0?Ee.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(ue.RTPVideoMapUpdate,t=>{this.postRTPMap(t)})}setupEventListeners(e,t){e.on(X.TrackPublished,(i,a)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==At.NONE,a.identity)),e.on(X.ConnectionStateChanged,i=>{i===Ve.Connected&&e.remoteParticipants.forEach(a=>{a.trackPublications.forEach(o=>{this.setParticipantCryptorEnabled(o.trackInfo.encryption!==At.NONE,a.identity)})})}).on(X.TrackUnsubscribed,(i,a,o)=>{var c;const u={kind:"removeTransform",data:{participantIdentity:o.identity,trackId:i.mediaStreamID}};(c=this.worker)===null||c===void 0||c.postMessage(u)}).on(X.TrackSubscribed,(i,a,o)=>{this.setupE2EEReceiver(i,o.identity,a.trackInfo)}).on(X.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(te.LocalSenderCreated,(i,a)=>M(this,void 0,void 0,function*(){this.setupE2EESender(a,i)})),e.localParticipant.on(te.LocalTrackPublished,i=>{if(!Ur(i.track)||!ml())return;const a={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:tl(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(a)}),t.on(Mr.SetKey,i=>this.postKey(i)).on(Mr.RatchetRequest,(i,a)=>this.postRatchetRequest(i,a))}encryptData(e){return M(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const t=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:t,payload:e,participantIdentity:this.room.localParticipant.identity}},a=new qn;return a.onFinally=()=>{this.encryptDataRequests.delete(t)},this.encryptDataRequests.set(t,a),this.worker.postMessage(i),a.promise})}handleEncryptedData(e,t,i,a){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const o=crypto.randomUUID(),c={kind:"decryptDataRequest",data:{uuid:o,payload:e,iv:t,participantIdentity:i,keyIndex:a}},u=new qn;return u.onFinally=()=>{this.decryptDataRequests.delete(o)},this.decryptDataRequests.set(o,u),this.worker.postMessage(c),u.promise}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(i)}postKey(e){let{key:t,participantIdentity:i,keyIndex:a}=e;var o;if(!this.worker)throw Error("could not set key, worker is missing");const c={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity),key:t,keyIndex:a}};this.worker.postMessage(c)}postEnable(e,t){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((t=this.room)===null||t===void 0)&&t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,i){if(e.receiver){if(!i?.mimeType||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,e.kind==="video"?tl(i.mimeType):void 0)}}setupE2EESender(e,t){if(!ga(e)||!t){t||Ee.warn("early return because sender is not ready");return}this.handleSender(t,e.mediaStreamID,void 0)}handleReceiver(e,t,i,a){return M(this,void 0,void 0,function*(){if(this.worker){if(Fp()&&!OS()){const o={kind:"decode",participantIdentity:i,trackId:t,codec:a};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{if(Vo in e&&a){const h={kind:"updateCodec",data:{trackId:t,codec:a,participantIdentity:i}};this.worker.postMessage(h);return}let o=e.writableStream,c=e.readableStream;if(!o||!c){const h=e.createEncodedStreams();e.writableStream=h.writable,o=h.writable,e.readableStream=h.readable,c=h.readable}const u={kind:"decode",data:{readableStream:c,writableStream:o,trackId:t,codec:a,participantIdentity:i,isReuse:Vo in e}};this.worker.postMessage(u,[c,o])}e[Vo]=!0}})}handleSender(e,t,i){var a;if(!(Vo in e||!this.worker)){if(!(!((a=this.room)===null||a===void 0)&&a.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Fp()&&!OS()){Ee.info("initialize script transform");const o={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{Ee.info("initialize encoded streams");const o=e.createEncodedStreams(),c={kind:"encode",data:{readableStream:o.readable,writableStream:o.writable,codec:i,trackId:t,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(c,[o.readable,o.writable])}e[Vo]=!0}}}const fP=500,pP=15e3;class As{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new As),this._instance}addFailedConnectionAttempt(e){var t;const i=new URL(e),a=Vf(i);if(!a)return;let o=(t=this.failedConnectionAttempts.get(a))!==null&&t!==void 0?t:0;this.failedConnectionAttempts.set(a,o+1),this.backOffPromises.set(a,Ht(Math.min(fP*Math.pow(2,o),pP)))}getBackOffPromise(e){const t=new URL(e),i=t&&Vf(t);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const t=new URL(e),i=t&&Vf(t);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}As._instance=null;const Jf="default";class Mt{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Mt),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return M(this,arguments,void 0,function(t){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;if(((o=Mt.userMediaPromiseMap)===null||o===void 0?void 0:o.size)>0){Ee.debug("awaiting getUserMedia promise");try{t?yield Mt.userMediaPromiseMap.get(t):yield Promise.all(Mt.userMediaPromiseMap.values())}catch{Ee.warn("error waiting for media permissons")}}let c=yield navigator.mediaDevices.enumerateDevices();if(a&&!(ba()&&i.hasDeviceInUse(t))&&(c.filter(h=>h.kind===t).length===0||c.some(h=>{const f=h.label==="",p=t?h.kind===t:!0;return f&&p}))){const h={video:t!=="audioinput"&&t!=="audiooutput",audio:t!=="videoinput"&&{deviceId:{ideal:"default"}}},f=yield navigator.mediaDevices.getUserMedia(h);c=yield navigator.mediaDevices.enumerateDevices(),f.getTracks().forEach(p=>{p.stop()})}return i._previousDevices=c,t&&(c=c.filter(u=>u.kind===t)),c})()})}normalizeDeviceId(e,t,i){return M(this,void 0,void 0,function*(){if(t!==Jf)return t;const a=yield this.getDevices(e),o=a.find(u=>u.deviceId===Jf);if(!o){Ee.warn("could not reliably determine default device");return}const c=a.find(u=>u.deviceId!==Jf&&u.groupId===(i??o.groupId));if(!c){Ee.warn("could not reliably determine default device");return}return c?.deviceId})}hasDeviceInUse(e){return e?Mt.userMediaPromiseMap.has(e):Mt.userMediaPromiseMap.size>0}}Mt.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Mt.userMediaPromiseMap=new Map;var nl;(function(n){n[n.WAITING=0]="WAITING",n[n.RUNNING=1]="RUNNING",n[n.COMPLETED=2]="COMPLETED"})(nl||(nl={}));class mP{constructor(){this.pendingTasks=new Map,this.taskMutex=new Yt,this.nextTaskIndex=0}run(e){return M(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:nl.WAITING};this.pendingTasks.set(t.id,t);const i=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=nl.RUNNING,yield e()}finally{t.status=nl.COMPLETED,this.pendingTasks.delete(t.id),i()}})}flush(){return M(this,void 0,void 0,function*(){return this.run(()=>M(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class gP{get readyState(){return this.ws.readyState}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,a;if(!((i=t.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const o=new WebSocket(e,(a=t.protocols)!==null&&a!==void 0?a:[]);o.binaryType="arraybuffer",this.ws=o;const c=function(){let{closeCode:u,reason:h}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return o.close(u,h)};this.opened=new ln((u,h)=>{const f=()=>{h(ke.websocket("Encountered websocket error during connection establishment"))};o.onopen=()=>{u({readable:new ReadableStream({start(p){o.onmessage=y=>{let{data:b}=y;return p.enqueue(b)},o.onerror=y=>p.error(y)},cancel:c}),writable:new WritableStream({write(p){o.send(p)},abort(){o.close()},close:c}),protocol:o.protocol,extensions:o.extensions}),o.removeEventListener("error",f)},o.addEventListener("error",f)}),this.closed=new ln((u,h)=>{const f=()=>M(this,void 0,void 0,function*(){const p=new ln(b=>{o.readyState!==WebSocket.CLOSED&&o.addEventListener("close",k=>{b(k)},{once:!0})}),y=yield ln.race([Ht(250),p]);y?u(y):h(ke.websocket("Encountered unspecified websocket error without a timely close event"))});o.onclose=p=>{let{code:y,reason:b}=p;u({closeCode:y,reason:b}),o.removeEventListener("error",f)},o.addEventListener("error",f)}),t.signal&&(t.signal.onabort=()=>o.close()),this.close=c}}const vP=["syncState","trickle","offer","answer","simulate","leave"];function yP(n){const e=vP.indexOf(n.case)>=0;return Ee.trace("request allowed to bypass queue:",{canPass:e,req:n}),e}var et;(function(n){n[n.CONNECTING=0]="CONNECTING",n[n.CONNECTED=1]="CONNECTED",n[n.RECONNECTING=2]="RECONNECTING",n[n.DISCONNECTING=3]="DISCONNECTING",n[n.DISCONNECTED=4]="DISCONNECTED"})(et||(et={}));const bP=250;class Im{get currentState(){return this.state}get isDisconnected(){return this.state===et.DISCONNECTING||this.state===et.DISCONNECTED}get isEstablishingConnection(){return this.state===et.CONNECTING||this.state===et.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=et.DISCONNECTED,this.log=Ee,this._requestId=0,this.useV0SignalPath=!1,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=Gi((i=t.loggerName)!==null&&i!==void 0?i:ai.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new mP,this.queuedRequests=[],this.closingLock=new Yt,this.connectionLock=new Yt,this.state=et.DISCONNECTED}get logContext(){var e,t;return(t=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&t!==void 0?t:{}}join(e,t,i,a){return M(this,arguments,void 0,function(o,c,u,h){var f=this;let p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){return f.state=et.CONNECTING,f.options=u,yield f.connect(o,c,u,h,p)})()})}reconnect(e,t,i,a){return M(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=et.RECONNECTING,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:a}),void 0,this.useV0SignalPath)})}connect(e,t,i,a){return M(this,arguments,void 0,function(o,c,u,h){var f=this;let p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){const y=yield f.connectionLock.lock();f.connectOptions=u,f.useV0SignalPath=p;const b=Gj(),k=p?SP(c,b,u):TP(c,b,u),C=nP(o,k,p).toString(),w=rP(C).toString();return new Promise((O,R)=>M(f,void 0,void 0,function*(){var P,j;try{let E=!1;const _=z=>M(this,void 0,void 0,function*(){if(E)return;E=!0;const H=z instanceof Event?z.currentTarget:z,ie=aP(H,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(ie)).catch(he=>{this.log.error(he),this.close()}):this.close(),A(),R(ke.cancelled(ie))});h?.addEventListener("abort",_);const A=()=>{clearTimeout(I),h?.removeEventListener("abort",_)},I=setTimeout(()=>{_(ke.timeout("room connection has timed out (signal)"))},u.websocketTimeout),F=(z,H)=>{this.handleSignalConnected(z,I,H)},B=new URL(C);B.searchParams.has("access_token")&&B.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(B),Object.assign({reconnect:u.reconnect,reconnectReason:u.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new gP(C);try{this.ws.closed.then(N=>{var K;this.isEstablishingConnection&&R(ke.internal("Websocket got closed during a (re)connection attempt: ".concat(N.reason))),N.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:N.reason,code:N.closeCode,wasClean:N.closeCode===1e3,state:this.state})),this.state===et.CONNECTED&&this.handleOnClose((K=N.reason)!==null&&K!==void 0?K:"Unexpected WS error"))}).catch(N=>{this.isEstablishingConnection&&R(ke.internal("Websocket error during a (re)connection attempt: ".concat(N)))});const z=yield this.ws.opened.catch(N=>M(this,void 0,void 0,function*(){if(this.state!==et.CONNECTED){this.state=et.DISCONNECTED,clearTimeout(I);const K=yield this.handleConnectionError(N,w);R(K);return}this.handleWSError(N),R(N)}));if(clearTimeout(I),!z)return;const H=z.readable.getReader();this.streamWriter=z.writable.getWriter();const ie=yield H.read();if(H.releaseLock(),!ie.value)throw ke.internal("no message received as first message");const he=NS(ie.value),Z=this.validateFirstMessage(he,(P=u.reconnect)!==null&&P!==void 0?P:!1);if(!Z.isValid){R(Z.error);return}((j=he.message)===null||j===void 0?void 0:j.case)==="join"&&(this.pingTimeoutDuration=he.message.value.pingTimeout,this.pingIntervalDuration=he.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const le=Z.shouldProcessFirstMessage?he:void 0;F(z,le),O(Z.response)}catch(z){R(z)}finally{A()}}finally{y()}}))})()})}startReadingLoop(e,t){return M(this,void 0,void 0,function*(){for(t&&this.handleSignalResponse(t);;){this.signalLatency&&(yield Ht(this.signalLatency));const{done:i,value:a}=yield e.read();if(i)break;const o=NS(a);this.handleSignalResponse(o)}})}close(){return M(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([et.DISCONNECTING||et.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const a=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=et.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const o=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([o,Ht(bP)])}}catch(o){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:o}))}finally{t&&(e.state=et.DISCONNECTED),a()}})()})}sendOffer(e,t){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:ws(e,t)})}sendAnswer(e,t){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:ws(e,t)})}sendIceCandidate(e,t){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Wu({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new Gu({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return M(this,arguments,void 0,function(i,a){var o=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const u=o.getNextRequestId();return yield o.sendRequest({case:"updateMetadata",value:new Em({requestId:u,metadata:i,name:a,attributes:c})}),u})()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new Qk({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new ew({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:lt.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new iw({timestamp:lt.parse(Date.now()),rtt:lt.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new xm({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new Ju({reason:ii.CLIENT_INITIATED,action:xs.DISCONNECT})})}sendRequest(e){return M(this,arguments,void 0,function(t){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!a&&!yP(t)&&i.state===et.RECONNECTING){i.queuedRequests.push(()=>M(i,void 0,void 0,function*(){yield this.sendRequest(t,!0)}));return}if(a||(yield i.requestQueue.flush()),i.signalLatency&&(yield Ht(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(t.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(t?.case),i.logContext);return}const c=new AA({message:t});try{i.useJSON?yield i.streamWriter.write(c.toJsonString()):yield i.streamWriter.write(c.toBinary())}catch(u){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:u}))}})()})}handleSignalResponse(e){var t,i;const a=e.message;if(a==null){this.log.debug("received unsupported message",this.logContext);return}let o=!1;if(a.case==="answer"){const c=BS(a.value);this.onAnswer&&this.onAnswer(c,a.value.id,a.value.midToTrackId)}else if(a.case==="offer"){const c=BS(a.value);this.onOffer&&this.onOffer(c,a.value.id,a.value.midToTrackId)}else if(a.case==="trickle"){const c=JSON.parse(a.value.candidateInit);this.onTrickle&&this.onTrickle(c,a.value.target)}else a.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((t=a.value.participants)!==null&&t!==void 0?t:[]):a.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(a.value):a.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=a.value.speakers)!==null&&i!==void 0?i:[]):a.case==="leave"?this.onLeave&&this.onLeave(a.value):a.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(a.value.sid,a.value.muted):a.case==="roomUpdate"?this.onRoomUpdate&&a.value.room&&this.onRoomUpdate(a.value.room):a.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(a.value):a.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(a.value):a.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(a.value):a.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(a.value):a.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(a.value):a.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(a.value):a.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(a.value):a.case==="pong"||(a.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(a.value.lastPingTimestamp.toString()),this.resetPingTimeout(),o=!0):a.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(a.value):a.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(a.value.trackSid):a.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(a.value.token),this.onRoomMoved&&this.onRoomMoved(a.value)):a.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(a.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:a.case})));o||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return M(this,void 0,void 0,function*(){if(this.state===et.DISCONNECTED)return;const t=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Ft.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Ft.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Ft.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Ft.clearInterval(this.pingInterval)}handleSignalConnected(e,t,i){this.state=et.CONNECTED,clearTimeout(t),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,t){var i,a,o,c,u;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===et.RECONNECTING&&((a=e.message)===null||a===void 0?void 0:a.case)!=="leave"?((o=e.message)===null||o===void 0?void 0:o.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((c=e.message)===null||c===void 0?void 0:c.case)==="leave"?{isValid:!1,error:ke.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:t?{isValid:!1,error:ke.internal("Unexpected first message")}:{isValid:!1,error:ke.internal("did not receive join response, got ".concat((u=e.message)===null||u===void 0?void 0:u.case," instead"))}}handleConnectionError(e,t){return M(this,void 0,void 0,function*(){try{const i=yield fetch(t);switch(i.status){case 404:return ke.serviceNotFound("v1 RTC path not found. Consider upgrading your LiveKit server version","v0-rtc");case 401:case 403:const a=yield i.text();return ke.notAllowed(a,i.status);default:break}return e instanceof ke?e:ke.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof ke?i:ke.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function BS(n){const e={type:"offer",sdp:n.sdp};switch(n.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=n.type;break}return e}function ws(n,e){return new Lr({sdp:n.sdp,type:n.type,id:e})}function SP(n,e,t){var i;const a=new URLSearchParams;return a.set("access_token",n),t.reconnect&&(a.set("reconnect","1"),t.sid&&a.set("sid",t.sid)),a.set("auto_subscribe",t.autoSubscribe?"1":"0"),a.set("sdk",mi()?"reactnative":"js"),a.set("version",e.version),a.set("protocol",e.protocol.toString()),e.deviceModel&&a.set("device_model",e.deviceModel),e.os&&a.set("os",e.os),e.osVersion&&a.set("os_version",e.osVersion),e.browser&&a.set("browser",e.browser),e.browserVersion&&a.set("browser_version",e.browserVersion),t.adaptiveStream&&a.set("adaptive_stream","1"),t.reconnectReason&&a.set("reconnect_reason",t.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&a.set("network",navigator.connection.type),a}function TP(n,e,t){const i=new URLSearchParams;i.set("access_token",n);const a=new XA({clientInfo:e,connectionSettings:new rw({autoSubscribe:!!t.autoSubscribe,adaptiveStream:!!t.adaptiveStream}),reconnect:!!t.reconnect,participantSid:t.sid?t.sid:void 0});t.reconnectReason&&(a.reconnectReason=t.reconnectReason);const o=new ZA({joinRequest:a.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(o.toBinary()))),i}class zS{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const t=this.buffer[0];if(this._totalSize-t.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class kP{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,t){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const a=i+this.ttl;return this._map.set(e,{value:t,expiresAt:a}),this}get(e){const t=this._map.get(e);if(t){if(t.expiresAt<Date.now()){this._map.delete(e);return}return t.value}}has(e){const t=this._map.get(e);return t?t.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[t,i]of this._map.entries())i.expiresAt<e&&this._map.delete(t);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[t,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,t,this.asValueMap())}map(e){this.cleanup();const t=[],i=this.asValueMap();for(const[a,o]of i.entries())t.push(e(o,a,i));return t}asValueMap(){const e=new Map;for(const[t,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(t,i.value);return e}}var Gn={},Yf={},Qf={exports:{}},qS;function Lm(){if(qS)return Qf.exports;qS=1;var n=Qf.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(n).forEach(function(e){var t=n[e];t.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),Qf.exports}var FS;function wP(){return FS||(FS=1,(function(n){var e=function(u){return String(Number(u))===u?Number(u):u},t=function(u,h,f,p){if(p&&!f)h[p]=e(u[1]);else for(var y=0;y<f.length;y+=1)u[y+1]!=null&&(h[f[y]]=e(u[y+1]))},i=function(u,h,f){var p=u.name&&u.names;u.push&&!h[u.push]?h[u.push]=[]:p&&!h[u.name]&&(h[u.name]={});var y=u.push?{}:p?h[u.name]:h;t(f.match(u.reg),y,u.names,u.name),u.push&&h[u.push].push(y)},a=Lm(),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(u){var h={},f=[],p=h;return u.split(/(\r\n|\r|\n)/).filter(o).forEach(function(y){var b=y[0],k=y.slice(2);b==="m"&&(f.push({rtp:[],fmtp:[]}),p=f[f.length-1]);for(var C=0;C<(a[b]||[]).length;C+=1){var w=a[b][C];if(w.reg.test(k))return i(w,p,k)}}),h.media=f,h};var c=function(u,h){var f=h.split(/=(.+)/,2);return f.length===2?u[f[0]]=e(f[1]):f.length===1&&h.length>1&&(u[f[0]]=void 0),u};n.parseParams=function(u){return u.split(/;\s?/).reduce(c,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(u){return u.toString().split(" ").map(Number)},n.parseRemoteCandidates=function(u){for(var h=[],f=u.split(" ").map(e),p=0;p<f.length;p+=3)h.push({component:f[p],ip:f[p+1],port:f[p+2]});return h},n.parseImageAttributes=function(u){return u.split(" ").map(function(h){return h.substring(1,h.length-1).split(",").reduce(c,{})})},n.parseSimulcastStreamList=function(u){return u.split(";").map(function(h){return h.split(",").map(function(f){var p,y=!1;return f[0]!=="~"?p=e(f):(p=e(f.substring(1,f.length)),y=!0),{scid:p,paused:y}})})}})(Yf)),Yf}var Xf,HS;function CP(){if(HS)return Xf;HS=1;var n=Lm(),e=/%[sdv%]/g,t=function(c){var u=1,h=arguments,f=h.length;return c.replace(e,function(p){if(u>=f)return p;var y=h[u];switch(u+=1,p){case"%%":return"%";case"%s":return String(y);case"%d":return Number(y);case"%v":return""}})},i=function(c,u,h){var f=u.format instanceof Function?u.format(u.push?h:h[u.name]):u.format,p=[c+"="+f];if(u.names)for(var y=0;y<u.names.length;y+=1){var b=u.names[y];u.name?p.push(h[u.name][b]):p.push(h[u.names[y]])}else p.push(h[u.name]);return t.apply(null,p)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return Xf=function(c,u){u=u||{},c.version==null&&(c.version=0),c.name==null&&(c.name=" "),c.media.forEach(function(y){y.payloads==null&&(y.payloads="")});var h=u.outerOrder||a,f=u.innerOrder||o,p=[];return h.forEach(function(y){n[y].forEach(function(b){b.name in c&&c[b.name]!=null?p.push(i(y,b,c)):b.push in c&&c[b.push]!=null&&c[b.push].forEach(function(k){p.push(i(y,b,k))})})}),c.media.forEach(function(y){p.push(i("m",n.m[0],y)),f.forEach(function(b){n[b].forEach(function(k){k.name in y&&y[k.name]!=null?p.push(i(b,k,y)):k.push in y&&y[k.push]!=null&&y[k.push].forEach(function(C){p.push(i(b,k,C))})})})}),p.join(`\r
`)+`\r
`},Xf}var VS;function _P(){if(VS)return Gn;VS=1;var n=wP(),e=CP(),t=Lm();return Gn.grammar=t,Gn.write=e,Gn.parse=n.parse,Gn.parseParams=n.parseParams,Gn.parseFmtpConfig=n.parseFmtpConfig,Gn.parsePayloads=n.parsePayloads,Gn.parseRemoteCandidates=n.parseRemoteCandidates,Gn.parseImageAttributes=n.parseImageAttributes,Gn.parseSimulcastStreamList=n.parseSimulcastStreamList,Gn}var Rr=_P();function Um(n,e,t){var i,a,o;e===void 0&&(e=50),t===void 0&&(t={});var c=(i=t.isImmediate)!=null&&i,u=(a=t.callback)!=null&&a,h=t.maxWait,f=Date.now(),p=[];function y(){if(h!==void 0){var k=Date.now()-f;if(k+e>=h)return h-k}return e}var b=function(){var k=[].slice.call(arguments),C=this;return new Promise(function(w,O){var R=c&&o===void 0;if(o!==void 0&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,f=Date.now(),!c){var j=n.apply(C,k);u&&u(j),p.forEach(function(E){return(0,E.resolve)(j)}),p=[]}},y()),R){var P=n.apply(C,k);return u&&u(P),w(P)}p.push({resolve:w,reject:O})})};return b.cancel=function(k){o!==void 0&&clearTimeout(o),p.forEach(function(C){return(0,C.reject)(k)}),p=[]},b}const xP=.7,EP=20,js={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class $S extends vi.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=Ee,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Um(a=>M(this,void 0,void 0,function*(){this.emit(js.NegotiationStarted);try{yield this.createAndSendOffer()}catch(o){if(a)a(o);else throw o}}),EP),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Gi((i=t.loggerName)!==null&&i!==void 0?i:ai.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC(),this.offerLock=new Yt}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=t=>{var i;t.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,t.candidate))},e.onicecandidateerror=t=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,t)},e.oniceconnectionstatechange=()=>{var t;(t=this.onIceConnectionStateChange)===null||t===void 0||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;(t=this.onSignalingStatechange)===null||t===void 0||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,e.connectionState)},e.ondatachannel=t=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,t)},e.ontrack=t=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,t)},e}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return M(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,t){return M(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&t>0&&t!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:t,latestOfferId:this.latestOfferId})),!1;let a;if(e.type==="offer"){let{stereoMids:o,nackMids:c}=RP(e);this.remoteStereoMids=o,this.remoteNackMids=c}else if(e.type==="answer"){const o=Rr.parse((i=e.sdp)!==null&&i!==void 0?i:"");o.media.forEach(c=>{const u=Bm(c.mid);c.type==="audio"&&this.trackBitrates.some(h=>{if(!h.transceiver||u!=h.transceiver.mid)return!1;let f=0;if(c.rtp.some(y=>y.codec.toUpperCase()===h.codec.toUpperCase()?(f=y.payload,!0):!1),f===0)return!0;let p=!1;for(const y of c.fmtp)if(y.payload===f){y.config=y.config.split(";").filter(b=>!b.includes("maxaveragebitrate")).join(";"),h.maxbr>0&&(y.config+=";maxaveragebitrate=".concat(h.maxbr*1e3)),p=!0;break}return p||h.maxbr>0&&c.fmtp.push({payload:f,config:"maxaveragebitrate=".concat(h.maxbr*1e3)}),!0})}),a=Rr.write(o)}return yield this.setMungedSDP(e,a,!0),this.pendingCandidates.forEach(o=>{this.pc.addIceCandidate(o)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(js.NegotiationComplete),e.sdp&&Rr.parse(e.sdp).media.forEach(c=>{c.type==="video"&&this.emit(js.RTPVideoPayloadTypes,c.rtp)})),!0})}createAndSendOffer(e){return M(this,void 0,void 0,function*(){var t;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const u=this._pc.remoteDescription;if(e?.iceRestart&&u)yield this._pc.setRemoteDescription(u);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const a=this.latestOfferId+1;this.latestOfferId=a;const o=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:o.sdp},this.logContext));const c=Rr.parse((t=o.sdp)!==null&&t!==void 0?t:"");if(c.media.forEach(u=>{GS(u),u.type==="audio"?WS(u,["all"],[]):u.type==="video"&&this.trackBitrates.some(h=>{if(!u.msid||!h.cid||!u.msid.includes(h.cid))return!1;let f=0;if(u.rtp.some(y=>y.codec.toUpperCase()===h.codec.toUpperCase()?(f=y.payload,!0):!1),f===0||(ti(h.codec)&&!ba()&&this.ensureVideoDDExtensionForSVC(u,c),!ti(h.codec)))return!0;const p=Math.round(h.maxbr*xP);for(const y of u.fmtp)if(y.payload===f){y.config.includes("x-google-start-bitrate")||(y.config+=";x-google-start-bitrate=".concat(p));break}return!0})}),this.latestOfferId>a){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:a}));return}yield this.setMungedSDP(o,Rr.write(c)),this.onOffer(o,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return M(this,void 0,void 0,function*(){var e;const t=yield this.pc.createAnswer(),i=Rr.parse((e=t.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(a=>{GS(a),a.type==="audio"&&WS(a,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,Rr.write(i)),t})}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTransceiverOfKind(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new bt("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new bt("PC closed, cannot configure");return(t=this._pc)===null||t===void 0?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var t;return(t=this._pc)===null||t===void 0?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&t!==void 0?t:"closed"}getICEConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&t!==void 0?t:"closed"}getSignallingState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&t!==void 0?t:"closed"}getTransceivers(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&t!==void 0?t:[]}getSenders(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&t!==void 0?t:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return M(this,void 0,void 0,function*(){var e;if(!this._pc)return;let t="";const i=new Map,a=new Map;if((yield this._pc.getStats()).forEach(u=>{switch(u.type){case"transport":t=u.selectedCandidatePairId;break;case"candidate-pair":t===""&&u.selected&&(t=u.id),i.set(u.id,u);break;case"remote-candidate":a.set(u.id,"".concat(u.address,":").concat(u.port));break}}),t==="")return;const c=(e=i.get(t))===null||e===void 0?void 0:e.remoteCandidateId;if(c!==void 0)return a.get(c)})}setMungedSDP(e,t,i){return M(this,void 0,void 0,function*(){if(t){const a=e.sdp;e.sdp=t;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(o){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:o,sdp:t})),e.sdp=a}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(a){let o="unknown error";a instanceof Error?o=a.message:typeof a=="string"&&(o=a);const c={error:o,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(c.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:c})),new Rs(o)}})}ensureVideoDDExtensionForSVC(e,t){var i,a;if(!((i=e.ext)===null||i===void 0?void 0:i.some(c=>c.uri===RS))){if(this.ddExtID===0){let c=0;t.media.forEach(u=>{var h;u.type==="video"&&((h=u.ext)===null||h===void 0||h.forEach(f=>{f.value>c&&(c=f.value)}))}),this.ddExtID=c+1}(a=e.ext)===null||a===void 0||a.push({value:this.ddExtID,uri:RS})}}}function WS(n,e,t){const i=Bm(n.mid);let a=0;n.rtp.some(o=>o.codec==="opus"?(a=o.payload,!0):!1),a>0&&(n.rtcpFb||(n.rtcpFb=[]),t.includes(i)&&!n.rtcpFb.some(o=>o.payload===a&&o.type==="nack")&&n.rtcpFb.push({payload:a,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&n.fmtp.some(o=>o.payload===a?(o.config.includes("stereo=1")||(o.config+=";stereo=1"),!0):!1))}function RP(n){var e;const t=[],i=[],a=Rr.parse((e=n.sdp)!==null&&e!==void 0?e:"");let o=0;return a.media.forEach(c=>{var u;const h=Bm(c.mid);c.type==="audio"&&(c.rtp.some(f=>f.codec==="opus"?(o=f.payload,!0):!1),!((u=c.rtcpFb)===null||u===void 0)&&u.some(f=>f.payload===o&&f.type==="nack")&&i.push(h),c.fmtp.some(f=>f.payload===o?(f.config.includes("sprop-stereo=1")&&t.push(h),!0):!1))}),{stereoMids:t,nackMids:i}}function GS(n){if(n.connection){const e=n.connection.ip.indexOf(":")>=0;(n.connection.version===4&&e||n.connection.version===6&&!e)&&(n.connection.ip="0.0.0.0",n.connection.version=4)}}function Bm(n){return typeof n=="number"?n.toFixed(0):n}const Hp="vp8",OP={audioPreset:Mp.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Dm.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Hp,backupCodec:!0,preConnectBuffer:!1},$w={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Ww={deviceId:{ideal:"default"},resolution:pl.h720.resolution},AP={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new oj,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!0},zm={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var pt;(function(n){n[n.NEW=0]="NEW",n[n.CONNECTING=1]="CONNECTING",n[n.CONNECTED=2]="CONNECTED",n[n.FAILED=3]="FAILED",n[n.CLOSING=4]="CLOSING",n[n.CLOSED=5]="CLOSED"})(pt||(pt={}));class jP{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}get mode(){return this._mode}constructor(e,t,i){var a;this.peerConnectionTimeout=zm.peerConnectionTimeout,this.log=Ee,this.updateState=()=>{var o,c;const u=this.state,h=this.requiredTransports.map(f=>f.getConnectionState());h.every(f=>f==="connected")?this.state=pt.CONNECTED:h.some(f=>f==="failed")?this.state=pt.FAILED:h.some(f=>f==="connecting")?this.state=pt.CONNECTING:h.every(f=>f==="closed")?this.state=pt.CLOSED:h.some(f=>f==="closed")?this.state=pt.CLOSING:h.every(f=>f==="new")&&(this.state=pt.NEW),u!==this.state&&(this.log.debug("pc state change: from ".concat(pt[u]," to ").concat(pt[this.state]),this.logContext),(o=this.onStateChange)===null||o===void 0||o.call(this,this.state,this.publisher.getConnectionState(),(c=this.subscriber)===null||c===void 0?void 0:c.getConnectionState()))},this.log=Gi((a=i.loggerName)!==null&&a!==void 0?a:ai.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=t!=="subscriber-primary",this.isSubscriberConnectionRequired=t==="subscriber-primary",this.publisher=new $S(e,i),this._mode=t,t!=="publisher-only"&&(this.subscriber=new $S(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=o=>{var c;(c=this.onIceCandidate)===null||c===void 0||c.call(this,o,ei.SUBSCRIBER)},this.subscriber.onDataChannel=o=>{var c;(c=this.onDataChannel)===null||c===void 0||c.call(this,o)},this.subscriber.onTrack=o=>{var c;(c=this.onTrack)===null||c===void 0||c.call(this,o)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=o=>{var c;(c=this.onIceCandidate)===null||c===void 0||c.call(this,o,ei.PUBLISHER)},this.publisher.onTrack=o=>{var c;(c=this.onTrack)===null||c===void 0||c.call(this,o)},this.publisher.onOffer=(o,c)=>{var u;(u=this.onPublisherOffer)===null||u===void 0||u.call(this,o,c)},this.state=pt.NEW,this.connectionLock=new Yt,this.remoteOfferLock=new Yt}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,t){return this.publisher.setRemoteDescription(e,t)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return M(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const t=this.publisher;for(const i of t.getSenders())try{t.canRemoveTrack()&&t.removeTrack(i)}catch(a){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:a}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return M(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,t){return M(this,void 0,void 0,function*(){var i;t===ei.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,t){return M(this,void 0,void 0,function*(){var i,a,o;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const c=yield this.remoteOfferLock.lock();try{return(yield(a=this.subscriber)===null||a===void 0?void 0:a.setRemoteDescription(e,t))?yield(o=this.subscriber)===null||o===void 0?void 0:o.createAndSetAnswer():void 0}finally{c()}})}updateConfiguration(e,t){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return M(this,void 0,void 0,function*(){var i;const a=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(o=>this.ensureTransportConnected(o,e,t)))}finally{a()}})}negotiate(e){return M(this,void 0,void 0,function*(){return new ln((t,i)=>M(this,void 0,void 0,function*(){const a=setTimeout(()=>{i(new Rs("negotiation timed out"))},this.peerConnectionTimeout),o=()=>{clearTimeout(a),i(new Rs("negotiation aborted"))};e.signal.addEventListener("abort",o),this.publisher.once(js.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(js.NegotiationComplete,()=>{clearTimeout(a),t()})}),yield this.publisher.negotiate(c=>{clearTimeout(a),c instanceof Error?i(c):i(new Error(String(c)))})}))})}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTransceiverOfKind(e,t){return this.publisher.addTransceiverOfKind(e,t)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(a=>a.receiver===e);return i?.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===ei.PUBLISHER?this.publisher.getConnectedAddress():e===ei.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return M(this,arguments,void 0,function(i,a){var o=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(i.getConnectionState()!=="connected")return new Promise((h,f)=>M(o,void 0,void 0,function*(){const p=()=>{this.log.warn("abort transport connection",this.logContext),Ft.clearTimeout(y),f(ke.cancelled("room connection has been cancelled"))};a?.signal.aborted&&p(),a?.signal.addEventListener("abort",p);const y=Ft.setTimeout(()=>{a?.signal.removeEventListener("abort",p),f(ke.internal("could not establish pc connection"))},c);for(;this.state!==pt.CONNECTED;)if(yield Ht(50),a?.signal.aborted){f(ke.cancelled("room connection has been cancelled"));return}Ft.clearTimeout(y),a?.signal.removeEventListener("abort",p),h()}))})()})}}const Gw=5e3,PP=3e4;class Be{static fetchRegionSettings(e,t,i){return M(this,void 0,void 0,function*(){const a=yield Be.fetchLock.lock();try{const o=yield fetch("".concat(DP(e),"/regions"),{headers:{authorization:"Bearer ".concat(t)},signal:i});if(o.ok){const c=tP(o.headers),u=c?c*1e3:Gw;return{regionSettings:yield o.json(),updatedAtInMs:Date.now(),maxAgeInMs:u}}else throw o.status===401?ke.notAllowed("Could not fetch region settings: ".concat(o.statusText),o.status):ke.internal("Could not fetch region settings: ".concat(o.statusText))}catch(o){throw o instanceof ke?o:i?.aborted?ke.cancelled("Region fetching was aborted"):ke.serverUnreachable("Could not fetch region settings, ".concat(o instanceof Error?"".concat(o.name,": ").concat(o.message):o))}finally{a()}})}static scheduleRefetch(e,t,i){return M(this,void 0,void 0,function*(){const a=Be.settingsTimeouts.get(e.hostname);clearTimeout(a),Be.settingsTimeouts.set(e.hostname,setTimeout(()=>M(this,void 0,void 0,function*(){try{const o=yield Be.fetchRegionSettings(e,t);Be.updateCachedRegionSettings(e,t,o)}catch(o){if(o instanceof ke&&o.reason===tt.NotAllowed){Ee.debug("token is not valid, cancelling auto region refresh");return}Ee.debug("auto refetching of region settings failed",{error:o}),Be.scheduleRefetch(e,t,i)}}),i))})}static updateCachedRegionSettings(e,t,i){Be.cache.set(e.hostname,i),Be.scheduleRefetch(e,t,i.maxAgeInMs)}static stopRefetch(e){const t=Be.settingsTimeouts.get(e);t&&(clearTimeout(t),Be.settingsTimeouts.delete(e))}static scheduleCleanup(e){let t=Be.connectionTrackers.get(e);t&&(t.cleanupTimeout&&clearTimeout(t.cleanupTimeout),t.cleanupTimeout=setTimeout(()=>{const i=Be.connectionTrackers.get(e);i&&i.connectionCount===0&&(Ee.debug("stopping region refetch after disconnect delay",{hostname:e}),Be.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},PP))}static cancelCleanup(e){const t=Be.connectionTrackers.get(e);t?.cleanupTimeout&&(clearTimeout(t.cleanupTimeout),t.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let t=Be.connectionTrackers.get(e);t||(t={connectionCount:0},Be.connectionTrackers.set(e,t)),t.connectionCount++,Be.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,t=Be.connectionTrackers.get(e);t&&(t.connectionCount=Math.max(0,t.connectionCount-1),t.connectionCount===0&&Be.scheduleCleanup(e))}constructor(e,t){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return Ms(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return M(this,void 0,void 0,function*(){return Be.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return M(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let t=Be.cache.get(this.serverUrl.hostname);(!t||Date.now()-t.updatedAtInMs>t.maxAgeInMs)&&(t=yield this.fetchRegionSettings(e),Be.updateCachedRegionSettings(this.serverUrl,this.token,t));const i=t.regionSettings.regions.filter(a=>!this.attemptedRegions.find(o=>o.url===a.url));if(i.length>0){const a=i[0];return this.attemptedRegions.push(a),Ee.debug("next region: ".concat(a.region)),a.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){Be.updateCachedRegionSettings(this.serverUrl,this.token,e)}}Be.cache=new Map;Be.settingsTimeouts=new Map;Be.connectionTrackers=new Map;Be.fetchLock=new Yt;function DP(n){return"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")}class gt extends Error{constructor(e,t,i){super(t),this.code=e,this.message=KS(t,gt.MAX_MESSAGE_BYTES),this.data=i?KS(i,gt.MAX_DATA_BYTES):void 0}static fromProto(e){return new gt(e.code,e.message,e.data)}toProto(){return new Bk({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new gt(gt.ErrorCode[e],gt.ErrorMessage[e],t)}}gt.MAX_MESSAGE_BYTES=256;gt.MAX_DATA_BYTES=15360;gt.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};gt.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const Kw=15360;function qm(n){return new TextEncoder().encode(n).length}function KS(n,e){if(qm(n)<=e)return n;let t=0,i=n.length;const a=new TextEncoder;for(;t<i;){const o=Math.floor((t+i+1)/2);a.encode(n.slice(0,o)).length<=e?t=o:i=o-1}return n.slice(0,t)}const Fm=2e3;function Qu(n,e){if(!e)return 0;let t,i;return"bytesReceived"in n?(t=n.bytesReceived,i=e.bytesReceived):"bytesSent"in n&&(t=n.bytesSent,i=e.bytesSent),t===void 0||i===void 0||n.timestamp===void 0||e.timestamp===void 0?0:(t-i)*8*1e3/(n.timestamp-e.timestamp)}const Hm=typeof MediaRecorder<"u";class MP{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const NP=Hm?MediaRecorder:MP;class IP extends NP{constructor(e,t){if(!Hm)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),t);let i,a;const o=()=>a===void 0,c=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",c),this.removeEventListener("error",u),a?.close(),a=void 0},u=h=>{a?.error(h),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",c),this.removeEventListener("error",u),a=void 0};this.byteStream=new ReadableStream({start:h=>{a=h,i=f=>M(this,void 0,void 0,function*(){let p;if(f.data.arrayBuffer){const y=yield f.data.arrayBuffer();p=new Uint8Array(y)}else if(f.data.byteArray)p=f.data.byteArray;else throw new Error("no data available!");o()||h.enqueue(p)}),this.addEventListener("dataavailable",i)},cancel:()=>{c()}}),this.addEventListener("stop",c),this.addEventListener("error",u)}}function LP(){return Hm}const UP=1e3,BP=1e4;class Jw extends Q{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,t,i){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4?arguments[4]:void 0;super(e,t,o),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Um(()=>M(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>M(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(ce.Ended,this)},this.reacquireTrack=!1,this.providedByUser=a,this.muteLock=new Yt,this.pauseUpstreamLock=new Yt,this.trackChangeLock=new Yt,this.trackChangeLock.lock().then(c=>M(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{c()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Q.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();if(e&&t)return{width:e,height:t}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return(t=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&t!==void 0?t:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return M(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!t)return;this._mediaStreamTrack&&(this.attachedElements.forEach(o=>{Os(this._mediaStreamTrack,o)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let a;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(ks(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),a=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(a??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(o=>{ks(a??e,o)}))})}waitForDimensions(){return M(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:UP;return(function*(){var i;if(e.kind===Q.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=un())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Ht(10));const a=Date.now();for(;Date.now()-a<t;){const o=e.dimensions;if(o)return o;yield Ht(50)}throw new Vi("unable to get track dimensions after timeout")})()})}setDeviceId(e){return M(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Dr(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),Dr(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return M(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(e.source===Q.Source.ScreenShare)return;const{deviceId:i,groupId:a}=e._mediaStreamTrack.getSettings(),o=e.kind===Q.Kind.Audio?"audioinput":"videoinput";return t?Mt.getInstance().normalizeDeviceId(o,i,a):i})()})}mute(){return M(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return M(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,t){return M(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Vi("unable to replace an unpublished track");let a,o;return typeof t=="boolean"?a=t:t!==void 0&&(a=t.userProvidedTrack,o=t.stopProcessor),this.providedByUser=a??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),o&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return M(this,void 0,void 0,function*(){this.manuallyStopped=!1;const t=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:a}=e,o=lj(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const c={audio:!1,video:!1};this.kind===Q.Kind.Video?c.video=i||a?{deviceId:i,facingMode:a}:!0:c.audio=i?Object.assign({deviceId:i},o):!0,this.attachedElements.forEach(f=>{Os(this.mediaStreamTrack,f)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const h=(yield navigator.mediaDevices.getUserMedia(c)).getTracks()[0];return this.kind===Q.Kind.Video&&(yield h.applyConstraints(o)),h.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(h),this._constraints=e,this.emit(ce.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ce.Muted:ce.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return M(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),qw()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return M(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(ce.UpstreamPaused,this);const i=un();if(i?.name==="Safari"&&gi(i.version,"12.0")<0)throw new Pm("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{t()}})}resumeUpstream(){return M(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(ce.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{t()}})}getRTCStatsReport(){return M(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return M(this,arguments,void 0,function(t){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;const c=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const u=document.createElement(i.kind),h={kind:i.kind,track:i._mediaStreamTrack,element:u,audioContext:i.audioContext};if(yield t.init(h),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(ks(i._mediaStreamTrack,u),u.muted=!0,u.play().catch(f=>{f instanceof DOMException&&f.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:f})),setTimeout(()=>{u.play().catch(p=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:p}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:f}))}),i.processor=t,i.processorElement=u,i.processor.processedTrack){for(const f of i.attachedElements)f!==i.processorElement&&a&&(Os(i._mediaStreamTrack,f),ks(i.processor.processedTrack,f));yield(o=i.sender)===null||o===void 0?void 0:o.replaceTrack(i.processor.processedTrack)}i.emit(ce.TrackProcessorUpdate,i.processor)}finally{c()}})()})}getProcessor(){return this.processor}stopProcessor(){return M(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(t)}finally{i()}})()})}internalStopProcessor(){return M(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var i,a;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,t||((a=e.processorElement)===null||a===void 0||a.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(ce.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!LP()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let t="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(t)||(t="video/mp4"),this.localTrackRecorder=new IP(this,{mimeType:t})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},BP)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class ju extends Jw{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;super(e,Q.Kind.Audio,t,i,o),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>M(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let c;try{c=yield this.getSenderStats()}catch(u){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:u}));return}c&&this.prevStats&&(this._currentBitrate=Qu(c,this.prevStats)),this.prevStats=c}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(ce.AudioTrackFeatureUpdate,this,Dt.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(ce.AudioTrackFeatureUpdate,this,Dt.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=a,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return M(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Q.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return M(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Dr(this._constraints.deviceId);return this.source===Q.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return M(this,void 0,void 0,function*(){let t;if(e){const i=Mm({audio:e});typeof i.audio!="boolean"&&(t=i.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return M(this,void 0,void 0,function*(){const i=yield t.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){cn()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Fm)))}setProcessor(e){return M(this,void 0,void 0,function*(){var t;const i=yield this.trackChangeLock.lock();try{if(!mi()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const a={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(a),this.processor=e,this.processor.processedTrack&&(yield(t=this.sender)===null||t===void 0?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(ce.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return M(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const t=yield this.sender.getStats();let i;return t.forEach(a=>{a.type==="outbound-rtp"&&(i={type:"audio",streamId:a.id,packetsSent:a.packetsSent,packetsLost:a.packetsLost,bytesSent:a.bytesSent,timestamp:a.timestamp,roundTripTime:a.roundTripTime,jitter:a.jitter})}),i})}checkForSilence(){return M(this,void 0,void 0,function*(){const e=yield Uw(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(ce.AudioSilenceDetected)),e})}}function zP(n,e,t){switch(n.kind){case"audio":return new ju(n,e,!1,void 0,t);case"video":return new Pu(n,e,!1,t);default:throw new Vi("unsupported track type: ".concat(n.kind))}}const qP=Object.values(pl),FP=Object.values(Np),HP=Object.values(Dm),VP=[pl.h180,pl.h360],$P=[Np.h180,Np.h360],WP=n=>[{scaleResolutionDownBy:2,fps:n.encoding.maxFramerate}].map(t=>{var i,a;return new Qe(Math.floor(n.width/t.scaleResolutionDownBy),Math.floor(n.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*(((i=n.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((a=t.fps)!==null&&a!==void 0?a:30))))),t.fps,n.encoding.priority)}),Vp=["q","h","f"];function $p(n,e,t,i){var a,o;let c=i?.videoEncoding;n&&(c=i?.screenShareEncoding);const u=i?.simulcast,h=i?.scalabilityMode,f=i?.videoCodec;if(!c&&!u&&!h||!e||!t)return[{}];c||(c=KP(n,e,t,f),Ee.debug("using video encoding",c));const p=c.maxFramerate,y=new Qe(e,t,c.maxBitrate,c.maxFramerate,c.priority);if(h&&ti(f)){const C=new Yw(h),w=[];if(C.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(h));const O=un();if(ml()||mi()||O?.name==="Chrome"&&gi(O?.version,"113")<0){const R=C.suffix=="h"?2:3,P=Hj(O);for(let j=0;j<C.spatial;j+=1)w.push({rid:Vp[2-j],maxBitrate:c.maxBitrate/Math.pow(R,j),maxFramerate:y.encoding.maxFramerate,scaleResolutionDownBy:P?Math.pow(2,j):void 0});w[0].scalabilityMode=h}else w.push({maxBitrate:c.maxBitrate,maxFramerate:y.encoding.maxFramerate,scalabilityMode:h});return y.encoding.priority&&(w[0].priority=y.encoding.priority,w[0].networkPriority=y.encoding.priority),Ee.debug("using svc encoding",{encodings:w}),w}if(!u)return[c];let b=[];n?b=(a=YS(i?.screenShareSimulcastLayers))!==null&&a!==void 0?a:JS(n,y):b=(o=YS(i?.videoSimulcastLayers))!==null&&o!==void 0?o:JS(n,y);let k;if(b.length>0){const C=b[0];b.length>1&&([,k]=b);const w=Math.max(e,t);if(w>=960&&k)return Zf(e,t,[C,k,y],p);if(w>=480)return Zf(e,t,[C,y],p)}return Zf(e,t,[y])}function GP(n,e,t){var i,a,o,c;if(!t.backupCodec||t.backupCodec===!0||t.backupCodec.codec===t.videoCodec)return;e!==t.backupCodec.codec&&Ee.warn("requested a different codec than specified as backup",{serverRequested:e,backup:t.backupCodec.codec}),t.videoCodec=e,t.videoEncoding=t.backupCodec.encoding;const u=n.mediaStreamTrack.getSettings(),h=(i=u.width)!==null&&i!==void 0?i:(a=n.dimensions)===null||a===void 0?void 0:a.width,f=(o=u.height)!==null&&o!==void 0?o:(c=n.dimensions)===null||c===void 0?void 0:c.height;return n.source===Q.Source.ScreenShare&&t.simulcast&&(t.simulcast=!1),$p(n.source===Q.Source.ScreenShare,h,f,t)}function KP(n,e,t,i){const a=JP(n,e,t);let{encoding:o}=a[0];const c=Math.max(e,t);for(let u=0;u<a.length;u+=1){const h=a[u];if(o=h.encoding,h.width>=c)break}if(i)switch(i){case"av1":case"h265":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.7;break;case"vp9":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.85;break}return o}function JP(n,e,t){if(n)return HP;const i=e>t?e/t:t/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?qP:FP}function JS(n,e){if(n)return WP(e);const{width:t,height:i}=e,a=t>i?t/i:i/t;return Math.abs(a-16/9)<Math.abs(a-4/3)?VP:$P}function Zf(n,e,t,i){const a=[];if(t.forEach((o,c)=>{if(c>=Vp.length)return;const u=Math.min(n,e),f={rid:Vp[c],scaleResolutionDownBy:Math.max(1,u/Math.min(o.width,o.height)),maxBitrate:o.encoding.maxBitrate},p=i&&o.encoding.maxFramerate?Math.min(i,o.encoding.maxFramerate):o.encoding.maxFramerate;p&&(f.maxFramerate=p);const y=ya()||c===0;o.encoding.priority&&y&&(f.priority=o.encoding.priority,f.networkPriority=o.encoding.priority),a.push(f)}),mi()&&Hw()==="ios"){let o;a.forEach(u=>{o?u.maxFramerate&&u.maxFramerate>o&&(o=u.maxFramerate):o=u.maxFramerate});let c=!0;a.forEach(u=>{var h;u.maxFramerate!=o&&(c&&(c=!1,Ee.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Ee.info('Setting framerate of encoding "'.concat((h=u.rid)!==null&&h!==void 0?h:"",'" to ').concat(o)),u.maxFramerate=o)})}return a}function YS(n){if(n)return n.sort((e,t)=>{const{encoding:i}=e,{encoding:a}=t;return i.maxBitrate>a.maxBitrate?1:i.maxBitrate<a.maxBitrate?-1:i.maxBitrate===a.maxBitrate&&i.maxFramerate&&a.maxFramerate?i.maxFramerate>a.maxFramerate?1:-1:0})}class Yw{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function YP(n){return n.source===Q.Source.ScreenShare||n.constraints.height&&Dr(n.constraints.height)>=1080?"maintain-resolution":"balanced"}const QP=5e3;class Pu extends Jw{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=arguments.length>3?arguments[3]:void 0;super(e,Q.Kind.Video,t,i,a),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>M(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(h){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:h}));return}const c=new Map(o.map(h=>[h.rid,h])),u=o.some(h=>h.qualityLimitationReason==="cpu");if(u!==this.isCpuConstrained&&(this.isCpuConstrained=u,this.isCpuConstrained&&this.emit(ce.CpuConstrained)),this.prevStats){let h=0;c.forEach((f,p)=>{var y;const b=(y=this.prevStats)===null||y===void 0?void 0:y.get(p);h+=Qu(f,b)}),this._currentBitrate=h}this.prevStats=c}),this.senderLock=new Yt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!cn())return;const i=(t=this.sender)===null||t===void 0?void 0:t.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Fm))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return M(this,void 0,void 0,function*(){var t,i,a,o,c;yield e.pauseUpstream.call(this);try{for(var u=!0,h=Hi(this.simulcastCodecs.values()),f;f=yield h.next(),t=f.done,!t;u=!0)o=f.value,u=!1,yield(c=o.sender)===null||c===void 0?void 0:c.replaceTrack(null)}catch(p){i={error:p}}finally{try{!u&&!t&&(a=h.return)&&(yield a.call(h))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return M(this,void 0,void 0,function*(){var t,i,a,o,c;yield e.resumeUpstream.call(this);try{for(var u=!0,h=Hi(this.simulcastCodecs.values()),f;f=yield h.next(),t=f.done,!t;u=!0){o=f.value,u=!1;const p=o;yield(c=p.sender)===null||c===void 0?void 0:c.replaceTrack(p.mediaStreamTrack)}}catch(p){i={error:p}}finally{try{!u&&!t&&(a=h.return)&&(yield a.call(h))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return M(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Q.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return M(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source===Q.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return M(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const t=[],i=yield this.sender.getStats();return i.forEach(a=>{var o;if(a.type==="outbound-rtp"){const c={type:"video",streamId:a.id,frameHeight:a.frameHeight,frameWidth:a.frameWidth,framesPerSecond:a.framesPerSecond,framesSent:a.framesSent,firCount:a.firCount,pliCount:a.pliCount,nackCount:a.nackCount,packetsSent:a.packetsSent,bytesSent:a.bytesSent,qualityLimitationReason:a.qualityLimitationReason,qualityLimitationDurations:a.qualityLimitationDurations,qualityLimitationResolutionChanges:a.qualityLimitationResolutionChanges,rid:(o=a.rid)!==null&&o!==void 0?o:a.id,retransmittedPacketsSent:a.retransmittedPacketsSent,targetBitrate:a.targetBitrate,timestamp:a.timestamp},u=i.get(a.remoteId);u&&(c.jitter=u.jitter,c.packetsLost=u.packetsLost,c.roundTripTime=u.roundTripTime),t.push(c)}}),t.sort((a,o)=>{var c,u;return((c=o.frameWidth)!==null&&c!==void 0?c:0)-((u=a.frameWidth)!==null&&u!==void 0?u:0)}),t})}setPublishingQuality(e){const t=[];for(let i=xn.LOW;i<=xn.HIGH;i+=1)t.push(new Rm({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(ti(this.codec),t)}restartTrack(e){return M(this,void 0,void 0,function*(){var t,i,a,o,c;let u;if(e){const y=Mm({video:e});typeof y.video!="boolean"&&(u=y.video)}yield this.restart(u),this.isCpuConstrained=!1;try{for(var h=!0,f=Hi(this.simulcastCodecs.values()),p;p=yield f.next(),t=p.done,!t;h=!0){o=p.value,h=!1;const y=o;y.sender&&((c=y.sender.transport)===null||c===void 0?void 0:c.state)!=="closed"&&(y.mediaStreamTrack=this.mediaStreamTrack.clone(),yield y.sender.replaceTrack(y.mediaStreamTrack))}}catch(y){i={error:y}}finally{try{!h&&!t&&(a=f.return)&&(yield a.call(f))}finally{if(i)throw i.error}}})}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return M(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var c,u,h,f,p,y;if(yield t.setProcessor.call(a,i,o),!((p=a.processor)===null||p===void 0)&&p.processedTrack)try{for(var b=!0,k=Hi(a.simulcastCodecs.values()),C;C=yield k.next(),c=C.done,!c;b=!0)f=C.value,b=!1,yield(y=f.sender)===null||y===void 0?void 0:y.replaceTrack(a.processor.processedTrack)}catch(w){u={error:w}}finally{try{!b&&!c&&(h=k.return)&&(yield h.call(k))}finally{if(u)throw u.error}}})()})}setDegradationPreference(e){return M(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(t){this.log.warn("failed to set degradationPreference",Object.assign({error:t},this.logContext))}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,t){const i=this.simulcastCodecs.get(e);i&&(i.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},QP))}setPublishingCodecs(e){return M(this,void 0,void 0,function*(){var t,i,a,o,c,u,h;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(ti(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const f=[];try{for(t=!0,i=Hi(e);a=yield i.next(),o=a.done,!o;t=!0){h=a.value,t=!1;const p=h;if(!this.codec||this.codec===p.codec)yield this.setPublishingLayers(ti(p.codec),p.qualities);else{const y=this.simulcastCodecs.get(p.codec);if(this.log.debug("try setPublishingCodec for ".concat(p.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:y})),!y||!y.sender){for(const b of p.qualities)if(b.enabled){f.push(p.codec);break}}else y.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(p.codec),this.logContext),yield QS(y.sender,y.encodings,p.qualities,this.senderLock,ti(p.codec),this.log,this.logContext))}}}catch(p){c={error:p}}finally{try{!t&&!o&&(u=i.return)&&(yield u.call(i))}finally{if(c)throw c.error}}return f})}setPublishingLayers(e,t){return M(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:t}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:t})),!(!this.sender||!this.encodings)&&(yield QS(this.sender,this.encodings,t,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return M(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const t=this.sender.getParameters();t.encodings=t.encodings.map((i,a)=>{var o;return Object.assign(Object.assign({},i),{active:a===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((o=this.mediaStreamTrack.getSettings().height)!==null&&o!==void 0?o:360)/360)),scalabilityMode:a===0&&ti(this.codec)?"L1T3":void 0,maxFramerate:a===0?15:0,maxBitrate:a===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:t.encodings})),this.encodings=t.encodings,yield this.sender.setParameters(t)}catch(t){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:t})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return M(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),qw()&&this.isInBackground&&this.source===Q.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function QS(n,e,t,i,a,o,c){return M(this,void 0,void 0,function*(){const u=yield i.lock();o.debug("setPublishingLayersForSender",Object.assign(Object.assign({},c),{sender:n,qualities:t,senderEncodings:e}));try{const h=n.getParameters(),{encodings:f}=h;if(!f)return;if(f.length!==e.length){o.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},c),{encodings:f,senderEncodings:e}));return}let p=!1;!1&&f[0].scalabilityMode||(a&&t.some(k=>k.enabled)&&t.forEach(k=>k.enabled=!0),f.forEach((b,k)=>{var C;let w=(C=b.rid)!==null&&C!==void 0?C:"";w===""&&(w="q");const O=Qw(w),R=t.find(P=>P.quality===O);R&&b.active!==R.enabled&&(p=!0,b.active=R.enabled,o.debug("setting layer ".concat(R.quality," to ").concat(b.active?"enabled":"disabled"),c),ya()&&(R.enabled?(b.scaleResolutionDownBy=e[k].scaleResolutionDownBy,b.maxBitrate=e[k].maxBitrate,b.maxFrameRate=e[k].maxFrameRate):(b.scaleResolutionDownBy=4,b.maxBitrate=10,b.maxFrameRate=2)))})),p&&(h.encodings=f,o.debug("setting encodings",Object.assign(Object.assign({},c),{encodings:h.encodings})),yield n.setParameters(h))}finally{u()}})}function Qw(n){switch(n){case"f":return xn.HIGH;case"h":return xn.MEDIUM;case"q":return xn.LOW;default:return xn.HIGH}}function XS(n,e,t,i){if(!t)return[new Pr({quality:xn.HIGH,width:n,height:e,bitrate:0,ssrc:0})];if(i){const a=t[0].scalabilityMode,o=new Yw(a),c=[],u=o.suffix=="h"?1.5:2,h=o.suffix=="h"?2:3;for(let f=0;f<o.spatial;f+=1)c.push(new Pr({quality:Math.min(xn.HIGH,o.spatial-1)-f,width:Math.ceil(n/Math.pow(u,f)),height:Math.ceil(e/Math.pow(u,f)),bitrate:t[0].maxBitrate?Math.ceil(t[0].maxBitrate/Math.pow(h,f)):0,ssrc:0}));return c}return t.map(a=>{var o,c,u;const h=(o=a.scaleResolutionDownBy)!==null&&o!==void 0?o:1;let f=Qw((c=a.rid)!==null&&c!==void 0?c:"");return new Pr({quality:f,width:Math.ceil(n/h),height:Math.ceil(e/h),bitrate:(u=a.maxBitrate)!==null&&u!==void 0?u:0,ssrc:0})})}const ZS="_lossy",eT="_reliable",XP=2*1e3,ep="leave-reconnect",ZP=3e4,eD=8*1024,tD=256*1024;var Bn;(function(n){n[n.New=0]="New",n[n.Connected=1]="Connected",n[n.Disconnected=2]="Disconnected",n[n.Reconnecting=3]="Reconnecting",n[n.Closed=4]="Closed"})(Bn||(Bn={}));class nD extends vi.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=zm.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Bn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Ee,this.reliableDataSequence=1,this.reliableMessageBuffer=new zS,this.reliableReceivedState=new kP(ZP),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>M(this,[i],void 0,function(a){var o=this;let{channel:c}=a;return(function*(){if(c){if(c.label===eT)o.reliableDCSub=c;else if(c.label===ZS)o.lossyDCSub=c;else return;o.log.debug("on data channel ".concat(c.id,", ").concat(c.label),o.logContext),c.onmessage=o.handleDataMessage}})()}),this.handleDataMessage=i=>M(this,void 0,void 0,function*(){var a,o,c,u,h;const f=yield this.dataProcessLock.lock();try{let p;if(i.data instanceof ArrayBuffer)p=i.data;else if(i.data instanceof Blob)p=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const y=Jt.fromBinary(new Uint8Array(p));if(y.sequence>0&&y.participantSid!==""){const b=this.reliableReceivedState.get(y.participantSid);if(b&&y.sequence<=b)return;this.reliableReceivedState.set(y.participantSid,y.sequence)}if(((a=y.value)===null||a===void 0?void 0:a.case)==="speaker")this.emit(ue.ActiveSpeakersUpdate,y.value.value.speakers);else if(((o=y.value)===null||o===void 0?void 0:o.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const b=yield(c=this.e2eeManager)===null||c===void 0?void 0:c.handleEncryptedData(y.value.value.encryptedValue,y.value.value.iv,y.participantIdentity,y.value.value.keyIndex),k=Ik.fromBinary(b.payload),C=new Jt({value:k.value,participantIdentity:y.participantIdentity,participantSid:y.participantSid});((u=C.value)===null||u===void 0?void 0:u.case)==="user"&&tT(C,C.value.value),this.emit(ue.DataPacketReceived,C,y.value.value.encryptionType)}else((h=y.value)===null||h===void 0?void 0:h.case)==="user"&&tT(y,y.value.value),this.emit(ue.DataPacketReceived,y,At.NONE)}finally{f()}}),this.handleDataError=i=>{const o=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:c}=i.error;this.log.error("DataChannel error on ".concat(o,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:c}))}else this.log.error("Unknown DataChannel error on ".concat(o),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const o=i.currentTarget.maxRetransmits===0?Ae.LOSSY:Ae.RELIABLE;this.updateAndEmitDCBufferStatus(o)},this.handleDisconnect=(i,a)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const o=h=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(h,"ms. giving up"),this.logContext),this.emit(ue.Disconnected),this.close()},c=Date.now()-this.reconnectStart;let u=this.getNextRetryDelay({elapsedMs:c,retryCount:this.reconnectAttempts});if(u===null){o(c);return}i===ep&&(u=0),this.log.debug("reconnecting in ".concat(u,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Ft.setTimeout(()=>this.attemptReconnect(a).finally(()=>this.reconnectTimeout=void 0),u)},this.waitForRestarted=()=>new Promise((i,a)=>{this.pcState===Bn.Connected&&i();const o=()=>{this.off(ue.Disconnected,c),i()},c=()=>{this.off(ue.Restarted,o),a()};this.once(ue.Restarted,o),this.once(ue.Disconnected,c)}),this.updateAndEmitDCBufferStatus=i=>{if(i===Ae.RELIABLE){const o=this.dataChannelForKind(i);o&&this.reliableMessageBuffer.alignBufferedAmount(o.bufferedAmount)}const a=this.isBufferStatusLow(i);typeof a<"u"&&a!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,a),this.emit(ue.DCBufferStatusChanged,a,i))},this.isBufferStatusLow=i=>{const a=this.dataChannelForKind(i);if(a)return a.bufferedAmount<=a.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>M(this,void 0,void 0,function*(){!this.url||!(yield fetch(gl(this.url),{method:"HEAD"}).then(a=>a.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===et.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===et.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(da.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>M(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(gl(this.url),{method:"HEAD"}),Ht(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=Gi((t=e.loggerName)!==null&&t!==void 0?t:ai.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Im(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Yt,this.dataProcessLock=new Yt,this.dcBufferStatus=new Map([[Ae.LOSSY,!0],[Ae.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(ue.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(ue.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(ue.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(ue.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(ue.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(ue.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(ue.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(ue.SignalRequestResponse,i)}get logContext(){var e,t,i,a,o,c;return{room:(t=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||t===void 0?void 0:t.name,roomID:(a=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||a===void 0?void 0:a.sid,participant:(c=(o=this.latestJoinResponse)===null||o===void 0?void 0:o.participant)===null||c===void 0?void 0:c.identity,pID:this.participantSid}}join(e,t,i,a){return M(this,arguments,void 0,function(o,c,u,h){var f=this;let p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){f.url=o,f.token=c,f.signalOpts=u,f.maxJoinAttempts=u.maxRetries;try{f.joinAttempts+=1,f.setupSignalClientCallbacks();const y=yield f.client.join(o,c,u,h,p);return f._isClosed=!1,f.latestJoinResponse=y,f.subscriberPrimary=y.subscriberPrimary,f.pcManager||(yield f.configure(y,!p)),(!f.subscriberPrimary||y.fastPublish)&&f.negotiate().catch(b=>{Ee.error(b,f.logContext)}),f.registerOnLineListener(),f.clientConfiguration=y.clientConfiguration,f.emit(ue.SignalConnected,y),y}catch(y){if(y instanceof ke){if(y.reason===tt.ServerUnreachable){if(f.log.warn("Couldn't connect to server, attempt ".concat(f.joinAttempts," of ").concat(f.maxJoinAttempts),f.logContext),f.joinAttempts<f.maxJoinAttempts)return f.join(o,c,u,h,p)}else if(y.reason===tt.ServiceNotFound)return f.log.warn("Initial connection failed: ".concat(y.message,"  Retrying")),f.join(o,c,u,h,!0)}throw y}})()})}close(){return M(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(ue.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return M(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const t=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new zS,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return M(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Vi("a track with the same ID has already been published");return new Promise((t,i)=>{const a=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(ke.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:o=>{clearTimeout(a),t(o)},reject:()=>{clearTimeout(a),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(t){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:t}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return M(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e,t){return M(this,void 0,void 0,function*(){var i,a;if(this.pcManager&&this.pcManager.currentState!==pt.NEW)return;this.participantSid=(i=e.participant)===null||i===void 0?void 0:i.sid;const o=this.makeRTCConfiguration(e);this.pcManager=new jP(o,t?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(ue.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(c,u)=>{this.client.sendIceCandidate(c,u)},this.pcManager.onPublisherOffer=(c,u)=>{this.client.sendOffer(c,u)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(c,u,h)=>M(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(c),this.logContext),["closed","disconnected","failed"].includes(u)&&(this.publisherConnectionPromise=void 0),c===pt.CONNECTED){const y=this.pcState===Bn.New;this.pcState=Bn.Connected,y&&this.emit(ue.Connected,e)}else c===pt.FAILED&&(this.pcState===Bn.Connected||this.pcState===Bn.Reconnecting)&&(this.pcState=Bn.Disconnected,this.handleDisconnect("peerconnection failed",h==="failed"?da.RR_SUBSCRIBER_FAILED:da.RR_PUBLISHER_FAILED));const f=this.client.isDisconnected||this.client.currentState===et.RECONNECTING,p=[pt.FAILED,pt.CLOSING,pt.CLOSED].includes(c);f&&p&&!this._isClosed&&this.emit(ue.Offline)}),this.pcManager.onTrack=c=>{c.streams.length!==0&&this.emit(ue.MediaTrackAdded,c.track,c.streams[0],c.receiver)},iD((a=e.serverInfo)===null||a===void 0?void 0:a.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,t,i)=>M(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,t))}),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=(e,t,i)=>M(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=t,!this.pcManager)return;this.midToTrackId=i;const a=yield this.pcManager.createSubscriberAnswerFromOffer(e,t);a&&this.client.sendAnswer(a,t)}),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(t=e.track)===null||t===void 0?void 0:t.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(ue.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(ue.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var t;this.token=e,(t=this.regionUrlProvider)===null||t===void 0||t.updateToken(e)},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(ue.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(ue.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var t;this.participantSid=(t=e.participant)===null||t===void 0?void 0:t.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(ue.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var t,i;const a={direction:"recvonly"};for(let o=0;o<e.numAudios;o++)(t=this.pcManager)===null||t===void 0||t.addPublisherTransceiverOfKind("audio",a);for(let o=0;o<e.numVideos;o++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",a);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",da.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e?.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:Gw,regionSettings:e.regions})),e.action){case xs.DISCONNECT:this.emit(ue.Disconnected,e?.reason),this.close();break;case xs.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(ep);break;case xs.RESUME:this.handleDisconnect(ep)}}}makeRTCConfiguration(e){var t;const i=Object.assign({},this.rtcConfig);if(!((t=this.signalOpts)===null||t===void 0)&&t.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const a=[];e.iceServers.forEach(o=>{const c={urls:o.urls};o.username&&(c.username=o.username),o.credential&&(c.credential=o.credential),a.push(c)}),i.iceServers=a}return e.clientConfiguration&&e.clientConfiguration.forceRelay===ul.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(ZS,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(eT,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(Ae.LOSSY);if(e){const t=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(t,eD),tD)}},1e3))}createSender(e,t,i){return M(this,void 0,void 0,function*(){if(Up())return yield this.createTransceiverRTCRtpSender(e,t,i);if(Bp())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new bt("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,i,a){return M(this,void 0,void 0,function*(){if(Up())return this.createSimulcastTransceiverSender(e,t,i,a);if(Bp())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new bt("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,i){return M(this,void 0,void 0,function*(){if(!this.pcManager)throw new bt("publisher is closed");const a=[];e.mediaStream&&a.push(e.mediaStream),Ur(e)&&(e.codec=t.videoCodec);const o={direction:"sendonly",streams:a};return i&&(o.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,o)).sender})}createSimulcastTransceiverSender(e,t,i,a){return M(this,void 0,void 0,function*(){if(!this.pcManager)throw new bt("publisher is closed");const o={direction:"sendonly"};a&&(o.sendEncodings=a);const c=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,o);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,c.sender),c.sender})}createRTCRtpSender(e){return M(this,void 0,void 0,function*(){if(!this.pcManager)throw new bt("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return M(this,void 0,void 0,function*(){var t,i,a;if(!this._isClosed){if(this.attemptingReconnect){Ee.warn("already attempting reconnect, returning early",this.logContext);return}(((t=this.clientConfiguration)===null||t===void 0?void 0:t.resumeConnection)===ul.DISABLED||((a=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&a!==void 0?a:pt.NEW)===pt.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(o){this.reconnectAttempts+=1;let c=!0;o instanceof bt?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:o})),c=!1):o instanceof ps||(this.fullReconnectOnNext=!0),c?this.handleDisconnect("reconnect",da.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(ue.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(t){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:t}))}return null}restartConnection(e){return M(this,void 0,void 0,function*(){var t,i,a;try{if(!this.url||!this.token)throw new bt("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(ue.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let o;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new ps;o=yield this.join(e??this.url,this.token,this.signalOpts,void 0,!this.options.singlePeerConnection)}catch(c){throw c instanceof ke&&c.reason===tt.NotAllowed?new bt("could not reconnect, token might be expired"):new ps}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(ue.SignalRestarted,o),yield this.waitForPCReconnected(),this.client.currentState!==et.CONNECTED)throw new ps("Signal connection got severed during reconnect");(t=this.regionUrlProvider)===null||t===void 0||t.resetAttempts(),this.emit(ue.Restarted)}catch(o){const c=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(c){yield this.restartConnection(c);return}else throw(a=this.regionUrlProvider)===null||a===void 0||a.resetAttempts(),o}})}resumeConnection(e){return M(this,void 0,void 0,function*(){var t;if(!this.url||!this.token)throw new bt("could not reconnect, url or token not saved");if(!this.pcManager)throw new bt("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(ue.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(a){let o="";throw a instanceof Error&&(o=a.message,this.log.error(a.message,Object.assign(Object.assign({},this.logContext),{error:a}))),a instanceof ke&&a.reason===tt.NotAllowed?new bt("could not reconnect, token might be expired"):a instanceof ke&&a.reason===tt.LeaveRequest?a:new ps(o)}if(this.emit(ue.SignalResumed),i){const a=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(a),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==et.CONNECTED)throw new ps("Signal connection got severed during reconnect");this.client.setReconnected(),((t=this.reliableDC)===null||t===void 0?void 0:t.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i?.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(ue.Resumed)})}waitForPCInitialConnection(e,t){return M(this,void 0,void 0,function*(){if(!this.pcManager)throw new bt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)})}waitForPCReconnected(){return M(this,void 0,void 0,function*(){this.pcState=Bn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Ht(XP),!this.pcManager)throw new bt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Bn.Connected}catch(e){throw this.pcState=Bn.Disconnected,ke.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,t,i,a){return M(this,void 0,void 0,function*(){const o=new Jt({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcResponse",value:new Cm({requestId:t,value:a?{case:"error",value:a.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(o,Ae.RELIABLE)})}publishRpcAck(e,t){return M(this,void 0,void 0,function*(){const i=new Jt({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcAck",value:new wm({requestId:t})}});yield this.sendDataPacket(i,Ae.RELIABLE)})}sendDataPacket(e,t){return M(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(t),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const o=dP(e);if(o){const c=yield this.e2eeManager.encryptData(o.toBinary());e.value={case:"encryptedPacket",value:new Nk({encryptedValue:c.payload,iv:c.iv,keyIndex:c.keyIndex})}}}t===Ae.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),a=this.dataChannelForKind(t);if(a){if(t===Ae.RELIABLE)yield this.waitForBufferStatusLow(t),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(t)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;a.send(i)}this.updateAndEmitDCBufferStatus(t)})}resendReliableMessagesForResume(e){return M(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(Ae.RELIABLE);const t=this.dataChannelForKind(Ae.RELIABLE);t&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{t.send(i.data)})),this.updateAndEmitDCBufferStatus(Ae.RELIABLE)})}waitForBufferStatusLow(e){return new ln((t,i)=>M(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))t();else{const a=()=>i(new bt("engine closed"));for(this.once(ue.Closing,a);!this.dcBufferStatus.get(e);)yield Ht(10);this.off(ue.Closing,a),t()}}))}ensureDataTransportConnected(e){return M(this,arguments,void 0,function(t){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var o;if(!i.pcManager)throw new bt("PC manager is closed");const c=a?i.pcManager.subscriber:i.pcManager.publisher,u=a?"Subscriber":"Publisher";if(!c)throw ke.internal("".concat(u," connection not set"));let h=!1;!a&&!i.dataChannelForKind(t,a)&&(i.createDataChannels(),h=!0),!h&&!a&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(h=!0),h&&i.negotiate().catch(y=>{Ee.error(y,i.logContext)});const f=i.dataChannelForKind(t,a);if(f?.readyState==="open")return;const p=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<p;){if(c.isICEConnected&&((o=i.dataChannelForKind(t,a))===null||o===void 0?void 0:o.readyState)==="open")return;yield Ht(50)}throw ke.internal("could not establish ".concat(u," connection, state: ").concat(c.getICEConnectionState()))})()})}ensurePublisherConnected(e){return M(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==pt.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return M(this,void 0,void 0,function*(){return new ln((e,t)=>M(this,void 0,void 0,function*(){if(!this.pcManager){t(new Rs("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,a=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t(new Rs("cannot negotiate on closed engine")),this.on(ue.Closing,a),this.pcManager.publisher.once(js.RTPVideoPayloadTypes,o=>{const c=new Map;o.forEach(u=>{const h=u.codec.toLowerCase();Kj(h)&&c.set(u.payload,h)}),this.emit(ue.RTPVideoMapUpdate,c)});try{yield this.pcManager.negotiate(i),e()}catch(o){o instanceof Rs&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",da.RR_UNKNOWN),o instanceof Error?t(o):t(new Error(String(o)))}finally{this.off(ue.Closing,a)}}))})}dataChannelForKind(e,t){if(t){if(e===Ae.LOSSY)return this.lossyDCSub;if(e===Ae.RELIABLE)return this.reliableDCSub}else{if(e===Ae.LOSSY)return this.lossyDC;if(e===Ae.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var i,a,o,c;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const u=this.pcManager.publisher.getLocalDescription(),h=this.pcManager.publisher.getRemoteDescription(),f=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),p=(a=this.pcManager.subscriber)===null||a===void 0?void 0:a.getLocalDescription(),y=(c=(o=this.signalOpts)===null||o===void 0?void 0:o.autoSubscribe)!==null&&c!==void 0?c:!0,b=new Array,k=new Array;e.forEach(C=>{C.isDesired!==y&&b.push(C.trackSid),C.isEnabled||k.push(C.trackSid)}),this.client.sendSyncState(new Om({answer:this.pcManager.mode==="publisher-only"?h?ws({sdp:h.sdp,type:h.type}):void 0:p?ws({sdp:p.sdp,type:p.type}):void 0,offer:this.pcManager.mode==="publisher-only"?u?ws({sdp:u.sdp,type:u.type}):void 0:f?ws({sdp:f.sdp,type:f.type}):void 0,subscription:new Ku({trackSids:b,subscribe:!y,participantTracks:[]}),publishTracks:jj(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:k,datachannelReceiveStates:this.reliableReceivedState.map((C,w)=>new tw({publisherSid:w,lastSeq:C}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(i,a)=>{i?.id!==void 0&&i.id!==null&&e.push(new nw({label:i.label,id:i.id,target:a}))};return t(this.dataChannelForKind(Ae.LOSSY),ei.PUBLISHER),t(this.dataChannelForKind(Ae.RELIABLE),ei.PUBLISHER),t(this.dataChannelForKind(Ae.LOSSY,!0),ei.SUBSCRIBER),t(this.dataChannelForKind(Ae.RELIABLE,!0),ei.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Ft.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){cn()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){cn()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var t;const i=(t=this.pcManager)===null||t===void 0?void 0:t.getMidForReceiver(e);if(i){const a=Object.entries(this.midToTrackId).find(o=>{let[c]=o;return c===i});if(a)return a[1]}}}function iD(n){return n!==void 0&&n>13}function tT(n,e){const t=n.participantIdentity?n.participantIdentity:e.participantIdentity;n.participantIdentity=t,e.participantIdentity=t;const i=n.destinationIdentities.length!==0?n.destinationIdentities:e.destinationIdentities;n.destinationIdentities=i,e.destinationIdentities=i}class Xw{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new zn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Kt.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new zn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Kt.LengthExceeded)}}constructor(e,t,i,a){this.reader=t,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=a}}class rD extends Xw{handleChunkReceived(e){var t;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(t=this.onProgress)===null||t===void 0||t.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let t=new qn,i=null,a=null;if(this.signal){const c=this.signal;a=()=>{var u;(u=t.reject)===null||u===void 0||u.call(t,c.reason)},c.addEventListener("abort",a),i=c}const o=()=>{e.releaseLock(),i&&a&&i.removeEventListener("abort",a),this.signal=void 0};return{next:()=>M(this,void 0,void 0,function*(){var c,u;try{const{done:h,value:f}=yield Promise.race([e.read(),t.promise,(u=(c=this.outOfBandFailureRejectingFuture)===null||c===void 0?void 0:c.promise)!==null&&u!==void 0?u:new Promise(()=>{})]);return h?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(f),{done:!1,value:f.content})}catch(h){throw o(),h}}),return(){return M(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return M(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,a,o,c;let u=new Set;const h=t.signal?e.withAbortSignal(t.signal):e;try{for(var f=!0,p=Hi(h),y;y=yield p.next(),i=y.done,!i;f=!0){c=y.value,f=!1;const b=c;u.add(b)}}catch(b){a={error:b}}finally{try{!f&&!i&&(o=p.return)&&(yield o.call(p))}finally{if(a)throw a.error}}return Array.from(u)})()})}}class aD extends Xw{constructor(e,t,i,a){super(e,t,i,a),this.receivedChunks=new Map}handleChunkReceived(e){var t;const i=vu(e.chunkIndex),a=this.receivedChunks.get(i);if(a&&a.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const o=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(t=this.onProgress)===null||t===void 0||t.call(this,o)}[Symbol.asyncIterator](){const e=this.reader.getReader(),t=new TextDecoder("utf-8",{fatal:!0});let i=new qn,a=null,o=null;if(this.signal){const u=this.signal;o=()=>{var h;(h=i.reject)===null||h===void 0||h.call(i,u.reason)},u.addEventListener("abort",o),a=u}const c=()=>{e.releaseLock(),a&&o&&a.removeEventListener("abort",o),this.signal=void 0};return{next:()=>M(this,void 0,void 0,function*(){var u,h;try{const{done:f,value:p}=yield Promise.race([e.read(),i.promise,(h=(u=this.outOfBandFailureRejectingFuture)===null||u===void 0?void 0:u.promise)!==null&&h!==void 0?h:new Promise(()=>{})]);if(f)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(p);let y;try{y=t.decode(p.content)}catch(b){throw new zn("Cannot decode datastream chunk ".concat(p.chunkIndex," as text: ").concat(b),Kt.DecodeFailed)}return{done:!1,value:y}}}catch(f){throw c(),f}}),return(){return M(this,void 0,void 0,function*(){return c(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return M(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,a,o,c;let u="";const h=t.signal?e.withAbortSignal(t.signal):e;try{for(var f=!0,p=Hi(h),y;y=yield p.next(),i=y.done,!i;f=!0)c=y.value,f=!1,u+=c}catch(b){a={error:b}}finally{try{!f&&!i&&(o=p.return)&&(yield o.call(p))}finally{if(a)throw a.error}}return u})()})}}class sD{constructor(){this.log=Ee,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,t){if(this.textStreamHandlers.has(e))throw new zn('A text stream handler for topic "'.concat(e,'" has already been set.'),Kt.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,t)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,t){if(this.byteStreamHandlers.has(e))throw new zn('A byte stream handler for topic "'.concat(e,'" has already been set.'),Kt.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,t)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var t,i,a,o;const c=Array.from(this.textStreamControllers.entries()).filter(h=>h[1].sendingParticipantIdentity===e),u=Array.from(this.byteStreamControllers.entries()).filter(h=>h[1].sendingParticipantIdentity===e);if(c.length>0||u.length>0){const h=new zn("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),Kt.AbnormalEnd);for(const[f,p]of u)(i=(t=p.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(t,h),this.byteStreamControllers.delete(f);for(const[f,p]of c)(o=(a=p.outOfBandFailureRejectingFuture).reject)===null||o===void 0||o.call(a,h),this.textStreamControllers.delete(f)}}handleDataStreamPacket(e,t){return M(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,t);case"streamChunk":return this.handleStreamChunk(e.value.value,t);case"streamTrailer":return this.handleStreamTrailer(e.value.value,t);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,t,i){return M(this,void 0,void 0,function*(){var a;if(e.contentHeader.case==="byteHeader"){const o=this.byteStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let c;const u=new qn;u.promise.catch(p=>{this.log.error(p)});const h={id:e.streamId,name:(a=e.contentHeader.value.name)!==null&&a!==void 0?a:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:vu(e.timestamp),attributes:e.attributes,encryptionType:i},f=new ReadableStream({start:p=>{if(c=p,this.textStreamControllers.has(e.streamId))throw new zn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Kt.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:h,controller:c,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:u})}});o(new rD(h,f,vu(e.totalLength),u),{identity:t})}else if(e.contentHeader.case==="textHeader"){const o=this.textStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let c;const u=new qn;u.promise.catch(p=>{this.log.error(p)});const h={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i},f=new ReadableStream({start:p=>{if(c=p,this.textStreamControllers.has(e.streamId))throw new zn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Kt.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:h,controller:c,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:u})}});o(new aD(h,f,vu(e.totalLength),u),{identity:t})}})}handleStreamChunk(e,t){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==t?(i.controller.error(new zn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(i.info.encryptionType),Kt.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const a=this.textStreamControllers.get(e.streamId);a&&(a.info.encryptionType!==t?(a.controller.error(new zn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(a.info.encryptionType),Kt.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&a.controller.enqueue(e))}handleStreamTrailer(e,t){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==t?i.controller.error(new zn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(i.info.encryptionType),Kt.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const a=this.byteStreamControllers.get(e.streamId);a&&(a.info.encryptionType!==t?a.controller.error(new zn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(a.info.encryptionType),Kt.EncryptionTypeMismatch)):(a.info.attributes=Object.assign(Object.assign({},a.info.attributes),e.attributes),a.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class Zw{constructor(e,t,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=t}write(e){return this.defaultWriter.write(e)}close(){return M(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class oD extends Zw{}class lD extends Zw{}const nT=15e3;class cD{constructor(e,t){this.engine=e,this.log=t}setupEngine(e){this.engine=e}sendText(e,t){return M(this,void 0,void 0,function*(){var i;const a=crypto.randomUUID(),c=new TextEncoder().encode(e).byteLength,u=(i=t?.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),h=new Array(u?u.length+1:1).fill(0),f=(y,b)=>{var k;h[b]=y;const C=h.reduce((w,O)=>w+O,0);(k=t?.onProgress)===null||k===void 0||k.call(t,C)},p=yield this.streamText({streamId:a,totalSize:c,destinationIdentities:t?.destinationIdentities,topic:t?.topic,attachedStreamIds:u,attributes:t?.attributes});return yield p.write(e),f(1,0),yield p.close(),t?.attachments&&u&&(yield Promise.all(t.attachments.map((y,b)=>M(this,void 0,void 0,function*(){return this._sendFile(u[b],y,{topic:t.topic,mimeType:y.type,onProgress:k=>{f(k,b+1)}})})))),p.info})}streamText(e){return M(this,void 0,void 0,function*(){var t,i,a;const o=(t=e?.streamId)!==null&&t!==void 0?t:crypto.randomUUID(),c={id:o,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e?.topic)!==null&&i!==void 0?i:"",size:e?.totalSize,attributes:e?.attributes,encryptionType:!((a=this.engine.e2eeManager)===null||a===void 0)&&a.isDataChannelEncryptionEnabled?At.GCM:At.NONE},u=new Ru({streamId:o,mimeType:c.mimeType,topic:c.topic,timestamp:ha(c.timestamp),totalLength:ha(e?.totalSize),attributes:c.attributes,contentHeader:{case:"textHeader",value:new Gk({version:e?.version,attachedStreamIds:e?.attachedStreamIds,replyToStreamId:e?.replyToStreamId,operationType:e?.type==="update"?Cp.UPDATE:Cp.CREATE})}}),h=e?.destinationIdentities,f=new Jt({destinationIdentities:h,value:{case:"streamHeader",value:u}});yield this.engine.sendDataPacket(f,Ae.RELIABLE);let p=0;const y=this.engine,b=new WritableStream({write(w){return M(this,void 0,void 0,function*(){for(const O of eP(w,nT)){const R=new Ou({content:O,streamId:o,chunkIndex:ha(p)}),P=new Jt({destinationIdentities:h,value:{case:"streamChunk",value:R}});yield y.sendDataPacket(P,Ae.RELIABLE),p+=1}})},close(){return M(this,void 0,void 0,function*(){const w=new Au({streamId:o}),O=new Jt({destinationIdentities:h,value:{case:"streamTrailer",value:w}});yield y.sendDataPacket(O,Ae.RELIABLE)})},abort(w){console.log("Sink error:",w)}});let k=()=>M(this,void 0,void 0,function*(){yield C.close()});y.once(ue.Closing,k);const C=new oD(b,c,()=>this.engine.off(ue.Closing,k));return C})}sendFile(e,t){return M(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,t),{id:i}})}_sendFile(e,t,i){return M(this,void 0,void 0,function*(){var a;const o=yield this.streamBytes({streamId:e,totalSize:t.size,name:t.name,mimeType:(a=i?.mimeType)!==null&&a!==void 0?a:t.type,topic:i?.topic,destinationIdentities:i?.destinationIdentities}),c=t.stream().getReader();for(;;){const{done:u,value:h}=yield c.read();if(u)break;yield o.write(h)}return yield o.close(),o.info})}streamBytes(e){return M(this,void 0,void 0,function*(){var t,i,a,o,c,u;const h=(t=e?.streamId)!==null&&t!==void 0?t:crypto.randomUUID(),f=e?.destinationIdentities,p={id:h,mimeType:(i=e?.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(a=e?.topic)!==null&&a!==void 0?a:"",timestamp:Date.now(),attributes:e?.attributes,size:e?.totalSize,name:(o=e?.name)!==null&&o!==void 0?o:"unknown",encryptionType:!((c=this.engine.e2eeManager)===null||c===void 0)&&c.isDataChannelEncryptionEnabled?At.GCM:At.NONE},y=new Ru({totalLength:ha((u=p.size)!==null&&u!==void 0?u:0),mimeType:p.mimeType,streamId:h,topic:p.topic,timestamp:ha(Date.now()),attributes:p.attributes,contentHeader:{case:"byteHeader",value:new Kk({name:p.name})}}),b=new Jt({destinationIdentities:f,value:{case:"streamHeader",value:y}});yield this.engine.sendDataPacket(b,Ae.RELIABLE);let k=0;const C=new Yt,w=this.engine,O=this.log,R=new WritableStream({write(j){return M(this,void 0,void 0,function*(){const E=yield C.lock();let _=0;try{for(;_<j.byteLength;){const A=j.slice(_,_+nT),I=new Jt({destinationIdentities:f,value:{case:"streamChunk",value:new Ou({content:A,streamId:h,chunkIndex:ha(k)})}});yield w.sendDataPacket(I,Ae.RELIABLE),k+=1,_+=A.byteLength}}finally{E()}})},close(){return M(this,void 0,void 0,function*(){const j=new Au({streamId:h}),E=new Jt({destinationIdentities:f,value:{case:"streamTrailer",value:j}});yield w.sendDataPacket(E,Ae.RELIABLE)})},abort(j){O.error("Sink error:",j)}});return new lD(R,p)})}}class e1 extends Q{constructor(e,t,i,a,o){super(e,i,o),this.sid=t,this.receiver=a}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ce.Muted:ce.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(ce.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return M(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Fm)),Pj()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(t=this.receiver)===null||t===void 0?void 0:t.getSynchronizationSources()[0];if(i){const{timestamp:a,rtpTimestamp:o}=i;o&&this.rtpTimestamp!==o&&(this.emit(ce.TimeSyncUpdate,{timestamp:a,rtpTimestamp:o}),this.rtpTimestamp=o)}};e()}}class t1 extends e1{constructor(e,t,i,a,o,c){super(e,t,Q.Kind.Audio,i,c),this.monitorReceiver=()=>M(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const u=yield this.getReceiverStats();u&&this.prevStats&&this.receiver&&(this._currentBitrate=Qu(u,this.prevStats)),this.prevStats=u}),this.audioContext=a,this.webAudioPluginNodes=[],o&&(this.sinkId=o.deviceId)}setVolume(e){var t;for(const i of this.attachedElements)this.audioContext?(t=this.gainNode)===null||t===void 0||t.gain.setTargetAtTime(e,0,.1):i.volume=e;mi()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(mi())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return M(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(zp(t))return t.setSinkId(e)}))})}attach(e){const t=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&zp(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(a=>{i.connect(a),i=a}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(ce.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(a=>{this.emit(ce.AudioPlaybackFailed,a)})}disconnectWebAudio(){var e,t;(e=this.gainNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return M(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t;return e.forEach(i=>{i.type==="inbound-rtp"&&(t={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),t})}}const tp=100;class uD extends e1{constructor(e,t,i,a,o){super(e,t,Q.Kind.Video,i,o),this.elementInfos=[],this.monitorReceiver=()=>M(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const c=yield this.getReceiverStats();c&&this.prevStats&&this.receiver&&(this._currentBitrate=Qu(c,this.prevStats)),this.prevStats=c}),this.debouncedHandleResize=Um(()=>{this.updateDimensions()},tp),this.adaptiveStreamSettings=a}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===Q.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?Os(this._mediaStreamTrack,t):ks(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(t=>t.element===e)===void 0){const t=new dD(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(t=>t===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const t=this.elementInfos.filter(i=>i===e);for(const i of t)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const i of t)this.stopObservingElement(i);return t}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return M(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,i="",a=new Map;return e.forEach(o=>{o.type==="inbound-rtp"?(i=o.codecId,t={type:"video",streamId:o.id,framesDecoded:o.framesDecoded,framesDropped:o.framesDropped,framesReceived:o.framesReceived,packetsReceived:o.packetsReceived,packetsLost:o.packetsLost,frameWidth:o.frameWidth,frameHeight:o.frameHeight,pliCount:o.pliCount,firCount:o.firCount,nackCount:o.nackCount,jitter:o.jitter,timestamp:o.timestamp,bytesReceived:o.bytesReceived,decoderImplementation:o.decoderImplementation}):o.type==="codec"&&a.set(o.id,o)}),t&&i!==""&&a.get(i)&&(t.mimeType=a.get(i).mimeType),t})}stopObservingElement(e){const t=this.elementInfos.filter(i=>i.element===e);for(const i of t)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return M(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var t,i;const a=this.elementInfos.reduce((h,f)=>Math.max(h,f.visibilityChangedAt||0),0),o=!((i=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,c=this.elementInfos.some(h=>h.pictureInPicture),u=this.elementInfos.some(h=>h.visible)&&!o||c;if(!(this.lastVisible===u&&!e)){if(!u&&Date.now()-a<tp){Ft.setTimeout(()=>{this.updateVisibility()},tp);return}this.lastVisible=u,this.emit(ce.VisibilityChanged,u,this)}}updateDimensions(){var e,t;let i=0,a=0;const o=this.getPixelDensity();for(const c of this.elementInfos){const u=c.width()*o,h=c.height()*o;u+h>i+a&&(i=u,a=h)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((t=this.lastDimensions)===null||t===void 0?void 0:t.height)===a||(this.lastDimensions={width:i,height:a},this.emit(ce.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return t==="screen"?AS():t||(AS()>2?2:1)}}class dD{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=i=>{var a;const{target:o,isIntersecting:c}=i;o===this.element&&(this.isIntersecting=c,this.isPiP=$o(this.element),this.visibilityChangedAt=Date.now(),(a=this.handleVisibilityChanged)===null||a===void 0||a.call(this))},this.onEnterPiP=()=>{var i,a,o;(a=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||a===void 0||a.addEventListener("pagehide",this.onLeavePiP),this.isPiP=$o(this.element),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=$o(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=t??Wp(e),this.isPiP=cn()&&$o(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,i;this.isIntersecting=Wp(this.element),this.isPiP=$o(this.element),this.element.handleResize=()=>{var a;(a=this.handleResize)===null||a===void 0||a.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,PS().observe(this.element),jS().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(t=window.documentPictureInPicture)===null||t===void 0?void 0:t.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,i,a,o;(e=PS())===null||e===void 0||e.unobserve(this.element),(t=jS())===null||t===void 0||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(o=(a=window.documentPictureInPicture)===null||a===void 0?void 0:a.window)===null||o===void 0||o.removeEventListener("pagehide",this.onLeavePiP)}}function $o(n){var e,t;return document.pictureInPictureElement===n?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Wp(n,(t=window.documentPictureInPicture)===null||t===void 0?void 0:t.window):!1}function Wp(n,e){const t=e||window;let i=n.offsetTop,a=n.offsetLeft;const o=n.offsetWidth,c=n.offsetHeight,{hidden:u}=n,{display:h}=getComputedStyle(n);for(;n.offsetParent;)n=n.offsetParent,i+=n.offsetTop,a+=n.offsetLeft;return i<t.pageYOffset+t.innerHeight&&a<t.pageXOffset+t.innerWidth&&i+c>t.pageYOffset&&a+o>t.pageXOffset&&!u&&h!=="none"}class zi extends vi.EventEmitter{constructor(e,t,i,a){var o;super(),this.metadataMuted=!1,this.encryption=At.NONE,this.log=Ee,this.handleMuted=()=>{this.emit(ce.Muted)},this.handleUnmuted=()=>{this.emit(ce.Unmuted)},this.log=Gi((o=a?.loggerName)!==null&&o!==void 0?o:ai.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=i,this.source=Q.Source.Unknown}setTrack(e){this.track&&(this.track.off(ce.Muted,this.handleMuted),this.track.off(ce.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(ce.Muted,this.handleMuted),e.on(ce.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Me(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==At.NONE}get audioTrack(){if(pi(this.track))return this.track}get videoTrack(){if(Ur(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=Q.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===Q.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(n){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(n.SubscriptionStatus||(n.SubscriptionStatus={})),(function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"})(n.PermissionStatus||(n.PermissionStatus={}))})(zi||(zi={}));class Du extends zi{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,t,i,a){super(e,t.sid,t.name,a),this.track=void 0,this.handleTrackEnded=()=>{this.emit(ce.Ended)},this.handleCpuConstrained=()=>{this.track&&Ur(this.track)&&this.emit(ce.CpuConstrained,this.track)},this.updateInfo(t),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(ce.Ended,this.handleTrackEnded),this.track.off(ce.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(ce.Ended,this.handleTrackEnded),e.on(ce.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return M(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return M(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return M(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return M(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(pi(this.track)){const t=this.track.getSourceTrackSettings(),i=new Set;return t.autoGainControl&&i.add(Dt.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&i.add(Dt.TF_ECHO_CANCELLATION),t.noiseSuppression&&i.add(Dt.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&i.add(Dt.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Dt.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Dt.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function Xu(n,e){return M(this,void 0,void 0,function*(){n??(n={});let t=!1;const{audioProcessor:i,videoProcessor:a,optionsWithoutProcessor:o}=zw(n);let c=o.audio,u=o.video;if(i&&typeof o.audio=="object"&&(o.audio.processor=i),a&&typeof o.video=="object"&&(o.video.processor=a),n.audio&&typeof o.audio=="object"&&typeof o.audio.deviceId=="string"){const y=o.audio.deviceId;o.audio.deviceId={exact:y},t=!0,c=Object.assign(Object.assign({},o.audio),{deviceId:{ideal:y}})}if(o.video&&typeof o.video=="object"&&typeof o.video.deviceId=="string"){const y=o.video.deviceId;o.video.deviceId={exact:y},t=!0,u=Object.assign(Object.assign({},o.video),{deviceId:{ideal:y}})}o.audio===!0?o.audio={deviceId:"default"}:typeof o.audio=="object"&&o.audio!==null&&(o.audio=Object.assign(Object.assign({},o.audio),{deviceId:o.audio.deviceId||"default"})),o.video===!0?o.video={deviceId:"default"}:typeof o.video=="object"&&!o.video.deviceId&&(o.video.deviceId="default");const h=Lw(o,$w,Ww),f=Mm(h),p=navigator.mediaDevices.getUserMedia(f);o.audio&&(Mt.userMediaPromiseMap.set("audioinput",p),p.catch(()=>Mt.userMediaPromiseMap.delete("audioinput"))),o.video&&(Mt.userMediaPromiseMap.set("videoinput",p),p.catch(()=>Mt.userMediaPromiseMap.delete("videoinput")));try{const y=yield p;return yield Promise.all(y.getTracks().map(b=>M(this,void 0,void 0,function*(){const k=b.kind==="audio";let C=k?h.audio:h.video;(typeof C=="boolean"||!C)&&(C={});let w;const O=k?f.audio:f.video;typeof O!="boolean"&&(w=O);const R=b.getSettings().deviceId;w?.deviceId&&Dr(w.deviceId)!==R?w.deviceId=R:w||(w={deviceId:R});const P=zP(b,w,e);return P.kind===Q.Kind.Video?P.source=Q.Source.Camera:P.kind===Q.Kind.Audio&&(P.source=Q.Source.Microphone),P.mediaStream=y,pi(P)&&i?yield P.setProcessor(i):Ur(P)&&a&&(yield P.setProcessor(a)),P})))}catch(y){if(!t)throw y;return Xu(Object.assign(Object.assign({},n),{audio:c,video:u}),e)}})}function hD(n){return M(this,void 0,void 0,function*(){return(yield Xu({audio:!1,video:!0}))[0]})}function fD(n){return M(this,void 0,void 0,function*(){return(yield Xu({audio:!0,video:!1}))[0]})}var ni;(function(n){n.Excellent="excellent",n.Good="good",n.Poor="poor",n.Lost="lost",n.Unknown="unknown"})(ni||(ni={}));function pD(n){switch(n){case Jo.EXCELLENT:return ni.Excellent;case Jo.GOOD:return ni.Good;case Jo.POOR:return ni.Poor;case Jo.LOST:return ni.Lost;default:return ni.Unknown}}class n1 extends vi.EventEmitter{get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===dl.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===_s.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,i,a,o,c){let u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:dl.STANDARD;var h;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=ni.Unknown,this.log=Ee,this.log=Gi((h=c?.loggerName)!==null&&h!==void 0?h:ai.Participant),this.loggerOptions=c,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=i,this.metadata=a,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=u,this._attributes=o??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new qn,this.once(te.Active,()=>{var e,t;(t=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||t===void 0||t.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(Q.Source.Camera);return!(!((e=t?.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(Q.Source.Microphone);return!(!((e=t?.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(Q.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var t;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===_s.ACTIVE&&((t=this.participantInfo)===null||t===void 0?void 0:t.state)!==_s.ACTIVE&&this.emit(te.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const t=this.metadata!==e,i=this.metadata;this.metadata=e,t&&this.emit(te.ParticipantMetadataChanged,i)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(te.ParticipantNameChanged,e)}_setAttributes(e){const t=Dj(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(te.AttributesChanged,t)}setPermissions(e){var t,i,a,o,c,u;const h=this.permissions,f=e.canPublish!==((t=this.permissions)===null||t===void 0?void 0:t.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((a=this.permissions)===null||a===void 0?void 0:a.canPublishData)||e.hidden!==((o=this.permissions)===null||o===void 0?void 0:o.hidden)||e.recorder!==((c=this.permissions)===null||c===void 0?void 0:c.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((p,y)=>{var b;return p!==((b=this.permissions)===null||b===void 0?void 0:b.canPublishSources[y])})||e.canSubscribeMetrics!==((u=this.permissions)===null||u===void 0?void 0:u.canSubscribeMetrics);return this.permissions=e,f&&this.emit(te.ParticipantPermissionsChanged,h),f}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(te.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=pD(e),t!==this._connectionQuality&&this.emit(te.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,t;this.activeFuture&&((t=(e=this.activeFuture).reject)===null||t===void 0||t.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(t=>pi(t.track)&&t.track.setAudioContext(e))}addTrackPublication(e){e.on(ce.Muted,()=>{this.emit(te.TrackMuted,e)}),e.on(ce.Unmuted,()=>{this.emit(te.TrackUnmuted,e)});const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case Q.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case Q.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function mD(n){var e,t,i;if(!n.participantSid&&!n.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Zk({participantIdentity:(e=n.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(t=n.participantSid)!==null&&t!==void 0?t:"",allTracks:(i=n.allowAll)!==null&&i!==void 0?i:!1,trackSids:n.allowedTrackSids||[]})}class gD extends n1{constructor(e,t,i,a,o,c){super(e,t,void 0,void 0,void 0,{loggerName:a.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=At.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new qn)},this.handleReconnected=()=>{var u,h;(h=(u=this.reconnectFuture)===null||u===void 0?void 0:u.resolve)===null||h===void 0||h.call(u),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var u,h,f,p,y,b;this.reconnectFuture&&(this.reconnectFuture.promise.catch(k=>this.log.warn(k.message,this.logContext)),(h=(u=this.reconnectFuture)===null||u===void 0?void 0:u.reject)===null||h===void 0||h.call(u,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((p=(f=this.signalConnectedFuture).reject)===null||p===void 0||p.call(f,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(b=(y=this.activeAgentFuture)===null||y===void 0?void 0:y.reject)===null||b===void 0||b.call(y,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=u=>{var h,f;u.participant&&this.updateInfo(u.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new qn),(f=(h=this.signalConnectedFuture).resolve)===null||f===void 0||f.call(h)},this.handleSignalRequestResponse=u=>{const{requestId:h,reason:f,message:p}=u,y=this.pendingSignalRequests.get(h);y&&(f!==Am.OK&&y.reject(new _S(p,f)),this.pendingSignalRequests.delete(h))},this.handleDataPacket=u=>{switch(u.value.case){case"rpcResponse":let h=u.value.value,f=null,p=null;h.value.case==="payload"?f=h.value.value:h.value.case==="error"&&(p=gt.fromProto(h.value.value)),this.handleIncomingRpcResponse(h.requestId,f,p);break;case"rpcAck":let y=u.value.value;this.handleIncomingRpcAck(y.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(u=>mD(u)))},this.onTrackUnmuted=u=>{this.onTrackMuted(u,u.isUpstreamPaused)},this.onTrackMuted=(u,h)=>{if(h===void 0&&(h=!0),!u.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Me(u)));return}this.engine.updateMuteStatus(u.sid,h)},this.onTrackUpstreamPaused=u=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Me(u))),this.onTrackMuted(u,!0)},this.onTrackUpstreamResumed=u=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Me(u))),this.onTrackMuted(u,u.isMuted)},this.onTrackFeatureUpdate=u=>{const h=this.audioTrackPublications.get(u.sid);if(!h){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(u.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(h.trackSid,h.getTrackFeatures())},this.onTrackCpuConstrained=(u,h)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Me(h))),this.emit(te.LocalTrackCpuConstrained,u,h)},this.handleSubscribedQualityUpdate=u=>M(this,void 0,void 0,function*(){var h,f,p,y,b;if(!(!((b=this.roomOptions)===null||b===void 0)&&b.dynacast))return;const k=this.videoTrackPublications.get(u.trackSid);if(!k){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:u.trackSid}));return}if(!k.videoTrack)return;const C=yield k.videoTrack.setPublishingCodecs(u.subscribedCodecs);try{for(var w=!0,O=Hi(C),R;R=yield O.next(),h=R.done,!h;w=!0){y=R.value,w=!1;const P=y;Rj(P)&&(this.log.debug("publish ".concat(P," for ").concat(k.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Me(k))),yield this.publishAdditionalCodecForTrack(k.videoTrack,P,k.options))}}catch(P){f={error:P}}finally{try{!w&&!h&&(p=O.return)&&(yield p.call(O))}finally{if(f)throw f.error}}}),this.handleLocalTrackUnpublished=u=>{const h=this.trackPublications.get(u.trackSid);if(!h){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:u.trackSid}));return}this.unpublishTrack(h.track)},this.handleTrackEnded=u=>M(this,void 0,void 0,function*(){if(u.source===Q.Source.ScreenShare||u.source===Q.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Me(u))),this.unpublishTrack(u);else if(u.isUserProvided)yield u.mute();else if(Ui(u)||_r(u))try{if(cn())try{const h=yield navigator?.permissions.query({name:u.source===Q.Source.Camera?"camera":"microphone"});if(h&&h.state==="denied")throw this.log.warn("user has revoked access to ".concat(u.source),Object.assign(Object.assign({},this.logContext),Me(u))),h.onchange=()=>{h.state!=="denied"&&(u.isMuted||u.restartTrack(),h.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}u.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Me(u))),Ui(u)?yield u.restartTrack({deviceId:"default"}):yield u.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Me(u))),yield u.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=a,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=o,this.roomOutgoingDataStreamManager=c}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==At.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){var t;this.engine=e,this.engine.on(ue.RemoteMute,(i,a)=>{const o=this.trackPublications.get(i);!o||!o.track||(a?o.mute():o.unmute())}),!((t=this.signalConnectedFuture)===null||t===void 0)&&t.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(ue.Connected,this.handleReconnected).on(ue.SignalConnected,this.handleSignalConnected).on(ue.SignalRestarted,this.handleReconnected).on(ue.SignalResumed,this.handleReconnected).on(ue.Restarting,this.handleReconnecting).on(ue.Resuming,this.handleReconnecting).on(ue.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(ue.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(ue.Closing,this.handleClosing).on(ue.SignalRequestResponse,this.handleSignalRequestResponse).on(ue.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return M(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return M(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return M(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return M(this,arguments,void 0,function(t){var i=this;let{metadata:a,name:o,attributes:c}=t;return(function*(){return new ln((u,h)=>M(i,void 0,void 0,function*(){var f,p;try{let y=!1;const b=yield this.engine.client.sendUpdateLocalMetadata((f=a??this.metadata)!==null&&f!==void 0?f:"",(p=o??this.name)!==null&&p!==void 0?p:"",c),k=performance.now();for(this.pendingSignalRequests.set(b,{resolve:u,reject:C=>{h(C),y=!0},values:{name:o,metadata:a,attributes:c}});performance.now()-k<5e3&&!y;){if((!o||this.name===o)&&(!a||this.metadata===a)&&(!c||Object.entries(c).every(C=>{let[w,O]=C;return this.attributes[w]===O||O===""&&!this.attributes[w]}))){this.pendingSignalRequests.delete(b),u();return}yield Ht(50)}h(new _S("Request to update local metadata timed out","TimeoutError"))}catch(y){y instanceof Error?h(y):h(new Error(String(y)))}}))})()})}setCameraEnabled(e,t,i){return this.setTrackEnabled(Q.Source.Camera,e,t,i)}setMicrophoneEnabled(e,t,i){return this.setTrackEnabled(Q.Source.Microphone,e,t,i)}setScreenShareEnabled(e,t,i){return this.setTrackEnabled(Q.Source.ScreenShare,e,t,i)}setE2EEEnabled(e){return M(this,void 0,void 0,function*(){this.encryptionType=e?At.GCM:At.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,t,i,a){return M(this,void 0,void 0,function*(){var o,c;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let u=this.getTrackPublication(e);if(t)if(u)yield u.unmute();else{let h;if(this.pendingPublishing.has(e)){const f=yield this.waitForPendingPublicationOfSource(e);return f||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield f?.unmute(),f}this.pendingPublishing.add(e);try{switch(e){case Q.Source.Camera:h=yield this.createTracks({video:(o=i)!==null&&o!==void 0?o:!0});break;case Q.Source.Microphone:h=yield this.createTracks({audio:(c=i)!==null&&c!==void 0?c:!0});break;case Q.Source.ScreenShare:h=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Vi(e)}}catch(f){throw h?.forEach(p=>{p.stop()}),f instanceof Error&&this.emit(te.MediaDevicesError,f,Lp(e)),this.pendingPublishing.delete(e),f}for(const f of h){const p=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===Q.Source.Microphone&&pi(f)&&p.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),f.startPreConnectBuffer())}try{const f=[];for(const y of h)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Me(y))),f.push(this.publishTrack(y,a));[u]=yield Promise.all(f)}catch(f){throw h?.forEach(p=>{p.stop()}),f}finally{this.pendingPublishing.delete(e)}}else if(!u?.track&&this.pendingPublishing.has(e)&&(u=yield this.waitForPendingPublicationOfSource(e),u||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),u&&u.track)if(e===Q.Source.ScreenShare){u=yield this.unpublishTrack(u.track);const h=this.getTrackPublication(Q.Source.ScreenShareAudio);h&&h.track&&this.unpublishTrack(h.track)}else yield u.mute();return u})}enableCameraAndMicrophone(){return M(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(Q.Source.Camera)||this.pendingPublishing.has(Q.Source.Microphone))){this.pendingPublishing.add(Q.Source.Camera),this.pendingPublishing.add(Q.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(t=>this.publishTrack(t)))}finally{this.pendingPublishing.delete(Q.Source.Camera),this.pendingPublishing.delete(Q.Source.Microphone)}}})}createTracks(e){return M(this,void 0,void 0,function*(){var t,i;e??(e={});const a=Lw(e,(t=this.roomOptions)===null||t===void 0?void 0:t.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield Xu(a,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(u=>(pi(u)&&(this.microphoneError=void 0,u.setAudioContext(this.audioContext),u.source=Q.Source.Microphone,this.emit(te.AudioStreamAcquired)),Ur(u)&&(this.cameraError=void 0,u.source=Q.Source.Camera),u))}catch(o){throw o instanceof Error&&(e.audio&&(this.microphoneError=o),e.video&&(this.cameraError=o)),o}})}createScreenTracks(e){return M(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Pm("getDisplayMedia not supported");e.resolution===void 0&&!Fj()&&(e.resolution=Dm.h1080fps30.resolution);const t=Aj(e),i=yield navigator.mediaDevices.getDisplayMedia(t),a=i.getVideoTracks();if(a.length===0)throw new Vi("no video track found");const o=new Pu(a[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=Q.Source.ScreenShare,e.contentHint&&(o.mediaStreamTrack.contentHint=e.contentHint);const c=[o];if(i.getAudioTracks().length>0){this.emit(te.AudioStreamAcquired);const u=new ju(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});u.source=Q.Source.ScreenShareAudio,c.push(u)}return c})}publishTrack(e,t){return M(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,t)})}publishOrRepublishTrack(e,t){return M(this,arguments,void 0,function(i,a){var o=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var u,h,f,p;Ui(i)&&i.setAudioContext(o.audioContext),yield(u=o.reconnectFuture)===null||u===void 0?void 0:u.promise,o.republishPromise&&!c&&(yield o.republishPromise),ga(i)&&o.pendingPublishPromises.has(i)&&(yield o.pendingPublishPromises.get(i));let y;if(i instanceof MediaStreamTrack)y=i.getConstraints();else{y=i.constraints;let R;switch(i.source){case Q.Source.Microphone:R="audioinput";break;case Q.Source.Camera:R="videoinput"}R&&o.activeDeviceMap.has(R)&&(y=Object.assign(Object.assign({},y),{deviceId:o.activeDeviceMap.get(R)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new ju(i,y,!0,o.audioContext,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;case"video":i=new Pu(i,y,!0,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;default:throw new Vi("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});let b;if(o.trackPublications.forEach(R=>{R.track&&R.track===i&&(b=R)}),b)return o.log.warn("track has already been published, skipping",Object.assign(Object.assign({},o.logContext),Me(b))),b;const k=Object.assign(Object.assign({},o.roomOptions.publishDefaults),a),C="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,w=(h=k.forceStereo)!==null&&h!==void 0?h:C;w&&(k.dtx===void 0&&o.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},o.logContext),Me(i))),k.red===void 0&&o.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(f=k.dtx)!==null&&f!==void 0||(k.dtx=!1),(p=k.red)!==null&&p!==void 0||(k.red=!1)),!Vj()&&o.roomOptions.e2ee&&(o.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},o.logContext)),k.simulcast=!1),k.source&&(i.source=k.source);const O=new Promise((R,P)=>M(o,void 0,void 0,function*(){try{if(this.engine.client.currentState!==et.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Me(i)}));let j=!1;const E=setTimeout(()=>{j=!0,i.stop(),P(new CS("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(E),j)return;const _=yield this.publish(i,k,w);R(_)}else try{const j=yield this.publish(i,k,w);R(j)}catch(j){P(j)}}catch(j){P(j)}}));o.pendingPublishPromises.set(i,O);try{return yield O}catch(R){throw R}finally{o.pendingPublishPromises.delete(i)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new qn),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Me(e))),!1;const{canPublish:t,canPublishSources:i}=this.permissions;return t&&(i.length===0||i.map(a=>Mj(a)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Me(e))),!1)}publish(e,t,i){return M(this,void 0,void 0,function*(){var a,o,c,u,h,f,p,y,b,k;if(!this.hasPermissionsToPublish(e))throw new CS("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(B=>ga(e)&&B.source===e.source)&&e.source!==Q.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Me(e))),t.stopMicTrackOnMute&&pi(e)&&(e.stopOnMute=!0),e.source===Q.Source.ScreenShare&&ya()&&(t.simulcast=!1),t.videoCodec==="av1"&&!Bj()&&(t.videoCodec=void 0),t.videoCodec==="vp9"&&!zj()&&(t.videoCodec=void 0),t.videoCodec===void 0&&(t.videoCodec=Hp),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(B=>t.videoCodec===tl(B.mime))||(t.videoCodec=tl(this.enabledPublishVideoCodecs[0].mime)));const w=t.videoCodec;e.on(ce.Muted,this.onTrackMuted),e.on(ce.Unmuted,this.onTrackUnmuted),e.on(ce.Ended,this.handleTrackEnded),e.on(ce.UpstreamPaused,this.onTrackUpstreamPaused),e.on(ce.UpstreamResumed,this.onTrackUpstreamResumed),e.on(ce.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const O=[],R=!(!((a=t.dtx)!==null&&a!==void 0)||a),P=e.getSourceTrackSettings();P.autoGainControl&&O.push(Dt.TF_AUTO_GAIN_CONTROL),P.echoCancellation&&O.push(Dt.TF_ECHO_CANCELLATION),P.noiseSuppression&&O.push(Dt.TF_NOISE_SUPPRESSION),P.channelCount&&P.channelCount>1&&O.push(Dt.TF_STEREO),R&&O.push(Dt.TF_NO_DTX),Ui(e)&&e.hasPreConnectBuffer&&O.push(Dt.TF_PRECONNECT_BUFFER);const j=new hl({cid:e.mediaStreamTrack.id,name:t.name,type:Q.kindToProto(e.kind),muted:e.isMuted,source:Q.sourceToProto(e.source),disableDtx:R,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((o=t.red)!==null&&o!==void 0)||o),stream:t?.stream,backupCodecPolicy:t?.backupCodecPolicy,audioFeatures:O});let E;if(e.kind===Q.Kind.Video){let B={width:0,height:0};try{B=yield e.waitForDimensions()}catch{const H=(u=(c=this.roomOptions.videoCaptureDefaults)===null||c===void 0?void 0:c.resolution)!==null&&u!==void 0?u:pl.h720.resolution;B={width:H.width,height:H.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Me(e)),{dims:B}))}j.width=B.width,j.height=B.height,_r(e)&&(ti(w)&&(e.source===Q.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Me(e))))),t.scalabilityMode=(h=t.scalabilityMode)!==null&&h!==void 0?h:"L3T3_KEY"),j.simulcastCodecs=[new xp({codec:w,cid:e.mediaStreamTrack.id})],t.backupCodec===!0&&(t.backupCodec={codec:Hp}),t.backupCodec&&w!==t.backupCodec.codec&&j.encryption===At.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),j.simulcastCodecs.push(new xp({codec:t.backupCodec.codec,cid:""})))),E=$p(e.source===Q.Source.ScreenShare,j.width,j.height,t),j.layers=XS(j.width,j.height,E,ti(t.videoCodec))}else e.kind===Q.Kind.Audio&&(E=[{maxBitrate:(f=t.audioPreset)===null||f===void 0?void 0:f.maxBitrate,priority:(y=(p=t.audioPreset)===null||p===void 0?void 0:p.priority)!==null&&y!==void 0?y:"high",networkPriority:(k=(b=t.audioPreset)===null||b===void 0?void 0:b.priority)!==null&&k!==void 0?k:"high"}]);if(!this.engine||this.engine.isClosed)throw new bt("cannot publish track when not connected");const _=()=>M(this,void 0,void 0,function*(){var B,z,H;if(!this.engine.pcManager)throw new bt("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,E),this.emit(te.LocalSenderCreated,e.sender,e),_r(e)&&((B=t.degradationPreference)!==null&&B!==void 0||(t.degradationPreference=YP(e)),e.setDegradationPreference(t.degradationPreference)),E)if(ya()&&e.kind===Q.Kind.Audio){let ie;for(const he of this.engine.pcManager.publisher.getTransceivers())if(he.sender===e.sender){ie=he;break}ie&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:ie,codec:"opus",maxbr:!((z=E[0])===null||z===void 0)&&z.maxBitrate?E[0].maxBitrate/1e3:0})}else e.codec&&ti(e.codec)&&(!((H=E[0])===null||H===void 0)&&H.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:j.cid,codec:e.codec,maxbr:E[0].maxBitrate/1e3});yield this.engine.negotiate()});let A;const I=new Promise((B,z)=>M(this,void 0,void 0,function*(){var H;try{A=yield this.engine.addTrack(j),B(A)}catch(ie){e.sender&&(!((H=this.engine.pcManager)===null||H===void 0)&&H.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(he=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Me(e)),{error:he}))})),z(ie)}}));if(this.enabledPublishVideoCodecs.length>0)A=(yield Promise.all([I,_()]))[0];else{A=yield I;let B;if(A.codecs.forEach(z=>{B===void 0&&(B=z.mimeType)}),B&&e.kind===Q.Kind.Video){const z=tl(B);z!==w&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Me(e)),{codec:z})),t.videoCodec=z,E=$p(e.source===Q.Source.ScreenShare,j.width,j.height,t))}yield _()}const F=new Du(e.kind,A,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(F.on(ce.CpuConstrained,B=>this.onTrackCpuConstrained(B,F)),F.options=t,e.sid=A.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:E,trackInfo:A})),_r(e)?e.startMonitor(this.engine.client):Ui(e)&&e.startMonitor(),this.addTrackPublication(F),this.emit(te.LocalTrackPublished,F),Ui(e)&&A.audioFeatures.includes(Dt.TF_PRECONNECT_BUFFER)){const B=e.getPreConnectBuffer(),z=e.getPreConnectBufferMimeType();this.on(te.LocalTrackSubscribed,H=>{if(H.trackSid===A.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Me(e))),e.stopPreConnectBuffer()}}),B&&new Promise((ie,he)=>M(this,void 0,void 0,function*(){var Z,le,N,K,ae,pe;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Me(e)));const oe=setTimeout(()=>{he(new Error("agent not active within 10 seconds"))},1e4),de=yield this.waitUntilActiveAgentPresent();clearTimeout(oe),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Me(e)));const ge=yield this.streamBytes({name:"preconnect-buffer",mimeType:z,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[de.identity],attributes:{trackId:F.trackSid,sampleRate:String((ae=P.sampleRate)!==null&&ae!==void 0?ae:"48000"),channels:String((pe=P.channelCount)!==null&&pe!==void 0?pe:"1")}});try{for(var ye=!0,D=Hi(B),J;J=yield D.next(),Z=J.done,!Z;ye=!0){K=J.value,ye=!1;const _e=K;yield ge.write(_e)}}catch(_e){le={error:_e}}finally{try{!ye&&!Z&&(N=D.return)&&(yield N.call(D))}finally{if(le)throw le.error}}yield ge.close(),ie()}catch(oe){he(oe)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Me(e)))}).catch(ie=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Me(e)),{error:ie}))})}return F})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,i){return M(this,void 0,void 0,function*(){var a;if(this.encryptionType!==At.NONE)return;let o;if(this.trackPublications.forEach(k=>{k.track&&k.track===e&&(o=k)}),!o)throw new Vi("track is not published");if(!_r(e))throw new Vi("track is not a video track");const c=Object.assign(Object.assign({},(a=this.roomOptions)===null||a===void 0?void 0:a.publishDefaults),i),u=GP(e,t,c);if(!u){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Me(e)));return}const h=e.addSimulcastTrack(t,u);if(!h)return;const f=new hl({cid:h.mediaStreamTrack.id,type:Q.kindToProto(e.kind),muted:e.isMuted,source:Q.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:c.videoCodec,cid:h.mediaStreamTrack.id}]});if(f.layers=XS(f.width,f.height,u),!this.engine||this.engine.isClosed)throw new bt("cannot publish track when not connected");const p=()=>M(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,h,c,u),yield this.engine.negotiate()}),b=(yield Promise.all([this.engine.addTrack(f),p()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:u,trackInfo:b}))})}unpublishTrack(e,t){return M(this,void 0,void 0,function*(){var i,a;if(ga(e)){const f=this.pendingPublishPromises.get(e);f&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Me(e))),yield f)}const o=this.getPublicationForTrack(e),c=o?Me(o):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),c)),!o||!o.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),c));return}e=o.track,e.off(ce.Muted,this.onTrackMuted),e.off(ce.Unmuted,this.onTrackUnmuted),e.off(ce.Ended,this.handleTrackEnded),e.off(ce.UpstreamPaused,this.onTrackUpstreamPaused),e.off(ce.UpstreamResumed,this.onTrackUpstreamResumed),e.off(ce.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),t===void 0&&(t=(a=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&a!==void 0?a:!0),t?e.stop():e.stopMonitor();let u=!1;const h=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<pt.FAILED&&h)try{for(const f of this.engine.pcManager.publisher.getTransceivers())f.sender===h&&(f.direction="inactive",u=!0);if(this.engine.removeTrack(h)&&(u=!0),_r(e)){for(const[,f]of e.simulcastCodecs)f.sender&&(this.engine.removeTrack(f.sender)&&(u=!0),f.sender=void 0);e.simulcastCodecs.clear()}}catch(f){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),c),{error:f}))}switch(this.trackPublications.delete(o.trackSid),o.kind){case Q.Kind.Audio:this.audioTrackPublications.delete(o.trackSid);break;case Q.Kind.Video:this.videoTrackPublications.delete(o.trackSid);break}return this.emit(te.LocalTrackUnpublished,o),o.setTrack(void 0),u&&(yield this.engine.negotiate()),o})}unpublishTracks(e){return M(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return M(this,arguments,void 0,function(t){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new ln((o,c)=>M(i,void 0,void 0,function*(){try{const u=[];this.trackPublications.forEach(h=>{h.track&&(t&&(h.options=Object.assign(Object.assign({},h.options),t)),u.push(h))}),yield Promise.all(u.map(h=>M(this,void 0,void 0,function*(){const f=h.track;yield this.unpublishTrack(f,!1),a&&!f.isMuted&&f.source!==Q.Source.ScreenShare&&f.source!==Q.Source.ScreenShareAudio&&(Ui(f)||_r(f))&&!f.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:h.trackSid})),yield f.restartTrack()),yield this.publishOrRepublishTrack(f,h.options,!0)}))),o()}catch(u){u instanceof Error?c(u):c(new Error(String(u)))}finally{this.republishPromise=void 0}})),yield i.republishPromise})()})}publishData(e){return M(this,arguments,void 0,function(t){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const o=a.reliable?Ae.RELIABLE:Ae.LOSSY,c=a.destinationIdentities,u=a.topic;let h=new Tm({participantIdentity:i.identity,payload:t,destinationIdentities:c,topic:u});const f=new Jt({kind:o,value:{case:"user",value:h}});yield i.engine.sendDataPacket(f,o)})()})}publishDtmf(e,t){return M(this,void 0,void 0,function*(){const i=new Jt({kind:Ae.RELIABLE,value:{case:"sipDtmf",value:new Uk({code:e,digit:t})}});yield this.engine.sendDataPacket(i,Ae.RELIABLE)})}sendChatMessage(e,t){return M(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:t?.attachments},a=new Jt({value:{case:"chatMessage",value:new Eu(Object.assign(Object.assign({},i),{timestamp:lt.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(a,Ae.RELIABLE),this.emit(te.ChatMessage,i),i})}editChatMessage(e,t){return M(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),a=new Jt({value:{case:"chatMessage",value:new Eu(Object.assign(Object.assign({},i),{timestamp:lt.parse(i.timestamp),editTimestamp:lt.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(a,Ae.RELIABLE),this.emit(te.ChatMessage,i),i})}sendText(e,t){return M(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,t)})}streamText(e){return M(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,t){return M(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,t)})}streamBytes(e){return M(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){let{destinationIdentity:t,method:i,payload:a,responseTimeout:o=15e3}=e;const c=7e3,u=c+1e3;return new ln((h,f)=>M(this,void 0,void 0,function*(){var p,y,b,k;if(qm(a)>Kw){f(gt.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((y=(p=this.engine.latestJoinResponse)===null||p===void 0?void 0:p.serverInfo)===null||y===void 0)&&y.version&&gi((k=(b=this.engine.latestJoinResponse)===null||b===void 0?void 0:b.serverInfo)===null||k===void 0?void 0:k.version,"1.8.0")<0){f(gt.builtIn("UNSUPPORTED_SERVER"));return}const C=Math.max(o,u),w=crypto.randomUUID();yield this.publishRpcRequest(t,w,i,a,C);const O=setTimeout(()=>{this.pendingAcks.delete(w),f(gt.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(w),clearTimeout(R)},c);this.pendingAcks.set(w,{resolve:()=>{clearTimeout(O)},participantIdentity:t});const R=setTimeout(()=>{this.pendingResponses.delete(w),f(gt.builtIn("RESPONSE_TIMEOUT"))},o);this.pendingResponses.set(w,{resolve:(P,j)=>{clearTimeout(R),this.pendingAcks.has(w)&&(this.log.warn("RPC response received before ack",w),this.pendingAcks.delete(w),clearTimeout(O)),j?f(j):h(P??"")},participantIdentity:t})}))}registerRpcMethod(e,t){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,i){const a=this.pendingResponses.get(e);a?(a.resolve(t,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,t,i,a,o){return M(this,void 0,void 0,function*(){const c=new Jt({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcRequest",value:new km({id:t,method:i,payload:a,responseTimeoutMs:o,version:1})}});yield this.engine.sendDataPacket(c,Ae.RELIABLE)})}handleParticipantDisconnected(e){for(const[t,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:i,resolve:a}]of this.pendingResponses)i===e&&(a(null,gt.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(t=>t.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(t=>{var i,a;const o=this.trackPublications.get(t.sid);if(o){const c=o.isMuted||((a=(i=o.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&a!==void 0?a:!1);c!==t.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Me(o)),{mutedOnServer:c})),this.engine.client.sendMuteTrack(t.sid,c))}}),!0):!1}setActiveAgent(e){var t,i,a,o;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(t=this.activeAgentFuture)===null||t===void 0?void 0:t.resolve)===null||i===void 0||i.call(t,e):(o=(a=this.activeAgentFuture)===null||a===void 0?void 0:a.reject)===null||o===void 0||o.call(a,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new qn),this.activeAgentFuture.promise)}getPublicationForTrack(e){let t;return this.trackPublications.forEach(i=>{const a=i.track;a&&(e instanceof MediaStreamTrack?(Ui(a)||_r(a))&&a.mediaStreamTrack===e&&(t=i):e===a&&(t=i))}),t}waitForPendingPublicationOfSource(e){return M(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const a=Array.from(this.pendingPublishPromises.entries()).find(o=>{let[c]=o;return c.source===e});if(a)return a[1];yield Ht(20)}})}}class Mu extends zi{constructor(e,t,i,a){super(e,t.sid,t.name,a),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=o=>{this.setTrack(void 0),this.emit(ce.Ended,o)},this.handleVisibilityChange=o=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(o),this.logContext),this.visible=o,this.emitTrackUpdate()},this.handleVideoDimensionsChange=o=>{this.log.debug("adaptivestream video dimensions ".concat(o.width,"x").concat(o.height),this.logContext),this.videoDimensionsAdaptiveStream=o,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const a=new Ku({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new zk({participantSid:"",trackSids:[this.trackSid]})]});this.emit(ce.UpdateSubscription,a),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?zi.SubscriptionStatus.Unsubscribed:super.isSubscribed?zi.SubscriptionStatus.Subscribed:zi.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?zi.PermissionStatus.Allowed:zi.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,i;this.isManualOperationAllowed()&&(((t=this.requestedVideoDimensions)===null||t===void 0?void 0:t.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(Kf(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Kf(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:xn.HIGH}setTrack(e){const t=this.subscriptionStatus,i=this.permissionStatus,a=this.track;a!==e&&(a&&(a.off(ce.VideoDimensionsChanged,this.handleVideoDimensionsChange),a.off(ce.VisibilityChanged,this.handleVisibilityChange),a.off(ce.Ended,this.handleEnded),a.detach(),a.stopMonitor(),this.emit(ce.Unsubscribed,a)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(ce.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(ce.VisibilityChanged,this.handleVisibilityChange),e.on(ce.Ended,this.handleEnded),this.emit(ce.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(ce.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?ce.Muted:ce.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(ce.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(ce.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Kf(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new Jk({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===Q.Kind.Video){let t=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(t)ES(this.videoDimensionsAdaptiveStream,t)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=Nj(this.trackInfo,this.requestedMaxQuality);i&&ES(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream;t?(e.width=Math.ceil(t.width),e.height=Math.ceil(t.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:xn.HIGH})),e.quality=xn.HIGH)}this.emit(ce.UpdateSettings,e)}}class Nu extends n1{static fromParticipantInfo(e,t,i){return new Nu(e,t.sid,t.identity,t.name,t.metadata,t.attributes,i,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,i,a,o,c,u){let h=arguments.length>7&&arguments[7]!==void 0?arguments[7]:dl.STANDARD;super(t,i||"",a,o,c,u,h),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(ce.UpdateSettings,t=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Me(e)),{settings:t})),this.signalClient.sendUpdateTrackSettings(t)}),e.on(ce.UpdateSubscription,t=>{t.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(t)}),e.on(ce.SubscriptionPermissionChanged,t=>{this.emit(te.TrackSubscriptionPermissionChanged,e,t)}),e.on(ce.SubscriptionStatusChanged,t=>{this.emit(te.TrackSubscriptionStatusChanged,e,t)}),e.on(ce.Subscribed,t=>{this.emit(te.TrackSubscribed,t,e)}),e.on(ce.Unsubscribed,t=>{this.emit(te.TrackUnsubscribed,t,e)}),e.on(ce.SubscriptionFailed,t=>{this.emit(te.TrackSubscriptionFailed,e.trackSid,t)})}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Q.Source.Microphone;this.volumeMap.set(t,e);const i=this.getTrackPublication(t);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Q.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,i,a,o,c){let u=this.getTrackPublicationBySid(t);if(u||t.startsWith("TR")||this.trackPublications.forEach(p=>{!u&&e.kind===p.kind.toString()&&(u=p)}),!u){if(c===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),this.emit(te.TrackSubscriptionFailed,t);return}c===void 0&&(c=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,t,i,a,o,c-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Me(u))),this.emit(te.TrackSubscriptionFailed,t);return}const h=e.kind==="video";let f;return h?f=new uD(e,t,a,o):f=new t1(e,t,a,this.audioContext,this.audioOutput),f.source=u.source,f.isMuted=u.isMuted,f.setMediaStream(i),f.start(),u.setTrack(f),this.volumeMap.has(u.source)&&qp(f)&&pi(f)&&f.setVolume(this.volumeMap.get(u.source)),u}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,i=new Map;return e.tracks.forEach(a=>{var o,c;let u=this.getTrackPublicationBySid(a.sid);if(u)u.updateInfo(a);else{const h=Q.kindFromProto(a.type);if(!h)return;u=new Mu(h,a,(o=this.signalClient.connectOptions)===null||o===void 0?void 0:o.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(c=this.loggerOptions)===null||c===void 0?void 0:c.loggerName}),u.updateInfo(a),i.set(a.sid,u);const f=Array.from(this.trackPublications.values()).find(p=>p.source===u?.source);f&&u.source!==Q.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(u.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Me(f),newTrack:Me(u)})),this.addTrackPublication(u)}t.set(a.sid,u)}),this.trackPublications.forEach(a=>{t.has(a.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Me(a))),this.unpublishTrack(a.trackSid,!0))}),i.forEach(a=>{this.emit(te.TrackPublished,a)}),!0}unpublishTrack(e,t){const i=this.trackPublications.get(e);if(!i)return;const{track:a}=i;switch(a&&(a.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case Q.Kind.Audio:this.audioTrackPublications.delete(e);break;case Q.Kind.Video:this.videoTrackPublications.delete(e);break}t&&this.emit(te.TrackUnpublished,i)}setAudioOutput(e){return M(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach(i=>{var a;pi(i.track)&&qp(i.track)&&t.push(i.track.setSinkId((a=e.deviceId)!==null&&a!==void 0?a:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var Ve;(function(n){n.Disconnected="disconnected",n.Connecting="connecting",n.Connected="connected",n.Reconnecting="reconnecting",n.SignalReconnecting="signalReconnecting"})(Ve||(Ve={}));const vD=4*1e3;class Ns extends vi.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var t,i,a,o,c;if(super(),t=this,this.state=Ve.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Ee,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(u,h,f)=>M(this,void 0,void 0,function*(){var p;if(!qj())throw mi()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const y=yield this.disconnectLock.lock();if(this.state===Ve.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),y(),Promise.resolve();if(this.connectFuture)return y(),this.connectFuture.promise;this.setAndEmitConnectionState(Ve.Connecting),((p=this.regionUrlProvider)===null||p===void 0?void 0:p.getServerUrl().toString())!==Vw(u)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Ms(new URL(u))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Be(u,h):this.regionUrlProvider.updateToken(h),this.regionUrlProvider.fetchRegionSettings().then(C=>{var w;(w=this.regionUrlProvider)===null||w===void 0||w.setServerReportedRegions(C)}).catch(C=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:C}))}));const b=(C,w,O)=>M(this,void 0,void 0,function*(){var R,P;this.abortController&&this.abortController.abort();const j=new AbortController;this.abortController=j,y?.();try{if(yield As.getInstance().getBackOffPromise(u),j.signal.aborted)throw ke.cancelled("Connection attempt aborted");yield this.attemptConnection(O??u,h,f,j),this.abortController=void 0,C()}catch(E){if(this.regionUrlProvider&&E instanceof ke&&E.reason!==tt.Cancelled&&E.reason!==tt.NotAllowed){let _=null;try{this.log.debug("Fetching next region"),_=yield this.regionUrlProvider.getNextBestRegionUrl((R=this.abortController)===null||R===void 0?void 0:R.signal)}catch(A){if(A instanceof ke&&(A.status===401||A.reason===tt.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),w(A);return}}[tt.InternalError,tt.ServerUnreachable,tt.Timeout].includes(E.reason)&&(this.log.debug("Adding failed connection attempt to back off"),As.getInstance().addFailedConnectionAttempt(u)),_&&!(!((P=this.abortController)===null||P===void 0)&&P.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(E.message,". Retrying with another region: ").concat(_),this.logContext),this.recreateEngine(),yield b(C,w,_)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,MS(E)),w(E))}else{let _=ii.UNKNOWN_REASON;E instanceof ke&&(_=MS(E)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,_),w(E)}}}),k=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new qn((C,w)=>{b(C,w,k)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(u,h,f,p,y,b)=>M(this,void 0,void 0,function*(){var k,C,w;const O=yield f.join(u,h,{autoSubscribe:p.autoSubscribe,adaptiveStream:typeof y.adaptiveStream=="object"?!0:y.adaptiveStream,maxRetries:p.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:p.websocketTimeout},b.signal,!y.singlePeerConnection);let R=O.serverInfo;if(R||(R={version:O.serverVersion,region:O.serverRegion}),this.serverInfo=R,this.log.debug("connected to Livekit Server ".concat(Object.entries(R).map(P=>{let[j,E]=P;return"".concat(j,": ").concat(E)}).join(", ")),{room:(k=O.room)===null||k===void 0?void 0:k.name,roomSid:(C=O.room)===null||C===void 0?void 0:C.sid,identity:(w=O.participant)===null||w===void 0?void 0:w.identity}),!R.version)throw new wj("unknown server version");return R.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),y.dynacast=!1),O}),this.applyJoinResponse=u=>{const h=u.participant;if(this.localParticipant.sid=h.sid,this.localParticipant.identity=h.identity,this.localParticipant.setEnabledPublishCodecs(u.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(u.sifTrailer)}catch(f){this.log.error(f instanceof Error?f.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:f}))}this.handleParticipantUpdates([h,...u.otherParticipants]),u.room&&this.handleRoomUpdate(u.room)},this.attemptConnection=(u,h,f,p)=>M(this,void 0,void 0,function*(){var y,b;this.state===Ve.Reconnecting||this.isResuming||!((y=this.engine)===null||y===void 0)&&y.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((b=this.regionUrlProvider)===null||b===void 0)&&b.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},zm),f),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const k=yield this.connectSignal(u,h,this.engine,this.connOptions,this.options,p);this.applyJoinResponse(k),this.setupLocalParticipantEvents(),this.emit(X.SignalConnected)}catch(k){yield this.engine.close(),this.recreateEngine();const C=p.signal.aborted?ke.cancelled("Signal connection aborted"):ke.serverUnreachable("could not establish signal connection");throw k instanceof Error&&(C.message="".concat(C.message,": ").concat(k.message)),k instanceof ke&&(C.reason=k.reason,C.status=k.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:k})),C}if(p.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),ke.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,p)}catch(k){throw yield this.engine.close(),this.recreateEngine(),k}cn()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),cn()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Ve.Connected),this.emit(X.Connected),As.getInstance().resetFailedConnectionAttempts(u),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var u=arguments.length,h=new Array(u),f=0;f<u;f++)h[f]=arguments[f];return M(t,[...h],void 0,function(){var p=this;let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var b,k,C;const w=yield p.disconnectLock.lock();try{if(p.state===Ve.Disconnected){p.log.debug("already disconnected",p.logContext);return}if(p.log.info("disconnect from room",Object.assign({},p.logContext)),p.state===Ve.Connecting||p.state===Ve.Reconnecting||p.isResuming){const O="Abort connection attempt due to user initiated disconnect";p.log.warn(O,p.logContext),(b=p.abortController)===null||b===void 0||b.abort(O),(C=(k=p.connectFuture)===null||k===void 0?void 0:k.reject)===null||C===void 0||C.call(k,ke.cancelled("Client initiated disconnect")),p.connectFuture=void 0}p.engine&&(p.engine.client.isDisconnected||(yield p.engine.client.sendLeave()),yield p.engine.close()),p.handleDisconnect(y,ii.CLIENT_INITIATED),p.engine=void 0}finally{w()}})()})},this.onPageLeave=()=>M(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>M(this,void 0,void 0,function*(){const u=[],h=un();if(h&&h.os==="iOS"){const f="livekit-dummy-audio-el";let p=document.getElementById(f);if(!p){p=document.createElement("audio"),p.id=f,p.autoplay=!0,p.hidden=!0;const y=Gf();y.enabled=!0;const b=new MediaStream([y]);p.srcObject=b,document.addEventListener("visibilitychange",()=>{p&&(p.srcObject=document.hidden?null:b,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(p),this.once(X.Disconnected,()=>{p?.remove(),p=null})}u.push(p)}this.remoteParticipants.forEach(f=>{f.audioTrackPublications.forEach(p=>{p.track&&p.track.attachedElements.forEach(y=>{u.push(y)})})});try{yield Promise.all([this.acquireAudioContext(),...u.map(f=>(f.muted=!1,f.play()))]),this.handleAudioPlaybackStarted()}catch(f){throw this.handleAudioPlaybackFailed(f),f}}),this.startVideo=()=>M(this,void 0,void 0,function*(){const u=[];for(const h of this.remoteParticipants.values())h.videoTrackPublications.forEach(f=>{var p;(p=f.track)===null||p===void 0||p.attachedElements.forEach(y=>{u.includes(y)||u.push(y)})});yield Promise.all(u.map(h=>h.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(h=>{h.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const u of this.remoteParticipants.values())this.handleParticipantDisconnected(u.identity,u);this.setAndEmitConnectionState(Ve.Reconnecting)&&this.emit(X.Reconnecting)},this.handleSignalRestarted=u=>M(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(u.serverRegion),Object.assign(Object.assign({},this.logContext),{region:u.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(u);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(h){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:h}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:u.serverRegion}))}catch{return}this.setAndEmitConnectionState(Ve.Connected),this.emit(X.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=u=>{u.forEach(h=>{var f;if(h.identity===this.localParticipant.identity){this.localParticipant.updateInfo(h);return}h.identity===""&&(h.identity=(f=this.sidToIdentity.get(h.sid))!==null&&f!==void 0?f:"");let p=this.remoteParticipants.get(h.identity);h.state===_s.DISCONNECTED?this.handleParticipantDisconnected(h.identity,p):p=this.getOrCreateParticipant(h.identity,h)})},this.handleActiveSpeakersUpdate=u=>{const h=[],f={};u.forEach(p=>{if(f[p.sid]=!0,p.sid===this.localParticipant.sid)this.localParticipant.audioLevel=p.level,this.localParticipant.setIsSpeaking(!0),h.push(this.localParticipant);else{const y=this.getRemoteParticipantBySid(p.sid);y&&(y.audioLevel=p.level,y.setIsSpeaking(!0),h.push(y))}}),f[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(p=>{f[p.sid]||(p.audioLevel=0,p.setIsSpeaking(!1))}),this.activeSpeakers=h,this.emitWhenConnected(X.ActiveSpeakersChanged,h)},this.handleSpeakersChanged=u=>{const h=new Map;this.activeSpeakers.forEach(p=>{const y=this.remoteParticipants.get(p.identity);y&&y.sid!==p.sid||h.set(p.sid,p)}),u.forEach(p=>{let y=this.getRemoteParticipantBySid(p.sid);p.sid===this.localParticipant.sid&&(y=this.localParticipant),y&&(y.audioLevel=p.level,y.setIsSpeaking(p.active),p.active?h.set(p.sid,y):h.delete(p.sid))});const f=Array.from(h.values());f.sort((p,y)=>y.audioLevel-p.audioLevel),this.activeSpeakers=f,this.emitWhenConnected(X.ActiveSpeakersChanged,f)},this.handleStreamStateUpdate=u=>{u.streamStates.forEach(h=>{const f=this.getRemoteParticipantBySid(h.participantSid);if(!f)return;const p=f.getTrackPublicationBySid(h.trackSid);if(!p||!p.track)return;const y=Q.streamStateFromProto(h.state);p.track.setStreamState(y),y!==p.track.streamState&&(f.emit(te.TrackStreamStateChanged,p,p.track.streamState),this.emitWhenConnected(X.TrackStreamStateChanged,p,p.track.streamState,f))})},this.handleSubscriptionPermissionUpdate=u=>{const h=this.getRemoteParticipantBySid(u.participantSid);if(!h)return;const f=h.getTrackPublicationBySid(u.trackSid);f&&f.setAllowed(u.allowed)},this.handleSubscriptionError=u=>{const h=Array.from(this.remoteParticipants.values()).find(p=>p.trackPublications.has(u.trackSid));if(!h)return;const f=h.getTrackPublicationBySid(u.trackSid);f&&f.setSubscriptionError(u.err)},this.handleDataPacket=(u,h)=>{const f=this.remoteParticipants.get(u.participantIdentity);if(u.value.case==="user")this.handleUserPacket(f,u.value.value,u.kind,h);else if(u.value.case==="transcription")this.handleTranscription(f,u.value.value);else if(u.value.case==="sipDtmf")this.handleSipDtmf(f,u.value.value);else if(u.value.case==="chatMessage")this.handleChatMessage(f,u.value.value);else if(u.value.case==="metrics")this.handleMetrics(u.value.value,f);else if(u.value.case==="streamHeader"||u.value.case==="streamChunk"||u.value.case==="streamTrailer")this.handleDataStream(u,h);else if(u.value.case==="rpcRequest"){const p=u.value.value;this.handleIncomingRpcRequest(u.participantIdentity,p.id,p.method,p.payload,p.responseTimeoutMs,p.version)}},this.handleUserPacket=(u,h,f,p)=>{this.emit(X.DataReceived,h.payload,u,f,h.topic,p),u?.emit(te.DataReceived,h.payload,f,p)},this.handleSipDtmf=(u,h)=>{this.emit(X.SipDTMFReceived,h,u),u?.emit(te.SipDTMFReceived,h)},this.handleTranscription=(u,h)=>{const f=h.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(h.transcribedParticipantIdentity),p=f?.trackPublications.get(h.trackId),y=Yj(h,this.transcriptionReceivedTimes);p?.emit(ce.TranscriptionReceived,y),f?.emit(te.TranscriptionReceived,y,p),this.emit(X.TranscriptionReceived,y,f,p)},this.handleChatMessage=(u,h)=>{const f=Qj(h);this.emit(X.ChatMessage,f,u)},this.handleMetrics=(u,h)=>{this.emit(X.MetricsReceived,u,h)},this.handleDataStream=(u,h)=>{this.incomingDataStreamManager.handleDataStreamPacket(u,h)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(X.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=u=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:u})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(X.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(X.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(X.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>M(this,void 0,void 0,function*(){var u;((u=un())===null||u===void 0?void 0:u.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(X.MediaDevicesChanged)}),this.handleRoomUpdate=u=>{const h=this.roomInfo;this.roomInfo=u,h&&h.metadata!==u.metadata&&this.emitWhenConnected(X.RoomMetadataChanged,u.metadata),h?.activeRecording!==u.activeRecording&&this.emitWhenConnected(X.RecordingStatusChanged,u.activeRecording)},this.handleConnectionQualityUpdate=u=>{u.updates.forEach(h=>{if(h.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(h.quality);return}const f=this.getRemoteParticipantBySid(h.participantSid);f&&f.setConnectionQuality(h.quality)})},this.onLocalParticipantMetadataChanged=u=>{this.emit(X.ParticipantMetadataChanged,u,this.localParticipant)},this.onLocalParticipantNameChanged=u=>{this.emit(X.ParticipantNameChanged,u,this.localParticipant)},this.onLocalAttributesChanged=u=>{this.emit(X.ParticipantAttributesChanged,u,this.localParticipant)},this.onLocalTrackMuted=u=>{this.emit(X.TrackMuted,u,this.localParticipant)},this.onLocalTrackUnmuted=u=>{this.emit(X.TrackUnmuted,u,this.localParticipant)},this.onTrackProcessorUpdate=u=>{var h;(h=u?.onPublish)===null||h===void 0||h.call(u,this)},this.onLocalTrackPublished=u=>M(this,void 0,void 0,function*(){var h,f,p,y,b,k;(h=u.track)===null||h===void 0||h.on(ce.TrackProcessorUpdate,this.onTrackProcessorUpdate),(f=u.track)===null||f===void 0||f.on(ce.Restarted,this.onLocalTrackRestarted),(b=(y=(p=u.track)===null||p===void 0?void 0:p.getProcessor())===null||y===void 0?void 0:y.onPublish)===null||b===void 0||b.call(y,this),this.emit(X.LocalTrackPublished,u,this.localParticipant),Ui(u.track)&&(yield u.track.checkForSilence())&&this.emit(X.LocalAudioSilenceDetected,u);const C=yield(k=u.track)===null||k===void 0?void 0:k.getDeviceId(!1),w=Lp(u.source);w&&C&&C!==this.localParticipant.activeDeviceMap.get(w)&&(this.localParticipant.activeDeviceMap.set(w,C),this.emit(X.ActiveDeviceChanged,w,C))}),this.onLocalTrackUnpublished=u=>{var h,f;(h=u.track)===null||h===void 0||h.off(ce.TrackProcessorUpdate,this.onTrackProcessorUpdate),(f=u.track)===null||f===void 0||f.off(ce.Restarted,this.onLocalTrackRestarted),this.emit(X.LocalTrackUnpublished,u,this.localParticipant)},this.onLocalTrackRestarted=u=>M(this,void 0,void 0,function*(){const h=yield u.getDeviceId(!1),f=Lp(u.source);f&&h&&h!==this.localParticipant.activeDeviceMap.get(f)&&(this.log.debug("local track restarted, setting ".concat(f," ").concat(h," active"),this.logContext),this.localParticipant.activeDeviceMap.set(f,h),this.emit(X.ActiveDeviceChanged,f,h))}),this.onLocalConnectionQualityChanged=u=>{this.emit(X.ConnectionQualityChanged,u,this.localParticipant)},this.onMediaDevicesError=(u,h)=>{this.emit(X.MediaDevicesError,u,h)},this.onLocalParticipantPermissionsChanged=u=>{this.emit(X.ParticipantPermissionsChanged,u,this.localParticipant)},this.onLocalChatMessageSent=u=>{this.emit(X.ChatMessage,u,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},AP),e),this.log=Gi((i=this.options.loggerName)!==null&&i!==void 0?i:ai.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},$w),e?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Ww),e?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},OP),e?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new sD,this.outgoingDataStreamManager=new cD(this.engine,this.log),this.disconnectLock=new Yt,this.localParticipant=new gD("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Dr(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Dr(this.options.audioCaptureDefaults.deviceId)),!((a=this.options.audioOutput)===null||a===void 0)&&a.deviceId&&this.switchActiveDevice("audiooutput",Dr(this.options.audioOutput.deviceId)).catch(u=>this.log.warn("Could not set audio output: ".concat(u.message),this.logContext)),cn()){const u=new AbortController;(c=(o=navigator.mediaDevices)===null||o===void 0?void 0:o.addEventListener)===null||c===void 0||c.call(o,"devicechange",this.handleDeviceChange,{signal:u.signal}),Ns.cleanupRegistry&&Ns.cleanupRegistry.register(this,()=>{u.abort()})}}registerTextStreamHandler(e,t){return this.incomingDataStreamManager.registerTextStreamHandler(e,t)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,t){return this.incomingDataStreamManager.registerByteStreamHandler(e,t)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,t){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return M(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const t=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=t):this.e2eeManager=new hP(i,t),this.e2eeManager.on(jr.ParticipantEncryptionStatusChanged,(a,o)=>{Zj(o)&&(this.isE2EEEnabled=a),this.emit(X.ParticipantEncryptionStatusChanged,a,o)}),this.e2eeManager.on(jr.EncryptionError,(a,o)=>{const c=o?this.getParticipantByIdentity(o):void 0;this.emit(X.EncryptionError,a,c)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&t!==void 0?t:!1}getSid(){return this.state===Ve.Disconnected?ln.resolve(""):this.roomInfo&&this.roomInfo.sid!==""?ln.resolve(this.roomInfo.sid):new ln((e,t)=>{const i=a=>{a.sid!==""&&(this.engine.off(ue.RoomUpdate,i),e(a.sid))};this.engine.on(ue.RoomUpdate,i),this.once(X.Disconnected,()=>{this.engine.off(ue.RoomUpdate,i),t(new bt("Room disconnected before room server id was available"))})})}get name(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&t!==void 0?t:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&t!==void 0?t:0}get numPublishers(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&t!==void 0?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new nD(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(ue.ParticipantUpdate,this.handleParticipantUpdates).on(ue.RoomUpdate,this.handleRoomUpdate).on(ue.SpeakersChanged,this.handleSpeakersChanged).on(ue.StreamStateChanged,this.handleStreamStateUpdate).on(ue.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(ue.SubscriptionError,this.handleSubscriptionError).on(ue.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(ue.MediaTrackAdded,(e,t,i)=>{this.onTrackAdded(e,t,i)}).on(ue.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(ue.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(ue.DataPacketReceived,this.handleDataPacket).on(ue.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Ve.SignalReconnecting)&&this.emit(X.SignalReconnecting)}).on(ue.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Ve.Connected)&&this.emit(X.Reconnected)}).on(ue.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Ve.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(ue.Restarting,this.handleRestarting).on(ue.SignalRestarted,this.handleSignalRestarted).on(ue.Offline,()=>{this.setAndEmitConnectionState(Ve.Reconnecting)&&this.emit(X.Reconnecting)}).on(ue.DCBufferStatusChanged,(e,t)=>{this.emit(X.DCBufferStatusChanged,e,t)}).on(ue.LocalTrackSubscribed,e=>{const t=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:a}=i;return a===e});if(!t){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(te.LocalTrackSubscribed,t),this.emitWhenConnected(X.LocalTrackSubscribed,t,this.localParticipant)}).on(ue.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((t,i)=>{this.handleParticipantDisconnected(i,t)}),this.emit(X.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Mt.getInstance().getDevices(e,t)}prepareConnection(e,t){return M(this,void 0,void 0,function*(){if(this.state===Ve.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Ms(new URL(e))&&t){this.regionUrlProvider=new Be(e,t);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===Ve.Disconnected&&(this.regionUrl=i,yield fetch(gl(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(gl(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return M(this,void 0,void 0,function*(){let i=()=>M(this,void 0,void 0,function*(){}),a;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":a=new di({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":a=new di({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":a=new di({scenario:{case:"serverLeave",value:!0}});break;case"migration":a=new di({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>M(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),a=new di({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>M(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),a=new di({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":a=new di({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>M(this,void 0,void 0,function*(){const o=this.engine.client.onLeave;o&&o(new Ju({reason:ii.CLIENT_INITIATED,action:xs.RECONNECT}))});break;case"subscriber-bandwidth":if(t===void 0||typeof t!="number")throw new Error("subscriber-bandwidth requires a number as argument");a=new di({scenario:{case:"subscriberBandwidth",value:ha(t)}});break;case"leave-full-reconnect":a=new di({scenario:{case:"leaveRequestFullReconnect",value:!0}})}a&&(yield this.engine.client.sendSimulateScenario(a),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return M(this,arguments,void 0,function(i,a){var o=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var u,h,f,p,y,b,k;let C=!0,w=!1;const O=c?{exact:a}:a;if(i==="audioinput"){w=o.localParticipant.audioTrackPublications.size===0;const R=(u=o.getActiveDevice(i))!==null&&u!==void 0?u:o.options.audioCaptureDefaults.deviceId;o.options.audioCaptureDefaults.deviceId=O;const P=Array.from(o.localParticipant.audioTrackPublications.values()).filter(E=>E.source===Q.Source.Microphone);try{C=(yield Promise.all(P.map(E=>{var _;return(_=E.audioTrack)===null||_===void 0?void 0:_.setDeviceId(O)}))).every(E=>E===!0)}catch(E){throw o.options.audioCaptureDefaults.deviceId=R,E}const j=P.some(E=>{var _,A;return(A=(_=E.track)===null||_===void 0?void 0:_.isMuted)!==null&&A!==void 0?A:!1});C&&j&&(w=!0)}else if(i==="videoinput"){w=o.localParticipant.videoTrackPublications.size===0;const R=(h=o.getActiveDevice(i))!==null&&h!==void 0?h:o.options.videoCaptureDefaults.deviceId;o.options.videoCaptureDefaults.deviceId=O;const P=Array.from(o.localParticipant.videoTrackPublications.values()).filter(E=>E.source===Q.Source.Camera);try{C=(yield Promise.all(P.map(E=>{var _;return(_=E.videoTrack)===null||_===void 0?void 0:_.setDeviceId(O)}))).every(E=>E===!0)}catch(E){throw o.options.videoCaptureDefaults.deviceId=R,E}const j=P.some(E=>{var _,A;return(A=(_=E.track)===null||_===void 0?void 0:_.isMuted)!==null&&A!==void 0?A:!1});C&&j&&(w=!0)}else if(i==="audiooutput"){if(w=!0,!zp()&&!o.options.webAudioMix||o.options.webAudioMix&&o.audioContext&&!("setSinkId"in o.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");o.options.webAudioMix&&(a=(f=yield Mt.getInstance().normalizeDeviceId("audiooutput",a))!==null&&f!==void 0?f:""),(p=(k=o.options).audioOutput)!==null&&p!==void 0||(k.audioOutput={});const R=(y=o.getActiveDevice(i))!==null&&y!==void 0?y:o.options.audioOutput.deviceId;o.options.audioOutput.deviceId=a;try{o.options.webAudioMix&&((b=o.audioContext)===null||b===void 0||b.setSinkId(a)),yield Promise.all(Array.from(o.remoteParticipants.values()).map(P=>P.setAudioOutput({deviceId:a})))}catch(P){throw o.options.audioOutput.deviceId=R,P}}return w&&(o.localParticipant.activeDeviceMap.set(i,a),o.emit(X.ActiveDeviceChanged,i,a)),C})()})}setupLocalParticipantEvents(){this.localParticipant.on(te.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(te.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(te.AttributesChanged,this.onLocalAttributesChanged).on(te.TrackMuted,this.onLocalTrackMuted).on(te.TrackUnmuted,this.onLocalTrackUnmuted).on(te.LocalTrackPublished,this.onLocalTrackPublished).on(te.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(te.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(te.MediaDevicesError,this.onMediaDevicesError).on(te.AudioStreamAcquired,this.startAudio).on(te.ChatMessage,this.onLocalChatMessageSent).on(te.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,i){if(this.state===Ve.Connecting||this.state===Ve.Reconnecting){const y=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:t.id,tracksInStream:t.getTracks().map(k=>k.id)}),this.onTrackAdded(e,t,i),b()},b=()=>{this.off(X.Reconnected,y),this.off(X.Connected,y),this.off(X.Disconnected,b)};this.once(X.Reconnected,y),this.once(X.Connected,y),this.once(X.Disconnected,b);return}if(this.state===Ve.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const a=Uj(t.id),o=a[0];let c=a[1],u=e.id;if(c&&c.startsWith("TR")&&(u=c),o===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const h=Array.from(this.remoteParticipants.values()).find(y=>y.sid===o);if(!h){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(o),this.logContext);return}if(!u.startsWith("TR")){const y=this.engine.getTrackIdForReceiver(i);if(!y){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(o),this.logContext);return}u=y}u.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(o,", streamId: ").concat(c,", trackId: ").concat(u),Object.assign(Object.assign({},this.logContext),{rpID:o,streamId:c,trackId:u}));let f;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?f=this.options.adaptiveStream:f={});const p=h.addSubscribedMediaTrack(e,u,t,i,f);p?.isEncrypted&&!this.e2eeManager&&this.emit(X.EncryptionError,new Error("Encrypted ".concat(p.source," track received from participant ").concat(h.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1?arguments[1]:void 0;var i,a;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Ve.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(o=>{o.trackPublications.forEach(c=>{o.unpublishTrack(c.trackSid)})}),this.localParticipant.trackPublications.forEach(o=>{var c,u,h;o.track&&this.localParticipant.unpublishTrack(o.track,e),e?((c=o.track)===null||c===void 0||c.detach(),(u=o.track)===null||u===void 0||u.stop()):(h=o.track)===null||h===void 0||h.stopMonitor()}),this.localParticipant.off(te.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(te.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(te.AttributesChanged,this.onLocalAttributesChanged).off(te.TrackMuted,this.onLocalTrackMuted).off(te.TrackUnmuted,this.onLocalTrackUnmuted).off(te.LocalTrackPublished,this.onLocalTrackPublished).off(te.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(te.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(te.MediaDevicesError,this.onMediaDevicesError).off(te.AudioStreamAcquired,this.startAudio).off(te.ChatMessage,this.onLocalChatMessageSent).off(te.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),cn()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(a=(i=navigator.mediaDevices)===null||i===void 0?void 0:i.removeEventListener)===null||a===void 0||a.call(i,"devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Ve.Disconnected),this.emit(X.Disconnected,t)}}}handleParticipantDisconnected(e,t){var i;this.remoteParticipants.delete(e),t&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),t.trackPublications.forEach(a=>{t.unpublishTrack(a.trackSid,!0)}),this.emit(X.ParticipantDisconnected,t),t.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(t.identity))}handleIncomingRpcRequest(e,t,i,a,o,c){return M(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,t),c!==1){yield this.engine.publishRpcResponse(e,t,null,gt.builtIn("UNSUPPORTED_VERSION"));return}const u=this.rpcHandlers.get(i);if(!u){yield this.engine.publishRpcResponse(e,t,null,gt.builtIn("UNSUPPORTED_METHOD"));return}let h=null,f=null;try{const p=yield u({requestId:t,callerIdentity:e,payload:a,responseTimeout:o});qm(p)>Kw?(h=gt.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):f=p}catch(p){p instanceof gt?h=p:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),p),h=gt.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,t,f,h)})}selectDefaultDevices(){return M(this,void 0,void 0,function*(){var e,t,i;const a=Mt.getInstance().previousDevices,o=yield Mt.getInstance().getDevices(void 0,!1),c=un();if(c?.name==="Chrome"&&c.os!=="iOS")for(let h of o){const f=a.find(p=>p.deviceId===h.deviceId);f&&f.label!==""&&f.kind===h.kind&&f.label!==h.label&&this.getActiveDevice(h.kind)==="default"&&this.emit(X.ActiveDeviceChanged,h.kind,h.deviceId)}const u=["audiooutput","audioinput","videoinput"];for(let h of u){const f=Oj(h),p=this.localParticipant.getTrackPublication(f);if(p&&(!((e=p.track)===null||e===void 0)&&e.isUserProvided))continue;const y=o.filter(k=>k.kind===h),b=this.getActiveDevice(h);if(b===((t=a.filter(k=>k.kind===h)[0])===null||t===void 0?void 0:t.deviceId)&&y.length>0&&((i=y[0])===null||i===void 0?void 0:i.deviceId)!==b){yield this.switchActiveDevice(h,y[0].deviceId);continue}h==="audioinput"&&!ml()||h==="videoinput"||y.length>0&&!y.find(k=>k.deviceId===this.getActiveDevice(h))&&(h!=="audiooutput"||!ml())&&(yield this.switchActiveDevice(h,y[0].deviceId))}})}acquireAudioContext(){return M(this,void 0,void 0,function*(){var e,t;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=Bw())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(a=>a.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Ht(200)])}catch(a){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:a}))}const i=((t=this.audioContext)===null||t===void 0?void 0:t.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(X.AudioPlaybackStatusChanged,i))})}createParticipant(e,t){var i;let a;return t?a=Nu.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):a=new Nu(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&a.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&a.setAudioOutput(this.options.audioOutput).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),a}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const a=this.remoteParticipants.get(e);return t&&a.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity),a}const i=this.createParticipant(e,t);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(X.ParticipantConnected,i),i.on(te.TrackPublished,a=>{this.emitWhenConnected(X.TrackPublished,a,i)}).on(te.TrackSubscribed,(a,o)=>{a.kind===Q.Kind.Audio?(a.on(ce.AudioPlaybackStarted,this.handleAudioPlaybackStarted),a.on(ce.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):a.kind===Q.Kind.Video&&(a.on(ce.VideoPlaybackFailed,this.handleVideoPlaybackFailed),a.on(ce.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(X.TrackSubscribed,a,o,i)}).on(te.TrackUnpublished,a=>{this.emit(X.TrackUnpublished,a,i)}).on(te.TrackUnsubscribed,(a,o)=>{this.emit(X.TrackUnsubscribed,a,o,i)}).on(te.TrackMuted,a=>{this.emitWhenConnected(X.TrackMuted,a,i)}).on(te.TrackUnmuted,a=>{this.emitWhenConnected(X.TrackUnmuted,a,i)}).on(te.ParticipantMetadataChanged,a=>{this.emitWhenConnected(X.ParticipantMetadataChanged,a,i)}).on(te.ParticipantNameChanged,a=>{this.emitWhenConnected(X.ParticipantNameChanged,a,i)}).on(te.AttributesChanged,a=>{this.emitWhenConnected(X.ParticipantAttributesChanged,a,i)}).on(te.ConnectionQualityChanged,a=>{this.emitWhenConnected(X.ConnectionQualityChanged,a,i)}).on(te.ParticipantPermissionsChanged,a=>{this.emitWhenConnected(X.ParticipantPermissionsChanged,a,i)}).on(te.TrackSubscriptionStatusChanged,(a,o)=>{this.emitWhenConnected(X.TrackSubscriptionStatusChanged,a,o,i)}).on(te.TrackSubscriptionFailed,(a,o)=>{this.emit(X.TrackSubscriptionFailed,a,i,o)}).on(te.TrackSubscriptionPermissionChanged,(a,o)=>{this.emitWhenConnected(X.TrackSubscriptionPermissionChanged,a,o,i)}).on(te.Active,()=>{this.emitWhenConnected(X.ParticipantActive,i),i.kind===dl.AGENT&&this.localParticipant.setActiveAgent(i)}),t&&i.updateInfo(t),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,a)=>(i.push(...a.getTrackPublications()),i),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&Xj(t)&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Ft.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,ii.STATE_MISMATCH))):e=0},vD)}clearConnectionReconcile(){this.connectionReconcileInterval&&Ft.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(X.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[t,i]=e;this.emit(t,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];if(this.state===Ve.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===Ve.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return M(this,void 0,void 0,function*(){var t,i,a,o;const c=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),u=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new $u({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:lt.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new va({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(X.SignalConnected),this.emit(X.Connected),this.setAndEmitConnectionState(Ve.Connected),c.video){const h=new Du(Q.Kind.Video,new Ts({source:xt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Zn.AUDIO,name:"video-dummy"}),new Pu(c.useRealTracks&&(!((t=window.navigator.mediaDevices)===null||t===void 0)&&t.getUserMedia)?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:DS(160*((i=u.aspectRatios[0])!==null&&i!==void 0?i:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(h),this.localParticipant.emit(te.LocalTrackPublished,h)}if(c.audio){const h=new Du(Q.Kind.Audio,new Ts({source:xt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Zn.AUDIO}),new ju(c.useRealTracks&&(!((a=navigator.mediaDevices)===null||a===void 0)&&a.getUserMedia)?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Gf(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(h),this.localParticipant.emit(te.LocalTrackPublished,h)}for(let h=0;h<u.count-1;h+=1){let f=new va({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(h),state:_s.ACTIVE,tracks:[],joinedAt:lt.parse(Date.now())});const p=this.getOrCreateParticipant(f.identity,f);if(u.video){const y=DS(160*((o=u.aspectRatios[h%u.aspectRatios.length])!==null&&o!==void 0?o:1),160,!1,!0),b=new Ts({source:xt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Zn.AUDIO});p.addSubscribedMediaTrack(y,b.sid,new MediaStream([y]),new RTCRtpReceiver),f.tracks=[...f.tracks,b]}if(u.audio){const y=Gf(),b=new Ts({source:xt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Zn.AUDIO});p.addSubscribedMediaTrack(y,b.sid,new MediaStream([y]),new RTCRtpReceiver),f.tracks=[...f.tracks,b]}p.updateInfo(f)}})}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];if(e!==X.ActiveSpeakersChanged&&e!==X.TranscriptionReceived){const o=i1(i).filter(c=>c!==void 0);(e===X.TrackSubscribed||e===X.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o}))}return super.emit(e,...i)}}Ns.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(n=>{n()});function i1(n){return n.map(e=>{if(e)return Array.isArray(e)?i1(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Xn;(function(n){n[n.IDLE=0]="IDLE",n[n.RUNNING=1]="RUNNING",n[n.SKIPPED=2]="SKIPPED",n[n.SUCCESS=3]="SUCCESS",n[n.FAILED=4]="FAILED"})(Xn||(Xn={}));class Br extends vi.EventEmitter{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Xn.IDLE,this.logs=[],this.options={},this.url=e,this.token=t,this.name=this.constructor.name,this.room=new Ns(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return M(this,void 0,void 0,function*(){if(this.status!==Xn.IDLE)throw Error("check is running already");this.setStatus(Xn.RUNNING);try{yield this.perform()}catch(t){t instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(t.message):this.appendError(t.message))}return yield this.disconnect(),yield new Promise(t=>setTimeout(t,500)),this.status!==Xn.SKIPPED&&this.setStatus(this.isSuccess()?Xn.SUCCESS:Xn.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return M(this,void 0,void 0,function*(){return this.room.state===Ve.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return M(this,void 0,void 0,function*(){this.room&&this.room.state!==Ve.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Xn.SKIPPED)}switchProtocol(e){return M(this,void 0,void 0,function*(){let t=!1,i=!1;if(this.room.on(X.Reconnecting,()=>{t=!0}),this.room.once(X.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(o=>setTimeout(o,1e3)),!t)return;const a=Date.now()+1e4;for(;Date.now()<a;){if(i)return;yield Ht(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class yD extends Br{get description(){return"Cloud regions"}perform(){return M(this,void 0,void 0,function*(){const e=new Be(this.url,this.token);if(!e.isCloud()){this.skip();return}const t=[],i=new Set;for(let o=0;o<3;o++){const c=yield e.getNextBestRegionUrl();if(!c)break;if(i.has(c))continue;i.add(c);const u=yield this.checkCloudRegion(c);this.appendMessage("".concat(u.region," RTT: ").concat(u.rtt,"ms, duration: ").concat(u.duration,"ms")),t.push(u)}t.sort((o,c)=>(o.duration-c.duration)*.5+(o.rtt-c.rtt)*.5);const a=t[0];this.bestStats=a,this.appendMessage("best Cloud region: ".concat(a.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return M(this,void 0,void 0,function*(){var t,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const a=(t=this.room.serverInfo)===null||t===void 0?void 0:t.region;if(!a)throw new Error("Region not found");const o=yield this.room.localParticipant.streamText({topic:"test"}),c=1e3,h=1e6/c,f="A".repeat(c),p=Date.now();for(let C=0;C<h;C++)yield o.write(f);yield o.close();const y=Date.now(),b=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),k={region:a,rtt:1e4,duration:y-p};return b?.forEach(C=>{C.type==="candidate-pair"&&C.nominated&&(k.rtt=C.currentRoundTripTime*1e3)}),yield this.disconnect(),k})}}const np=1e4;class bD extends Br{get description(){return"Connection via UDP vs TCP"}perform(){return M(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),t=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-t.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-t.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=t):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(np/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(np/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return M(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const t=document.createElement("canvas");t.width=1280,t.height=720;const i=t.getContext("2d");if(!i)throw new Error("Could not get canvas context");let a=0;const o=()=>{a=(a+1)%360,i.fillStyle="hsl(".concat(a,", 100%, 50%)"),i.fillRect(0,0,t.width,t.height),requestAnimationFrame(o)};o();const u=t.captureStream(30).getVideoTracks()[0],f=(yield this.room.localParticipant.publishTrack(u,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,p={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},y=setInterval(()=>M(this,void 0,void 0,function*(){const b=yield f.getRTCStatsReport();b?.forEach(k=>{k.type==="outbound-rtp"?(p.packetsSent=k.packetsSent,p.qualityLimitationDurations=k.qualityLimitationDurations,p.bitrateTotal+=k.targetBitrate,p.count++):k.type==="remote-inbound-rtp"&&(p.packetsLost=k.packetsLost,p.rttTotal+=k.roundTripTime,p.jitterTotal+=k.jitter)})}),1e3);return yield new Promise(b=>setTimeout(b,np)),clearInterval(y),u.stop(),t.remove(),yield this.disconnect(),p})}}class SD extends Br{get description(){return"Can publish audio"}perform(){return M(this,void 0,void 0,function*(){var e;const t=yield this.connect(),i=yield fD();if(yield Uw(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),t.localParticipant.publishTrack(i),yield new Promise(u=>setTimeout(u,3e3));const o=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!o)throw new Error("Could not get RTCStats");let c=0;if(o.forEach(u=>{u.type==="outbound-rtp"&&(u.kind==="audio"||!u.kind&&u.mediaType==="audio")&&(c=u.packetsSent)}),c===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(c," audio packets"))})}}class TD extends Br{get description(){return"Can publish video"}perform(){return M(this,void 0,void 0,function*(){var e;const t=yield this.connect(),i=yield hD();yield this.checkForVideo(i.mediaStreamTrack),t.localParticipant.publishTrack(i),yield new Promise(c=>setTimeout(c,5e3));const a=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!a)throw new Error("Could not get RTCStats");let o=0;if(a.forEach(c=>{c.type==="outbound-rtp"&&(c.kind==="video"||!c.kind&&c.mediaType==="video")&&(o+=c.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," video packets"))})}checkForVideo(e){return M(this,void 0,void 0,function*(){const t=new MediaStream;t.addTrack(e.clone());const i=document.createElement("video");i.srcObject=t,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(a=>{i.onplay=()=>{setTimeout(()=>{var o,c,u,h;const f=document.createElement("canvas"),p=e.getSettings(),y=(c=(o=p.width)!==null&&o!==void 0?o:i.videoWidth)!==null&&c!==void 0?c:1280,b=(h=(u=p.height)!==null&&u!==void 0?u:i.videoHeight)!==null&&h!==void 0?h:720;f.width=y,f.height=b;const k=f.getContext("2d");k.drawImage(i,0,0);const w=k.getImageData(0,0,f.width,f.height).data;let O=!0;for(let R=0;R<w.length;R+=4)if(w[R]!==0||w[R+1]!==0||w[R+2]!==0){O=!1;break}O?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),a()},1e3)},i.play()}),t.getTracks().forEach(a=>a.stop()),i.remove()})}}class kD extends Br{get description(){return"Resuming connection after interruption"}perform(){return M(this,void 0,void 0,function*(){var e;const t=yield this.connect();let i=!1,a=!1,o;const c=new Promise(f=>{setTimeout(f,5e3),o=f}),u=()=>{i=!0};t.on(X.SignalReconnecting,u).on(X.Reconnecting,u).on(X.Reconnected,()=>{a=!0,o(!0)}),(e=t.engine.client.ws)===null||e===void 0||e.close();const h=t.engine.client.onClose;if(h&&h(""),yield c,i){if(!a||t.state!==Ve.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class wD extends Br{get description(){return"Can connect via TURN"}perform(){return M(this,void 0,void 0,function*(){var e,t,i;Ms(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new Be(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const a=new Im,o=yield a.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0);let c=!1,u=!1,h=!1;for(let f of o.iceServers)for(let p of f.urls)p.startsWith("turn:")?(u=!0,h=!0):p.startsWith("turns:")&&(u=!0,h=!0,c=!0),p.startsWith("stun:")&&(h=!0);h?u&&!c&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield a.close(),!((i=(t=this.connectOptions)===null||t===void 0?void 0:t.rtcConfig)===null||i===void 0)&&i.iceServers||u?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(f=>setTimeout(f,0)))})}}class CD extends Br{get description(){return"Establishing WebRTC connection"}perform(){return M(this,void 0,void 0,function*(){let e=!1,t=!1;this.room.on(X.SignalConnected,()=>{var i;const a=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(o,c)=>{if(o.candidate){const u=new RTCIceCandidate(o);let h="".concat(u.protocol," ").concat(u.address,":").concat(u.port," ").concat(u.type);u.address&&(_D(u.address)?h+=" (private)":u.protocol==="tcp"&&u.tcpType==="passive"?(e=!0,h+=" (passive)"):u.protocol==="udp"&&(t=!0)),this.appendMessage(h)}a&&a(o,c)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=o=>{o instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(o.errorCode," ").concat(o.errorText," ").concat(o.url))})});try{yield this.connect(),Ee.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),t||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function _D(n){const e=n.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const t=parseInt(e[1],10);if(t>=16&&t<=31)return!0}}return!1}class xD extends Br{get description(){return"Connecting to signal connection via WebSocket"}perform(){return M(this,void 0,void 0,function*(){var e,t,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let a=new Im,o;try{o=yield a.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0)}catch(c){if(Ms(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(c.message,". Retrying with region fallback"));const h=yield new Be(this.url,this.token).getNextBestRegionUrl();h&&(o=yield a.join(h,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}o?(this.appendMessage("Connected to server, version ".concat(o.serverVersion,".")),((e=o.serverInfo)===null||e===void 0?void 0:e.edition)===Fk.Cloud&&(!((t=o.serverInfo)===null||t===void 0)&&t.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=o.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield a.close()})}}class wL extends vi.EventEmitter{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=t,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Xn.IDLE,name:"",description:""}),e}updateCheck(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Xn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return M(this,void 0,void 0,function*(){const t=this.getNextCheckId(),i=new e(this.url,this.token,this.options),a=c=>{this.updateCheck(t,c)};i.on("update",a);const o=yield i.run();return i.off("update",a),o})}checkWebsocket(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(xD)})}checkWebRTC(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(CD)})}checkTURN(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(wD)})}checkReconnect(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(kD)})}checkPublishAudio(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(SD)})}checkPublishVideo(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(TD)})}checkConnectionProtocol(){return M(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(bD);if(e.data&&"protocol"in e.data){const t=e.data;this.options.protocol=t.protocol}return e})}checkCloudRegion(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(yD)})}}function Ne(n,e,t){return(e=RD(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ED(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function RD(n){var e=ED(n,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class Xt extends Error{constructor(e,t){var i;super(e,t),Ne(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}Ne(Xt,"code","ERR_JOSE_GENERIC");class OD extends Xt{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:a,payload:t}}),Ne(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),Ne(this,"claim",void 0),Ne(this,"reason",void 0),Ne(this,"payload",void 0),this.claim=i,this.reason=a,this.payload=t}}Ne(OD,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class AD extends Xt{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:a,payload:t}}),Ne(this,"code","ERR_JWT_EXPIRED"),Ne(this,"claim",void 0),Ne(this,"reason",void 0),Ne(this,"payload",void 0),this.claim=i,this.reason=a,this.payload=t}}Ne(AD,"code","ERR_JWT_EXPIRED");class jD extends Xt{constructor(){super(...arguments),Ne(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}Ne(jD,"code","ERR_JOSE_ALG_NOT_ALLOWED");class PD extends Xt{constructor(){super(...arguments),Ne(this,"code","ERR_JOSE_NOT_SUPPORTED")}}Ne(PD,"code","ERR_JOSE_NOT_SUPPORTED");class DD extends Xt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",t=arguments.length>1?arguments[1]:void 0;super(e,t),Ne(this,"code","ERR_JWE_DECRYPTION_FAILED")}}Ne(DD,"code","ERR_JWE_DECRYPTION_FAILED");class MD extends Xt{constructor(){super(...arguments),Ne(this,"code","ERR_JWE_INVALID")}}Ne(MD,"code","ERR_JWE_INVALID");class ND extends Xt{constructor(){super(...arguments),Ne(this,"code","ERR_JWS_INVALID")}}Ne(ND,"code","ERR_JWS_INVALID");class ID extends Xt{constructor(){super(...arguments),Ne(this,"code","ERR_JWT_INVALID")}}Ne(ID,"code","ERR_JWT_INVALID");class LD extends Xt{constructor(){super(...arguments),Ne(this,"code","ERR_JWK_INVALID")}}Ne(LD,"code","ERR_JWK_INVALID");class UD extends Xt{constructor(){super(...arguments),Ne(this,"code","ERR_JWKS_INVALID")}}Ne(UD,"code","ERR_JWKS_INVALID");class BD extends Xt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",t=arguments.length>1?arguments[1]:void 0;super(e,t),Ne(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}Ne(BD,"code","ERR_JWKS_NO_MATCHING_KEY");class zD extends Xt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",t=arguments.length>1?arguments[1]:void 0;super(e,t),Ne(this,Symbol.asyncIterator,void 0),Ne(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}Ne(zD,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class qD extends Xt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",t=arguments.length>1?arguments[1]:void 0;super(e,t),Ne(this,"code","ERR_JWKS_TIMEOUT")}}Ne(qD,"code","ERR_JWKS_TIMEOUT");class FD extends Xt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",t=arguments.length>1?arguments[1]:void 0;super(e,t),Ne(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}Ne(FD,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function HD(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var t;const i=ga(n)?n.mediaStreamTrack:n,a=i.getSettings();let o={facingMode:(t=e.defaultFacingMode)!==null&&t!==void 0?t:"user",confidence:"low"};if("facingMode"in a){const c=a.facingMode;Ee.trace("rawFacingMode",{rawFacingMode:c}),c&&typeof c=="string"&&WD(c)&&(o={facingMode:c,confidence:"high"})}if(["low","medium"].includes(o.confidence)){Ee.trace("Try to get facing mode from device label: (".concat(i.label,")"));const c=$D(i.label);c!==void 0&&(o=c)}return o}const iT=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),VD=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function $D(n){var e;const t=n.trim().toLowerCase();if(t!=="")return iT.has(t)?iT.get(t):(e=Array.from(VD.entries()).find(i=>{let[a]=i;return t.includes(a)}))===null||e===void 0?void 0:e[1]}function WD(n){return n===void 0||["user","environment","left","right"].includes(n)}var Qc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function r1(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Gp={exports:{}},GD=Gp.exports,rT;function KD(){return rT||(rT=1,(function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(GD,function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"],o={},c=null;function u(w,O){var R=w[O];if(typeof R.bind=="function")return R.bind(w);try{return Function.prototype.bind.call(R,w)}catch{return function(){return Function.prototype.apply.apply(R,[w,arguments])}}}function h(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function f(w){return w==="debug"&&(w="log"),typeof console===t?!1:w==="trace"&&i?h:console[w]!==void 0?u(console,w):console.log!==void 0?u(console,"log"):e}function p(){for(var w=this.getLevel(),O=0;O<a.length;O++){var R=a[O];this[R]=O<w?e:this.methodFactory(R,w,this.name)}if(this.log=this.debug,typeof console===t&&w<this.levels.SILENT)return"No console available for logging"}function y(w){return function(){typeof console!==t&&(p.call(this),this[w].apply(this,arguments))}}function b(w,O,R){return f(w)||y.apply(this,arguments)}function k(w,O){var R=this,P,j,E,_="loglevel";typeof w=="string"?_+=":"+w:typeof w=="symbol"&&(_=void 0);function A(H){var ie=(a[H]||"silent").toUpperCase();if(!(typeof window===t||!_)){try{window.localStorage[_]=ie;return}catch{}try{window.document.cookie=encodeURIComponent(_)+"="+ie+";"}catch{}}}function I(){var H;if(!(typeof window===t||!_)){try{H=window.localStorage[_]}catch{}if(typeof H===t)try{var ie=window.document.cookie,he=encodeURIComponent(_),Z=ie.indexOf(he+"=");Z!==-1&&(H=/^([^;]+)/.exec(ie.slice(Z+he.length+1))[1])}catch{}return R.levels[H]===void 0&&(H=void 0),H}}function F(){if(!(typeof window===t||!_)){try{window.localStorage.removeItem(_)}catch{}try{window.document.cookie=encodeURIComponent(_)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function B(H){var ie=H;if(typeof ie=="string"&&R.levels[ie.toUpperCase()]!==void 0&&(ie=R.levels[ie.toUpperCase()]),typeof ie=="number"&&ie>=0&&ie<=R.levels.SILENT)return ie;throw new TypeError("log.setLevel() called with invalid level: "+H)}R.name=w,R.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},R.methodFactory=O||b,R.getLevel=function(){return E??j??P},R.setLevel=function(H,ie){return E=B(H),ie!==!1&&A(E),p.call(R)},R.setDefaultLevel=function(H){j=B(H),I()||R.setLevel(H,!1)},R.resetLevel=function(){E=null,F(),p.call(R)},R.enableAll=function(H){R.setLevel(R.levels.TRACE,H)},R.disableAll=function(H){R.setLevel(R.levels.SILENT,H)},R.rebuild=function(){if(c!==R&&(P=B(c.getLevel())),p.call(R),c===R)for(var H in o)o[H].rebuild()},P=B(c?c.getLevel():"WARN");var z=I();z!=null&&(E=B(z)),p.call(R)}c=new k,c.getLogger=function(w){if(typeof w!="symbol"&&typeof w!="string"||w==="")throw new TypeError("You must supply a name when creating a logger.");var O=o[w];return O||(O=o[w]=new k(w,c.methodFactory)),O};var C=typeof window!==t?window.log:void 0;return c.noConflict=function(){return typeof window!==t&&window.log===c&&(window.log=C),c},c.getLoggers=function(){return o},c.default=c,c})})(Gp)),Gp.exports}var JD=KD();const YD=r1(JD);var Kp=function(n,e){return Kp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])},Kp(n,e)};function Qi(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Kp(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function QD(n,e,t,i){function a(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function u(p){try{f(i.next(p))}catch(y){c(y)}}function h(p){try{f(i.throw(p))}catch(y){c(y)}}function f(p){p.done?o(p.value):a(p.value).then(u,h)}f((i=i.apply(n,[])).next())})}function a1(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,a,o,c=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return c.next=u(0),c.throw=u(1),c.return=u(2),typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function u(f){return function(p){return h([f,p])}}function h(f){if(i)throw new TypeError("Generator is already executing.");for(;c&&(c=0,f[0]&&(t=0)),t;)try{if(i=1,a&&(o=f[0]&2?a.return:f[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,f[1])).done)return o;switch(a=0,o&&(f=[f[0]&2,o.value]),f[0]){case 0:case 1:o=f;break;case 4:return t.label++,{value:f[1],done:!1};case 5:t.label++,a=f[1],f=[0];continue;case 7:f=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(f[0]===6||f[0]===2)){t=0;continue}if(f[0]===3&&(!o||f[1]>o[0]&&f[1]<o[3])){t.label=f[1];break}if(f[0]===6&&t.label<o[1]){t.label=o[1],o=f;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(f);break}o[2]&&t.ops.pop(),t.trys.pop();continue}f=e.call(n,t)}catch(p){f=[6,p],a=0}finally{i=o=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function Is(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ls(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),a,o=[],c;try{for(;(e===void 0||e-- >0)&&!(a=i.next()).done;)o.push(a.value)}catch(u){c={error:u}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(c)throw c.error}}return o}function vl(n,e,t){if(arguments.length===2)for(var i=0,a=e.length,o;i<a;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return n.concat(o||Array.prototype.slice.call(e))}function Ps(n){return this instanceof Ps?(this.v=n,this):new Ps(n)}function XD(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),a,o=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",c),a[Symbol.asyncIterator]=function(){return this},a;function c(k){return function(C){return Promise.resolve(C).then(k,y)}}function u(k,C){i[k]&&(a[k]=function(w){return new Promise(function(O,R){o.push([k,w,O,R])>1||h(k,w)})},C&&(a[k]=C(a[k])))}function h(k,C){try{f(i[k](C))}catch(w){b(o[0][3],w)}}function f(k){k.value instanceof Ps?Promise.resolve(k.value.v).then(p,y):b(o[0][2],k)}function p(k){h("next",k)}function y(k){h("throw",k)}function b(k,C){k(C),o.shift(),o.length&&h(o[0][0],o[0][1])}}function ZD(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Is=="function"?Is(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(c){return new Promise(function(u,h){c=n[o](c),a(u,h,c.done,c.value)})}}function a(o,c,u,h){Promise.resolve(h).then(function(f){o({value:f,done:u})},c)}}function rt(n){return typeof n=="function"}function Vm(n){var e=function(i){Error.call(i),i.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var ip=Vm(function(n){return function(e){n(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(t,i){return i+1+") "+t.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Iu(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var kl=(function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,i,a,o;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var u=Is(c),h=u.next();!h.done;h=u.next()){var f=h.value;f.remove(this)}}catch(w){e={error:w}}finally{try{h&&!h.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}else c.remove(this);var p=this.initialTeardown;if(rt(p))try{p()}catch(w){o=w instanceof ip?w.errors:[w]}var y=this._finalizers;if(y){this._finalizers=null;try{for(var b=Is(y),k=b.next();!k.done;k=b.next()){var C=k.value;try{aT(C)}catch(w){o=o??[],w instanceof ip?o=vl(vl([],Ls(o)),Ls(w.errors)):o.push(w)}}}catch(w){i={error:w}}finally{try{k&&!k.done&&(a=b.return)&&a.call(b)}finally{if(i)throw i.error}}}if(o)throw new ip(o)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)aT(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Iu(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&Iu(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=(function(){var e=new n;return e.closed=!0,e})(),n})(),s1=kl.EMPTY;function o1(n){return n instanceof kl||n&&"closed"in n&&rt(n.remove)&&rt(n.add)&&rt(n.unsubscribe)}function aT(n){rt(n)?n():n.unsubscribe()}var eM={Promise:void 0},tM={setTimeout:function(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];return setTimeout.apply(void 0,vl([n,e],Ls(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function l1(n){tM.setTimeout(function(){throw n})}function Jp(){}function yu(n){n()}var $m=(function(n){Qi(e,n);function e(t){var i=n.call(this)||this;return i.isStopped=!1,t?(i.destination=t,o1(t)&&t.add(i)):i.destination=rM,i}return e.create=function(t,i,a){return new Yp(t,i,a)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(kl),nM=(function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(i){Xc(i)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(i){Xc(i)}else Xc(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){Xc(t)}},n})(),Yp=(function(n){Qi(e,n);function e(t,i,a){var o=n.call(this)||this,c;return rt(t)||!t?c={next:t??void 0,error:i??void 0,complete:a??void 0}:c=t,o.destination=new nM(c),o}return e})($m);function Xc(n){l1(n)}function iM(n){throw n}var rM={closed:!0,next:Jp,error:iM,complete:Jp},Wm=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function Gm(n){return n}function aM(n){return n.length===0?Gm:n.length===1?n[0]:function(e){return n.reduce(function(t,i){return i(t)},e)}}var Wt=(function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,i){var a=this,o=oM(e)?e:new Yp(e,t,i);return yu(function(){var c=a,u=c.operator,h=c.source;o.add(u?u.call(o,h):h?a._subscribe(o):a._trySubscribe(o))}),o},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var i=this;return t=sT(t),new t(function(a,o){var c=new Yp({next:function(u){try{e(u)}catch(h){o(h),c.unsubscribe()}},error:o,complete:a});i.subscribe(c)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[Wm]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return aM(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=sT(e),new e(function(i,a){var o;t.subscribe(function(c){return o=c},function(c){return a(c)},function(){return i(o)})})},n.create=function(e){return new n(e)},n})();function sT(n){var e;return(e=n??eM.Promise)!==null&&e!==void 0?e:Promise}function sM(n){return n&&rt(n.next)&&rt(n.error)&&rt(n.complete)}function oM(n){return n&&n instanceof $m||sM(n)&&o1(n)}function lM(n){return rt(n?.lift)}function Xi(n){return function(e){if(lM(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ki(n,e,t,i,a){return new cM(n,e,t,i,a)}var cM=(function(n){Qi(e,n);function e(t,i,a,o,c,u){var h=n.call(this,t)||this;return h.onFinalize=c,h.shouldUnsubscribe=u,h._next=i?function(f){try{i(f)}catch(p){t.error(p)}}:n.prototype._next,h._error=o?function(f){try{o(f)}catch(p){t.error(p)}finally{this.unsubscribe()}}:n.prototype._error,h._complete=a?function(){try{a()}catch(f){t.error(f)}finally{this.unsubscribe()}}:n.prototype._complete,h}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;n.prototype.unsubscribe.call(this),!i&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e})($m),uM=Vm(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),c1=(function(n){Qi(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var i=new oT(this,this);return i.operator=t,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new uM},e.prototype.next=function(t){var i=this;yu(function(){var a,o;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var c=Is(i.currentObservers),u=c.next();!u.done;u=c.next()){var h=u.value;h.next(t)}}catch(f){a={error:f}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(a)throw a.error}}}})},e.prototype.error=function(t){var i=this;yu(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=t;for(var a=i.observers;a.length;)a.shift().error(t)}})},e.prototype.complete=function(){var t=this;yu(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var i=t.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var i=this,a=this,o=a.hasError,c=a.isStopped,u=a.observers;return o||c?s1:(this.currentObservers=null,u.push(t),new kl(function(){i.currentObservers=null,Iu(u,t)}))},e.prototype._checkFinalizedStatuses=function(t){var i=this,a=i.hasError,o=i.thrownError,c=i.isStopped;a?t.error(o):c&&t.complete()},e.prototype.asObservable=function(){var t=new Wt;return t.source=this,t},e.create=function(t,i){return new oT(t,i)},e})(Wt),oT=(function(n){Qi(e,n);function e(t,i){var a=n.call(this)||this;return a.destination=t,a.source=i,a}return e.prototype.next=function(t){var i,a;(a=(i=this.destination)===null||i===void 0?void 0:i.next)===null||a===void 0||a.call(i,t)},e.prototype.error=function(t){var i,a;(a=(i=this.destination)===null||i===void 0?void 0:i.error)===null||a===void 0||a.call(i,t)},e.prototype.complete=function(){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||i===void 0||i.call(t)},e.prototype._subscribe=function(t){var i,a;return(a=(i=this.source)===null||i===void 0?void 0:i.subscribe(t))!==null&&a!==void 0?a:s1},e})(c1);(function(n){Qi(e,n);function e(t){var i=n.call(this)||this;return i._value=t,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var i=n.prototype._subscribe.call(this,t);return!i.closed&&t.next(this._value),i},e.prototype.getValue=function(){var t=this,i=t.hasError,a=t.thrownError,o=t._value;if(i)throw a;return this._throwIfClosed(),o},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e})(c1);var dM={now:function(){return Date.now()}},hM=(function(n){Qi(e,n);function e(t,i){return n.call(this)||this}return e.prototype.schedule=function(t,i){return this},e})(kl),lT={setInterval:function(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];return setInterval.apply(void 0,vl([n,e],Ls(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},fM=(function(n){Qi(e,n);function e(t,i){var a=n.call(this,t,i)||this;return a.scheduler=t,a.work=i,a.pending=!1,a}return e.prototype.schedule=function(t,i){var a;if(i===void 0&&(i=0),this.closed)return this;this.state=t;var o=this.id,c=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(c,o,i)),this.pending=!0,this.delay=i,this.id=(a=this.id)!==null&&a!==void 0?a:this.requestAsyncId(c,this.id,i),this},e.prototype.requestAsyncId=function(t,i,a){return a===void 0&&(a=0),lT.setInterval(t.flush.bind(t,this),a)},e.prototype.recycleAsyncId=function(t,i,a){if(a===void 0&&(a=0),a!=null&&this.delay===a&&this.pending===!1)return i;i!=null&&lT.clearInterval(i)},e.prototype.execute=function(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var a=this._execute(t,i);if(a)return a;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,i){var a=!1,o;try{this.work(t)}catch(c){a=!0,o=c||new Error("Scheduled action threw falsy error")}if(a)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,i=t.id,a=t.scheduler,o=a.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Iu(o,this),i!=null&&(this.id=this.recycleAsyncId(a,i,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e})(hM),cT=(function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,i){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(i,t)},n.now=dM.now,n})(),pM=(function(n){Qi(e,n);function e(t,i){i===void 0&&(i=cT.now);var a=n.call(this,t,i)||this;return a.actions=[],a._active=!1,a}return e.prototype.flush=function(t){var i=this.actions;if(this._active){i.push(t);return}var a;this._active=!0;do if(a=t.execute(t.state,t.delay))break;while(t=i.shift());if(this._active=!1,a){for(;t=i.shift();)t.unsubscribe();throw a}},e})(cT),mM=new pM(fM);function gM(n){return n&&rt(n.schedule)}function vM(n){return n[n.length-1]}function Km(n){return gM(vM(n))?n.pop():void 0}var Jm=(function(n){return n&&typeof n.length=="number"&&typeof n!="function"});function u1(n){return rt(n?.then)}function d1(n){return rt(n[Wm])}function h1(n){return Symbol.asyncIterator&&rt(n?.[Symbol.asyncIterator])}function f1(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function yM(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var p1=yM();function m1(n){return rt(n?.[p1])}function g1(n){return XD(this,arguments,function(){var e,t,i,a;return a1(this,function(o){switch(o.label){case 0:e=n.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Ps(e.read())];case 3:return t=o.sent(),i=t.value,a=t.done,a?[4,Ps(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Ps(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function v1(n){return rt(n?.getReader)}function zr(n){if(n instanceof Wt)return n;if(n!=null){if(d1(n))return bM(n);if(Jm(n))return SM(n);if(u1(n))return TM(n);if(h1(n))return y1(n);if(m1(n))return kM(n);if(v1(n))return wM(n)}throw f1(n)}function bM(n){return new Wt(function(e){var t=n[Wm]();if(rt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function SM(n){return new Wt(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function TM(n){return new Wt(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,l1)})}function kM(n){return new Wt(function(e){var t,i;try{for(var a=Is(n),o=a.next();!o.done;o=a.next()){var c=o.value;if(e.next(c),e.closed)return}}catch(u){t={error:u}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}e.complete()})}function y1(n){return new Wt(function(e){CM(n,e).catch(function(t){return e.error(t)})})}function wM(n){return y1(g1(n))}function CM(n,e){var t,i,a,o;return QD(this,void 0,void 0,function(){var c,u;return a1(this,function(h){switch(h.label){case 0:h.trys.push([0,5,6,11]),t=ZD(n),h.label=1;case 1:return[4,t.next()];case 2:if(i=h.sent(),!!i.done)return[3,4];if(c=i.value,e.next(c),e.closed)return[2];h.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return u=h.sent(),a={error:u},[3,11];case 6:return h.trys.push([6,,9,10]),i&&!i.done&&(o=t.return)?[4,o.call(t)]:[3,8];case 7:h.sent(),h.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Nr(n,e,t,i,a){i===void 0&&(i=0),a===void 0&&(a=!1);var o=e.schedule(function(){t(),a?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(o),!a)return o}function b1(n,e){return e===void 0&&(e=0),Xi(function(t,i){t.subscribe(Ki(i,function(a){return Nr(i,n,function(){return i.next(a)},e)},function(){return Nr(i,n,function(){return i.complete()},e)},function(a){return Nr(i,n,function(){return i.error(a)},e)}))})}function S1(n,e){return e===void 0&&(e=0),Xi(function(t,i){i.add(n.schedule(function(){return t.subscribe(i)},e))})}function _M(n,e){return zr(n).pipe(S1(e),b1(e))}function xM(n,e){return zr(n).pipe(S1(e),b1(e))}function EM(n,e){return new Wt(function(t){var i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}function RM(n,e){return new Wt(function(t){var i;return Nr(t,e,function(){i=n[p1](),Nr(t,e,function(){var a,o,c;try{a=i.next(),o=a.value,c=a.done}catch(u){t.error(u);return}c?t.complete():t.next(o)},0,!0)}),function(){return rt(i?.return)&&i.return()}})}function T1(n,e){if(!n)throw new Error("Iterable cannot be null");return new Wt(function(t){Nr(t,e,function(){var i=n[Symbol.asyncIterator]();Nr(t,e,function(){i.next().then(function(a){a.done?t.complete():t.next(a.value)})},0,!0)})})}function OM(n,e){return T1(g1(n),e)}function AM(n,e){if(n!=null){if(d1(n))return _M(n,e);if(Jm(n))return EM(n,e);if(u1(n))return xM(n,e);if(h1(n))return T1(n,e);if(m1(n))return RM(n,e);if(v1(n))return OM(n,e)}throw f1(n)}function k1(n,e){return e?AM(n,e):zr(n)}function uT(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Km(n);return k1(n,t)}function jM(n){return n instanceof Date&&!isNaN(n)}var PM=Vm(function(n){return function(e){e===void 0&&(e=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function DM(n,e){var t=jM(n)?{first:n}:typeof n=="number"?{each:n}:n,i=t.first,a=t.each,o=t.with,c=o===void 0?MM:o,u=t.scheduler,h=u===void 0?mM:u,f=t.meta,p=f===void 0?null:f;if(i==null&&a==null)throw new TypeError("No timeout provided.");return Xi(function(y,b){var k,C,w=null,O=0,R=function(P){C=Nr(b,h,function(){try{k.unsubscribe(),zr(c({meta:p,lastValue:w,seen:O})).subscribe(b)}catch(j){b.error(j)}},P)};k=y.subscribe(Ki(b,function(P){C?.unsubscribe(),O++,b.next(w=P),a>0&&R(a)},void 0,void 0,function(){C!=null&&C.closed||C==null||C.unsubscribe(),w=null})),!O&&R(i!=null?typeof i=="number"?i:+i-h.now():a)})}function MM(n){throw new PM(n)}function si(n,e){return Xi(function(t,i){var a=0;t.subscribe(Ki(i,function(o){i.next(n.call(e,o,a++))}))})}var NM=Array.isArray;function IM(n,e){return NM(e)?n.apply(void 0,vl([],Ls(e))):n(e)}function LM(n){return si(function(e){return IM(n,e)})}function UM(n,e,t,i,a,o,c,u){var h=[],f=0,p=0,y=!1,b=function(){y&&!h.length&&!f&&e.complete()},k=function(w){return f<i?C(w):h.push(w)},C=function(w){f++;var O=!1;zr(t(w,p++)).subscribe(Ki(e,function(R){e.next(R)},function(){O=!0},void 0,function(){if(O)try{f--;for(var R=function(){var P=h.shift();c||C(P)};h.length&&f<i;)R();b()}catch(P){e.error(P)}}))};return n.subscribe(Ki(e,k,function(){y=!0,b()})),function(){}}function Ym(n,e,t){return t===void 0&&(t=1/0),rt(e)?Ym(function(i,a){return si(function(o,c){return e(i,o,a,c)})(zr(n(i,a)))},t):(typeof e=="number"&&(t=e),Xi(function(i,a){return UM(i,a,n,t)}))}function BM(n){return Ym(Gm,n)}function zM(){return BM(1)}function Qp(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return zM()(k1(n,Km(n)))}var qM=["addListener","removeListener"],FM=["addEventListener","removeEventListener"],HM=["on","off"];function Xp(n,e,t,i){if(rt(t)&&(i=t,t=void 0),i)return Xp(n,e,t).pipe(LM(i));var a=Ls(WM(n)?FM.map(function(u){return function(h){return n[u](e,h,t)}}):VM(n)?qM.map(dT(n,e)):$M(n)?HM.map(dT(n,e)):[],2),o=a[0],c=a[1];if(!o&&Jm(n))return Ym(function(u){return Xp(u,e,t)})(zr(n));if(!o)throw new TypeError("Invalid event target");return new Wt(function(u){var h=function(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];return u.next(1<f.length?f:f[0])};return o(h),function(){return c(h)}})}function dT(n,e){return function(t){return function(i){return n[t](e,i)}}}function VM(n){return rt(n.addListener)&&rt(n.removeListener)}function $M(n){return rt(n.on)&&rt(n.off)}function WM(n){return rt(n.addEventListener)&&rt(n.removeEventListener)}function GM(n,e){return Xi(function(t,i){var a=0;t.subscribe(Ki(i,function(o){return n.call(e,o,a++)&&i.next(o)}))})}function KM(n,e){return e===void 0&&(e=Gm),n=n??JM,Xi(function(t,i){var a,o=!0;t.subscribe(Ki(i,function(c){var u=e(c);(o||!n(a,u))&&(o=!1,a=u,i.next(c))}))})}function JM(n,e){return n===e}function YM(n){return Xi(function(e,t){var i=!1,a=Ki(t,function(){a?.unsubscribe(),i=!0},Jp);zr(n).subscribe(a),e.subscribe(Ki(t,function(o){return i&&t.next(o)}))})}function qr(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Km(n);return Xi(function(i,a){(t?Qp(n,i,t):Qp(n,i)).subscribe(a)})}var QM="lk";function dn(n){return typeof n>"u"?!1:XM(n)||ZM(n)}function XM(n){var e;return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&n.hasOwnProperty("track")&&typeof((e=n.publication)==null?void 0:e.track)<"u":!1}function ZM(n){return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&n.hasOwnProperty("publication")&&typeof n.publication<"u":!1}function yl(n){return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&typeof n.publication>"u":!1}function $t(n){if(typeof n=="string"||typeof n=="number")return`${n}`;if(yl(n))return`${n.participant.identity}_${n.source}_placeholder`;if(dn(n))return`${n.participant.identity}_${n.publication.source}_${n.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${n}`)}function w1(n,e){return typeof e>"u"?!1:dn(n)?e.some(t=>t.participant.identity===n.participant.identity&&dn(t)&&t.publication.trackSid===n.publication.trackSid):yl(n)?e.some(t=>t.participant.identity===n.participant.identity&&yl(t)&&t.source===n.source):!1}function eN(n,e){return yl(n)&&dn(e)&&e.participant.identity===n.participant.identity&&e.source===n.source}var tN=[X.ConnectionStateChanged,X.RoomMetadataChanged,X.ActiveSpeakersChanged,X.ConnectionQualityChanged,X.ParticipantConnected,X.ParticipantDisconnected,X.ParticipantPermissionsChanged,X.ParticipantMetadataChanged,X.ParticipantNameChanged,X.ParticipantAttributesChanged,X.TrackMuted,X.TrackUnmuted,X.TrackPublished,X.TrackUnpublished,X.TrackStreamStateChanged,X.TrackSubscriptionFailed,X.TrackSubscriptionPermissionChanged,X.TrackSubscriptionStatusChanged],nN=[...tN,X.LocalTrackPublished,X.LocalTrackUnpublished];te.TrackPublished,te.TrackUnpublished,te.TrackMuted,te.TrackUnmuted,te.TrackStreamStateChanged,te.TrackSubscribed,te.TrackUnsubscribed,te.TrackSubscriptionPermissionChanged,te.TrackSubscriptionFailed,te.LocalTrackPublished,te.LocalTrackUnpublished;var iN=[te.ConnectionQualityChanged,te.IsSpeakingChanged,te.ParticipantMetadataChanged,te.ParticipantPermissionsChanged,te.TrackMuted,te.TrackUnmuted,te.TrackPublished,te.TrackUnpublished,te.TrackStreamStateChanged,te.TrackSubscriptionFailed,te.TrackSubscriptionPermissionChanged,te.TrackSubscriptionStatusChanged];[...iN,te.LocalTrackPublished,te.LocalTrackUnpublished];var Ot=YD.getLogger("lk-components-js");Ot.setDefaultLevel("WARN");var rN=[{columns:1,rows:1},{columns:1,rows:2,orientation:"portrait"},{columns:2,rows:1,orientation:"landscape"},{columns:2,rows:2,minWidth:560},{columns:3,rows:3,minWidth:700},{columns:4,rows:4,minWidth:960},{columns:5,rows:5,minWidth:1100}];function C1(n,e,t,i){if(n.length<1)throw new Error("At least one grid layout definition must be provided.");const a=aN(n);if(t<=0||i<=0)return a[0];let o=0;const c=t/i>1?"landscape":"portrait";let u=a.find((h,f,p)=>{o=f;const y=p.findIndex((b,k)=>{const C=!b.orientation||b.orientation===c,w=k>f,O=b.maxTiles===h.maxTiles;return w&&O&&C})!==-1;return h.maxTiles>=e&&!y});if(u===void 0)if(u=a[a.length-1],u)Ot.warn(`No layout found for: participantCount: ${e}, width/height: ${t}/${i} fallback to biggest available layout (${u}).`);else throw new Error("No layout or fallback layout found.");if((t<u.minWidth||i<u.minHeight)&&o>0){const h=a[o-1];u=C1(a.slice(0,o),h.maxTiles,t,i)}return u}function aN(n){return[...n].map(e=>{var t,i;return{name:`${e.columns}x${e.rows}`,columns:e.columns,rows:e.rows,maxTiles:e.columns*e.rows,minWidth:(t=e.minWidth)!=null?t:0,minHeight:(i=e.minHeight)!=null?i:0,orientation:e.orientation}}).sort((e,t)=>e.maxTiles!==t.maxTiles?e.maxTiles-t.maxTiles:e.minWidth!==0||t.minWidth!==0?e.minWidth-t.minWidth:e.minHeight!==0||t.minHeight!==0?e.minHeight-t.minHeight:0)}var _1=(n=>(n.AgentState="lk.agent.state",n.PublishOnBehalf="lk.publish_on_behalf",n.TranscriptionFinal="lk.transcription_final",n.TranscriptionSegmentId="lk.segment_id",n.TranscribedTrackId="lk.transcribed_track_id",n))(_1||{});function x1(n){return typeof n=="object"}function E1(n){return Array.isArray(n)&&n.filter(x1).length>0}function sN(n,e){return e.audioLevel-n.audioLevel}function oN(n,e){return n.isSpeaking===e.isSpeaking?0:n.isSpeaking?-1:1}function lN(n,e){var t,i,a,o;return n.lastSpokeAt!==void 0||e.lastSpokeAt!==void 0?((i=(t=e.lastSpokeAt)==null?void 0:t.getTime())!=null?i:0)-((o=(a=n.lastSpokeAt)==null?void 0:a.getTime())!=null?o:0):0}function Zp(n,e){var t,i,a,o;return((i=(t=n.joinedAt)==null?void 0:t.getTime())!=null?i:0)-((o=(a=e.joinedAt)==null?void 0:a.getTime())!=null?o:0)}function cN(n,e){return dn(n)?dn(e)?0:-1:dn(e)?1:0}function uN(n,e){const t=n.participant.isCameraEnabled,i=e.participant.isCameraEnabled;return t!==i?t?-1:1:0}function dN(n){const e=[],t=[],i=[],a=[];n.forEach(u=>{u.participant.isLocal&&u.source===Q.Source.Camera?e.push(u):u.source===Q.Source.ScreenShare?t.push(u):u.source===Q.Source.Camera?i.push(u):a.push(u)});const o=hN(t),c=fN(i);return[...e,...o,...c,...a]}function hN(n){const e=[],t=[];return n.forEach(i=>{i.participant.isLocal?e.push(i):t.push(i)}),e.sort((i,a)=>Zp(i.participant,a.participant)),t.sort((i,a)=>Zp(i.participant,a.participant)),[...t,...e]}function fN(n){const e=[],t=[];return n.forEach(i=>{i.participant.isLocal?e.push(i):t.push(i)}),t.sort((i,a)=>i.participant.isSpeaking&&a.participant.isSpeaking?sN(i.participant,a.participant):i.participant.isSpeaking!==a.participant.isSpeaking?oN(i.participant,a.participant):i.participant.lastSpokeAt!==a.participant.lastSpokeAt?lN(i.participant,a.participant):dn(i)!==dn(a)?cN(i,a):i.participant.isCameraEnabled!==a.participant.isCameraEnabled?uN(i,a):Zp(i.participant,a.participant)),[...e,...t]}function pN(n,e){return n.reduce((t,i,a)=>a%e===0?[...t,[i]]:[...t.slice(0,-1),[...t.slice(-1)[0],i]],[])}function hT(n,e){const t=Math.max(n.length,e.length);return new Array(t).fill([]).map((i,a)=>[n[a],e[a]])}function Lu(n,e,t){return n.filter(i=>!e.map(a=>t(a)).includes(t(i)))}function em(n){return n.map(e=>typeof e=="string"||typeof e=="number"?`${e}`:$t(e))}function mN(n,e){return{dropped:Lu(n,e,$t),added:Lu(e,n,$t)}}function gN(n){return n.added.length!==0||n.dropped.length!==0}function tm(n,e){const t=e.findIndex(i=>$t(i)===$t(n));if(t===-1)throw new Error(`Element not part of the array: ${$t(n)} not in ${em(e)}`);return t}function vN(n,e,t){const i=tm(n,t),a=tm(e,t);return t.splice(i,1,e),t.splice(a,1,n),t}function yN(n,e){const t=tm(n,e);return e.splice(t,1),e}function bN(n,e){return[...e,n]}function rp(n,e){return pN(n,e)}function SN(n,e,t){let i=TN(n,e);if(i.length<e.length){const c=Lu(e,i,$t);i=[...i,...c]}const a=rp(i,t),o=rp(e,t);if(hT(a,o).forEach(([c,u],h)=>{if(c&&u){const f=rp(i,t)[h],p=mN(f,u);gN(p)&&(Ot.debug(`Detected visual changes on page: ${h}, current: ${em(c)}, next: ${em(u)}`,{changes:p}),p.added.length===p.dropped.length&&hT(p.added,p.dropped).forEach(([y,b])=>{if(y&&b)i=vN(y,b,i);else throw new Error(`For a swap action we need a addition and a removal one is missing: ${y}, ${b}`)}),p.added.length===0&&p.dropped.length>0&&p.dropped.forEach(y=>{i=yN(y,i)}),p.added.length>0&&p.dropped.length===0&&p.added.forEach(y=>{i=bN(y,i)}))}}),i.length>e.length){const c=Lu(i,e,$t);i=i.filter(u=>!c.map($t).includes($t(u)))}return i}function TN(n,e){return n.map(t=>e.find(a=>$t(t)===$t(a)||typeof t!="number"&&yl(t)&&dn(a)&&eN(t,a))??t)}function Us(n){return`${QM}-${n}`}function kN(n){const e=nm(n),t=xN(n.participant).pipe(si(()=>nm(n)),qr(e));return{className:Us(n.source===Q.Source.Camera||n.source===Q.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:t}}function nm(n){if(dn(n))return n.publication;{const{source:e,name:t,participant:i}=n;if(e&&t)return i.getTrackPublications().find(a=>a.source===e&&a.trackName===t);if(t)return i.getTrackPublicationByName(t);if(e)return i.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function wN(n,...e){return new Wt(t=>{const i=()=>{t.next(n)};return e.forEach(a=>{n.on(a,i)}),()=>{e.forEach(a=>{n.off(a,i)})}}).pipe(qr(n))}function CN(n,e){return new Wt(t=>{const i=(...a)=>{t.next(a)};return n.on(e,i),()=>{n.off(e,i)}})}function _N(n,e){return CN(n,X.ParticipantEncryptionStatusChanged).pipe(GM(([,t])=>e?.identity===t?.identity||!t&&e?.identity===n.localParticipant.identity),si(([t])=>t),qr(e!=null&&e.isLocal?e.isE2EEEnabled:!!(e!=null&&e.isEncrypted)))}function Qm(n,...e){return new Wt(t=>{const i=()=>{t.next(n)};return e.forEach(a=>{n.on(a,i)}),()=>{e.forEach(a=>{n.off(a,i)})}}).pipe(qr(n))}function xN(n){return Qm(n,te.TrackMuted,te.TrackUnmuted,te.ParticipantPermissionsChanged,te.TrackPublished,te.TrackUnpublished,te.LocalTrackPublished,te.LocalTrackUnpublished,te.MediaDevicesError,te.TrackSubscriptionStatusChanged).pipe(si(e=>{const{isMicrophoneEnabled:t,isCameraEnabled:i,isScreenShareEnabled:a}=e,o=e.getTrackPublication(Q.Source.Microphone),c=e.getTrackPublication(Q.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:t,isScreenShareEnabled:a,cameraTrack:c,microphoneTrack:o,participant:e}}))}function EN(n){return n?Qm(n,te.ParticipantMetadataChanged,te.ParticipantNameChanged).pipe(si(({name:e,identity:t,metadata:i})=>({name:e,identity:t,metadata:i})),qr({name:n.name,identity:n.identity,metadata:n.metadata})):void 0}function RN(n){return R1(n,te.ConnectionQualityChanged).pipe(si(([e])=>e),qr(n.connectionQuality))}function R1(n,e){return new Wt(t=>{const i=(...a)=>{t.next(a)};return n.on(e,i),()=>{n.off(e,i)}})}function O1(n){var e,t,i,a;return Qm(n.participant,te.TrackMuted,te.TrackUnmuted,te.TrackSubscribed,te.TrackUnsubscribed,te.LocalTrackPublished,te.LocalTrackUnpublished).pipe(si(o=>{var c,u;const h=(c=n.publication)!=null?c:o.getTrackPublication(n.source);return(u=h?.isMuted)!=null?u:!0}),qr((a=(i=(e=n.publication)==null?void 0:e.isMuted)!=null?i:(t=n.participant.getTrackPublication(n.source))==null?void 0:t.isMuted)!=null?a:!0))}function ON(n){return R1(n,te.IsSpeakingChanged).pipe(si(([e])=>e))}function AN(n){const e=Us("connection-quality"),t=RN(n);return{className:e,connectionQualityObserver:t}}function jN(n){let e="track-muted-indicator-camera";switch(n.source){case Q.Source.Camera:e="track-muted-indicator-camera";break;case Q.Source.Microphone:e="track-muted-indicator-microphone";break}const t=Us(e),i=O1(n);return{className:t,mediaMutedObserver:i}}function PN(n){return{className:"lk-participant-name",infoObserver:EN(n)}}function DN(){return{className:Us("participant-tile")}}function MN(){return{className:[Us("button"),Us("focus-toggle-button")].join(" ")}}function NN(){return{className:"lk-room-container"}}function fT(n,e,t=!0){const i=[n.localParticipant,...Array.from(n.remoteParticipants.values())],a=[];return i.forEach(o=>{e.forEach(c=>{const u=Array.from(o.trackPublications.values()).filter(h=>h.source===c&&(!t||h.track)).map(h=>({participant:o,publication:h,source:h.source}));a.push(...u)})}),{trackReferences:a,participants:i}}function IN(n,e,t){var i,a;const o=(i=t.additionalRoomEvents)!=null?i:nN,c=(a=t.onlySubscribed)!=null?a:!0,u=Array.from(new Set([X.ParticipantConnected,X.ParticipantDisconnected,X.ConnectionStateChanged,X.LocalTrackPublished,X.LocalTrackUnpublished,X.TrackPublished,X.TrackUnpublished,X.TrackSubscriptionStatusChanged,...o]).values());return wN(n,...u).pipe(si(h=>{const f=fT(h,e,c);return Ot.debug(`TrackReference[] was updated. (length ${f.trackReferences.length})`,f),f}),qr(fT(n,e,c)))}function LN(n,e=1e3){if(n===null)return uT(!1);const t=Xp(n,"mousemove",{passive:!0}).pipe(si(()=>!0)),i=t.pipe(DM({each:e,with:()=>Qp(uT(!1),i.pipe(YM(t)))}),KM());return i}const A1=T.createContext(void 0);function j1(){return T.useContext(A1)}const Xm=T.createContext(void 0);function Zu(){return T.useContext(Xm)}function Fs(n){const e=Zu(),t=n??e;if(!t)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return t}const P1=T.createContext(void 0);function D1(){return T.useContext(P1)}function wl(n){const e=D1(),t=Zu(),i=n??e??t?.participant;if(!i)throw new Error("No participant provided, make sure you are inside a participant context or pass the participant explicitly");return i}const Zm=T.createContext(void 0);function eg(){const n=T.useContext(Zm);if(!n)throw Error("tried to access room context outside of livekit room component");return n}function UN(){return T.useContext(Zm)}function M1(n){const e=UN(),t=n??e;if(!t)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return t}T.createContext(void 0);const N1=T.createContext(void 0);function BN(n){return T.useContext(N1)}function I1(n){var e,t,i="";if(typeof n=="string"||typeof n=="number")i+=n;else if(typeof n=="object")if(Array.isArray(n)){var a=n.length;for(e=0;e<a;e++)n[e]&&(t=I1(n[e]))&&(i&&(i+=" "),i+=t)}else for(t in n)n[t]&&(i&&(i+=" "),i+=t);return i}function L1(){for(var n,e,t=0,i="",a=arguments.length;t<a;t++)(n=arguments[t])&&(e=I1(n))&&(i&&(i+=" "),i+=e);return i}function zN(...n){return(...e)=>{for(const t of n)if(typeof t=="function")try{t(...e)}catch(i){console.error(i)}}}function ed(...n){const e={...n[0]};for(let t=1;t<n.length;t++){const i=n[t];for(const a in i){const o=e[a],c=i[a];typeof o=="function"&&typeof c=="function"&&a[0]==="o"&&a[1]==="n"&&a.charCodeAt(2)>=65&&a.charCodeAt(2)<=90?e[a]=zN(o,c):(a==="className"||a==="UNSAFE_className")&&typeof o=="string"&&typeof c=="string"?e[a]=L1(o,c):e[a]=c!==void 0?c:o}}return e}function qN(n){return n!==void 0}function Cl(...n){return ed(...n.filter(qN))}function FN(n,e,t){return T.Children.map(n,i=>T.isValidElement(i)&&T.Children.only(n)?(i.props.className&&(e??(e={}),e.className=L1(i.props.className,e.className),e.style={...i.props.style,...e.style}),T.cloneElement(i,{...e,key:t})):i)}function HN(n,e){return n==="processor"&&e&&typeof e=="object"&&"name"in e?e.name:n==="e2ee"&&e?"e2ee-enabled":e}const VN={connect:!0,audio:!1,video:!1};function $N(n){const{token:e,serverUrl:t,options:i,room:a,connectOptions:o,connect:c,audio:u,video:h,screen:f,onConnected:p,onDisconnected:y,onError:b,onMediaDeviceFailure:k,onEncryptionError:C,simulateParticipants:w,...O}={...VN,...n};i&&a&&Ot.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[R,P]=T.useState(),j=T.useRef(c);T.useEffect(()=>{P(a??new Ns(i))},[a,JSON.stringify(i,HN)]);const E=T.useMemo(()=>{const{className:_}=NN();return ed(O,{className:_})},[O]);return T.useEffect(()=>{if(!R)return;const _=()=>{const z=R.localParticipant;Ot.debug("trying to publish local tracks"),Promise.all([z.setMicrophoneEnabled(!!u,typeof u!="boolean"?u:void 0),z.setCameraEnabled(!!h,typeof h!="boolean"?h:void 0),z.setScreenShareEnabled(!!f,typeof f!="boolean"?f:void 0)]).catch(H=>{Ot.warn(H),b?.(H)})},A=(z,H)=>{const ie=fl.getFailure(z);k?.(ie,H)},I=z=>{C?.(z)},F=z=>{y?.(z)},B=()=>{p?.()};return R.on(X.SignalConnected,_).on(X.MediaDevicesError,A).on(X.EncryptionError,I).on(X.Disconnected,F).on(X.Connected,B),()=>{R.off(X.SignalConnected,_).off(X.MediaDevicesError,A).off(X.EncryptionError,I).off(X.Disconnected,F).off(X.Connected,B)}},[R,u,h,f,b,C,k,p,y]),T.useEffect(()=>{if(R){if(w){R.simulateParticipants({participants:{count:w},publish:{audio:!0,useRealTracks:!0}});return}if(c){if(j.current=!0,Ot.debug("connecting"),!e){Ot.debug("no token yet");return}if(!t){Ot.warn("no livekit url provided"),b?.(Error("no livekit url provided"));return}R.connect(t,e,o).catch(_=>{Ot.warn(_),j.current===!0&&b?.(_)})}else Ot.debug("disconnecting because connect is false"),j.current=!1,R.disconnect()}},[c,e,JSON.stringify(o),R,b,t,w]),T.useEffect(()=>{if(R)return()=>{Ot.info("disconnecting on onmount"),R.disconnect()}},[R]),{room:R,htmlProps:E}}const U1=T.forwardRef(function(n,e){const{room:t,htmlProps:i}=$N(n);return T.createElement("div",{ref:e,...i},t&&T.createElement(Zm.Provider,{value:t},T.createElement(N1.Provider,{value:n.featureFlags},n.children)))}),WN=n=>{const e=T.useRef(n);return T.useEffect(()=>{e.current=n}),e};function GN(n,e){const t=JN(),i=WN(e);return T.useLayoutEffect(()=>{let a=!1;const o=n.current;if(!o)return;function c(u,h){a||i.current(u,h)}return t?.subscribe(o,c),()=>{a=!0,t?.unsubscribe(o,c)}},[n.current,t,i]),t?.observer}function KN(){let n=!1,e=[];const t=new Map;if(typeof window>"u")return;const i=new ResizeObserver((a,o)=>{e=e.concat(a),n||window.requestAnimationFrame(()=>{const c=new Set;for(let u=0;u<e.length;u++){if(c.has(e[u].target))continue;c.add(e[u].target);const h=t.get(e[u].target);h?.forEach(f=>f(e[u],o))}e=[],n=!1}),n=!0});return{observer:i,subscribe(a,o){i.observe(a);const c=t.get(a)??[];c.push(o),t.set(a,c)},unsubscribe(a,o){const c=t.get(a)??[];if(c.length===1){i.unobserve(a),t.delete(a);return}const u=c.indexOf(o);u!==-1&&c.splice(u,1),t.set(a,c)}}}let pT;const JN=()=>pT||(pT=KN()),YN=n=>{const[e,t]=T.useState({width:0,height:0});T.useLayoutEffect(()=>{if(n.current){const{width:a,height:o}=n.current.getBoundingClientRect();t({width:a,height:o})}},[n.current]);const i=T.useCallback(a=>t(a.contentRect),[]);return GN(n,i),e};function _l(n,e,t=!0){const[i,a]=T.useState(e);return T.useEffect(()=>{if(t&&a(e),typeof window>"u"||!n)return;const o=n.subscribe(a);return()=>o.unsubscribe()},[n,t]),i}function QN(n={}){const e=wl(n.participant),{className:t,connectionQualityObserver:i}=T.useMemo(()=>AN(e),[e]),a=_l(i,e.connectionQuality);return{className:t,quality:a}}function XN(n){if(n.publication instanceof Du){const e=n.publication.track;if(e){const{facingMode:t}=HD(e);return t}}return"undefined"}function ZN({trackRef:n,props:e}){const t=Fs(n),i=j1(),{className:a}=T.useMemo(()=>MN(),[]),o=T.useMemo(()=>w1(t,i?.pin.state),[t,i?.pin.state]);return{mergedProps:T.useMemo(()=>ed(e,{className:a,onClick:c=>{var u,h,f,p,y;(u=e.onClick)==null||u.call(e,c),o?(f=i==null?void 0:(h=i.pin).dispatch)==null||f.call(h,{msg:"clear_pin"}):(y=i==null?void 0:(p=i.pin).dispatch)==null||y.call(p,{msg:"set_pin",trackReference:t})}}),[e,a,t,o,i?.pin]),inFocus:o}}function eI(n,e,t={}){const i=t.gridLayouts??rN,{width:a,height:o}=YN(n),c=C1(i,e,a,o);return T.useEffect(()=>{n.current&&c&&(n.current.style.setProperty("--lk-col-count",c?.columns.toString()),n.current.style.setProperty("--lk-row-count",c?.rows.toString()))},[n,c]),{layout:c,containerWidth:a,containerHeight:o}}function mT(n,e={}){var t,i;const a=typeof n=="string"?e.participant:n.participant,o=wl(a),c=typeof n=="string"?{participant:o,source:n}:n,[u,h]=T.useState(!!((t=c.publication)!=null&&t.isMuted||(i=o.getTrackPublication(c.source))!=null&&i.isMuted));return T.useEffect(()=>{const f=O1(c).subscribe(h);return()=>f.unsubscribe()},[$t(c)]),u}function tI(n){const e=wl(n),t=T.useMemo(()=>ON(e),[e]);return _l(t,e.isSpeaking)}function nI(n,e,t={}){const i=T.useRef([]),a=T.useRef(-1),o=e!==a.current,c=typeof t.customSortFunction=="function"?t.customSortFunction(n):dN(n);let u=[...c];if(o===!1)try{u=SN(i.current,c,e)}catch(h){Ot.error("Error while running updatePages(): ",h)}return o?i.current=c:i.current=u,a.current=e,u}function iI(n,e){const[t,i]=T.useState(1),a=Math.max(Math.ceil(e.length/n),1);t>a&&i(a);const o=t*n,c=o-n,u=p=>{i(y=>p==="next"?y===a?y:y+1:y===1?y:y-1)},h=p=>{p>a?i(a):p<1?i(1):i(p)},f=nI(e,n).slice(c,o);return{totalPageCount:a,nextPage:()=>u("next"),prevPage:()=>u("previous"),setPage:h,firstItemIndex:c,lastItemIndex:o,tracks:f,currentPage:t}}function rI({trackRef:n,onParticipantClick:e,disableSpeakingIndicator:t,htmlProps:i}){const a=Fs(n),o=T.useMemo(()=>{const{className:b}=DN();return ed(i,{className:b,onClick:k=>{var C;if((C=i.onClick)==null||C.call(i,k),typeof e=="function"){const w=a.publication??a.participant.getTrackPublication(a.source);e({participant:a.participant,track:w})}}})},[i,e,a.publication,a.source,a.participant]),c=a.participant.getTrackPublication(Q.Source.Microphone),u=T.useMemo(()=>({participant:a.participant,source:Q.Source.Microphone,publication:c}),[c,a.participant]),h=mT(a),f=mT(u),p=tI(a.participant),y=XN(a);return{elementProps:{"data-lk-audio-muted":f,"data-lk-video-muted":h,"data-lk-speaking":t===!0?!1:p,"data-lk-local-participant":a.participant.isLocal,"data-lk-source":a.source,"data-lk-facing-mode":y,...o}}}function aI(n,e={}){const t=T.useRef(null),i=T.useRef(null),a=e.minSwipeDistance??50,o=h=>{i.current=null,t.current=h.targetTouches[0].clientX},c=h=>{i.current=h.targetTouches[0].clientX},u=T.useCallback(()=>{if(!t.current||!i.current)return;const h=t.current-i.current,f=h>a,p=h<-a;f&&e.onLeftSwipe&&e.onLeftSwipe(),p&&e.onRightSwipe&&e.onRightSwipe()},[a,e]);T.useEffect(()=>{const h=n.current;return h&&(h.addEventListener("touchstart",o,{passive:!0}),h.addEventListener("touchmove",c,{passive:!0}),h.addEventListener("touchend",u,{passive:!0})),()=>{h&&(h.removeEventListener("touchstart",o),h.removeEventListener("touchmove",c),h.removeEventListener("touchend",u))}},[n,u])}function sI(n){var e,t;const i=Fs(n),{className:a,mediaMutedObserver:o}=T.useMemo(()=>jN(i),[$t(i)]);return{isMuted:_l(o,!!((e=i.publication)!=null&&e.isMuted||(t=i.participant.getTrackPublication(i.source))!=null&&t.isMuted)),className:a}}function tg(n=[Q.Source.Camera,Q.Source.Microphone,Q.Source.ScreenShare,Q.Source.ScreenShareAudio,Q.Source.Unknown],e={}){const t=M1(e.room),[i,a]=T.useState([]),[o,c]=T.useState([]),u=T.useMemo(()=>n.map(h=>x1(h)?h.source:h),[JSON.stringify(n)]);return T.useEffect(()=>{const h=IN(t,u,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:f,participants:p})=>{Ot.debug("setting track bundles",f,p),a(f),c(p)});return()=>h.unsubscribe()},[t,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(n)]),T.useMemo(()=>{if(E1(n)){const h=lI(n,o),f=Array.from(i);return o.forEach(p=>{h.has(p.identity)&&(h.get(p.identity)??[]).forEach(y=>{if(i.find(({participant:k,publication:C})=>p.identity===k.identity&&C.source===y))return;Ot.debug(`Add ${y} placeholder for participant ${p.identity}.`);const b={participant:p,source:y};f.push(b)})}),f}else return i},[i,o,n])}function oI(n,e){const t=new Set(n);for(const i of e)t.delete(i);return t}function lI(n,e){const t=new Map;if(E1(n)){const i=n.filter(a=>a.withPlaceholder).map(a=>a.source);e.forEach(a=>{const o=a.getTrackPublications().map(u=>{var h;return(h=u.track)==null?void 0:h.source}).filter(u=>u!==void 0),c=Array.from(oI(new Set(i),new Set(o)));c.length>0&&t.set(a.identity,c)})}return t}function cI(n,e={}){const t=wl(n),i=M1(e.room),a=T.useMemo(()=>_N(i,t),[i,t]);return _l(a,t.isLocal?t.isE2EEEnabled:!!(t!=null&&t.isEncrypted))}_1.AgentState;var Zc={exports:{}},gT;function uI(){if(gT)return Zc.exports;gT=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(E,_,A){return Function.prototype.apply.call(E,_,A)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(E){return Object.getOwnPropertyNames(E).concat(Object.getOwnPropertySymbols(E))}:t=function(E){return Object.getOwnPropertyNames(E)};function i(E){console&&console.warn&&console.warn(E)}var a=Number.isNaN||function(E){return E!==E};function o(){o.init.call(this)}Zc.exports=o,Zc.exports.once=R,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function u(E){if(typeof E!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof E)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(E){if(typeof E!="number"||E<0||a(E))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+E+".");c=E}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(E){if(typeof E!="number"||E<0||a(E))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+E+".");return this._maxListeners=E,this};function h(E){return E._maxListeners===void 0?o.defaultMaxListeners:E._maxListeners}o.prototype.getMaxListeners=function(){return h(this)},o.prototype.emit=function(E){for(var _=[],A=1;A<arguments.length;A++)_.push(arguments[A]);var I=E==="error",F=this._events;if(F!==void 0)I=I&&F.error===void 0;else if(!I)return!1;if(I){var B;if(_.length>0&&(B=_[0]),B instanceof Error)throw B;var z=new Error("Unhandled error."+(B?" ("+B.message+")":""));throw z.context=B,z}var H=F[E];if(H===void 0)return!1;if(typeof H=="function")e(H,this,_);else for(var ie=H.length,he=C(H,ie),A=0;A<ie;++A)e(he[A],this,_);return!0};function f(E,_,A,I){var F,B,z;if(u(A),B=E._events,B===void 0?(B=E._events=Object.create(null),E._eventsCount=0):(B.newListener!==void 0&&(E.emit("newListener",_,A.listener?A.listener:A),B=E._events),z=B[_]),z===void 0)z=B[_]=A,++E._eventsCount;else if(typeof z=="function"?z=B[_]=I?[A,z]:[z,A]:I?z.unshift(A):z.push(A),F=h(E),F>0&&z.length>F&&!z.warned){z.warned=!0;var H=new Error("Possible EventEmitter memory leak detected. "+z.length+" "+String(_)+" listeners added. Use emitter.setMaxListeners() to increase limit");H.name="MaxListenersExceededWarning",H.emitter=E,H.type=_,H.count=z.length,i(H)}return E}o.prototype.addListener=function(E,_){return f(this,E,_,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(E,_){return f(this,E,_,!0)};function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(E,_,A){var I={fired:!1,wrapFn:void 0,target:E,type:_,listener:A},F=p.bind(I);return F.listener=A,I.wrapFn=F,F}o.prototype.once=function(E,_){return u(_),this.on(E,y(this,E,_)),this},o.prototype.prependOnceListener=function(E,_){return u(_),this.prependListener(E,y(this,E,_)),this},o.prototype.removeListener=function(E,_){var A,I,F,B,z;if(u(_),I=this._events,I===void 0)return this;if(A=I[E],A===void 0)return this;if(A===_||A.listener===_)--this._eventsCount===0?this._events=Object.create(null):(delete I[E],I.removeListener&&this.emit("removeListener",E,A.listener||_));else if(typeof A!="function"){for(F=-1,B=A.length-1;B>=0;B--)if(A[B]===_||A[B].listener===_){z=A[B].listener,F=B;break}if(F<0)return this;F===0?A.shift():w(A,F),A.length===1&&(I[E]=A[0]),I.removeListener!==void 0&&this.emit("removeListener",E,z||_)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(E){var _,A,I;if(A=this._events,A===void 0)return this;if(A.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):A[E]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete A[E]),this;if(arguments.length===0){var F=Object.keys(A),B;for(I=0;I<F.length;++I)B=F[I],B!=="removeListener"&&this.removeAllListeners(B);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(_=A[E],typeof _=="function")this.removeListener(E,_);else if(_!==void 0)for(I=_.length-1;I>=0;I--)this.removeListener(E,_[I]);return this};function b(E,_,A){var I=E._events;if(I===void 0)return[];var F=I[_];return F===void 0?[]:typeof F=="function"?A?[F.listener||F]:[F]:A?O(F):C(F,F.length)}o.prototype.listeners=function(E){return b(this,E,!0)},o.prototype.rawListeners=function(E){return b(this,E,!1)},o.listenerCount=function(E,_){return typeof E.listenerCount=="function"?E.listenerCount(_):k.call(E,_)},o.prototype.listenerCount=k;function k(E){var _=this._events;if(_!==void 0){var A=_[E];if(typeof A=="function")return 1;if(A!==void 0)return A.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function C(E,_){for(var A=new Array(_),I=0;I<_;++I)A[I]=E[I];return A}function w(E,_){for(;_+1<E.length;_++)E[_]=E[_+1];E.pop()}function O(E){for(var _=new Array(E.length),A=0;A<_.length;++A)_[A]=E[A].listener||E[A];return _}function R(E,_){return new Promise(function(A,I){function F(z){E.removeListener(_,B),I(z)}function B(){typeof E.removeListener=="function"&&E.removeListener("error",F),A([].slice.call(arguments))}j(E,_,B,{once:!0}),_!=="error"&&P(E,F,{once:!0})})}function P(E,_,A){typeof E.on=="function"&&j(E,"error",_,A)}function j(E,_,A,I){if(typeof E.on=="function")I.once?E.once(_,A):E.on(_,A);else if(typeof E.addEventListener=="function")E.addEventListener(_,function F(B){I.once&&E.removeEventListener(_,F),A(B)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof E)}return Zc.exports}uI();const dI=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...n},T.createElement("path",{d:"M1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708L11 10.293V4.5A1.5 1.5 0 0 0 9.5 3H3.707zM0 4.5a1.5 1.5 0 0 1 .943-1.393l9.532 9.533c-.262.224-.603.36-.975.36h-8A1.5 1.5 0 0 1 0 11.5z"}),T.createElement("path",{d:"m15.2 3.6-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),hI=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...n},T.createElement("path",{d:"M0 4.5A1.5 1.5 0 0 1 1.5 3h8A1.5 1.5 0 0 1 11 4.5v7A1.5 1.5 0 0 1 9.5 13h-8A1.5 1.5 0 0 1 0 11.5zM15.2 3.6l-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),vT=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...n},T.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M5.293 2.293a1 1 0 0 1 1.414 0l4.823 4.823a1.25 1.25 0 0 1 0 1.768l-4.823 4.823a1 1 0 0 1-1.414-1.414L9.586 8 5.293 3.707a1 1 0 0 1 0-1.414z",clipRule:"evenodd"})),fI=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...n},T.createElement("g",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},T.createElement("path",{d:"M10 1.75h4.25m0 0V6m0-4.25L9 7M6 14.25H1.75m0 0V10m0 4.25L7 9"}))),pI=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...n},T.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M4 6.104V4a4 4 0 1 1 8 0v2.104c1.154.326 2 1.387 2 2.646v4.5A2.75 2.75 0 0 1 11.25 16h-6.5A2.75 2.75 0 0 1 2 13.25v-4.5c0-1.259.846-2.32 2-2.646ZM5.5 4a2.5 2.5 0 0 1 5 0v2h-5V4Z",clipRule:"evenodd"})),mI=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...n},T.createElement("path",{d:"M12.227 11.52a5.477 5.477 0 0 0 1.246-2.97.5.5 0 0 0-.995-.1 4.478 4.478 0 0 1-.962 2.359l-1.07-1.07C10.794 9.247 11 8.647 11 8V3a3 3 0 0 0-6 0v1.293L1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708zM8 12.5c.683 0 1.33-.152 1.911-.425l.743.743c-.649.359-1.378.59-2.154.66V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .995-.098A4.5 4.5 0 0 0 8 12.5z"}),T.createElement("path",{d:"M8.743 10.907 5 7.164V8a3 3 0 0 0 3.743 2.907z"})),gI=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...n},T.createElement("path",{fillRule:"evenodd",d:"M2.975 8.002a.5.5 0 0 1 .547.449 4.5 4.5 0 0 0 8.956 0 .5.5 0 1 1 .995.098A5.502 5.502 0 0 1 8.5 13.478V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .448-.547z",clipRule:"evenodd"}),T.createElement("path",{d:"M5 3a3 3 0 1 1 6 0v5a3 3 0 0 1-6 0z"})),vI=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor",...n},T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"})),yI=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor",...n},T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("g",{opacity:.25},T.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}))),bI=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor",...n},T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("g",{opacity:.25},T.createElement("path",{d:"M6 6.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("path",{d:"M6 6.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}))),SI=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...n},T.createElement("g",{opacity:.25},T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4Zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-9Zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V.5Z"}),T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4Zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-9Zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V.5Z"}))),B1=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...n},T.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h14.5A2.75 2.75 0 0 1 20 2.75v10.5A2.75 2.75 0 0 1 17.25 16H2.75A2.75 2.75 0 0 1 0 13.25V2.75ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h14.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),T.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.47 4.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1-1.06 1.06l-.97-.97v4.69a.75.75 0 0 1-1.5 0V6.56l-.97.97a.75.75 0 0 1-1.06-1.06l2.25-2.25Z",clipRule:"evenodd"})),TI=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...n},T.createElement("g",{fill:"currentColor"},T.createElement("path",{d:"M7.28 4.22a.75.75 0 0 0-1.06 1.06L8.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L10 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L11.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L10 6.94z"}),T.createElement("path",{fillRule:"evenodd",d:"M2.75 0A2.75 2.75 0 0 0 0 2.75v10.5A2.75 2.75 0 0 0 2.75 16h14.5A2.75 2.75 0 0 0 20 13.25V2.75A2.75 2.75 0 0 0 17.25 0zM1.5 2.75c0-.69.56-1.25 1.25-1.25h14.5c.69 0 1.25.56 1.25 1.25v10.5c0 .69-.56 1.25-1.25 1.25H2.75c-.69 0-1.25-.56-1.25-1.25z",clipRule:"evenodd"}))),kI=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...n},T.createElement("g",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},T.createElement("path",{d:"M13.25 7H9m0 0V2.75M9 7l5.25-5.25M2.75 9H7m0 0v4.25M7 9l-5.25 5.25"}))),wI=T.forwardRef(function({trackRef:n,...e},t){const i=Zu(),{mergedProps:a,inFocus:o}=ZN({trackRef:n??i,props:e});return T.createElement(A1.Consumer,null,c=>c!==void 0&&T.createElement("button",{ref:t,...a},e.children?e.children:o?T.createElement(kI,null):T.createElement(fI,null)))});function CI(n,e){switch(n){case Q.Source.Microphone:return e?T.createElement(gI,null):T.createElement(mI,null);case Q.Source.Camera:return e?T.createElement(hI,null):T.createElement(dI,null);case Q.Source.ScreenShare:return e?T.createElement(TI,null):T.createElement(B1,null);default:return}}function _I(n){switch(n){case ni.Excellent:return T.createElement(vI,null);case ni.Good:return T.createElement(yI,null);case ni.Poor:return T.createElement(bI,null);default:return T.createElement(SI,null)}}const xI=T.forwardRef(function(n,e){const{className:t,quality:i}=QN(n),a=T.useMemo(()=>({...Cl(n,{className:t}),"data-lk-quality":i}),[i,n,t]);return T.createElement("div",{ref:e,...a},n.children??_I(i))}),yT=T.forwardRef(function({participant:n,...e},t){const i=wl(n),{className:a,infoObserver:o}=T.useMemo(()=>PN(i),[i]),{identity:c,name:u}=_l(o,{name:i.name,identity:i.identity,metadata:i.metadata}),h=T.useMemo(()=>Cl(e,{className:a,"data-lk-participant-name":u}),[e,a,u]);return T.createElement("span",{ref:t,...h},u!==""?u:c,e.children)}),EI=T.forwardRef(function({trackRef:n,show:e="always",...t},i){const{className:a,isMuted:o}=sI(n),c=e==="always"||e==="muted"&&o||e==="unmuted"&&!o,u=T.useMemo(()=>Cl(t,{className:a}),[a,t]);return c?T.createElement("div",{ref:i,...u,"data-lk-muted":o},t.children??CI(n.source,!o)):null}),RI=n=>T.createElement("svg",{width:320,height:320,viewBox:"0 0 320 320",preserveAspectRatio:"xMidYMid meet",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},T.createElement("path",{d:"M160 180C204.182 180 240 144.183 240 100C240 55.8172 204.182 20 160 20C115.817 20 79.9997 55.8172 79.9997 100C79.9997 144.183 115.817 180 160 180Z",fill:"white",fillOpacity:.25}),T.createElement("path",{d:"M97.6542 194.614C103.267 191.818 109.841 192.481 115.519 195.141C129.025 201.466 144.1 205 159.999 205C175.899 205 190.973 201.466 204.48 195.141C210.158 192.481 216.732 191.818 222.345 194.614C262.703 214.719 291.985 253.736 298.591 300.062C300.15 310.997 291.045 320 280 320H39.9997C28.954 320 19.8495 310.997 21.4087 300.062C28.014 253.736 57.2966 214.72 97.6542 194.614Z",fill:"white",fillOpacity:.25}));function z1(n,e={}){const[t,i]=T.useState(nm(n)),[a,o]=T.useState(t?.isMuted),[c,u]=T.useState(t?.isSubscribed),[h,f]=T.useState(t?.track),[p,y]=T.useState("landscape"),b=T.useRef(),{className:k,trackObserver:C}=T.useMemo(()=>kN(n),[n.participant.sid??n.participant.identity,n.source,dn(n)&&n.publication.trackSid]);return T.useEffect(()=>{const w=C.subscribe(O=>{Ot.debug("update track",O),i(O),o(O?.isMuted),u(O?.isSubscribed),f(O?.track)});return()=>w?.unsubscribe()},[C]),T.useEffect(()=>{var w,O;return h&&(b.current&&h.detach(b.current),(w=e.element)!=null&&w.current&&!(n.participant.isLocal&&h?.kind==="audio")&&h.attach(e.element.current)),b.current=(O=e.element)==null?void 0:O.current,()=>{b.current&&h?.detach(b.current)}},[h,e.element]),T.useEffect(()=>{var w,O;if(typeof((w=t?.dimensions)==null?void 0:w.width)=="number"&&typeof((O=t?.dimensions)==null?void 0:O.height)=="number"){const R=t.dimensions.width>t.dimensions.height?"landscape":"portrait";y(R)}},[t]),{publication:t,isMuted:a,isSubscribed:c,track:h,elementProps:Cl(e.props,{className:k,"data-lk-local-participant":n.participant.isLocal,"data-lk-source":t?.source,...t?.kind==="video"&&{"data-lk-orientation":p}})}}var ap,bT;function OI(){if(bT)return ap;bT=1;var n="Expected a function",e=NaN,t="[object Symbol]",i=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt,h=typeof Qc=="object"&&Qc&&Qc.Object===Object&&Qc,f=typeof self=="object"&&self&&self.Object===Object&&self,p=h||f||Function("return this")(),y=Object.prototype,b=y.toString,k=Math.max,C=Math.min,w=function(){return p.Date.now()};function O(_,A,I){var F,B,z,H,ie,he,Z=0,le=!1,N=!1,K=!0;if(typeof _!="function")throw new TypeError(n);A=E(A)||0,R(I)&&(le=!!I.leading,N="maxWait"in I,z=N?k(E(I.maxWait)||0,A):z,K="trailing"in I?!!I.trailing:K);function ae(Se){var nt=F,Fe=B;return F=B=void 0,Z=Se,H=_.apply(Fe,nt),H}function pe(Se){return Z=Se,ie=setTimeout(J,A),le?ae(Se):H}function ye(Se){var nt=Se-he,Fe=Se-Z,hn=A-nt;return N?C(hn,z-Fe):hn}function D(Se){var nt=Se-he,Fe=Se-Z;return he===void 0||nt>=A||nt<0||N&&Fe>=z}function J(){var Se=w();if(D(Se))return oe(Se);ie=setTimeout(J,ye(Se))}function oe(Se){return ie=void 0,K&&F?ae(Se):(F=B=void 0,H)}function de(){ie!==void 0&&clearTimeout(ie),Z=0,F=he=B=ie=void 0}function ge(){return ie===void 0?H:oe(w())}function _e(){var Se=w(),nt=D(Se);if(F=arguments,B=this,he=Se,nt){if(ie===void 0)return pe(he);if(N)return ie=setTimeout(J,A),ae(he)}return ie===void 0&&(ie=setTimeout(J,A)),H}return _e.cancel=de,_e.flush=ge,_e}function R(_){var A=typeof _;return!!_&&(A=="object"||A=="function")}function P(_){return!!_&&typeof _=="object"}function j(_){return typeof _=="symbol"||P(_)&&b.call(_)==t}function E(_){if(typeof _=="number")return _;if(j(_))return e;if(R(_)){var A=typeof _.valueOf=="function"?_.valueOf():_;_=R(A)?A+"":A}if(typeof _!="string")return _===0?_:+_;_=_.replace(i,"");var I=o.test(_);return I||c.test(_)?u(_.slice(2),I?2:8):a.test(_)?e:+_}return ap=O,ap}var AI=OI();const ST=r1(AI);function jI(n){const e=T.useRef(n);e.current=n,T.useEffect(()=>()=>{e.current()},[])}function PI(n,e=500,t){const i=T.useRef();jI(()=>{i.current&&i.current.cancel()});const a=T.useMemo(()=>{const o=ST(n,e,t),c=(...u)=>o(...u);return c.cancel=()=>{o.cancel()},c.isPending=()=>!!i.current,c.flush=()=>o.flush(),c},[n,e,t]);return T.useEffect(()=>{i.current=ST(n,e,t)},[n,e,t]),a}function DI(n,e,t){const i=((f,p)=>f===p),a=n instanceof Function?n():n,[o,c]=T.useState(a),u=T.useRef(a),h=PI(c,e,t);return i(u.current,a)||(h(a),u.current=a),[o,h]}function MI({threshold:n=0,root:e=null,rootMargin:t="0%",freezeOnceVisible:i=!1,initialIsIntersecting:a=!1,onChange:o}={}){var c;const[u,h]=T.useState(null),[f,p]=T.useState(()=>({isIntersecting:a,entry:void 0})),y=T.useRef();y.current=o;const b=((c=f.entry)==null?void 0:c.isIntersecting)&&i;T.useEffect(()=>{if(!u||!("IntersectionObserver"in window)||b)return;const w=new IntersectionObserver(O=>{const R=Array.isArray(w.thresholds)?w.thresholds:[w.thresholds];O.forEach(P=>{const j=P.isIntersecting&&R.some(E=>P.intersectionRatio>=E);p({isIntersecting:j,entry:P}),y.current&&y.current(j,P)})},{threshold:n,root:e,rootMargin:t});return w.observe(u),()=>{w.disconnect()}},[u,JSON.stringify(n),e,t,b,i]);const k=T.useRef(null);T.useEffect(()=>{var w;!u&&(w=f.entry)!=null&&w.target&&!i&&!b&&k.current!==f.entry.target&&(k.current=f.entry.target,p({isIntersecting:a,entry:void 0}))},[u,f.entry,i,b,a]);const C=[h,!!f.isIntersecting,f.entry];return C.ref=C[0],C.isIntersecting=C[1],C.entry=C[2],C}const NI=T.forwardRef(function({onTrackClick:n,onClick:e,onSubscriptionStatusChanged:t,trackRef:i,manageSubscription:a,...o},c){const u=Fs(i),h=T.useRef(null);T.useImperativeHandle(c,()=>h.current);const f=MI({root:h.current}),[p]=DI(f,3e3);T.useEffect(()=>{a&&u.publication instanceof Mu&&p?.isIntersecting===!1&&f?.isIntersecting===!1&&u.publication.setSubscribed(!1)},[p,u,a]),T.useEffect(()=>{a&&u.publication instanceof Mu&&f?.isIntersecting===!0&&u.publication.setSubscribed(!0)},[f,u,a]);const{elementProps:y,publication:b,isSubscribed:k}=z1(u,{element:h,props:o});T.useEffect(()=>{t?.(!!k)},[k,t]);const C=w=>{e?.(w),n?.({participant:u?.participant,track:b})};return T.createElement("video",{ref:h,...y,muted:!0,onClick:C})}),q1=T.forwardRef(function({trackRef:n,onSubscriptionStatusChanged:e,volume:t,...i},a){const o=Fs(n),c=T.useRef(null);T.useImperativeHandle(a,()=>c.current);const{elementProps:u,isSubscribed:h,track:f,publication:p}=z1(o,{element:c,props:i});return T.useEffect(()=>{e?.(!!h)},[h,e]),T.useEffect(()=>{f===void 0||t===void 0||(f instanceof t1?f.setVolume(t):Ot.warn("Volume can only be set on remote audio tracks."))},[t,f]),T.useEffect(()=>{p===void 0||i.muted===void 0||(p instanceof Mu?p.setEnabled(!i.muted):Ot.warn("Can only call setEnabled on remote track publications."))},[i.muted,p,f]),T.createElement("audio",{ref:c,...u})});function II(n){const e=!!D1();return n.participant&&!e?T.createElement(P1.Provider,{value:n.participant},n.children):T.createElement(T.Fragment,null,n.children)}function LI(n){const e=!!Zu();return n.trackRef&&!e?T.createElement(Xm.Provider,{value:n.trackRef},n.children):T.createElement(T.Fragment,null,n.children)}const F1=T.forwardRef(function({trackRef:n,children:e,onParticipantClick:t,disableSpeakingIndicator:i,...a},o){var c,u;const h=Fs(n),{elementProps:f}=rI({htmlProps:a,disableSpeakingIndicator:i,onParticipantClick:t,trackRef:h}),p=cI(h.participant),y=j1(),b=(c=BN())==null?void 0:c.autoSubscription,k=T.useCallback(C=>{h.source&&!C&&y&&y.pin.dispatch&&w1(h,y.pin.state)&&y.pin.dispatch({msg:"clear_pin"})},[h,y]);return T.createElement("div",{ref:o,style:{position:"relative"},...f},T.createElement(LI,{trackRef:h},T.createElement(II,{participant:h.participant},e??T.createElement(T.Fragment,null,dn(h)&&(((u=h.publication)==null?void 0:u.kind)==="video"||h.source===Q.Source.Camera||h.source===Q.Source.ScreenShare)?T.createElement(NI,{trackRef:h,onSubscriptionStatusChanged:k,manageSubscription:b}):dn(h)&&T.createElement(q1,{trackRef:h,onSubscriptionStatusChanged:k}),T.createElement("div",{className:"lk-participant-placeholder"},T.createElement(RI,null)),T.createElement("div",{className:"lk-participant-metadata"},T.createElement("div",{className:"lk-participant-metadata-item"},h.source===Q.Source.Camera?T.createElement(T.Fragment,null,p&&T.createElement(pI,{style:{marginRight:"0.25rem"}}),T.createElement(EI,{trackRef:{participant:h.participant,source:Q.Source.Microphone},show:"muted"}),T.createElement(yT,null)):T.createElement(T.Fragment,null,T.createElement(B1,{style:{marginRight:"0.25rem"}}),T.createElement(yT,null,"'s screen"))),T.createElement(xI,{className:"lk-participant-metadata-item"}))),T.createElement(wI,{trackRef:h}))))});function UI({tracks:n,...e}){return T.createElement(T.Fragment,null,n.map(t=>T.createElement(Xm.Provider,{value:t,key:$t(t)},FN(e.children))))}function BI({totalPageCount:n,nextPage:e,prevPage:t,currentPage:i,pagesContainer:a}){const[o,c]=T.useState(!1);return T.useEffect(()=>{let u;return a&&(u=LN(a.current,2e3).subscribe(c)),()=>{u&&u.unsubscribe()}},[a]),T.createElement("div",{className:"lk-pagination-control","data-lk-user-interaction":o},T.createElement("button",{className:"lk-button",onClick:t},T.createElement(vT,null)),T.createElement("span",{className:"lk-pagination-count"},`${i} of ${n}`),T.createElement("button",{className:"lk-button",onClick:e},T.createElement(vT,null)))}const zI=T.forwardRef(function({totalPageCount:n,currentPage:e},t){const i=new Array(n).fill("").map((a,o)=>o+1===e?T.createElement("span",{"data-lk-active":!0,key:o}):T.createElement("span",{key:o}));return T.createElement("div",{ref:t,className:"lk-pagination-indicator"},i)});function H1({tracks:n,...e}){const t=T.createRef(),i=T.useMemo(()=>Cl(e,{className:"lk-grid-layout"}),[e]),{layout:a}=eI(t,n.length),o=iI(a.maxTiles,n);return aI(t,{onLeftSwipe:o.nextPage,onRightSwipe:o.prevPage}),T.createElement("div",{ref:t,"data-lk-pagination":o.totalPageCount>1,...i},T.createElement(UI,{tracks:o.tracks},e.children),n.length>a.maxTiles&&T.createElement(T.Fragment,null,T.createElement(zI,{totalPageCount:o.totalPageCount,currentPage:o.currentPage}),T.createElement(BI,{pagesContainer:t,...o})))}function V1({room:n,volume:e,muted:t}){const i=tg([Q.Source.Microphone,Q.Source.ScreenShareAudio,Q.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0,room:n}).filter(a=>!a.participant.isLocal&&a.publication.kind===Q.Kind.Audio);return T.createElement("div",{style:{display:"none"}},i.map(a=>T.createElement(q1,{key:$t(a),trackRef:a,volume:e,muted:t})))}function qI(){if(typeof window<"u"&&window.location.hostname==="localhost")return"https://www.homeplanet.city";const e=String("").trim();return!e||e==="undefined"||e==="null"?"":e}const TT=qI();function FI(){return typeof navigator>"u"?!1:/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)}async function HI(n,e){const i=`${TT?TT.replace(/\/+$/,""):""}/api/livekit-token?room=${encodeURIComponent(n)}&identity=${encodeURIComponent(e)}`,a=await fetch(i,{method:"GET",headers:{Accept:"application/json"}});if(!a.ok){const c=await a.text().catch(()=>"");throw new Error(`Token fetch failed (${a.status}): ${c||a.statusText}`)}const o=await a.json();if(!o?.token||!o?.url)throw new Error("Token response missing { token, url }");return o}function VI(n="creator"){return`${n}_${Math.random().toString(16).slice(2)}`}function $I(){const n=tg([{source:Q.Source.Camera,withPlaceholder:!0},{source:Q.Source.ScreenShare,withPlaceholder:!0}]);return g.jsx("div",{style:{height:"100%",width:"100%"},children:g.jsx(H1,{tracks:n,style:{height:"100%"},children:g.jsx(F1,{})})})}function WI({show:n,onUnlock:e}){return n?g.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",padding:16,background:"rgba(0,0,0,0.55)",zIndex:30,backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)",pointerEvents:n?"auto":"none"},children:g.jsxs("div",{style:{maxWidth:420,width:"100%",background:"rgba(20,20,20,0.92)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:14,padding:16,color:"white",boxShadow:"0 20px 60px rgba(0,0,0,0.45)"},children:[g.jsx("div",{style:{fontSize:18,fontWeight:900,marginBottom:8},children:"Tap to start audio"}),g.jsx("div",{style:{fontSize:13,opacity:.9,marginBottom:12,lineHeight:1.35},children:"iPhone/Android browsers block audio until you tap. This unlocks playback so viewers can hear you and you can hear guests."}),g.jsx("button",{onClick:()=>e(),style:{width:"100%",height:44,borderRadius:12,border:"none",cursor:"pointer",fontWeight:900,background:"white",color:"black"},children:"Start Audio"})]})}):null}function GI({wantMicOn:n,setWantMicOn:e,wantCamOn:t,setWantCamOn:i,onEnd:a,showAudioUnlock:o,onUnlockAudio:c}){const u=eg(),h=async()=>{const p=!n;e(p);try{await u.localParticipant.setMicrophoneEnabled(p)}catch(y){console.error("Mic toggle failed:",y)}},f=async()=>{const p=!t;i(p);try{await u.localParticipant.setCameraEnabled(p)}catch(y){console.error("Cam toggle failed:",y)}};return g.jsxs(g.Fragment,{children:[g.jsx(WI,{show:o,onUnlock:c}),g.jsxs("div",{style:{position:"absolute",left:0,right:0,bottom:0,padding:12,paddingBottom:"calc(12px + env(safe-area-inset-bottom))",display:"flex",gap:10,justifyContent:"center",alignItems:"center",zIndex:10,background:"linear-gradient(to top, rgba(0,0,0,0.70), rgba(0,0,0,0.0))"},children:[g.jsx("button",{onClick:h,children:n?"Mic On":"Mic Off"}),g.jsx("button",{onClick:f,children:t?"Cam On":"Cam Off"}),g.jsx("button",{onClick:a,children:"End"})]})]})}function KI({wantMicOn:n,setWantMicOn:e,wantCamOn:t,setWantCamOn:i,onEnd:a,mobile:o}){const c=eg(),[u,h]=T.useState(!o),f=T.useCallback(async()=>{try{await c.startAudio(),h(!0)}catch{h(!1)}},[c]);return T.useEffect(()=>{(async()=>{try{if(o)try{await c.startAudio(),h(!0)}catch{h(!1)}await c.localParticipant.setMicrophoneEnabled(n),await c.localParticipant.setCameraEnabled(t)}catch(p){console.error("Initial publish failed:",p)}})()},[]),g.jsxs("div",{style:{position:"relative",height:"100dvh",width:"100vw"},children:[g.jsx(V1,{}),g.jsx($I,{}),g.jsx(GI,{wantMicOn:n,setWantMicOn:e,wantCamOn:t,setWantCamOn:i,onEnd:a,showAudioUnlock:o&&!u,onUnlockAudio:f})]})}function JI(){const n=Qt(),e=T.useMemo(()=>FI(),[]),t="creator-live",[i]=T.useState(()=>VI("host")),[a,o]=T.useState(""),[c,u]=T.useState(""),[h,f]=T.useState("idle"),[p,y]=T.useState(""),[b,k]=T.useState(!0),[C,w]=T.useState(!0),O=T.useCallback(async()=>{f("loading"),y("");try{const P=await HI(t,i);u(P.token),o(P.url),f("live")}catch(P){y(P?.message||"Failed to go live"),f("error")}},[t,i]);return h==="live"&&!!c&&!!a?g.jsx(U1,{token:c,serverUrl:a,connect:!0,audio:!0,video:!0,children:g.jsx(KI,{wantMicOn:b,setWantMicOn:k,wantCamOn:C,setWantCamOn:w,onEnd:()=>n("/planet/creator"),mobile:e})}):g.jsxs("div",{children:[g.jsx("button",{onClick:O,children:"Go Live"}),p&&g.jsx("pre",{children:p})]})}function YI(){const n=tg([{source:Q.Source.Camera,withPlaceholder:!0},{source:Q.Source.ScreenShare,withPlaceholder:!0}],{onlySubscribed:!0});return g.jsx(H1,{tracks:n,style:{height:"70vh"},children:g.jsx(F1,{})})}function QI(){const n=eg(),[e,t]=T.useState("idle"),i=T.useCallback(async()=>{try{await n.startAudio(),t("ok")}catch(a){console.error("startAudio failed:",a),t("fail")}},[n]);return g.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",marginBottom:12},children:[g.jsx("button",{onClick:i,style:{height:44,padding:"0 16px",borderRadius:12,border:"1px solid rgba(255,255,255,0.18)",background:"white",fontWeight:900,cursor:"pointer"},children:"Start Audio"}),g.jsxs("div",{style:{fontSize:12,opacity:.8},children:[e==="idle"&&"Tap once to enable sound in this tab.",e==="ok"&&"Audio enabled ",e==="fail"&&"Audio blocked  (check browser/site sound + permissions)"]})]})}function XI(){const{room:n}=Yi(),[e,t]=T.useState(""),[i,a]=T.useState("");return T.useEffect(()=>{(async()=>{const o=String(n||"").trim();if(!o)return;const c=await fetch(`/api/livekit-token?room=${encodeURIComponent(o)}&role=viewer`,{method:"GET",headers:{Accept:"application/json"}});if(!c.ok)throw new Error(await c.text());const u=await c.json();if(!u.token||!u.url)throw new Error("Token response missing token/url");t(u.token),a(u.url)})().catch(o=>console.error(o))},[n]),n?!e||!i?g.jsx("div",{style:{padding:16},children:"Joining"}):g.jsxs("div",{style:{padding:16,background:"black",color:"white",minHeight:"100vh"},children:[g.jsxs("div",{style:{fontSize:18,fontWeight:900,marginBottom:10},children:["Live: ",n]}),g.jsxs(U1,{token:e,serverUrl:i,connect:!0,audio:!0,video:!1,style:{background:"black"},children:[g.jsx(V1,{}),g.jsx(QI,{}),g.jsx(YI,{})]}),g.jsx("div",{style:{marginTop:10,fontSize:12,opacity:.75},children:"If you still cant hear: make sure the HOST mic is not muted and your browser tab/site is not muted."})]}):g.jsx("div",{style:{padding:16},children:"Missing room."})}function ms({children:n}){const{user:e,loading:t}=$T(),i=Hn();return t?g.jsx("div",{style:{opacity:.7},children:"Checking session"}):e?g.jsx(g.Fragment,{children:n}):g.jsx(Sp,{to:"/login",replace:!0,state:{from:i.pathname}})}function ZI(n){if(!n||!/.||||||| /u.test(n))return n;try{const t=Uint8Array.from(n,a=>a.charCodeAt(0)&255);return new TextDecoder("utf-8",{fatal:!1}).decode(t)||n}catch{return n}}function kT(n){const e=new WeakMap,t=i=>{if(typeof i=="string")return ZI(i);if(i==null||typeof i!="object")return i;if(e.has(i))return e.get(i);if(Array.isArray(i)){const o=[];e.set(i,o);for(const c of i)o.push(t(c));return o}const a={};e.set(i,a);for(const[o,c]of Object.entries(i))a[o]=t(c);return a};return t(n)}function Ye(n){try{return String(n??"").trim()}catch{return""}}function sp(){try{return new Date().toISOString()}catch{return""}}async function op(n){try{return await navigator.clipboard.writeText(n),!0}catch{try{const e=document.createElement("textarea");return e.value=n,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e),!0}catch{return!1}}}function eL(n){const e=Ye(n.name)||"New customer",t=Ye(n.preferred_contact)||"Text",i=Ye(n.best_time),a=Ye(n.address),o=Ye(n.message),c=o?o.length>220?o.slice(0,217)+"":o:"Request details will appear here as you type",u=[];return u.push(`${e}  prefers ${t.toLowerCase()}`),i&&u.push(`best time: ${i.toLowerCase()}`),a&&u.push(`location: ${a}`),{title:e,request:c,meta:u.join("  ")}}async function tL(n,e=1280,t=1280,i=.82){if(!/^image\//i.test(n.type))throw new Error("Please choose an image file.");const o=URL.createObjectURL(n);try{const c=await new Promise((R,P)=>{const j=new Image;j.onload=()=>R(j),j.onerror=()=>P(new Error("Failed to load image.")),j.src=o}),u=c.naturalWidth||c.width,h=c.naturalHeight||c.height;let f=u,p=h;const y=e/Math.max(1,u),b=t/Math.max(1,h),k=Math.min(1,y,b);f=Math.max(1,Math.round(u*k)),p=Math.max(1,Math.round(h*k));const C=document.createElement("canvas");C.width=f,C.height=p;const w=C.getContext("2d");if(!w)throw new Error("Canvas not available.");return w.drawImage(c,0,0,f,p),C.toDataURL("image/jpeg",i)}finally{URL.revokeObjectURL(o)}}function nL(n){const e=n.indexOf(",");if(e<0)return n.length;const t=n.slice(e+1),i=t.endsWith("==")?2:t.endsWith("=")?1:0;return Math.max(0,Math.floor(t.length*3/4)-i)}function wT(){const n=Yi(),e=n?.slug||n?.id||"",[t,i]=T.useState(!0),[a,o]=T.useState(!1),[c,u]=T.useState(null),[h,f]=T.useState(null),[p,y]=T.useState({name:"",phone:"",email:"",preferred_contact:"Text",address:"",best_time:"",message:""}),[b,k]=T.useState(null),[C,w]=T.useState(null),[O,R]=T.useState(null),[P,j]=T.useState(null),[E,_]=T.useState(null),[A,I]=T.useState(null),F=T.useMemo(()=>String(e||"").trim().replace(/^c\//i,"").replace(/^\/+/,"").replace(/\/+$/,"").toLowerCase(),[e]);T.useEffect(()=>{let le=!0;async function N(){if(i(!0),u(null),R(null),j(null),_(null),I(null),!F){i(!1),u("Missing public page identifier (slug).");return}const{data:K,error:ae}=await je.from("public_pages").select("id, slug").eq("slug",F).maybeSingle();if(!le)return;if(ae){i(!1),u(ae.message||"Failed to load public page.");return}if(!K){i(!1),u("Public page not found.");return}const pe=kT(K);f(pe),i(!1)}return N(),()=>{le=!1}},[F]);const B=(le,N)=>{y(K=>({...K,[le]:N}))},z=()=>{const le={name:Ye(p.name),phone:Ye(p.phone),email:Ye(p.email),preferred_contact:Ye(p.preferred_contact),address:Ye(p.address),best_time:Ye(p.best_time),message:Ye(p.message),client_ts:sp(),source:"qr_public"};return b&&(le.photo={name:C||"upload.jpg",mime:"image/jpeg",data_url:b}),kT(le)},H=T.useMemo(()=>{const le=Ye(p.name),N=Ye(p.phone),K=Ye(p.email),ae=Ye(p.message);return!!le||!!N||!!K||!!ae},[p]),ie=T.useMemo(()=>eL(p),[p]),he=async()=>{if(!h||a)return;o(!0),u(null),R(null),j(null),_(null),I(null);const le=z();if(!(!!Ye(le.name)||!!Ye(le.phone)||!!Ye(le.email)||!!Ye(le.message))){o(!1),u("Add at least a name/phone/email or a short message, then submit.");return}const K={slug:h.slug,payload:le};try{const ae=globalThis?.crypto?.randomUUID?.()||`rcpt_${Date.now()}_${Math.random().toString(16).slice(2)}`,pe={...K,receipt_id:ae},{error:ye}=await je.from("public_intake_submissions").insert(pe);if(ye)throw ye;j(String(ae));try{window.localStorage.setItem("last_receipt_id",String(ae))}catch{}I(sp());try{_(JSON.stringify(le,null,2))}catch{_(null)}o(!1),R("Request logged.");return}catch(ae){try{const{error:pe}=await je.from("public_intake_submissions").insert(K);if(pe)throw pe;const ye=globalThis?.crypto?.randomUUID?.()||`rcpt_${Date.now()}_${Math.random().toString(16).slice(2)}`;j(String(ye));try{window.localStorage.setItem("last_receipt_id",String(ye))}catch{}I(sp());try{_(JSON.stringify(le,null,2))}catch{_(null)}o(!1),R("Request logged.");return}catch(pe){o(!1),u(pe?.message||ae?.message||"Failed to submit intake.")}}},Z={page:{minHeight:"100vh",background:"#0b0f17",padding:14,display:"flex",justifyContent:"center"},shell:{width:"100%",maxWidth:520},topBar:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:10,marginBottom:12},brand:{display:"flex",alignItems:"center",gap:10},badge:{width:36,height:36,borderRadius:12,background:"linear-gradient(135deg,#3b82f6,#22c55e)",boxShadow:"0 10px 30px rgba(0,0,0,0.35)"},brandText:{color:"#e8eefc",fontWeight:900,fontSize:14,lineHeight:1.1},brandSub:{color:"#b7c2da",fontWeight:700,fontSize:12,opacity:.9},card:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.10)",borderRadius:18,padding:14,boxShadow:"0 18px 40px rgba(0,0,0,0.35)",backdropFilter:"blur(8px)"},hero:{borderRadius:18,overflow:"hidden",border:"1px solid rgba(255,255,255,0.12)",background:"linear-gradient(135deg, rgba(59,130,246,0.18), rgba(34,197,94,0.14))",marginBottom:12},heroInner:{padding:14,minHeight:150,display:"flex",flexDirection:"column",justifyContent:"flex-end",gap:8,position:"relative"},heroTitle:{color:"#e8eefc",fontSize:20,fontWeight:950,lineHeight:1.15,letterSpacing:-.2},heroText:{color:"#b7c2da",fontSize:13,fontWeight:700,lineHeight:1.35},pillRow:{display:"flex",flexWrap:"wrap",gap:8,marginTop:8},pill:{padding:"7px 10px",borderRadius:999,border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.05)",color:"#e8eefc",fontWeight:900,fontSize:12},trust:{marginBottom:12},trustItem:{display:"flex",gap:10,alignItems:"flex-start",color:"#dbe7ff",fontSize:13,fontWeight:750,lineHeight:1.35,opacity:.95,marginTop:8},dot:{width:10,height:10,marginTop:4,borderRadius:999,background:"#22c55e",boxShadow:"0 0 0 3px rgba(34,197,94,0.15)",flex:"0 0 auto"},label:{color:"#c7d2ea",fontSize:12,fontWeight:900,letterSpacing:.2,marginBottom:6},input:{width:"100%",padding:"12px 12px",borderRadius:14,border:"1px solid rgba(255,255,255,0.14)",background:"rgba(0,0,0,0.18)",color:"#e8eefc",fontSize:14,outline:"none"},textarea:{width:"100%",padding:"12px 12px",borderRadius:14,border:"1px solid rgba(255,255,255,0.14)",background:"rgba(0,0,0,0.18)",color:"#e8eefc",fontSize:14,outline:"none",resize:"vertical",fontFamily:"ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial"},grid:{display:"grid",gridTemplateColumns:"1fr",gap:12},chips:{display:"flex",gap:8,flexWrap:"wrap"},chip:le=>({padding:"10px 12px",borderRadius:999,border:"1px solid rgba(255,255,255,0.14)",background:le?"rgba(59,130,246,0.25)":"rgba(255,255,255,0.05)",color:"#e8eefc",fontWeight:950,fontSize:12,cursor:"pointer",userSelect:"none"}),cta:{width:"100%",padding:"14px 14px",borderRadius:16,border:"1px solid rgba(255,255,255,0.16)",background:"linear-gradient(135deg, rgba(59,130,246,0.90), rgba(34,197,94,0.85))",color:"#071019",fontWeight:950,fontSize:15,cursor:"pointer",boxShadow:"0 18px 40px rgba(0,0,0,0.35)"},ctaDisabled:{opacity:.6,cursor:"not-allowed"},bannerOk:{marginTop:10,padding:"10px 12px",borderRadius:14,border:"1px solid rgba(34,197,94,0.35)",background:"rgba(34,197,94,0.12)",color:"#d8ffe6",fontWeight:900,fontSize:13},bannerErr:{marginTop:10,padding:"10px 12px",borderRadius:14,border:"1px solid rgba(176,0,32,0.45)",background:"rgba(176,0,32,0.12)",color:"#ffd2da",fontWeight:900,fontSize:13},receiptCard:{marginTop:12,borderRadius:18},mono:{fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace",fontSize:12,color:"#e8eefc",opacity:.95,wordBreak:"break-all"},row:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center",marginTop:10},smallBtn:{padding:"10px 12px",borderRadius:14,border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.06)",color:"#e8eefc",fontWeight:950,fontSize:12,cursor:"pointer"},footer:{marginTop:14,color:"#b7c2da",fontSize:11,fontWeight:800,opacity:.8,textAlign:"center"},uploadBox:{borderRadius:16,border:"1px dashed rgba(255,255,255,0.20)",background:"rgba(255,255,255,0.04)",padding:12},uploadRow:{display:"flex",gap:10,alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},uploadBtn:{padding:"10px 12px",borderRadius:14,border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.06)",color:"#e8eefc",fontWeight:950,fontSize:12,cursor:"pointer"},uploadHint:{color:"#b7c2da",fontSize:12,fontWeight:800,opacity:.9,lineHeight:1.35},thumb:{width:86,height:64,borderRadius:12,border:"1px solid rgba(255,255,255,0.12)",objectFit:"cover",background:"rgba(0,0,0,0.18)"}};return t?g.jsx("div",{style:Z.page,children:g.jsx("div",{style:Z.shell,children:g.jsx("div",{style:{color:"#e8eefc",fontWeight:900,fontSize:14,padding:10},children:"Loading"})})}):c?g.jsx("div",{style:Z.page,children:g.jsxs("div",{style:Z.shell,children:[g.jsx("div",{style:Z.topBar,children:g.jsxs("div",{style:Z.brand,children:[g.jsx("div",{style:Z.badge}),g.jsxs("div",{children:[g.jsx("div",{style:Z.brandText,children:"HomePlanet"}),g.jsx("div",{style:Z.brandSub,children:"Public Intake"})]})]})}),g.jsxs("div",{style:{...Z.card,padding:14},children:[g.jsx("div",{style:{color:"#e8eefc",fontWeight:950,fontSize:16,marginBottom:8},children:"Public Intake"}),g.jsx("div",{style:{color:"#ffd2da",fontWeight:900},children:c})]})]})}):g.jsx("div",{style:Z.page,children:g.jsxs("div",{style:Z.shell,children:[g.jsxs("div",{style:Z.topBar,children:[g.jsxs("div",{style:Z.brand,children:[g.jsx("div",{style:Z.badge}),g.jsxs("div",{children:[g.jsx("div",{style:Z.brandText,children:"HomePlanet"}),g.jsxs("div",{style:Z.brandSub,children:["Public Intake  ",h?.slug]})]})]}),g.jsx("div",{style:{...Z.pill,opacity:.9},children:"Receipt-ready"})]}),g.jsx("div",{style:Z.hero,children:g.jsxs("div",{style:Z.heroInner,children:[g.jsx("div",{style:Z.heroTitle,children:"Request logged. Proof-ready."}),g.jsx("div",{style:Z.heroText,children:"Submit your request in under a minute. Youll get a receipt ID you can reference anytime."}),g.jsxs("div",{style:Z.pillRow,children:[g.jsx("div",{style:Z.pill,children:"Instant receipt"}),g.jsx("div",{style:Z.pill,children:"Timestamped"}),g.jsx("div",{style:Z.pill,children:"Verified intake"})]})]})}),g.jsxs("div",{style:{...Z.card,...Z.trust},children:[g.jsx("div",{style:{color:"#e8eefc",fontWeight:950,fontSize:14},children:"What happens next"}),g.jsxs("div",{style:Z.trustItem,children:[g.jsx("div",{style:Z.dot}),g.jsx("div",{children:"Your request is saved immediately with a receipt ID."})]}),g.jsxs("div",{style:Z.trustItem,children:[g.jsx("div",{style:Z.dot}),g.jsx("div",{children:"A reviewer can see it the moment it lands."})]}),g.jsxs("div",{style:Z.trustItem,children:[g.jsx("div",{style:Z.dot}),g.jsx("div",{children:"No lost texts. No we never got it. Everything is logged."})]})]}),g.jsxs("div",{style:Z.card,children:[g.jsx("div",{style:{color:"#e8eefc",fontWeight:950,fontSize:16,marginBottom:10},children:"One-Page Intake"}),g.jsxs("div",{style:{borderRadius:16,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(0,0,0,0.22)",padding:12,marginBottom:12},children:[g.jsx("div",{style:{color:"#b7c2da",fontWeight:900,fontSize:12,marginBottom:6},children:"Live preview"}),g.jsx("div",{style:{color:"#e8eefc",fontWeight:950,fontSize:14},children:ie.title}),g.jsx("div",{style:{color:"#b7c2ea",fontWeight:900,fontSize:12,marginTop:10},children:"Preview request description"}),g.jsx("div",{style:{color:"#c7d2ea",fontWeight:800,fontSize:13,marginTop:6,lineHeight:1.35},children:ie.request}),g.jsx("div",{style:{color:"#b7c2da",fontWeight:900,fontSize:12,marginTop:10},children:ie.meta})]}),g.jsxs("div",{style:Z.grid,children:[g.jsxs("div",{children:[g.jsx("div",{style:Z.label,children:"Full name"}),g.jsx("input",{value:p.name,onChange:le=>B("name",le.target.value),placeholder:"Customer name",style:Z.input})]}),g.jsxs("div",{children:[g.jsx("div",{style:Z.label,children:"Phone"}),g.jsx("input",{value:p.phone,onChange:le=>B("phone",le.target.value),placeholder:"(555) 555-5555",style:Z.input})]}),g.jsxs("div",{children:[g.jsx("div",{style:Z.label,children:"Email"}),g.jsx("input",{value:p.email,onChange:le=>B("email",le.target.value),placeholder:"email@example.com",style:Z.input})]}),g.jsxs("div",{children:[g.jsx("div",{style:Z.label,children:"Preferred contact"}),g.jsx("div",{style:Z.chips,children:["Text","Call","Email"].map(le=>{const N=Ye(p.preferred_contact).toLowerCase()===le.toLowerCase();return g.jsx("div",{onClick:()=>B("preferred_contact",le),style:Z.chip(N),role:"button","aria-label":`Preferred contact ${le}`,children:le},le)})})]}),g.jsxs("div",{children:[g.jsx("div",{style:Z.label,children:"Address (optional)"}),g.jsx("input",{value:p.address,onChange:le=>B("address",le.target.value),placeholder:"City, State",style:Z.input})]}),g.jsxs("div",{children:[g.jsx("div",{style:Z.label,children:"Best time"}),g.jsxs("select",{value:p.best_time,onChange:le=>B("best_time",le.target.value),style:Z.input,children:[g.jsx("option",{value:"",children:"Choose time"}),g.jsx("option",{value:"Morning",children:"Morning"}),g.jsx("option",{value:"Afternoon",children:"Afternoon"}),g.jsx("option",{value:"Evening",children:"Evening"}),g.jsx("option",{value:"Anytime",children:"Anytime"})]})]}),g.jsxs("div",{children:[g.jsx("div",{style:Z.label,children:"What do you need help with?"}),g.jsx("textarea",{value:p.message,onChange:le=>B("message",le.target.value),rows:6,placeholder:"Describe the issue / request",style:Z.textarea})]}),g.jsxs("div",{children:[g.jsx("div",{style:Z.label,children:"Upload a photo (optional)"}),g.jsx("div",{style:Z.uploadBox,children:g.jsxs("div",{style:Z.uploadRow,children:[g.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[b?g.jsx("img",{src:b,alt:"Upload preview",style:Z.thumb}):null,g.jsxs("div",{style:Z.uploadHint,children:["Add a photo of the issue.",g.jsx("br",{}),"(Kept compact for proof + speed.)"]})]}),g.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[g.jsxs("label",{style:Z.uploadBtn,children:["Upload",g.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:async le=>{const N=le.target.files?.[0];if(N){u(null);try{const K=await tL(N,1280,1280,.82);if(nL(K)>65e4)throw new Error("Image too large. Try a smaller photo.");w(N.name),k(K)}catch(K){w(null),k(null),u(K?.message||"Failed to attach photo.")}finally{le.target.value=""}}}})]}),b?g.jsx("button",{type:"button",style:Z.uploadBtn,onClick:()=>{w(null),k(null)},children:"Remove"}):null]})]})})]}),g.jsx("button",{onClick:he,disabled:a||!H,style:{...Z.cta,...a||!H?Z.ctaDisabled:{}},children:a?"Submitting":"Confirm & Get Receipt"}),O?g.jsx("div",{style:Z.bannerOk,children:O}):null,c?g.jsx("div",{style:Z.bannerErr,children:c}):null]})]}),P?g.jsxs("div",{style:{...Z.card,...Z.receiptCard},children:[g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:10,flexWrap:"wrap"},children:[g.jsxs("div",{children:[g.jsx("div",{style:{color:"#e8eefc",fontWeight:950,fontSize:14},children:"Receipt"}),g.jsxs("div",{style:{color:"#b7c2da",fontWeight:900,fontSize:12,marginTop:4},children:["Saved ",A?` ${A}`:""]})]}),g.jsx("div",{style:{...Z.pill,background:"rgba(34,197,94,0.18)",borderColor:"rgba(34,197,94,0.35)"},children:"Logged ?"})]}),g.jsxs("div",{style:{marginTop:10},children:[g.jsx("div",{style:{color:"#b7c2da",fontWeight:900,fontSize:12,marginBottom:6},children:"Receipt ID"}),g.jsx("div",{style:Z.mono,children:P})]}),g.jsxs("div",{style:Z.row,children:[g.jsx("button",{style:Z.smallBtn,onClick:async()=>{await op(P)&&alert("Receipt copied")},children:"Copy Receipt"}),g.jsx("button",{style:Z.smallBtn,onClick:async()=>{const le=`Receipt: ${P}
Slug: ${h?.slug}
Saved: ${A??""}
Name: ${Ye(p.name)}
Phone: ${Ye(p.phone)}
Email: ${Ye(p.email)}
Preferred: ${Ye(p.preferred_contact)}
Address: ${Ye(p.address)}
Best time: ${Ye(p.best_time)}
Message: ${Ye(p.message)}`+(C?`
Photo: ${C}`:"");await op(le)&&alert("Summary copied")},children:"Copy Summary"}),g.jsx("button",{style:Z.smallBtn,onClick:async()=>{const le=E||"";if(!le)return;await op(le)&&alert("JSON copied")},disabled:!E,children:"Copy JSON"})]})]}):null,g.jsx("div",{style:Z.footer,children:"Powered by HomePlanet  Presence-First Intake"})]})})}const iL={"taylor-creek":{slug:"taylor-creek",brandName:"Taylor Creek Auto Repair",locationLine:"Okeechobee, Florida",planetLabel:"Planet: Auto Services",tierLabel:"Gold Tier  Verified",phoneLabel:"(000) 000-0000",addressLabel:"Okeechobee, FL",accentRingClass:"focus-visible:ring-red-500/40",accentBorderClass:"border-red-500/20",accentTextClass:"text-red-200",accentBgClass:"bg-red-500/10"}};function rL(n){return n?iL[n]??null:null}function aL({theme:n}){return g.jsx("div",{className:"border-b border-slate-800 bg-slate-950/70 backdrop-blur",children:g.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-4 flex items-center justify-between gap-3",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"h-10 w-10 rounded-xl bg-slate-800 flex items-center justify-center font-bold",children:n.brandName.split(" ").slice(0,1).map(()=>"TC")}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"text-lg font-semibold leading-tight",children:n.brandName}),g.jsxs("span",{className:"hidden sm:inline-flex items-center rounded-full border border-slate-700 bg-slate-950/40 px-2.5 py-1 text-[11px] text-slate-300",children:[" ",n.planetLabel]})]}),g.jsx("div",{className:"text-xs text-slate-400 leading-tight",children:n.locationLine})]})]}),n.tierLabel?g.jsxs("div",{className:"hidden sm:flex items-center gap-2 rounded-full border border-amber-400/60 bg-amber-400/10 px-3 py-1",children:[g.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-amber-300"}),g.jsx("span",{className:"text-xs font-medium text-amber-200",children:n.tierLabel})]}):null]})})}function sL({theme:n,children:e,rightRail:t}){return g.jsxs("div",{className:"min-h-screen bg-slate-950 text-slate-100",children:[g.jsx(aL,{theme:n}),g.jsx("div",{className:"mx-auto max-w-6xl px-4 py-10",children:g.jsx("div",{className:"rounded-3xl border border-slate-800 bg-slate-900/40 p-6 md:p-10 shadow",children:g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1fr_360px] gap-8",children:[g.jsx("div",{children:e}),g.jsx("div",{className:"space-y-4",children:t})]})})})]})}function oL(){const{slug:n}=Yi(),e=rL(n);return e?g.jsx(sL,{theme:e,rightRail:g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-950/40 p-5",children:[g.jsx("div",{className:"text-sm font-semibold",children:"Contact"}),g.jsxs("div",{className:"mt-2 text-sm text-slate-300 space-y-1",children:[g.jsxs("div",{children:["Phone: ",g.jsx("span",{className:"text-slate-200",children:e.phoneLabel??""})]}),g.jsxs("div",{children:["Address: ",g.jsx("span",{className:"text-slate-200",children:e.addressLabel??""})]})]}),g.jsx("div",{className:"mt-3 text-xs text-slate-500",children:"Uploads + notes become a clean, time-ordered intake trail you can reference later."})]}),g.jsxs("div",{className:`rounded-2xl border ${e.accentBorderClass} ${e.accentBgClass} p-4`,children:[g.jsx("div",{className:"text-sm font-semibold text-amber-200",children:"Proof-ready workflow"}),g.jsx("div",{className:"mt-1 text-xs text-amber-100/90",children:"Time-ordered record. Cleaner approvals. Fewer disputes."})]})]}),children:g.jsx(wT,{})}):g.jsx(wT,{})}function lL(n){try{return String(n??"").trim()}catch{return""}}function cL(){const e=Yi()?.receipt||"",t=T.useMemo(()=>lL(e),[e]),[i,a]=T.useState(!0),[o,c]=T.useState(null),[u,h]=T.useState(null);T.useEffect(()=>{let C=!0;async function w(){if(a(!0),c(null),h(null),!t){a(!1),c("Missing receipt ID.");return}const{data:O,error:R}=await je.rpc("get_intake_receipt",{receipt:t});if(C){if(R){a(!1),c(R.message||"Receipt lookup failed.");return}if(!O){a(!1),c("Receipt not found.");return}h(O),a(!1)}}return w(),()=>{C=!1}},[t]);const f=u?.receipt_id||u?.id||t,p=u?.created_at||"",y=u?.slug||"",b=u?.payload||{},k=[`Receipt: ${f}`,y?`Slug: ${y}`:"",p?`Saved: ${p}`:"",b?.name?`Name: ${b.name}`:"",b?.phone?`Phone: ${b.phone}`:"",b?.email?`Email: ${b.email}`:"",b?.preferred_contact?`Preferred: ${b.preferred_contact}`:"",b?.address?`Address: ${b.address}`:"",b?.best_time?`Best time: ${b.best_time}`:"",b?.message?`Message: ${b.message}`:""].filter(Boolean).join(`
`);return g.jsx("div",{style:{minHeight:"100vh",background:"#0b0f17",padding:14},children:g.jsxs("div",{style:{maxWidth:560,margin:"0 auto"},children:[g.jsx("div",{style:{color:"#e8eefc",fontWeight:900,fontSize:18},children:"Receipt  Proof-ready"}),g.jsx("div",{style:{marginTop:12,background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.10)",borderRadius:18,padding:14},children:i?g.jsx("div",{style:{color:"#e8eefc"},children:"Loading receipt"}):o?g.jsx("div",{style:{color:"#ffd2da",fontWeight:900},children:o}):g.jsxs(g.Fragment,{children:[g.jsx("div",{style:{color:"#e8eefc",fontWeight:900},children:"Receipt ID"}),g.jsx("pre",{style:{marginTop:6,color:"#c7d2ea",fontSize:12,whiteSpace:"pre-wrap"},children:f}),g.jsxs("div",{style:{marginTop:12},children:[g.jsx("button",{onClick:async()=>{await navigator.clipboard.writeText(f),alert("Receipt copied")},children:"Copy Receipt"}),g.jsx("button",{onClick:async()=>{await navigator.clipboard.writeText(k),alert("Summary copied")},style:{marginLeft:8},children:"Copy Summary"}),g.jsx("button",{onClick:async()=>{await navigator.clipboard.writeText(JSON.stringify(b,null,2)),alert("JSON copied")},style:{marginLeft:8},children:"Copy JSON"})]})]})})]})})}function xr(n){try{return String(n??"").trim()}catch{return""}}function uL(n){const e=Number(String(n??"").replace(/[^0-9.]/g,""));return!isFinite(e)||e<=0?"$0.00":e.toLocaleString(void 0,{style:"currency",currency:"USD"})}function dL(){try{return new Date().toISOString()}catch{return""}}function hL(n){const e=(crypto?.randomUUID?.()??Math.random().toString(16).slice(2)).replace(/-/g,"");return`${n}-${e.slice(0,10).toUpperCase()}`}function fL(){const{receipt:n}=Yi(),[e]=uk(),t=e.get("cap")||"250",i=T.useMemo(()=>uL(t),[t]),[a,o]=T.useState(!0),[c,u]=T.useState(!1),[h,f]=T.useState(null),[p,y]=T.useState(null),[b,k]=T.useState(null),[C,w]=T.useState(null),[O,R]=T.useState(null),P=T.useMemo(()=>xr(n),[n]);T.useEffect(()=>{let ie=!0;async function he(){if(o(!0),f(null),k(null),!P){o(!1),f("Missing receipt.");return}const{data:Z,error:le}=await je.from("public_intake_submissions").select("id, receipt_id, slug, created_at, payload").or(`receipt_id.eq.${P},id.eq.${P}`).limit(1).maybeSingle();if(ie){if(le){o(!1),f(le.message||"Failed to load intake.");return}if(!Z){o(!1),f("Intake not found for this receipt.");return}y(Z),o(!1)}}return he(),()=>{ie=!1}},[P]);const j={page:{minHeight:"100vh",background:"#0b0f17",padding:14,display:"flex",justifyContent:"center"},shell:{width:"100%",maxWidth:520},topBar:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:10,marginBottom:12},brand:{display:"flex",alignItems:"center",gap:10},badge:{width:36,height:36,borderRadius:12,background:"linear-gradient(135deg,#3b82f6,#22c55e)",boxShadow:"0 10px 30px rgba(0,0,0,0.35)"},brandText:{color:"#e8eefc",fontWeight:900,fontSize:14,lineHeight:1.1},brandSub:{color:"#b7c2da",fontWeight:700,fontSize:12,opacity:.9},pill:{padding:"7px 10px",borderRadius:999,border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.05)",color:"#e8eefc",fontWeight:900,fontSize:12},hero:{borderRadius:18,overflow:"hidden",border:"1px solid rgba(255,255,255,0.12)",background:"linear-gradient(135deg, rgba(59,130,246,0.18), rgba(34,197,94,0.14))",marginBottom:12},heroInner:{padding:14,display:"flex",flexDirection:"column",gap:8},heroTitle:{color:"#e8eefc",fontSize:20,fontWeight:950,lineHeight:1.15},heroText:{color:"#b7c2da",fontSize:13,fontWeight:700,lineHeight:1.35},card:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.10)",borderRadius:18,padding:14,boxShadow:"0 18px 40px rgba(0,0,0,0.35)",backdropFilter:"blur(8px)",marginBottom:12},label:{color:"#b7c2da",fontWeight:900,fontSize:12,marginBottom:6},mono:{fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace",fontSize:12,color:"#e8eefc",opacity:.95,wordBreak:"break-all"},bigMoney:{color:"#e8eefc",fontWeight:950,fontSize:26,letterSpacing:-.3},trustItem:{display:"flex",gap:10,alignItems:"flex-start",color:"#dbe7ff",fontSize:13,fontWeight:750,lineHeight:1.35,opacity:.95,marginTop:8},dot:{width:10,height:10,marginTop:4,borderRadius:999,background:"#22c55e",boxShadow:"0 0 0 3px rgba(34,197,94,0.15)",flex:"0 0 auto"},cta:{width:"100%",padding:"14px 14px",borderRadius:16,border:"1px solid rgba(255,255,255,0.16)",background:"linear-gradient(135deg, rgba(59,130,246,0.90), rgba(34,197,94,0.85))",color:"#071019",fontWeight:950,fontSize:15,cursor:"pointer",boxShadow:"0 18px 40px rgba(0,0,0,0.35)"},btn:{width:"100%",padding:"12px 14px",borderRadius:16,border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.06)",color:"#e8eefc",fontWeight:950,fontSize:13,cursor:"pointer",marginTop:10},bannerOk:{marginTop:10,padding:"10px 12px",borderRadius:14,border:"1px solid rgba(34,197,94,0.35)",background:"rgba(34,197,94,0.12)",color:"#d8ffe6",fontWeight:900,fontSize:13},bannerErr:{marginTop:10,padding:"10px 12px",borderRadius:14,border:"1px solid rgba(176,0,32,0.45)",background:"rgba(176,0,32,0.12)",color:"#ffd2da",fontWeight:900,fontSize:13},footer:{marginTop:14,color:"#b7c2da",fontSize:11,fontWeight:800,opacity:.8,textAlign:"center"}},E=p?.payload||{},_=xr(E?.name)||"Customer",A=xr(E?.phone),I=xr(E?.email),F=xr(E?.message)||"(no message)",B=xr(p?.slug),z=xr(p?.receipt_id)||xr(p?.id),H=async()=>{if(!z||!B)return;u(!0),f(null),k(null);const ie=hL("HP-AUTH"),he=dL(),Z={auth_receipt:ie,intakeReceipt:z,slug:B,amount_cap:Number(String(t).replace(/[^0-9.]/g,""))||0,created_at_client:he,payload_snapshot:E},{error:le}=await je.from("payment_authorizations").insert(Z);if(le){u(!1),f(le.message||"Failed to record authorization.");return}u(!1),w(ie),R(he),k("Authorization recorded.")};return a?g.jsx("div",{style:j.page,children:g.jsx("div",{style:j.shell,children:g.jsx("div",{style:{color:"#e8eefc",fontWeight:900,fontSize:14,padding:10},children:"Loading"})})}):h&&!p?g.jsx("div",{style:j.page,children:g.jsxs("div",{style:j.shell,children:[g.jsxs("div",{style:j.topBar,children:[g.jsxs("div",{style:j.brand,children:[g.jsx("div",{style:j.badge}),g.jsxs("div",{children:[g.jsx("div",{style:j.brandText,children:"HomePlanet"}),g.jsx("div",{style:j.brandSub,children:"Authorization"})]})]}),g.jsx("div",{style:j.pill,children:"Proof-ready"})]}),g.jsxs("div",{style:j.card,children:[g.jsx("div",{style:{color:"#e8eefc",fontWeight:950,fontSize:16,marginBottom:8},children:"Authorization"}),g.jsx("div",{style:{color:"#ffd2da",fontWeight:900},children:h})]})]})}):g.jsx("div",{style:j.page,children:g.jsxs("div",{style:j.shell,children:[g.jsxs("div",{style:j.topBar,children:[g.jsxs("div",{style:j.brand,children:[g.jsx("div",{style:j.badge}),g.jsxs("div",{children:[g.jsx("div",{style:j.brandText,children:"HomePlanet"}),g.jsxs("div",{style:j.brandSub,children:["Authorization  ",B||"business"]})]})]}),g.jsx("div",{style:j.pill,children:"Receipt-linked"})]}),g.jsx("div",{style:j.hero,children:g.jsxs("div",{style:j.heroInner,children:[g.jsx("div",{style:j.heroTitle,children:"Authorize service. Proof logged."}),g.jsx("div",{style:j.heroText,children:"Youre approving a maximum amount  not a charge yet. Every change is timestamped."})]})}),g.jsxs("div",{style:j.card,children:[g.jsx("div",{style:{color:"#e8eefc",fontWeight:950,fontSize:16,marginBottom:10},children:"Service Summary"}),g.jsx("div",{style:j.label,children:"Intake Receipt"}),g.jsx("div",{style:j.mono,children:z}),g.jsxs("div",{style:{marginTop:10},children:[g.jsx("div",{style:j.label,children:"Customer"}),g.jsx("div",{style:{color:"#e8eefc",fontWeight:900},children:_}),g.jsxs("div",{style:{color:"#b7c2da",fontWeight:800,fontSize:12,marginTop:4},children:[A||"",A&&I?"  ":"",I||""]})]}),g.jsxs("div",{style:{marginTop:10},children:[g.jsx("div",{style:j.label,children:"Request"}),g.jsx("div",{style:{color:"#c7d2ea",fontWeight:800,fontSize:13,lineHeight:1.35},children:F})]})]}),g.jsxs("div",{style:j.card,children:[g.jsx("div",{style:{color:"#e8eefc",fontWeight:950,fontSize:16,marginBottom:10},children:"Authorization Cap"}),g.jsx("div",{style:j.bigMoney,children:i}),g.jsx("div",{style:{color:"#b7c2da",fontWeight:800,fontSize:12,marginTop:6,lineHeight:1.35},children:"This is the maximum amount the business may charge without additional approval."}),g.jsxs("div",{style:{marginTop:12},children:[g.jsxs("div",{style:j.trustItem,children:[g.jsx("div",{style:j.dot}),g.jsx("div",{children:"Receipt-backed and timestamped."})]}),g.jsxs("div",{style:j.trustItem,children:[g.jsx("div",{style:j.dot}),g.jsx("div",{children:"No surprise charges  capture happens later."})]}),g.jsxs("div",{style:j.trustItem,children:[g.jsx("div",{style:j.dot}),g.jsx("div",{children:"Change requests create a new proof record."})]})]}),g.jsx("button",{onClick:H,disabled:c,style:{...j.cta,opacity:c?.7:1},children:c?"Recording":`Authorize Up To ${i}`}),g.jsx("button",{onClick:()=>alert("Request different amount  coming next."),disabled:c,style:j.btn,children:"Request Different Amount"}),b?g.jsxs("div",{style:j.bannerOk,children:[b,C?g.jsxs("div",{style:{marginTop:8},children:[g.jsx("div",{style:{fontWeight:950},children:"Authorization Receipt"}),g.jsx("div",{style:{...j.mono,marginTop:4},children:C}),g.jsxs("div",{style:{color:"#b7c2da",fontWeight:800,fontSize:12,marginTop:6},children:["Linked intake: ",z,O?`  ${O}`:""]})]}):null]}):null,h?g.jsx("div",{style:j.bannerErr,children:h}):null]}),g.jsx("div",{style:j.footer,children:"Powered by HomePlanet  Presence-First Authorization"})]})})}function pL(){return g.jsxs("div",{style:{padding:24},children:[g.jsx("h1",{style:{margin:0,fontSize:22},children:"HomePlanet Dashboard"}),g.jsx("p",{style:{opacity:.8,marginTop:10},children:"Dashboard temporarily disabled while we ship Intake. Build is unblocked."})]})}function mL(){const n=Qt(),[e,t]=T.useState("creator"),i=[{key:"creator",title:"Creator Planet",status:"Live",desc:"Build, publish, intake, proof, and monetize  receipts by default.",cities:[{label:"Studio City",to:"/planet/creator/studio",live:!0},{label:"Build City",to:"/planet/creator/build",live:!0},{label:"Live City",to:"/planet/creator/live",live:!1}]},{key:"vehicles",title:"Vehicles Planet",status:"Coming online",desc:"Intake ? service ? disputes, with receipts + presence.",cities:[{label:"Intake City",to:"/planet/vehicles/intake",live:!1},{label:"Service City",to:"/planet/vehicles/service",live:!1}]},{key:"education",title:"Education Planet",status:"Coming online",desc:"Presence-first timestamped classrooms with dispute-free submissions.",cities:[{label:"Classroom City",to:"/planet/education/classroom",live:!1},{label:"Admin Review City",to:"/planet/education/admin",live:!1}]}],a={minHeight:"100vh",padding:"40px 22px 60px",display:"flex",justifyContent:"center",background:"radial-gradient(900px 480px at 50% 0%, rgba(130,160,255,0.18), rgba(0,0,0,0) 60%), #070707",color:"rgba(255,255,255,0.92)"},o={width:"min(1100px, 100%)"},c={border:"1px solid rgba(255,255,255,0.10)",borderRadius:18,padding:22,background:"rgba(255,255,255,0.03)",boxShadow:"0 0 60px rgba(120,140,255,0.08), inset 0 0 0 1px rgba(255,255,255,0.04)"},u={fontSize:18,fontWeight:900,letterSpacing:.3,margin:0},h={marginTop:8,opacity:.78,lineHeight:1.55,fontSize:13.5,maxWidth:860},f={marginTop:14,display:"flex",flexWrap:"wrap",gap:10},p={fontSize:12,fontWeight:800,padding:"8px 10px",borderRadius:999,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(0,0,0,0.20)",color:"rgba(255,255,255,0.86)"},y={marginTop:22,display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:14},b={border:"1px solid rgba(255,255,255,0.10)",borderRadius:26,background:"rgba(255,255,255,0.02)",padding:16,cursor:"pointer"},k={display:"flex",alignItems:"baseline",justifyContent:"space-between",gap:10},C={fontWeight:900,fontSize:14,margin:0},w={fontSize:11,fontWeight:900,opacity:.85,padding:"4px 8px",borderRadius:999,border:"1px solid rgba(255,255,255,0.14)",background:"rgba(0,0,0,0.25)",whiteSpace:"nowrap"},O={marginTop:8,opacity:.75,fontSize:12.5,lineHeight:1.5},R={marginTop:12,display:"flex",flexDirection:"column",gap:8},P={display:"flex",alignItems:"center",justifyContent:"space-between",gap:10,padding:"10px 10px",borderRadius:12,border:"1px solid rgba(255,255,255,0.10)",background:"rgba(0,0,0,0.18)",color:"rgba(255,255,255,0.90)",cursor:"pointer",fontWeight:900,fontSize:12.5},j={marginTop:18,display:"flex",justifyContent:"space-between",alignItems:"center",gap:12,opacity:.7,fontSize:12},E={padding:"8px 10px",borderRadius:12,border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.04)",color:"rgba(255,255,255,0.92)",cursor:"pointer",fontWeight:900,fontSize:12};return g.jsxs("div",{style:a,children:[g.jsxs("div",{style:o,children:[g.jsxs("div",{style:c,children:[g.jsxs("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between",gap:12},children:[g.jsxs("div",{children:[g.jsx("h1",{style:u,children:"HOMEPLANET CORE"}),g.jsx("div",{style:h,children:"Presence-first proof at inception. Receipts for meaningful actions. Orbits are shared systems that wrap every planet."})]}),g.jsx("button",{type:"button",style:E,onClick:()=>n("/planet/creator/studio"),title:"Enter Creator Studio",children:"Enter Creator Studio ?"})]}),g.jsxs("div",{style:f,children:[g.jsx("div",{style:p,children:"Star = Core doctrine + shared rules"}),g.jsx("div",{style:p,children:"Planets = vertical worlds"}),g.jsx("div",{style:p,children:"Cities = workflows inside planets"}),g.jsx("div",{style:p,children:"Orbits = shared systems around everything"})]})]}),g.jsx("div",{style:y,children:i.map(_=>{const A=e===_.key;return g.jsxs("div",{style:{...b,background:A?"rgba(255,255,255,0.035)":b.background},onClick:()=>t(A?null:_.key),children:[g.jsxs("div",{style:k,children:[g.jsx("div",{style:C,children:_.title}),g.jsx("div",{style:w,children:_.status??"Coming online"})]}),g.jsx("div",{style:O,children:_.desc}),A&&_.cities&&g.jsx("div",{style:R,children:_.cities.map(I=>g.jsxs("button",{type:"button",style:{...P,opacity:I.live?1:.55},onClick:F=>{F.stopPropagation(),I.live&&n(I.to)},title:I.live?"Open":"Coming online",children:[g.jsx("span",{children:I.label}),g.jsx("span",{style:{opacity:.7,fontWeight:900},children:I.live?"Open ?":"Coming online"})]},I.label))}),!A&&g.jsx("div",{style:{marginTop:12,opacity:.55,fontSize:12},children:"Click to reveal cities"})]},_.key)})}),g.jsxs("div",{style:j,children:[g.jsx("div",{children:"Slow, efficient, planetary. Definitions first. Expand only what you need."}),g.jsx("button",{type:"button",style:E,onClick:()=>n("/explorer"),title:"Open Explorer",children:"Open Explorer ?"})]}),g.jsx("style",{children:`
          @media (max-width: 980px) {
            .hpGridFix { grid-template-columns: 1fr !important; }
          }
        `})]}),g.jsx("script",{})]})}function im({status:n}){const e={Live:"bg-emerald-500/15 border-emerald-400 text-emerald-300",Structured:"bg-yellow-500/15 border-yellow-400 text-yellow-300","Concept Locked":"bg-sky-500/15 border-sky-400 text-sky-300",Prototype:"bg-purple-500/15 border-purple-400 text-purple-300","Pending Doctrine":"bg-orange-500/15 border-orange-400 text-orange-300",Experimental:"bg-red-500/15 border-red-400 text-red-300"};return g.jsx("span",{className:`inline-flex items-center rounded-full border px-2.5 py-1 text-xs ${e[n]}`,children:n})}function gs({name:n,mission:e,status:t}){return g.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-950/40 p-6",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:n}),g.jsx(im,{status:t})]}),g.jsx("p",{className:"mt-3 text-sm text-slate-400",children:e})]})}function gL(){return g.jsx("div",{className:"min-h-screen bg-slate-950 text-slate-100 px-6 py-16",children:g.jsxs("div",{className:"max-w-6xl mx-auto space-y-12",children:[g.jsxs("div",{children:[g.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"HomePlanet System Registry"}),g.jsx("p",{className:"mt-3 text-slate-400 max-w-2xl",children:"Structured planetary architecture. Core engines, live cities, and locked category systems."})]}),g.jsxs("section",{children:[g.jsx("h2",{className:"text-xl font-semibold mb-6",children:"Core Planets"}),g.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[g.jsx(gs,{name:"Invention Planet",mission:"Capture origin, preserve structure, prepare for licensing.",status:"Structured"}),g.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-950/40 p-6",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"MLS  Parenting Signal Infrastructure"}),g.jsx(im,{status:"Structured"})]}),g.jsx("p",{className:"mt-3 text-sm text-slate-400",children:"Origin Concept: Chelsea Rule  Captured: October 2025 (approx.)"}),g.jsx(ri,{to:"/mls",className:"inline-block mt-4 text-sm text-sky-400 hover:underline",children:"View Concept "})]}),g.jsx(gs,{name:"Civic / Proof Infrastructure",mission:"Convert real-world submissions into timestamped, dispute-resistant records.",status:"Live"}),g.jsx(gs,{name:"Physical Goods Provenance",mission:"Track physical products from retail to regulator.",status:"Concept Locked"}),g.jsx(gs,{name:"Workforce Presence Theater",mission:"Live operational visibility for workplaces.",status:"Concept Locked"}),g.jsx(gs,{name:"Education Planet",mission:"Presence-first classrooms and verifiable submissions.",status:"Concept Locked"}),g.jsx(gs,{name:"Safety / PredatorShield",mission:"Structured protection and evidence preservation.",status:"Pending Doctrine"})]})]}),g.jsxs("section",{children:[g.jsx("h2",{className:"text-xl font-semibold mb-6",children:"Active City Nodes"}),g.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:g.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-950/40 p-6",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("h3",{className:"text-lg font-semibold",children:"Taylor Creek Auto Repair"}),g.jsx(im,{status:"Live"})]}),g.jsx("p",{className:"mt-3 text-sm text-slate-400",children:"Gold Tier Local Service Provenance pilot node."}),g.jsx(ri,{to:"/taylor-creek",className:"inline-block mt-4 text-sm text-sky-400 hover:underline",children:"View City "})]})})]})]})})}function vL(){return g.jsx("div",{style:{minHeight:"100vh",background:"#060916",color:"#EAF0FF",padding:"28px",fontFamily:"system-ui, -apple-system, Segoe UI, Roboto, sans-serif"},children:g.jsxs("div",{style:{maxWidth:720,margin:"0 auto"},children:[g.jsx("div",{style:{opacity:.8,fontSize:14,marginBottom:10},children:"Invention Planet  Origin Concept: Chelsea Rule"}),g.jsx("h1",{style:{fontSize:42,lineHeight:1.05,margin:"0 0 12px 0"},children:"MLS"}),g.jsx("h2",{style:{fontSize:22,fontWeight:600,margin:"0 0 18px 0",opacity:.9},children:"Parenting Signal Infrastructure"}),g.jsx("div",{style:{fontSize:16,opacity:.85,lineHeight:1.5,marginBottom:22},children:"A wearable-linked concept for behavioral awareness + calm guidance  pattern visibility, not control. This is a concept page to preserve origin and show the vision."}),g.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",marginBottom:18},children:[g.jsx("a",{href:"/planets",style:{padding:"12px 16px",borderRadius:14,background:"#1E2A5E",color:"#fff",textDecoration:"none",fontWeight:700},children:"Go to Planets Registry "}),g.jsx("a",{href:"/",style:{padding:"12px 16px",borderRadius:14,border:"1px solid rgba(255,255,255,.18)",color:"#EAF0FF",textDecoration:"none",fontWeight:700},children:"Home "})]}),g.jsx("div",{style:{opacity:.55,fontSize:13},children:"Note: This page is intentionally minimal to guarantee stability on mobile while we polish the full MLS layout."})]})})}function yL(){const n=Qt(),[e]=uk(),t=(e.get("slug")||"taylor-creek").trim(),i=()=>n(`/c/${encodeURIComponent(t)}`);return g.jsx("div",{style:{minHeight:"100vh",background:"#05070d",color:"#e5e7eb",padding:"24px",fontFamily:'ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"'},children:g.jsxs("div",{style:{maxWidth:980,margin:"0 auto"},children:[g.jsxs("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between",gap:16},children:[g.jsxs("div",{children:[g.jsx("div",{style:{fontSize:22,fontWeight:900},children:" Taylor Creek Auto Repair"}),g.jsx("div",{style:{opacity:.8,marginTop:4},children:"Powered by HomePlanet"})]}),g.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",justifyContent:"flex-end"},children:[g.jsx("a",{href:"#demo",style:eu,children:"Demo"}),g.jsx("a",{href:"#downloads",style:eu,children:"Downloads"}),g.jsx("a",{href:"#gov",style:eu,children:"Government"}),g.jsx("a",{href:"#press",style:eu,children:"Press"})]})]}),g.jsxs("div",{style:Wo,children:[g.jsx("div",{style:{fontSize:13,opacity:.85,letterSpacing:.4},children:"PRESS KIT"}),g.jsx("div",{style:{fontSize:28,fontWeight:950,marginTop:8,lineHeight:1.15},children:"Public Proof Infrastructure for Real-World Submissions"}),g.jsx("div",{style:{marginTop:10,lineHeight:1.55,opacity:.92},children:"A live auto repair shop issuing receipts, timestamps, public lookups, and preserved PDF proof records  before disputes begin."}),g.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",marginTop:14},children:[g.jsx("span",{style:ca,children:"Receipt issued instantly"}),g.jsx("span",{style:ca,children:"Timestamped record"}),g.jsx("span",{style:ca,children:"Public lookup"}),g.jsx("span",{style:ca,children:"Downloadable PDF"})]}),g.jsxs("div",{style:{marginTop:14,opacity:.9},children:[g.jsx("div",{style:{fontWeight:900,fontSize:13,letterSpacing:.4,opacity:.85},children:"TRUSTED FOR"}),g.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:8,marginTop:8},children:[g.jsx("span",{style:Kn,children:"inspectors"}),g.jsx("span",{style:Kn,children:"courts"}),g.jsx("span",{style:Kn,children:"municipalities"}),g.jsx("span",{style:Kn,children:"contractors"}),g.jsx("span",{style:Kn,children:"schools"})]})]}),g.jsxs("div",{id:"demo",style:{display:"flex",gap:12,flexWrap:"wrap",marginTop:18},children:[g.jsx("button",{type:"button",onClick:i,style:bL,children:"Run 60-Second Demo "}),g.jsx("button",{type:"button",onClick:i,style:Er,children:"Submit Request"}),g.jsx("a",{href:"/assets/press/taylor-creek/sample-receipt.pdf",style:Er,children:"Download Sample PDF"}),g.jsx(ri,{to:"/live/taylor-creek",style:Er,children:"Open Live Demo (optional)"})]}),g.jsxs("div",{style:{marginTop:10,fontSize:12,opacity:.75},children:["Using slug: ",g.jsx("code",{style:CT,children:t})," (set via ",g.jsx("code",{style:CT,children:"?slug=YOURSLUG"}),")"]})]}),g.jsxs("div",{style:Wo,children:[g.jsx("div",{style:{fontSize:18,fontWeight:900},children:"The 60-Second Demo Flow"}),g.jsxs("ol",{style:{marginTop:10,lineHeight:1.7,opacity:.92},children:[g.jsx("li",{children:"Scan QR"}),g.jsx("li",{children:"Submit"}),g.jsx("li",{children:"Get Receipt"}),g.jsx("li",{children:"Open Lookup"}),g.jsx("li",{children:"See Timestamp"}),g.jsx("li",{children:"Download PDF"})]})]}),g.jsxs("div",{id:"gov",style:Wo,children:[g.jsx("div",{style:{fontSize:18,fontWeight:900},children:"Government & Court Mode"}),g.jsx("div",{style:{marginTop:10,lineHeight:1.55,opacity:.92},children:"Same system. Different headline. Built for inspections, reporting, and chain-of-custody records."}),g.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:10,marginTop:12},children:[g.jsx("span",{style:ca,children:"Public Submissions, Verified"}),g.jsx("span",{style:ca,children:"Chain of Custody for Communities"}),g.jsx("span",{style:ca,children:"Receipts for Reality"})]}),g.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:8,marginTop:12,opacity:.9},children:[g.jsx("span",{style:Kn,children:"code enforcement intake"}),g.jsx("span",{style:Kn,children:"inspections"}),g.jsx("span",{style:Kn,children:"citizen reports"}),g.jsx("span",{style:Kn,children:"permit intake"}),g.jsx("span",{style:Kn,children:"incident logs"}),g.jsx("span",{style:Kn,children:"school submissions"})]})]}),g.jsxs("div",{id:"downloads",style:Wo,children:[g.jsx("div",{style:{fontSize:18,fontWeight:900},children:"Downloads"}),g.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",marginTop:12},children:[g.jsx("a",{href:"/assets/press/taylor-creek/one-pager.pdf",style:Er,children:"One-Pager PDF"}),g.jsx("a",{href:"/assets/press/taylor-creek/flow-diagram.pdf",style:Er,children:"Flow Diagram PDF"}),g.jsx("a",{href:"/assets/press/taylor-creek/sample-receipt.pdf",style:Er,children:"Sample Receipt PDF"})]})]}),g.jsxs("div",{id:"press",style:Wo,children:[g.jsx("div",{style:{fontSize:18,fontWeight:900},children:"Press Release"}),g.jsx("div",{style:{marginTop:10,whiteSpace:"pre-wrap",lineHeight:1.55,opacity:.95},children:"FOR IMMEDIATE RELEASE Local Auto Repair Shop Launches Public Proof System for Service Requests and Receipts Okeechobee, FL  February 10, 2026 Taylor Creek Auto Repair has launched a public-facing system that allows customers, inspectors, and reporters to submit service requests, receive instant receipts, and download timestamped PDF recordsbefore any work begins. Using a QR code posted at the shop or on its website, customers can submit a service request in seconds. They immediately receive a receipt ID, can look up their submission on a public page, and download a preserved PDF snapshot showing exactly what was submitted and when. This isnt marketing. Its documentation. The public demo is live now:  Service intake: /c/[slug]  Receipt lookup: /r/[receipt-id]  Press kit: /press/taylor-creek Media Contact: press@homeplanet.city"}),g.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",marginTop:16},children:[g.jsx("a",{href:"mailto:press@homeplanet.city",style:Er,children:"Email Press"}),g.jsx("button",{type:"button",onClick:i,style:Er,children:"Submit Request"})]})]}),g.jsxs("div",{style:{opacity:.72,fontSize:12,marginTop:18,display:"flex",gap:10,flexWrap:"wrap"},children:[g.jsx("span",{children:" HomePlanet  Public Proof Infrastructure"}),g.jsx("span",{children:""}),g.jsx("span",{children:"Receipts  Timestamping  Chain-of-Custody  Records"}),g.jsx("span",{children:""}),g.jsx("a",{href:"#demo",style:tu,children:"Demo"}),g.jsx("a",{href:"#downloads",style:tu,children:"Downloads"}),g.jsx("a",{href:"#gov",style:tu,children:"Government"}),g.jsx("a",{href:"#press",style:tu,children:"Press"})]})]})})}const Wo={marginTop:16,background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.10)",borderRadius:16,padding:18,boxShadow:"0 8px 30px rgba(0,0,0,0.35)"},ca={fontSize:12,padding:"6px 10px",borderRadius:999,background:"rgba(56,189,248,0.12)",border:"1px solid rgba(56,189,248,0.25)",color:"#7dd3fc",fontWeight:900},Kn={fontSize:12,padding:"6px 10px",borderRadius:999,background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",color:"#e5e7eb",fontWeight:800},bL={background:"#38bdf8",color:"#021018",border:"none",borderRadius:12,padding:"10px 14px",fontWeight:950,cursor:"pointer"},Er={background:"rgba(255,255,255,0.06)",color:"#e5e7eb",border:"1px solid rgba(255,255,255,0.14)",borderRadius:12,padding:"10px 14px",fontWeight:900,textDecoration:"none",display:"inline-block",cursor:"pointer"},eu={color:"#93c5fd",textDecoration:"underline",textUnderlineOffset:3,fontWeight:900},tu={color:"#93c5fd",textDecoration:"underline",textUnderlineOffset:3,fontWeight:800},CT={background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",padding:"2px 6px",borderRadius:8};function SL(){return g.jsxs("div",{className:"min-h-screen bg-slate-950 text-slate-100",children:[g.jsx("div",{className:"border-b border-slate-800 bg-slate-950/70 backdrop-blur",children:g.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-4 flex items-center justify-between gap-3",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"h-10 w-10 rounded-xl bg-slate-800 flex items-center justify-center font-bold",children:"TC"}),g.jsxs("div",{children:[g.jsxs("div",{className:"text-lg font-semibold leading-tight flex items-center gap-2",children:[g.jsx("span",{"aria-hidden":!0,children:""}),g.jsx("span",{children:"Taylor Creek Auto Repair"}),g.jsxs("span",{className:"hidden sm:inline-flex items-center gap-2 rounded-full border border-slate-700 bg-slate-950/50 px-2.5 py-1 text-[11px] text-slate-200",children:[g.jsx("span",{className:"inline-block h-1.5 w-1.5 rounded-full bg-sky-300/80"}),"Planet: Auto Services"]})]}),g.jsx("div",{className:"text-xs text-slate-400 leading-tight",children:"Okeechobee, Florida  HomePlanet Verified Node"})]})]}),g.jsxs("div",{className:"hidden sm:flex items-center gap-2 rounded-full border border-amber-400/60 bg-amber-400/10 px-3 py-1",children:[g.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-amber-300"}),g.jsx("span",{className:"text-xs font-medium text-amber-200",children:"Gold Tier  Public Proof Enabled"})]})]})}),g.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-12 space-y-10",children:[g.jsx("section",{className:"rounded-3xl border border-slate-800 bg-slate-900/30 p-6 md:p-10 shadow",children:g.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-slate-800 bg-slate-950/45",children:[g.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute -left-24 -top-24 h-[520px] w-[520px] rounded-full blur-3xl opacity-20",style:{background:"radial-gradient(circle at 30% 30%, rgba(56,189,248,0.9), rgba(56,189,248,0.0) 55%)"}}),g.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute -right-32 -bottom-32 h-[560px] w-[560px] rounded-full blur-3xl opacity-15",style:{background:"radial-gradient(circle at 70% 70%, rgba(239,68,68,0.9), rgba(239,68,68,0.0) 60%)"}}),g.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute inset-0 opacity-[0.06]",style:{backgroundImage:"repeating-linear-gradient(90deg, rgba(255,255,255,0.10) 0px, rgba(255,255,255,0.10) 1px, rgba(0,0,0,0) 2px, rgba(0,0,0,0) 6px), repeating-linear-gradient(0deg, rgba(255,255,255,0.05) 0px, rgba(255,255,255,0.05) 1px, rgba(0,0,0,0) 2px, rgba(0,0,0,0) 10px)"}}),g.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute inset-0 opacity-60",style:{background:"radial-gradient(circle at 50% 35%, rgba(0,0,0,0) 0%, rgba(0,0,0,0.55) 75%, rgba(0,0,0,0.85) 100%)"}}),g.jsx("div",{className:"relative p-6 md:p-10",children:g.jsxs("div",{className:"grid md:grid-cols-[1fr_360px] gap-10",children:[g.jsxs("div",{children:[g.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:["Receipt-ready","Timestamped","Verified intake","Public lookup"].map(n=>g.jsx("span",{className:"inline-flex items-center rounded-full border border-slate-700 bg-slate-950/50 px-3 py-1 text-[11px] text-slate-200",children:n},n))}),g.jsxs("h1",{className:"text-3xl md:text-4xl font-bold tracking-tight",children:["Honest repairs. Clear communication."," ",g.jsx("span",{className:"block mt-1 text-red-500",children:"Receipt-ready proof."})]}),g.jsx("p",{className:"mt-4 text-slate-300 max-w-2xl",children:"Submit a service request in under a minute. Add a photo if needed. Youll get a receipt ID and a clean, time-ordered intake record you can reference later."}),g.jsxs("div",{className:"mt-7 flex flex-wrap gap-3",children:[g.jsx(ri,{to:"/c/taylor-creek",className:"inline-flex items-center justify-center rounded-xl bg-red-600 px-6 py-3 font-semibold hover:bg-red-500 transition shadow-sm",children:"Start a service request"}),g.jsx("a",{href:"tel:+10000000000",className:"inline-flex items-center justify-center rounded-xl border border-slate-700 bg-slate-950/40 px-6 py-3 font-semibold hover:bg-slate-900 transition",children:"Call the shop"}),g.jsx("a",{href:"https://www.google.com/maps/search/?api=1&query=Taylor+Creek+Auto+Repair+Okeechobee+FL",target:"_blank",rel:"noreferrer",className:"inline-flex items-center justify-center rounded-xl border border-slate-700 bg-slate-950/40 px-6 py-3 font-semibold hover:bg-slate-900 transition",children:"Get directions"})]}),g.jsx("div",{className:"mt-5 text-xs text-slate-500",children:"Powered by HomePlanet  Presence-First Intake  Receipt + record at submission (not after)."}),g.jsxs("div",{className:"mt-6 rounded-2xl border border-slate-800 bg-slate-950/40 px-4 py-3 text-sm text-slate-200 flex items-start gap-3",children:[g.jsx("span",{className:"mt-2 inline-block h-2 w-2 rounded-full bg-sky-300/80"}),g.jsxs("div",{children:[g.jsx("span",{className:"font-semibold",children:"Presence-First:"})," ","your request is anchored at submission  before edits, confusion, or we never got it."]})]})]}),g.jsxs("aside",{className:"space-y-4",children:[g.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-950/45 p-5",children:[g.jsx("div",{className:"text-xs tracking-wider text-slate-400 font-semibold",children:"OPERATING HOURS"}),g.jsxs("div",{className:"mt-3 space-y-1 text-sm text-slate-300",children:[g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"MonFri"}),g.jsx("span",{children:"8:00am  5:00pm"})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"Saturday"}),g.jsx("span",{children:"By appointment"})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"Sunday"}),g.jsx("span",{children:"Closed"})]})]}),g.jsxs("div",{className:"mt-4 border-t border-slate-800 pt-4",children:[g.jsx("div",{className:"text-xs tracking-wider text-slate-400 font-semibold",children:"NODE CONTACT"}),g.jsxs("div",{className:"mt-2 text-sm text-slate-300 space-y-1",children:[g.jsx("div",{children:"Phone: (000) 000-0000"}),g.jsx("div",{children:"Address: Okeechobee, FL"})]}),g.jsx("div",{className:"mt-3 text-xs text-slate-500",children:"Safe placeholders  swap with real details anytime."})]})]}),g.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-950/45 p-5",children:[g.jsx("div",{className:"text-sm font-semibold text-slate-200",children:"Proof-ready workflow"}),g.jsx("p",{className:"mt-2 text-sm text-slate-300",children:"Photos + notes become a single, time-ordered record. Cleaner approvals. Fewer disputes. Easier follow-ups."})]})]})]})})]})}),g.jsxs("section",{className:"grid md:grid-cols-3 gap-5",children:[g.jsxs("div",{className:"relative rounded-2xl border border-slate-800 bg-slate-950/45 p-6 overflow-hidden",children:[g.jsx("div",{"aria-hidden":!0,className:"absolute left-0 top-0 h-full w-[2px]",style:{background:"linear-gradient(to bottom, rgba(239,68,68,0.0), rgba(239,68,68,0.8), rgba(239,68,68,0.0))"}}),g.jsx("div",{className:"text-sm font-semibold",children:"Submit  Receipt  PDF"}),g.jsx("p",{className:"mt-2 text-sm text-slate-300",children:"Every intake becomes a time-anchored proof trail the moment it lands."})]}),g.jsxs("div",{className:"relative rounded-2xl border border-slate-800 bg-slate-950/45 p-6 overflow-hidden",children:[g.jsx("div",{"aria-hidden":!0,className:"absolute left-0 top-0 h-full w-[2px]",style:{background:"linear-gradient(to bottom, rgba(56,189,248,0.0), rgba(56,189,248,0.85), rgba(56,189,248,0.0))"}}),g.jsx("div",{className:"text-sm font-semibold",children:"Public Lookup Enabled"}),g.jsx("p",{className:"mt-2 text-sm text-slate-300",children:"Customers and managers can reference records instantly when needed."})]}),g.jsxs("div",{className:"relative rounded-2xl border border-slate-800 bg-slate-950/45 p-6 overflow-hidden",children:[g.jsx("div",{"aria-hidden":!0,className:"absolute left-0 top-0 h-full w-[2px]",style:{background:"linear-gradient(to bottom, rgba(251,191,36,0.0), rgba(251,191,36,0.85), rgba(251,191,36,0.0))"}}),g.jsx("div",{className:"text-sm font-semibold",children:"Gold Tier Node"}),g.jsx("p",{className:"mt-2 text-sm text-slate-300",children:"Enhanced verification for high-trust operations (visual layer for now)."})]})]}),g.jsx("section",{className:"grid md:grid-cols-3 gap-5",children:[["Diagnostics","No guessing. Findings documented before work begins."],["Brakes & Suspension","Safety-critical systems handled with clear notes and verification."],["Maintenance","Oil, fluids, inspections, and longevity care."]].map(([n,e])=>g.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-950/45 p-6",children:[g.jsx("div",{className:"text-sm font-semibold",children:n}),g.jsx("p",{className:"mt-2 text-sm text-slate-300",children:e})]},n))}),g.jsxs("footer",{className:"mt-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 text-xs text-slate-500 border-t border-slate-900 pt-6",children:[g.jsxs("div",{children:[" ",new Date().getFullYear()," Taylor Creek Auto Repair"]}),g.jsxs("nav",{className:"flex gap-4",children:[g.jsx(ri,{to:"/c/taylor-creek",className:"hover:text-slate-300",children:"Start request"}),g.jsx(ri,{to:"/press/taylor-creek",className:"hover:text-slate-300",children:"Press kit"})]})]})]})]})}function TL(){return g.jsx(j2,{children:g.jsxs(s2,{children:[g.jsx(Ze,{path:"/c/:slug",element:g.jsx(oL,{})}),g.jsx(Ze,{path:"/r/:receipt",element:g.jsx(cL,{})}),g.jsx(Ze,{path:"/authorize/:receipt",element:g.jsx(fL,{})}),g.jsx(Ze,{path:"/press/taylor-creek",element:g.jsx(yL,{})}),g.jsxs(Ze,{element:g.jsx(H2,{}),children:[g.jsx(Ze,{path:"/login",element:g.jsx(TO,{})}),g.jsx(Ze,{path:"/signup",element:g.jsx(kO,{})}),g.jsx(Ze,{path:"/reset-password",element:g.jsx(wO,{})}),g.jsx(Ze,{path:"/forgot",element:g.jsx(Sp,{to:"/reset-password",replace:!0})}),g.jsx(Ze,{path:"/live/:room",element:g.jsx(XI,{})}),g.jsx(Ze,{path:"/",element:g.jsx(mL,{})}),g.jsx(Ze,{path:"/explorer",element:g.jsx(pL,{})}),g.jsx(Ze,{path:"/core/doctrine",element:g.jsx(Yb,{title:"Doctrine",body:"HomePlanet doctrine lives here. Next: render the canonical doctrine + excerpts."})}),g.jsx(Ze,{path:"/core/binder",element:g.jsx(Yb,{title:"Binder Map",body:"HomePlanet binder map lives here. Next: show volumes + quick links."})}),g.jsx(Ze,{path:"/planet/creator/release/:releaseId",element:g.jsx(ms,{children:g.jsx(SO,{})})}),g.jsx(Ze,{path:"/planet/:planetId",element:g.jsx(ms,{children:g.jsx(uO,{})})}),g.jsx(Ze,{path:"/planet/creator/projects",element:g.jsx(ms,{children:g.jsx(hO,{})})}),g.jsx(Ze,{path:"/planet/creator/build",element:g.jsx(ms,{children:g.jsx(bO,{})})}),g.jsx(Ze,{path:"/planet/:planetId/:cityId",element:g.jsx(ms,{children:g.jsx(dO,{})})}),g.jsx(Ze,{path:"/planet/creator/live",element:g.jsx(ms,{children:g.jsx(JI,{})})})]}),g.jsx(Ze,{path:"/planet/creator/studio",element:g.jsx(Wb,{})}),g.jsx(Ze,{path:"/planet/creator/studio/:mode",element:g.jsx(Wb,{})}),g.jsx(Ze,{path:"/taylor-creek",element:g.jsx(SL,{})}),g.jsx(Ze,{path:"/planets",element:g.jsx(gL,{})}),g.jsx(Ze,{path:"/mls",element:g.jsx(vL,{})}),g.jsx(Ze,{path:"*",element:g.jsx(Sp,{to:"/",replace:!0})})]})})}sR.createRoot(document.getElementById("root")).render(g.jsx(Go.StrictMode,{children:g.jsx(X5,{children:g.jsx(TL,{})})}));
